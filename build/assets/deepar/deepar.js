!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.DeepAR=t():e.DeepAR=t()}(self,(()=>(()=>{var e={683:()=>{},345:()=>{}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";n.d(r,{DeepAR:()=>Vb});var e=function(){return e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},e.apply(this,arguments)};function t(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function i(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}function o(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}var s=function(){function e(e,t,n){this.NB_BUFFERS=5,this._videoFrames=[],this._nbFramesDelay=0,this._videoElement=e,this._videoCanvas=document.createElement("canvas"),this._videoCanvas.style.display="none",this._videoCanvasContext=this._videoCanvas.getContext("2d"),null!=t&&(this._videoCanvas.width=t),null!=n&&(this._videoCanvas.height=n)}return e.prototype.getNbFramesDelay=function(){return this._nbFramesDelay},e.prototype.setNbFramesDelay=function(e){e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=e:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS)},e.prototype.getVideoCanvas=function(){return this._videoCanvas},e.prototype.compare=function(e,t,n,r){var a=!0;return[1,50,100,1e3,2e3,3e3,5e3,9e3].forEach((function(o){o<n*r*3&&e.data[o]!=t.data[o]&&(a=!1)})),a},e.prototype.preProcessWithBuffer=function(e){for(var t=0;t<this._videoFrames.length;t++)if(this.compare(this._videoFrames[t],e,this._videoCanvas.width,this._videoCanvas.height))return!1;return this._videoFrames.length===this.NB_BUFFERS&&(this._videoFrames=this._videoFrames.slice(0,-1)),this._videoFrames=o([e],this._videoFrames,!0),!0},e.prototype.preProcess=function(){if(null==this._videoElement||0===this._videoElement.videoWidth||0===this._videoElement.videoHeight)return!1;this._videoCanvas.width===this._videoElement.videoWidth&&this._videoCanvas.height===this._videoElement.videoHeight||(this._videoFrames=[],this._videoCanvas.width=this._videoElement.videoWidth,this._videoCanvas.height=this._videoElement.videoHeight),this._videoCanvasContext.drawImage(this._videoElement,0,0,this._videoCanvas.width,this._videoCanvas.height);for(var e=this._videoCanvasContext.getImageData(0,0,this._videoCanvas.width,this._videoCanvas.height),t=0;t<this._videoFrames.length;t++)if(this.compare(this._videoFrames[t],e,this._videoCanvas.width,this._videoCanvas.height))return!1;return this._videoFrames.length===this.NB_BUFFERS&&(this._videoFrames=this._videoFrames.slice(0,-1)),this._videoFrames=o([e],this._videoFrames,!0),!0},e.prototype.postProcess=function(){if(this._nbFramesDelay>0&&this._videoFrames.length>0){var e=this._nbFramesDelay<this._videoFrames.length?this._videoFrames[this._nbFramesDelay]:this._videoFrames[this._videoFrames.length-1];this._videoCanvasContext.putImageData(e,0,0)}},e.prototype.getCameraFrame=function(){if(this._nbFramesDelay>0&&this._videoFrames.length>0)return this._nbFramesDelay<this._videoFrames.length?this._videoFrames[this._nbFramesDelay]:this._videoFrames[this._videoFrames.length-1]},e.prototype.updateDelay=function(e){e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=e:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS)},e.prototype.getLastBuffer=function(){return this._videoFrames.length>0?this._videoFrames[0]:null},e.prototype.setOverlapingImage=function(e){this._videoCanvasContext.putImageData(e,10,10)},e}(),i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)};function u(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function l(e){return"function"==typeof e}var c=!1,h={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,c=e},get useDeprecatedSynchronousErrorHandling(){return c}};function p(e){setTimeout((function(){throw e}),0)}var f={closed:!0,next:function(e){},error:function(e){if(h.useDeprecatedSynchronousErrorHandling)throw e;p(e)},complete:function(){}},d=Array.isArray||function(e){return e&&"number"==typeof e.length};function m(e){return null!==e&&"object"==typeof e}var g=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),y=g,b=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,r=n._parentOrParents,a=n._ctorUnsubscribe,o=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var i=0;i<r.length;++i)r[i].remove(this);if(l(o)){a&&(this._unsubscribe=void 0);try{o.call(this)}catch(e){t=e instanceof y?v(e.errors):[e]}}if(d(s)){i=-1;for(var u=s.length;++i<u;){var c=s[i];if(m(c))try{c.unsubscribe()}catch(e){t=t||[],e instanceof y?t=t.concat(v(e.errors)):t.push(e)}}}if(t)throw new y(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function v(e){return e.reduce((function(e,t){return e.concat(t instanceof y?t.errors:t)}),[])}var x="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),w=function(e){function t(n,r,a){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=f;break;case 1:if(!n){o.destination=f;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new _(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new _(o,n,r,a)}return o}return u(t,e),t.prototype[x]=function(){return this},t.create=function(e,n,r){var a=new t(e,n,r);return a.syncErrorThrowable=!1,a},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(b),_=function(e){function t(t,n,r,a){var o,s=e.call(this)||this;s._parentSubscriber=t;var i=s;return l(n)?o=n:n&&(o=n.next,r=n.error,a=n.complete,n!==f&&(l((i=Object.create(n)).unsubscribe)&&s.add(i.unsubscribe.bind(i)),i.unsubscribe=s.unsubscribe.bind(s))),s._context=i,s._next=o,s._error=r,s._complete=a,s}return u(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;h.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=h.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):p(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;p(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};h.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),h.useDeprecatedSynchronousErrorHandling)throw e;p(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!h.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return h.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(p(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(w),T="function"==typeof Symbol&&Symbol.observable||"@@observable";function E(e){return e}function S(e){return 0===e.length?E:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var I=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,a=function(e,t,n){if(e){if(e instanceof w)return e;if(e[x])return e[x]()}return e||t||n?new w(e,t,n):new w(f)}(e,t,n);if(r?a.add(r.call(a,this.source)):a.add(this.source||h.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),h.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){h.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,a=t.isStopped;if(n||a)return!1;e=r&&r instanceof w?r:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=k(t))((function(t,r){var a;a=n.subscribe((function(t){try{e(t)}catch(e){r(e),a&&a.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[T]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:S(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=k(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function k(e){if(e||(e=h.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var C=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},N="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",A=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function $(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var R=function(e){if(e&&"function"==typeof e[T])return r=e,function(e){var t=r[T]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(A(e))return C(e);if($(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,p),e};if(e&&"function"==typeof e[N])return t=e,function(e){for(var n=t[N]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,a=m(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+a+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},F=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return u(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(w),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(w);function D(e){return e&&"function"==typeof e.schedule}var M=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parent=t,a.outerValue=n,a.outerIndex=r,a.index=0,a}return u(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(w);function L(e,t,n,r,a){if(void 0===a&&(a=new M(e,n,r)),!a.closed)return t instanceof I?t.subscribe(a):R(t)(a)}var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.notifyNext=function(e,t,n,r,a){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(w);function B(e,t){return new I((function(n){var r=new b,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function U(e,t){return t?B(e,t):new I(C(e))}var z={};function V(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return D(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&d(e[0])&&(e=e[0]),U(e,r).lift(new W(n))}var W=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new j(e,this.resultSelector))},e}(),j=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return u(t,e),t.prototype._next=function(e){this.values.push(z),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(L(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,a=r[n],o=this.toRespond?a===z?--this.toRespond:this.toRespond:0;r[n]=t,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(P);function G(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[T]}(e))return function(e,t){return new I((function(n){var r=new b;return r.add(t.schedule((function(){var a=e[T]();r.add(a.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if($(e))return function(e,t){return new I((function(n){var r=new b;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(A(e))return B(e,t);if(function(e){return e&&"function"==typeof e[N]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new I((function(n){var r,a=new b;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(t.schedule((function(){r=e[N](),a.add(t.schedule((function(){if(!n.closed){var e,t;try{var a=r.next();e=a.value,t=a.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),a}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof I?e:new I(R(e))}function H(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return D(n)?(e.pop(),B(e,n)):U(e)}function K(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new q(e,t))}}var q=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new X(e,this.project,this.thisArg))},e}(),X=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.project=n,a.count=0,a.thisArg=r||a,a}return u(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(w),Y=new I((function(e){return e.complete()}));function Q(e,t){return new I(t?function(n){return t.schedule(J,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function J(e){var t=e.error;e.subscriber.error(t)}function Z(e){return function(t){return t.lift(new ee(e))}}var ee=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new te(e,this.callback))},e}(),te=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new b(n)),r}return u(t,e),t}(w),ne=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),re=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return u(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(b),ae=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return u(t,e),t}(w),oe=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return u(t,e),t.prototype[x]=function(){return new ae(this)},t.prototype.lift=function(e){var t=new se(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new ne;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].next(e)},t.prototype.error=function(e){if(this.closed)throw new ne;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new ne;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new ne;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new ne;return this.hasError?(e.error(this.thrownError),b.EMPTY):this.isStopped?(e.complete(),b.EMPTY):(this.observers.push(e),new re(this,e))},t.prototype.asObservable=function(){var e=new I;return e.source=this,e},t.create=function(e,t){return new se(e,t)},t}(I),se=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return u(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):b.EMPTY},t}(oe),ie=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return u(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ne;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(oe);function ue(e){return void 0===e&&(e=-1),function(t){return t.lift(new le(e,t))}}var le=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.count,this.source))},e}(),ce=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.count=n,a.source=r,a}return u(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(w);function he(e,t){return"function"==typeof t?function(n){return n.pipe(he((function(n,r){return G(e(n,r)).pipe(K((function(e,a){return t(n,e,r,a)})))})))}:function(t){return t.lift(new pe(e))}}var pe=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new fe(e,this.project))},e}(),fe=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return u(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new F(this),r=this.destination;r.add(n),this.innerSubscription=function(e,t){if(!t.closed){if(e instanceof I)return e.subscribe(t);var n;try{n=R(e)(t)}catch(e){t.error(e)}return n}}(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(O);function de(){}var me=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new ge(e,this.nextOrObserver,this.error,this.complete))},e}(),ge=function(e){function t(t,n,r,a){var o=e.call(this,t)||this;return o._tapNext=de,o._tapError=de,o._tapComplete=de,o._tapError=r||de,o._tapComplete=a||de,l(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||de,o._tapError=n.error||de,o._tapComplete=n.complete||de),o}return u(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(w);function ye(e){return new I((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?G(n):Y).subscribe(t)}))}var be=void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function ve(){throw new Error("setTimeout has not been defined")}function xe(){throw new Error("clearTimeout has not been defined")}var we=ve,_e=xe;function Te(e){if(we===setTimeout)return setTimeout(e,0);if((we===ve||!we)&&setTimeout)return we=setTimeout,setTimeout(e,0);try{return we(e,0)}catch(t){try{return we.call(null,e,0)}catch(t){return we.call(this,e,0)}}}"function"==typeof be.setTimeout&&(we=setTimeout),"function"==typeof be.clearTimeout&&(_e=clearTimeout);var Ee,Se=[],Ie=!1,ke=-1;function Ce(){Ie&&Ee&&(Ie=!1,Ee.length?Se=Ee.concat(Se):ke=-1,Se.length&&Ne())}function Ne(){if(!Ie){var e=Te(Ce);Ie=!0;for(var t=Se.length;t;){for(Ee=Se,Se=[];++ke<t;)Ee&&Ee[ke].run();ke=-1,t=Se.length}Ee=null,Ie=!1,function(e){if(_e===clearTimeout)return clearTimeout(e);if((_e===xe||!_e)&&clearTimeout)return _e=clearTimeout,clearTimeout(e);try{_e(e)}catch(t){try{return _e.call(null,e)}catch(t){return _e.call(this,e)}}}(e)}}function Ae(e,t){this.fun=e,this.array=t}function $e(){}Ae.prototype.run=function(){this.fun.apply(null,this.array)};var Re=$e,Fe=$e,Oe=$e,De=$e,Me=$e,Le=$e,Pe=$e,Be=be.performance||{},Ue=Be.now||Be.mozNow||Be.msNow||Be.oNow||Be.webkitNow||function(){return(new Date).getTime()},ze=new Date,Ve={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Se.push(new Ae(e,t)),1!==Se.length||Ie||Te(Ne)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Re,addListener:Fe,once:Oe,off:De,removeListener:Me,removeAllListeners:Le,emit:Pe,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*Ue.call(Be),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-ze)/1e3}},We=Ve;class je{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Ge{refCount(e){return He("refCount")}incRef(e){return He("incRef")}timerAvailable(){return!0}time(e){return He("time")}read(e){return He("read")}readSync(e){return He("readSync")}readToGPU(e,t){return He("readToGPU")}numDataIds(){return He("numDataIds")}disposeData(e,t){return He("disposeData")}write(e,t,n){return He("write")}move(e,t,n,r,a){return He("move")}memory(){return He("memory")}floatPrecision(){return He("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return He("dispose")}}function He(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function Ke(e,t,n){return Math.max(e,Math.min(t,n))}function qe(e){return e%2==0?e:e+1}function Xe(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Ye(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Qe(e,t,n=""){Ye(tt(e,t),(()=>n+` Shapes ${e} and ${t} must match`))}function Je(e){Ye(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function Ze(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||pt(e)&&!n)for(let r=0;r<e.length;++r)Ze(e[r],t,n);else t.push(e);return t}function et(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function tt(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function nt(e){return e%1==0}function rt(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function at(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ot(e,t=(e=>0),n){return new Promise(((r,a)=>{let o=0;const s=()=>{if(e())return void r();o++;const i=t(o);null!=n&&o>=n?a():setTimeout(s,i)};s()}))}function st(e,t){let n=1,r=-1;for(let t=0;t<e.length;++t)if(e[t]>=0)n*=e[t];else if(-1===e[t]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${t}`);r=t}else if(e[t]<0)throw Error(`Shapes can not be < 0. Found ${e[t]} at dim ${t}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const a=e.slice();return a[r]=t/n,a}function it(e,t){const n=t.length;return Ye((e=null==e?t.map(((e,t)=>t)):[].concat(e)).every((e=>e>=-n&&e<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`)),Ye(e.every((e=>nt(e))),(()=>`All values in axis param must be integers but got axis ${e}`)),e.map((e=>e<0?n+e:e))}function ut(e,t){const n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||a?null:it(t,e).sort();let s=0;for(let t=0;t<e.length;++t){if(null!=o){if(o[s]===t&&1!==e[t])throw new Error(`Can't squeeze axis ${t} since its dim '${e[t]}' is not 1`);(null==o[s]||o[s]>t)&&1===e[t]&&(n.push(e[t]),r.push(t)),o[s]<=t&&s++}1!==e[t]&&(n.push(e[t]),r.push(t))}return{newShape:n,keptDims:r}}function lt(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error(`Unknown data type ${e}`);n=new Uint8Array(t)}return n}function ct(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error(`Unknown data type ${e}`);n=new Array(t)}return n}function ht(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function pt(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function ft(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error(`Unknown dtype ${e}`)}function dt(e){return"string"==typeof e||e instanceof String}function mt(e){return Array.isArray(e)?mt(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":"number"==typeof e?"float32":dt(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function gt(e){return!!(e&&e.constructor&&e.call&&e.apply)}function yt(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function bt(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function vt(e,t,n,r=!1){const a=new Array;if(1===t.length){const o=t[0]*(r?2:1);for(let t=0;t<o;t++)a[t]=n[e+t]}else{const o=t[0],s=t.slice(1),i=s.reduce(((e,t)=>e*t))*(r?2:1);for(let t=0;t<o;t++)a[t]=vt(e+t*i,s,n,r)}return a}function xt(e,t,n=!1){if(0===e.length)return t[0];const r=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return vt(0,e,t,n)}function wt(e,t){const n=_t(e,t);for(let e=0;e<n.length;e++)n[e]=1;return n}function _t(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function Tt(e){e.forEach((t=>{Ye(Number.isInteger(t)&&t>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`))}))}function Et(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let t=0;t<e.length-1;++t)r+=n[t]*e[t];return r}function St(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let t=0;t<r.length-1;++t)r[t]=Math.floor(e/n[t]),e-=r[t]*n[t];return r[r.length-1]=e,r}function It(e){return e&&e.then&&"function"==typeof e.then}class kt{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ct,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(Nt().getBool("IS_TEST")||Nt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];Nt().getBool("IS_TEST")||Nt().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(It(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)}))}}function Ct(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")))),t}function Nt(){return $t}let At,$t=null;function Rt(){if(null==At){let e;if("undefined"!=typeof window)e=window;else if(void 0!==be)e=be;else if(void 0!==We)e=We;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}At=e}return At}function Ft(e,t){const n=function(){const e=Rt();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}function Ot(...e){Nt().getBool("IS_TEST")||Nt().getBool("PROD")||console.warn(...e)}const Dt=Ft("kernelRegistry",(()=>new Map)),Mt=Ft("gradRegistry",(()=>new Map));function Lt(e,t){const n=zt(e,t);return Dt.get(n)}function Pt(e){return Mt.get(e)}function Bt(e){const t=Dt.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[o,s]=a,[i]=o.split("_");i===e&&n.push(s)}return n}function Ut(e){const{kernelName:t,backendName:n}=e,r=zt(t,n);Dt.has(r)&&Ot(`The kernel '${t}' for backend '${n}' is already registered`),Dt.set(r,e)}function zt(e,t){return`${t}_${e}`}var Vt=jt,Wt=null;try{Wt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Yn){}function jt(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function Gt(e){return!0===(e&&e.__isLong__)}jt.prototype.__isLong__,Object.defineProperty(jt.prototype,"__isLong__",{value:!0}),jt.isLong=Gt;var Ht={},Kt={};function qt(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=Kt[e])?r:(n=Yt(e,(0|e)<0?-1:0,!0),a&&(Kt[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=Ht[e])?r:(n=Yt(e,e<0?-1:0,!1),a&&(Ht[e]=n),n)}function Xt(e,t){if(isNaN(e))return t?on:an;if(t){if(e<0)return on;if(e>=tn)return hn}else{if(e<=-nn)return pn;if(e+1>=nn)return cn}return e<0?Xt(-e,t).neg():Yt(e%en|0,e/en|0,t)}function Yt(e,t,n){return new jt(e,t,n)}jt.fromInt=qt,jt.fromNumber=Xt,jt.fromBits=Yt;var Qt=Math.pow;function Jt(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return an;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Jt(e.substring(1),t,n).neg();for(var a=Xt(Qt(n,8)),o=an,s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+i),n);if(i<8){var l=Xt(Qt(n,i));o=o.mul(l).add(Xt(u))}else o=(o=o.mul(a)).add(Xt(u))}return o.unsigned=t,o}function Zt(e,t){return"number"==typeof e?Xt(e,t):"string"==typeof e?Jt(e,t):Yt(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}jt.fromString=Jt,jt.fromValue=Zt;var en=4294967296,tn=en*en,nn=tn/2,rn=qt(1<<24),an=qt(0);jt.ZERO=an;var on=qt(0,!0);jt.UZERO=on;var sn=qt(1);jt.ONE=sn;var un=qt(1,!0);jt.UONE=un;var ln=qt(-1);jt.NEG_ONE=ln;var cn=Yt(-1,2147483647,!1);jt.MAX_VALUE=cn;var hn=Yt(-1,-1,!0);jt.MAX_UNSIGNED_VALUE=hn;var pn=Yt(0,-2147483648,!1);jt.MIN_VALUE=pn;var fn=jt.prototype;fn.toInt=function(){return this.unsigned?this.low>>>0:this.low},fn.toNumber=function(){return this.unsigned?(this.high>>>0)*en+(this.low>>>0):this.high*en+(this.low>>>0)},fn.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(pn)){var t=Xt(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=Xt(Qt(e,6),this.unsigned),o=this,s="";;){var i=o.div(a),u=(o.sub(i.mul(a)).toInt()>>>0).toString(e);if((o=i).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},fn.getHighBits=function(){return this.high},fn.getHighBitsUnsigned=function(){return this.high>>>0},fn.getLowBits=function(){return this.low},fn.getLowBitsUnsigned=function(){return this.low>>>0},fn.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pn)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},fn.isZero=function(){return 0===this.high&&0===this.low},fn.eqz=fn.isZero,fn.isNegative=function(){return!this.unsigned&&this.high<0},fn.isPositive=function(){return this.unsigned||this.high>=0},fn.isOdd=function(){return 1==(1&this.low)},fn.isEven=function(){return 0==(1&this.low)},fn.equals=function(e){return Gt(e)||(e=Zt(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},fn.eq=fn.equals,fn.notEquals=function(e){return!this.eq(e)},fn.neq=fn.notEquals,fn.ne=fn.notEquals,fn.lessThan=function(e){return this.comp(e)<0},fn.lt=fn.lessThan,fn.lessThanOrEqual=function(e){return this.comp(e)<=0},fn.lte=fn.lessThanOrEqual,fn.le=fn.lessThanOrEqual,fn.greaterThan=function(e){return this.comp(e)>0},fn.gt=fn.greaterThan,fn.greaterThanOrEqual=function(e){return this.comp(e)>=0},fn.gte=fn.greaterThanOrEqual,fn.ge=fn.greaterThanOrEqual,fn.compare=function(e){if(Gt(e)||(e=Zt(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},fn.comp=fn.compare,fn.negate=function(){return!this.unsigned&&this.eq(pn)?pn:this.not().add(sn)},fn.neg=fn.negate,fn.add=function(e){Gt(e)||(e=Zt(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,o=e.high>>>16,s=65535&e.high,i=e.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=a+(65535&e.low))>>>16,l+=(c+=r+i)>>>16,u+=(l+=n+s)>>>16,u+=t+o,Yt((c&=65535)<<16|(h&=65535),(u&=65535)<<16|(l&=65535),this.unsigned)},fn.subtract=function(e){return Gt(e)||(e=Zt(e)),this.add(e.neg())},fn.sub=fn.subtract,fn.multiply=function(e){if(this.isZero())return an;if(Gt(e)||(e=Zt(e)),Wt)return Yt(Wt.mul(this.low,this.high,e.low,e.high),Wt.get_high(),this.unsigned);if(e.isZero())return an;if(this.eq(pn))return e.isOdd()?pn:an;if(e.eq(pn))return this.isOdd()?pn:an;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(rn)&&e.lt(rn))return Xt(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,o=e.high>>>16,s=65535&e.high,i=e.low>>>16,u=65535&e.low,l=0,c=0,h=0,p=0;return h+=(p+=a*u)>>>16,c+=(h+=r*u)>>>16,h&=65535,c+=(h+=a*i)>>>16,l+=(c+=n*u)>>>16,c&=65535,l+=(c+=r*i)>>>16,c&=65535,l+=(c+=a*s)>>>16,l+=t*u+n*i+r*s+a*o,Yt((h&=65535)<<16|(p&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},fn.mul=fn.multiply,fn.divide=function(e){if(Gt(e)||(e=Zt(e)),e.isZero())throw Error("division by zero");var t,n,r;if(Wt)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Yt((this.unsigned?Wt.div_u:Wt.div_s)(this.low,this.high,e.low,e.high),Wt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?on:an;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return on;if(e.gt(this.shru(1)))return un;r=on}else{if(this.eq(pn))return e.eq(sn)||e.eq(ln)?pn:e.eq(pn)?sn:(t=this.shr(1).div(e).shl(1)).eq(an)?e.isNegative()?sn:ln:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(pn))return this.unsigned?on:an;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=an}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),o=a<=48?1:Qt(2,a-48),s=Xt(t),i=s.mul(e);i.isNegative()||i.gt(n);)i=(s=Xt(t-=o,this.unsigned)).mul(e);s.isZero()&&(s=sn),r=r.add(s),n=n.sub(i)}return r},fn.div=fn.divide,fn.modulo=function(e){return Gt(e)||(e=Zt(e)),Wt?Yt((this.unsigned?Wt.rem_u:Wt.rem_s)(this.low,this.high,e.low,e.high),Wt.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},fn.mod=fn.modulo,fn.rem=fn.modulo,fn.not=function(){return Yt(~this.low,~this.high,this.unsigned)},fn.and=function(e){return Gt(e)||(e=Zt(e)),Yt(this.low&e.low,this.high&e.high,this.unsigned)},fn.or=function(e){return Gt(e)||(e=Zt(e)),Yt(this.low|e.low,this.high|e.high,this.unsigned)},fn.xor=function(e){return Gt(e)||(e=Zt(e)),Yt(this.low^e.low,this.high^e.high,this.unsigned)},fn.shiftLeft=function(e){return Gt(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Yt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Yt(0,this.low<<e-32,this.unsigned)},fn.shl=fn.shiftLeft,fn.shiftRight=function(e){return Gt(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Yt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Yt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},fn.shr=fn.shiftRight,fn.shiftRightUnsigned=function(e){if(Gt(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?Yt(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Yt(32===e?t:t>>>e-32,0,this.unsigned)},fn.shru=fn.shiftRightUnsigned,fn.shr_u=fn.shiftRightUnsigned,fn.toSigned=function(){return this.unsigned?Yt(this.low,this.high,!1):this},fn.toUnsigned=function(){return this.unsigned?this:Yt(this.low,this.high,!0)},fn.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},fn.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},fn.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},jt.fromBytes=function(e,t,n){return n?jt.fromBytesLE(e,t):jt.fromBytesBE(e,t)},jt.fromBytesLE=function(e,t){return new jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},jt.fromBytesBE=function(e,t){return new jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const dn=Vt||function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:Vt},[Vt]);function mn(e){return dn.fromString(e,!0,16)}const gn=mn("c3a5c85c97cb3127"),yn=mn("b492b66fbe98f273"),bn=mn("9ae16a3b2f90404f");function vn(e){return e.xor(e.shru(47))}function xn(e,t,n){const r=e.slice(t,t+n);return dn.fromBytes(Array.from(r),!0,!0)}function wn(e,t){return xn(e,t,8)}function _n(e,t){return xn(e,t,4)}function Tn(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function En(e,t,n=mn("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function Sn(e,t,n,r){return function(e,t,n,r,a,o){a=a.add(e),o=Tn(o.add(a).add(r),21);const s=a;return a=(a=a.add(t)).add(n),o=o.add(Tn(a,44)),[a.add(r),o.add(s)]}(wn(e,t),wn(e,t+8),wn(e,t+16),wn(e,t+24),n,r)}function In(e,t=e.length){const n=dn.fromNumber(81,!0);if(t<=32)return t<=16?function(e,t=e.length){if(t>=8){const n=bn.add(2*t),r=wn(e,0).add(bn),a=wn(e,t-8);return En(Tn(a,37).mul(n).add(r),Tn(r,25).add(a).mul(n),n)}if(t>=4){const n=bn.add(2*t);return En(_n(e,0).shl(3).add(t),_n(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return vn(bn.mul(n).xor(gn.mul(r))).mul(bn)}return bn}(e,t):function(e,t=e.length){const n=bn.add(2*t),r=wn(e,0).mul(yn),a=wn(e,8),o=wn(e,t-8).mul(n),s=wn(e,t-16).mul(bn);return En(Tn(r.add(a),43).add(Tn(o,30)).add(s),r.add(Tn(a.add(bn),18)).add(o),n)}(e,t);if(t<=64)return function(e,t=e.length){const n=bn.add(2*t),r=wn(e,0).mul(bn),a=wn(e,8),o=wn(e,t-8).mul(n),s=wn(e,t-16).mul(bn),i=Tn(r.add(a),43).add(Tn(o,30)).add(s),u=En(i,r.add(Tn(a.add(bn),18)).add(o),n),l=wn(e,16).mul(n),c=wn(e,24),h=i.add(wn(e,t-32)).mul(n),p=u.add(wn(e,t-24)).mul(n);return En(Tn(l.add(c),43).add(Tn(h,30)).add(p),l.add(Tn(c.add(r),18)).add(h),n)}(e,t);let r=n,a=n.mul(yn).add(113),o=vn(a.mul(bn).add(113)).mul(bn),s=[dn.UZERO,dn.UZERO],i=[dn.UZERO,dn.UZERO];r=r.mul(bn).add(wn(e,0));let u=0;const l=64*(t-1>>6),c=l+(t-1&63)-63;do{r=Tn(r.add(a).add(s[0]).add(wn(e,u+8)),37).mul(yn),a=Tn(a.add(s[1]).add(wn(e,u+48)),42).mul(yn),r=r.xor(i[1]),a=a.add(s[0]).add(wn(e,u+40)),o=Tn(o.add(i[0]),33).mul(yn),s=Sn(e,u,s[1].mul(yn),r.add(i[0])),i=Sn(e,u+32,o.add(i[1]),a.add(wn(e,u+16))),[o,r]=[r,o],u+=64}while(u!==l);const h=yn.add(o.and(255).shl(1));return u=c,i[0]=i[0].add(t-1&63),s[0]=s[0].add(i[0]),i[0]=i[0].add(s[0]),r=Tn(r.add(a).add(s[0]).add(wn(e,u+8)),37).mul(h),a=Tn(a.add(s[1]).add(wn(e,u+48)),42).mul(h),r=r.xor(i[1].mul(9)),a=a.add(s[0].mul(9).add(wn(e,u+40))),o=Tn(o.add(i[0]),33).mul(h),s=Sn(e,u,s[1].mul(h),r.add(i[0])),i=Sn(e,u+32,o.add(i[1]),a.add(wn(e,u+16))),[o,r]=[r,o],En(En(s[0],i[0],h).add(vn(a).mul(gn)).add(o),En(s[1],i[1],h).add(r),h)}function kn(e,t){return"string"===t?An(e):Cn([e],t)}function Cn(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Ze(e)),Nt().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error(`Unknown data type ${t}`)}function Nn(){return Nt().platform.now()}function An(e,t="utf-8"){return t=t||"utf-8",Nt().platform.encode(e,t)}function $n(e,t="utf-8"){return t=t||"utf-8",Nt().platform.decode(e,t)}class Rn{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new On)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let o;const s=Nn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();o=Promise.resolve({kernelMs:Nn()-s})}if(Nt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let t=0;t<r.length;t++){const n=r[t];n.data().then((t=>{Fn(t,n.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then((e=>e.kernelMs)),extraInfo:o.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:o}=e;n.forEach((e=>{Promise.all([e.data(),r,o]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}function Fn(e,t,n){if("float32"!==t)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class On{logKernelProfile(e,t,n,r,a,o){const s="number"==typeof r?at(`${r}ms`,9):r.error,i=at(e,25),u=t.rank,l=t.size,c=at(t.shape.toString(),14);let h="";for(const e in a){const n=a[e];if(null!=n){const r=n.shape||t.shape,a=r.length;h+=`${e}: ${a}D ${a>0?r:""} `}}console.log(`%c${i}\t%c${s}\t%c${u}D ${c}\t%c${l}\t%c${h}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function Dn(e,t,n,r){const a=bt(t),o=function(e,t,n,r){const a=et(t),o=r[r.length-1],s=new Array(o).fill(0),i=t.length,u="complex64"===n?Bn(e):e;if(i>1)for(let e=0;e<a/o;e++){const t=e*o;for(let e=0;e<o;e++)s[e]=Math.max(s[e],Mn(u[t+e],0,n).length)}return s}(e,t,n,a),s=t.length,i=Pn(e,t,n,a,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${s}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(i.map((e=>"    "+e)).join("\n")),u.join("\n")}function Mn(e,t,n){let r;return r=Array.isArray(e)?`${parseFloat(e[0].toFixed(7))} + ${parseFloat(e[1].toFixed(7))}j`:dt(e)?`'${e}'`:"bool"===n?Ln(e):parseFloat(e.toFixed(7)).toString(),at(r,t)}function Ln(e){return 0===e?"false":"true"}function Pn(e,t,n,r,a,o=!0){const s="complex64"===n?2:1,i=t[0],u=t.length;if(0===u)return"complex64"===n?[Mn(Bn(e)[0],0,n)]:"bool"===n?[Ln(e[0])]:[e[0].toString()];if(1===u){if(i>20){const t=3*s;let r=Array.from(e.slice(0,t)),o=Array.from(e.slice((i-3)*s,i*s));return"complex64"===n&&(r=Bn(r),o=Bn(o)),["["+r.map(((e,t)=>Mn(e,a[t],n))).join(", ")+", ..., "+o.map(((e,t)=>Mn(e,a[i-3+t],n))).join(", ")+"]"]}return["["+("complex64"===n?Bn(e):Array.from(e)).map(((e,t)=>Mn(e,a[t],n))).join(", ")+"]"]}const l=t.slice(1),c=r.slice(1),h=r[0]*s,p=[];if(i>20){for(let t=0;t<3;t++){const r=t*h,o=r+h;p.push(...Pn(e.slice(r,o),l,n,c,a,!1))}p.push("...");for(let t=i-3;t<i;t++){const r=t*h,o=r+h;p.push(...Pn(e.slice(r,o),l,n,c,a,t===i-1))}}else for(let t=0;t<i;t++){const r=t*h,o=r+h;p.push(...Pn(e.slice(r,o),l,n,c,a,t===i-1))}const f=2===u?",":"";p[0]="["+p[0]+f;for(let e=1;e<p.length-1;e++)p[e]=" "+p[e]+f;let d=",\n";for(let e=2;e<u;e++)d+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":d),p}function Bn(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class Un{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=et(e),null!=n){const e=n.length;Ye(e===this.size,(()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ct(t,this.size),this.strides=bt(e)}set(e,...t){0===t.length&&(t=[0]),Ye(t.length===this.rank,(()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`));const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const n of e){if(n<0||n>=this.shape[t]){const t=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(t)}t++}let n=e[e.length-1];for(let t=0;t<e.length-1;++t)n+=this.strides[t]*e[t];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return zn().makeTensor(this.values,this.shape,this.dtype)}}let zn=null,Vn=null;class Wn{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=et(e),this.strides=bt(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Vn.buffer(this.shape,this.dtype,e)}bufferSync(){return Vn.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return xt(this.shape,e,"complex64"===this.dtype)}arraySync(){return xt(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=zn().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map((e=>$n(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),zn().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=zn().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>$n(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await zn().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(zn().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Vn.print(this,e)}clone(){return this.throwIfDisposed(),Vn.clone(this)}toString(e=!1){return Dn(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Vn.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),zn().makeVariable(this,e,t,n)}}Object.defineProperty(Wn,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),Ft("Tensor",(()=>Wn));class jn extends Wn{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!tt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);zn().disposeTensor(this),this.dataId=e.dataId,zn().incRef(this,null)}dispose(){zn().disposeVariable(this),this.isDisposedInternal=!0}}var Gn,Hn,Kn,qn,Xn,Yn;Object.defineProperty(jn,Symbol.hasInstance,{value:e=>e instanceof Wn&&null!=e.assign&&e.assign instanceof Function}),(Yn=Gn||(Gn={})).R0="R0",Yn.R1="R1",Yn.R2="R2",Yn.R3="R3",Yn.R4="R4",Yn.R5="R5",Yn.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Hn||(Hn={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Kn||(Kn={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(qn||(qn={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Xn||(Xn={}));const Qn={float32:qn,int32:Hn,bool:Kn,complex64:Xn};function Jn(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return Qn[e][t]}function Zn(e,t){if(e.dtype===t.dtype)return[e,t];const n=Jn(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function er(e){const t=[];return tr(e,t,new Set),t}function tr(e,t,n){if(null==e)return;if(e instanceof Wn)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!=typeof r)return;var r;const a=e;for(const e in a){const r=a[e];n.has(r)||(n.add(r),tr(r,t,n))}}function nr(e){return null!=e.kernelName}class rr{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ar{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new rr}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(Ot(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Rn(this.backendInstance),!0}setupRegisteredKernels(){Bt(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){Bt(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof Ge||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId||(this.registry[e]=n,this.pendingBackendInit=null,0)))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,Ot(`Initialization of backend ${e} failed`),Ot(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(t){return Ot(`Initialization of backend ${e} failed`),Ot(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(e){throw t(),e}}nextTensorId(){return ar.nextTensorId++}nextVariableId(){return ar.nextVariableId++}clone(e){const t=sr.runKernel("Identity",{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t={x:e};return sr.runKernel("Cast",t,{dtype:"float32"})}})),[],{}),t}runKernel(e,t,n){if(null==this.backendName&&this.backend,null==Lt(e,this.backendName))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach((e=>{a+="complex64"===e.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),a=this.state.numBytes,o=this.state.numTensors;let s,i;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=nr(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(nr(e)){const{kernelName:t,inputs:a,attrs:o}=e;null==this.backendName&&this.backend;const u=Lt(t,this.backendName);Ye(null!=u,(()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`)),s=()=>{const e=this.backend.numDataIds();i=u.kernelFunc({inputs:a,attrs:o,backend:this.backend});const s=Array.isArray(i)?i:[i];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,s);const l=s.map((e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e)));if(r){const e=this.getTensorsForGradient(t,a,l);n=this.saveTensorsForBackwardMode(e)}return l}}else{const{forwardFunc:t}=e,a=e=>{r&&(n=e.map((e=>this.keep(this.clone(e)))))};s=()=>{const e=this.backend.numDataIds();i=this.tidy((()=>t(this.backend,a)));const n=Array.isArray(i)?i:[i];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,e,n),n}}const{inputs:l,attrs:c}=e,h=nr(e)?null:e.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(u,l,(()=>s())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs):t=s()})),r&&this.addTapeNode(u,l,t,h,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map((e=>null!=l[e]?l[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(i)?t:t[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){const r=Pt(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let o;r.saveAllInputs?(Ye(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(t).map((e=>t[e]))):o=e.map((e=>t[e]));const s=n.filter(((e,t)=>a[t]));return o.concat(s)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&dt(e[0])&&(a=e.map((e=>An(e))));const o=r.write(a,t,n),s=new Wn(t,n,o,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){const e=this.state.tensorInfo.get(o),t=function(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){const a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:a}=e,o=new Wn(r,a,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new jn(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*ft(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof jn||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*ft(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const e of this.state.activeProfile.kernels)e.kernelTimeMs=await e.kernelTimeMs,e.extraInfo=await e.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,o){const s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},i=Pt(e);null!=i&&(r=i.gradFunc),null!=r&&(s.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],r=_t(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],a,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=er(e),n=new Set(t.map((e=>e.id)));for(let e=0;e<this.state.activeScope.track.length;e++){const t=this.state.activeScope.track[e];t.kept||n.has(t.id)||t.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{e.kept||e.scopeId!==r.id||this.track(e)}))}gradients(e,t,n,r=!1){if(Ye(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const a=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));Ye(a instanceof Wn,(()=>"The result y returned by f() must be a tensor."));const o=function(e,t,n){const r={},a={};for(let e=0;e<t.length;e++)r[t[e].id]=!0;for(let n=0;n<e.length;n++){const o=e[n],s=o.inputs;for(const e in s){const n=s[e];let i=!1;for(let e=0;e<t.length;e++)if(r[n.id]){o.outputs.forEach((e=>r[e.id]=!0)),i=!0,a[o.id]=!0;break}if(i)break}}const o={};o[n.id]=!0;const s={};for(let t=e.length-1;t>=0;t--){const n=e[t],r=n.inputs;for(let e=0;e<n.outputs.length;e++)if(o[n.outputs[e].id]){for(const e in r)o[r[e].id]=!0,s[n.id]=!0;break}}const i=[];for(let t=0;t<e.length;t++){const n=e[t];if(a[n.id]&&s[n.id]){const e={};for(const t in n.inputs){const a=n.inputs[t];r[a.id]&&(e[t]=a)}const t=Object.assign({},n);t.inputs=e,t.outputs=n.outputs,i.push(t)}}return i}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[a.id]=null==n?function(e){const t=wt(et(e),"float32");return sr.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){const o=t[a],s=[];if(o.outputs.forEach((t=>{const n=e[t.id];null!=n?s.push(n):s.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const i=o.gradient(s);for(const t in o.inputs){if(!(t in i))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(i)}.`);const a=n((()=>i[t]()));if("float32"!==a.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${a.dtype}'`);const s=o.inputs[t];if(!tt(a.shape,s.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${t}' has shape '${a.shape}', which does not match the shape of the input '${s.shape}'`);if(null==e[s.id])e[s.id]=a;else{const t=e[s.id];e[s.id]=r(t,a),t.dispose()}}}}(e,o,(e=>this.tidy(e)),ir);const r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:a,grads:r}}))}customGrad(e){return Ye(gt(e),(()=>"The f passed in customGrad(f) must be a function.")),(...t)=>{let n;Ye(t.every((e=>e instanceof Wn)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};return t.forEach(((e,t)=>{r[t]=e})),this.runKernelFunc({forwardFunc:(r,a)=>(n=e(...t,a),Ye(n.value instanceof Wn,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),Ye(gt(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(e,r)=>{const a=n.gradFunc(e,r),o=Array.isArray(a)?a:[a];Ye(o.length===t.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),Ye(o.every((e=>e instanceof Wn)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const s={};return o.forEach(((e,t)=>{s[t]=()=>e})),s},inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Nn(),n=await this.backend.time(e);return n.wallMs=Nn()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new rr;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function or(){const e=Rt();if(null==e._tfengine){const t=new kt(e);e._tfengine=new ar(t)}var t;return t=e._tfengine.ENV,$t=t,zn=()=>e._tfengine,e._tfengine}ar.nextTensorId=0,ar.nextVariableId=0;const sr=or();function ir(e,t){const n={a:e,b:t};return sr.runKernel("Add",n)}function ur(e){if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function lr(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const cr=Nt();cr.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),cr.registerFlag("IS_BROWSER",(()=>lr())),cr.registerFlag("IS_NODE",(()=>void 0!==We&&void 0!==We.versions&&void 0!==We.versions.node)),cr.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),cr.registerFlag("PROD",(()=>!1)),cr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>cr.getBool("DEBUG"))),cr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),cr.registerFlag("IS_TEST",(()=>!1)),cr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),cr.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),cr.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var hr=[],pr=[],fr="undefined"!=typeof Uint8Array?Uint8Array:Array,dr=!1;function mr(){dr=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)hr[t]=e[t],pr[e.charCodeAt(t)]=t;pr["-".charCodeAt(0)]=62,pr["_".charCodeAt(0)]=63}function gr(e,t,n){for(var r,a,o=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(hr[(a=r)>>18&63]+hr[a>>12&63]+hr[a>>6&63]+hr[63&a]);return o.join("")}function yr(e){var t;dr||mr();for(var n=e.length,r=n%3,a="",o=[],s=16383,i=0,u=n-r;i<u;i+=s)o.push(gr(e,i,i+s>u?u:i+s));return 1===r?(t=e[n-1],a+=hr[t>>2],a+=hr[t<<4&63],a+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],a+=hr[t>>10],a+=hr[t>>4&63],a+=hr[t<<2&63],a+="="),o.push(a),o.join("")}function br(e,t,n,r,a){var o,s,i=8*a-r-1,u=(1<<i)-1,l=u>>1,c=-7,h=n?a-1:0,p=n?-1:1,f=e[t+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=i;c>0;o=256*o+e[t+h],h+=p,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;c>0;s=256*s+e[t+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=l}return(f?-1:1)*s*Math.pow(2,o-r)}function vr(e,t,n,r,a,o){var s,i,u,l=8*o-a-1,c=(1<<l)-1,h=c>>1,p=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(i=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=c?(i=0,s=c):s+h>=1?(i=(t*u-1)*Math.pow(2,a),s+=h):(i=t*Math.pow(2,h-1)*Math.pow(2,a),s=0));a>=8;e[n+f]=255&i,f+=d,i/=256,a-=8);for(s=s<<a|i,l+=a;l>0;e[n+f]=255&s,f+=d,s/=256,l-=8);e[n+f-d]|=128*m}var xr={}.toString,wr=Array.isArray||function(e){return"[object Array]"==xr.call(e)};function _r(){return Er.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Tr(e,t){if(_r()<t)throw new RangeError("Invalid typed array length");return Er.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Er.prototype:(null===e&&(e=new Er(t)),e.length=t),e}function Er(e,t,n){if(!(Er.TYPED_ARRAY_SUPPORT||this instanceof Er))return new Er(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return kr(this,e)}return Sr(this,e,t,n)}function Sr(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),Er.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Er.prototype:e=Cr(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Er.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|$r(t,n),a=(e=Tr(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(Ar(t)){var n=0|Nr(t.length);return 0===(e=Tr(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?Tr(e,0):Cr(e,t);if("Buffer"===t.type&&wr(t.data))return Cr(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Ir(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function kr(e,t){if(Ir(t),e=Tr(e,t<0?0:0|Nr(t)),!Er.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Cr(e,t){var n=t.length<0?0:0|Nr(t.length);e=Tr(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function Nr(e){if(e>=_r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_r().toString(16)+" bytes");return 0|e}function Ar(e){return!(null==e||!e._isBuffer)}function $r(e,t){if(Ar(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return ra(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return aa(e).length;default:if(r)return ra(e).length;t=(""+t).toLowerCase(),r=!0}}function Rr(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Hr(this,t,n);case"utf8":case"utf-8":return Wr(this,t,n);case"ascii":return jr(this,t,n);case"latin1":case"binary":return Gr(this,t,n);case"base64":return Vr(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Kr(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function Fr(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Or(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=Er.from(t,r)),Ar(t))return 0===t.length?-1:Dr(e,t,n,r,a);if("number"==typeof t)return t&=255,Er.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Dr(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function Dr(e,t,n,r,a){var o,s=1,i=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,i/=2,u/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(a){var c=-1;for(o=n;o<i;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(n+u>i&&(n=i-u),o=n;o>=0;o--){for(var h=!0,p=0;p<u;p++)if(l(e,o+p)!==l(t,p)){h=!1;break}if(h)return o}return-1}function Mr(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var i=parseInt(t.substr(2*s,2),16);if(isNaN(i))return s;e[n+s]=i}return s}function Lr(e,t,n,r){return oa(ra(t,e.length-n),e,n,r)}function Pr(e,t,n,r){return oa(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function Br(e,t,n,r){return Pr(e,t,n,r)}function Ur(e,t,n,r){return oa(aa(t),e,n,r)}function zr(e,t,n,r){return oa(function(e,t){for(var n,r,a,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,a=n%256,o.push(a),o.push(r);return o}(t,e.length-n),e,n,r)}function Vr(e,t,n){return 0===t&&n===e.length?yr(e):yr(e.slice(t,n))}function Wr(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var o,s,i,u,l=e[a],c=null,h=l>239?4:l>223?3:l>191?2:1;if(a+h<=n)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[a+1]))&&(u=(31&l)<<6|63&o)>127&&(c=u);break;case 3:o=e[a+1],s=e[a+2],128==(192&o)&&128==(192&s)&&(u=(15&l)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=e[a+1],s=e[a+2],i=e[a+3],128==(192&o)&&128==(192&s)&&128==(192&i)&&(u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&i)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),a+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function jr(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function Gr(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function Hr(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",o=t;o<n;++o)a+=na(e[o]);return a}function Kr(e,t,n){for(var r=e.slice(t,n),a="",o=0;o<r.length;o+=2)a+=String.fromCharCode(r[o]+256*r[o+1]);return a}function qr(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Xr(e,t,n,r,a,o){if(!Ar(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function Yr(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-n,2);a<o;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function Qr(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-n,4);a<o;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function Jr(e,t,n,r,a,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Zr(e,t,n,r,a){return a||Jr(e,0,n,4),vr(e,t,n,r,23,4),n+4}function ea(e,t,n,r,a){return a||Jr(e,0,n,8),vr(e,t,n,r,52,8),n+8}Er.TYPED_ARRAY_SUPPORT=void 0===be.TYPED_ARRAY_SUPPORT||be.TYPED_ARRAY_SUPPORT,_r(),Er.poolSize=8192,Er._augment=function(e){return e.__proto__=Er.prototype,e},Er.from=function(e,t,n){return Sr(null,e,t,n)},Er.TYPED_ARRAY_SUPPORT&&(Er.prototype.__proto__=Uint8Array.prototype,Er.__proto__=Uint8Array),Er.alloc=function(e,t,n){return function(e,t,n,r){return Ir(t),t<=0?Tr(e,t):void 0!==n?"string"==typeof r?Tr(e,t).fill(n,r):Tr(e,t).fill(n):Tr(e,t)}(null,e,t,n)},Er.allocUnsafe=function(e){return kr(null,e)},Er.allocUnsafeSlow=function(e){return kr(null,e)},Er.isBuffer=function(e){return null!=e&&(!!e._isBuffer||sa(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&sa(e.slice(0,0))}(e))},Er.compare=function(e,t){if(!Ar(e)||!Ar(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,o=Math.min(n,r);a<o;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},Er.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Er.concat=function(e,t){if(!wr(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Er.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=Er.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!Ar(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},Er.byteLength=$r,Er.prototype._isBuffer=!0,Er.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Fr(this,t,t+1);return this},Er.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Fr(this,t,t+3),Fr(this,t+1,t+2);return this},Er.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Fr(this,t,t+7),Fr(this,t+1,t+6),Fr(this,t+2,t+5),Fr(this,t+3,t+4);return this},Er.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Wr(this,0,e):Rr.apply(this,arguments)},Er.prototype.equals=function(e){if(!Ar(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Er.compare(this,e)},Er.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Er.prototype.compare=function(e,t,n,r,a){if(!Ar(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),i=Math.min(o,s),u=this.slice(r,a),l=e.slice(t,n),c=0;c<i;++c)if(u[c]!==l[c]){o=u[c],s=l[c];break}return o<s?-1:s<o?1:0},Er.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Er.prototype.indexOf=function(e,t,n){return Or(this,e,t,n,!0)},Er.prototype.lastIndexOf=function(e,t,n){return Or(this,e,t,n,!1)},Er.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return Mr(this,e,t,n);case"utf8":case"utf-8":return Lr(this,e,t,n);case"ascii":return Pr(this,e,t,n);case"latin1":case"binary":return Br(this,e,t,n);case"base64":return Ur(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return zr(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Er.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Er.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),Er.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Er.prototype;else{var a=t-e;n=new Er(a,void 0);for(var o=0;o<a;++o)n[o]=this[o+e]}return n},Er.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||qr(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r},Er.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||qr(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},Er.prototype.readUInt8=function(e,t){return t||qr(e,1,this.length),this[e]},Er.prototype.readUInt16LE=function(e,t){return t||qr(e,2,this.length),this[e]|this[e+1]<<8},Er.prototype.readUInt16BE=function(e,t){return t||qr(e,2,this.length),this[e]<<8|this[e+1]},Er.prototype.readUInt32LE=function(e,t){return t||qr(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Er.prototype.readUInt32BE=function(e,t){return t||qr(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Er.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||qr(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},Er.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||qr(e,t,this.length);for(var r=t,a=1,o=this[e+--r];r>0&&(a*=256);)o+=this[e+--r]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},Er.prototype.readInt8=function(e,t){return t||qr(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Er.prototype.readInt16LE=function(e,t){t||qr(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Er.prototype.readInt16BE=function(e,t){t||qr(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Er.prototype.readInt32LE=function(e,t){return t||qr(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Er.prototype.readInt32BE=function(e,t){return t||qr(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Er.prototype.readFloatLE=function(e,t){return t||qr(e,4,this.length),br(this,e,!0,23,4)},Er.prototype.readFloatBE=function(e,t){return t||qr(e,4,this.length),br(this,e,!1,23,4)},Er.prototype.readDoubleLE=function(e,t){return t||qr(e,8,this.length),br(this,e,!0,52,8)},Er.prototype.readDoubleBE=function(e,t){return t||qr(e,8,this.length),br(this,e,!1,52,8)},Er.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Xr(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=e/a&255;return t+n},Er.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Xr(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+n},Er.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,1,255,0),Er.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Er.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,2,65535,0),Er.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Yr(this,e,t,!0),t+2},Er.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,2,65535,0),Er.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Yr(this,e,t,!1),t+2},Er.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,4,4294967295,0),Er.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Qr(this,e,t,!0),t+4},Er.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,4,4294967295,0),Er.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Qr(this,e,t,!1),t+4},Er.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Xr(this,e,t,n,a-1,-a)}var o=0,s=1,i=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===i&&0!==this[t+o-1]&&(i=1),this[t+o]=(e/s>>0)-i&255;return t+n},Er.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Xr(this,e,t,n,a-1,-a)}var o=n-1,s=1,i=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===i&&0!==this[t+o+1]&&(i=1),this[t+o]=(e/s>>0)-i&255;return t+n},Er.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,1,127,-128),Er.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Er.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,2,32767,-32768),Er.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Yr(this,e,t,!0),t+2},Er.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,2,32767,-32768),Er.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Yr(this,e,t,!1),t+2},Er.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,4,2147483647,-2147483648),Er.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Qr(this,e,t,!0),t+4},Er.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Xr(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Er.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Qr(this,e,t,!1),t+4},Er.prototype.writeFloatLE=function(e,t,n){return Zr(this,e,t,!0,n)},Er.prototype.writeFloatBE=function(e,t,n){return Zr(this,e,t,!1,n)},Er.prototype.writeDoubleLE=function(e,t,n){return ea(this,e,t,!0,n)},Er.prototype.writeDoubleBE=function(e,t,n){return ea(this,e,t,!1,n)},Er.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,o=r-n;if(this===e&&n<t&&t<r)for(a=o-1;a>=0;--a)e[a+t]=this[a+n];else if(o<1e3||!Er.TYPED_ARRAY_SUPPORT)for(a=0;a<o;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},Er.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Er.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=Ar(e)?e:ra(new Er(e,r).toString()),i=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%i]}return this};var ta=/[^+\/0-9A-Za-z-_]/g;function na(e){return e<16?"0"+e.toString(16):e.toString(16)}function ra(e,t){var n;t=t||1/0;for(var r=e.length,a=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function aa(e){return function(e){var t,n,r,a,o,s;dr||mr();var i=e.length;if(i%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[i-2]?2:"="===e[i-1]?1:0,s=new fr(3*i/4-o),r=o>0?i-4:i;var u=0;for(t=0,n=0;t<r;t+=4,n+=3)a=pr[e.charCodeAt(t)]<<18|pr[e.charCodeAt(t+1)]<<12|pr[e.charCodeAt(t+2)]<<6|pr[e.charCodeAt(t+3)],s[u++]=a>>16&255,s[u++]=a>>8&255,s[u++]=255&a;return 2===o?(a=pr[e.charCodeAt(t)]<<2|pr[e.charCodeAt(t+1)]>>4,s[u++]=255&a):1===o&&(a=pr[e.charCodeAt(t)]<<10|pr[e.charCodeAt(t+1)]<<4|pr[e.charCodeAt(t+2)]>>2,s[u++]=a>>8&255,s[u++]=255&a),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(ta,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function oa(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function sa(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function ia(e,t){let n=e;if(pt(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||pt(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Nt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&ua(e,r,[]),r}function ua(e,t,n){if(n=n||[],!Array.isArray(e)&&!pt(e))return void Ye(0===t.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`));Ye(t.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`)),Ye(e.length===t[0],(()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`));const r=t.slice(1);for(let t=0;t<e.length;++t)ua(e[t],r,n.concat(t))}function la(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function ca(e,t,n,r="numeric"){if(e instanceof Wn)return la(r,e.dtype,t,n),e;let a=mt(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),la(r,a,t,n),null==e||!pt(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const r=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=ia(e,a);pt(e)||Array.isArray(e)||(e=[e]);const s="string"!==a?Cn(e,a):Ze(e,[],!0);return sr.makeTensor(s,o,a)}function ha(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map(((e,a)=>ca(e,`${t}[${a}]`,n,r)))}function pa(e){const t=Object.keys(e);if(1!==t.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const a=(...e)=>{sr.startScope(n);try{const t=r(...e);return It(t)&&console.error("Cannot return a Promise inside of tidy."),sr.endScope(t),t}catch(e){throw sr.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}const fa=pa({complex_:function(e,t){const n=ca(e,"real","complex"),r=ca(t,"imag","complex");Qe(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const a={real:n,imag:r};return sr.runKernel("Complex",a)}});function da(e,t,n,r){if(null==r&&(r=mt(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!pt(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Tt(t);const e=et(t),r=et(n);Ye(e===r,(()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`));for(let e=0;e<n.length;++e){const r=n[e],a=e!==n.length-1||r!==et(t.slice(e));Ye(n[e]===t[e]||!a,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `))}}return pt(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Cn(e,r):Ze(e,[],!0),sr.makeTensor(e,t,r)}function ma(e,t,n){return da(e,t,ia(e,n),n)}const ga={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},ya="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function ba(e){return ya?Er.byteLength(e):new Blob([e]).size}function va(e){if(1===e.length)return e[0];let t=0;e.forEach((e=>{t+=e.byteLength}));const n=new Uint8Array(t);let r=0;return e.forEach((e=>{n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function xa(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:ba(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:ba(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function wa(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const a=new ArrayBuffer(4*r.length),o=new Uint32Array(a);for(let a=0;a<r.length;a++){const s=r[a],i=e[n[s>>10]+(1023&s)]+t[s>>10];o[a]=i}return new Float32Array(a)}}class _a{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==_a.instance&&(_a.instance=new _a),_a.instance}static registerSaveRouter(e){_a.getInstance().saveRouters.push(e)}static registerLoadRouter(e){_a.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return _a.getHandlers(e,"save")}static getLoadHandlers(e,t){return _a.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?_a.getInstance().loadRouters:_a.getInstance().saveRouters).forEach((t=>{const a=t(e,n);null!==a&&r.push(a)})),r}}function Ta(){if(!Nt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Ea(e){const t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}class Sa{constructor(e){if(this.indexedDB=Ta(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Ea(r),r.onsuccess=()=>{const a=r.result;if(null==t){const t=a.transaction("models_store","readonly"),r=t.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{const r=xa(t),o=a.transaction("model_info_store","readwrite");let s=o.objectStore("model_info_store");const i=s.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;i.onsuccess=()=>{u=a.transaction("models_store","readwrite");const i=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r});i.onsuccess=()=>e({modelArtifactsInfo:r}),i.onerror=e=>{s=o.objectStore("model_info_store");const t=s.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(i.error)),t.onerror=e=>(a.close(),n(i.error))}},i.onerror=e=>(a.close(),n(i.error)),o.oncomplete=()=>{null==u?a.close():u.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)}))}}Sa.URL_SCHEME="indexeddb://";const Ia=e=>{return Nt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Sa.URL_SCHEME)?(t=e.slice(Sa.URL_SCHEME.length),new Sa(t)):null;var t};_a.registerSaveRouter(Ia),_a.registerLoadRouter(Ia);class ka{constructor(){this.indexedDB=Ta()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>Ea(n),n.onsuccess=()=>{const r=n.result,a=r.transaction("model_info_store","readonly"),o=a.objectStore("model_info_store").getAll();o.onsuccess=()=>{const t={};for(const e of o.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},o.onerror=e=>(r.close(),t(o.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){var t;return e=(t=e).startsWith(Sa.URL_SCHEME)?t.slice(Sa.URL_SCHEME.length):t,new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Ea(r),r.onsuccess=()=>{const a=r.result,o=a.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),i=s.get(e);let u;i.onsuccess=()=>{if(null==i.result)return a.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=s.delete(e),o=()=>{u=a.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(e);r.onsuccess=()=>t(i.result.modelArtifactsInfo),r.onerror=e=>n(i.error)};r.onsuccess=o,r.onerror=e=>(o(),a.close(),n(i.error))}},i.onerror=e=>(a.close(),n(i.error)),o.oncomplete=()=>{null==u?a.close():u.oncomplete=()=>a.close()}},r.onerror=e=>n(r.error)}))}}const Ca="tensorflowjs_models",Na="info",Aa="model_topology",$a="weight_specs",Ra="weight_data",Fa="model_metadata";function Oa(e){return{info:[Ca,e,Na].join("/"),topology:[Ca,e,Aa].join("/"),weightSpecs:[Ca,e,$a].join("/"),weightData:[Ca,e,Ra].join("/"),modelMetadata:[Ca,e,Fa].join("/")}}function Da(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function Ma(e){const t=e.split("/");if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join("/")}class La{constructor(e){if(!Nt().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Oa(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=xa(e);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(ya)return Er.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let e=0,r=t.length;e<r;e++)n+=String.fromCharCode(t[e]);return btoa(n)}(e.weightData));const a={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:r}}catch(e){throw Da(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){const e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(ya){const t=Er.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n.set([t.charCodeAt(e)],e);return n.buffer}(o),t}}La.URL_SCHEME="localstorage://";const Pa=e=>{return Nt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(La.URL_SCHEME)?(t=e.slice(La.URL_SCHEME.length),new La(t)):null;var t};_a.registerSaveRouter(Pa),_a.registerLoadRouter(Pa);class Ba{constructor(){Ye(Nt().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),Ye("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=Ca+"/",n="/"+Na;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);a.startsWith(t)&&a.endsWith(n)&&(e[Ma(a)]=JSON.parse(this.LS.getItem(a)))}return e}async removeModel(e){var t;const n=Oa(e=(t=e).startsWith(La.URL_SCHEME)?t.slice(La.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return Da(n),r}}function Ua(e,t,n,r){!function(e){Ye(null!=e&&Array.isArray(e)&&e.length>0,(()=>"promises must be a none empty array"))}(e),function(e,t){Ye(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${e}`)),Ye(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${t}`)),Ye(t>=e,(()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction ${t}`))}(n=null==n?0:n,r=null==r?1:r);let a=0;return Promise.all(e.map((o=>(o.then((o=>{const s=n+ ++a/e.length*(r-n);return t(s),o})),o))))}class za{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(Ye("function"==typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=Nt().platform.fetch,Ye(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&Ye(2===e.length,(()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`)),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=function(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:xa(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch(e){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return async function(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),null!=e.weightsManifest){const[r,a]=await t(e.weightsManifest);n.weightSpecs=r,n.weightData=a}return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),n}(t,(e=>this.loadWeights(e)))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),a=this.weightPathPrefix||n,o=[];for(const t of e)o.push(...t.weights);const s=[],i=[];for(const t of e)for(const e of t.paths)null!=this.weightUrlConverter?i.push(this.weightUrlConverter(e)):s.push(a+e+r);this.weightUrlConverter&&s.push(...await Promise.all(i));const u=await async function(e,t){null==t&&(t={});const n=null==t.fetchFunc?Nt().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),a=(null==t.onProgress?await Promise.all(r):await Ua(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(a):await Ua(a,t.onProgress,.5,1)}(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,va(u)]}}function Va(e){return null!=e.match(za.URL_SCHEME_REGEX)}za.URL_SCHEME_REGEX=/^https?:\/\//;const Wa=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>Va(e))):Va(e),n)return ja(e,t)}return null};function ja(e,t){return new za(e,t)}function Ga(e,t){return ja(e,t)}_a.registerSaveRouter(Wa),_a.registerLoadRouter(Wa);class Ha{constructor(){this.managers={}}static getInstance(){return null==Ha.instance&&(Ha.instance=new Ha),Ha.instance}static registerManager(e,t){Ye(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith("://")&&(e=e.slice(0,e.indexOf("://"))),Ye(e.length>0,(()=>"scheme must not be an empty string."));const n=Ha.getInstance();Ye(null==n.managers[e],(()=>`A model store manager is already registered for scheme '${e}'.`)),n.managers[e]=t}static getManager(e){const t=this.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(this.getInstance().managers)}}const Ka=pa({cast_:function(e,t){const n=ca(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},a={dtype:t};return sr.runKernel("Cast",r,a)}}),qa=pa({matMul_:function(e,t,n=!1,r=!1){let a=ca(e,"a","matMul"),o=ca(t,"b","matMul");[a,o]=Zn(a,o);const s={a,b:o},i={transposeA:n,transposeB:r};return sr.runKernel("BatchMatMul",s,i)}}),Xa=pa({oneHot_:function(e,t,n=1,r=0){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const a={indices:ca(e,"indices","oneHot","int32")},o={depth:t,onValue:n,offValue:r};return sr.runKernel("OneHot",a,o)}});function Ya(){return sr}function Qa(e,t){return sr.tidy(e,t)}function Ja(e){return sr.keep(e)}function Za(e,t,n=1){return sr.registerBackend(e,t,n)}const eo=pa({imag_:function(e){const t={input:ca(e,"input","imag")};return sr.runKernel("Imag",t)}}),to=pa({neg_:function(e){const t={x:ca(e,"x","neg")};return sr.runKernel("Neg",t)}}),no=pa({real_:function(e){const t={input:ca(e,"input","real")};return sr.runKernel("Real",t)}}),ro=pa({transpose_:function(e,t,n){const r=ca(e,"x","transpose");if(null==t&&(t=r.shape.map(((e,t)=>t)).reverse()),Ye(r.rank===t.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`)),t.forEach((e=>{Ye(e>=0&&e<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${t}`))})),r.rank<=1)return r.clone();const a={x:r},o={perm:t};return"complex64"===r.dtype?Qa((()=>{let e=no(r),t=eo(r);return e=sr.runKernel("Transpose",{x:e},o),t=sr.runKernel("Transpose",{x:t},o),n&&(t=to(t)),fa(e,t)})):sr.runKernel("Transpose",a,o)}});function ao(e,t){const n=e.length,r=[];for(let a=0;a<n;a++){const o=n-1-a,s=e[o]||1;(t[t.length-1-a]||1)>1&&1===s&&r.unshift(o)}return r}function oo(e,t){const n=[];for(let r=0;r<t.length;r++){const a=e[e.length-r-1],o=t.length-r-1,s=t[o];(null==a||1===a&&s>1)&&n.unshift(o)}return n}function so(e,t){const n=[],r=Math.max(e.length,t.length);for(let a=0;a<r;a++){let r=e[e.length-a-1];null==r&&(r=1);let o=t[t.length-a-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);n.unshift(r)}}return n}let io;const uo=pa({fromPixels_:function(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,o=!1,s=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)o=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);i=!0}if(a){const t=2;if(a&&e.readyState<t)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Lt("FromPixels",sr.backendName)){const n={pixels:e},r={numChannels:t};return sr.runKernel("FromPixels",n,r)}const[u,l]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height];let c,h;if(s)c=e.getContext("2d").getImageData(0,0,u,l).data;else if(r||n)c=e.data;else if(o||a||i){if(null==io)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");io=new OffscreenCanvas(1,1).getContext("2d")}else io=document.createElement("canvas").getContext("2d");io.canvas.width=u,io.canvas.height=l,io.drawImage(e,0,0,u,l),c=io.getImageData(0,0,u,l).data}if(4===t)h=new Int32Array(c);else{const e=u*l;h=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)h[n*t+e]=c[4*n+e]}return function(e,t,n){if(Je(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=ia(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return da(e,t,r,n)}(h,[l,u,t],"int32")}});function lo(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(o+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(o+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(o+" update.rank != "+(a+e.length-r));for(let e=0;e<a;++e)if(n.shape[e]!==t.shape[e])throw new Error(o+` updates.shape[${e}] (${n.shape[e]}) != indices.shape[${e}] (${t.shape[e]}).`);for(let t=0;t<n.rank-a;++t)if(n.shape[t+a]!==e[t+r])throw new Error(o+` updates.shape[${t+a}] (${n.shape[t+a]}) != shape[${t+a}] (${e[t+a]})`)}function co(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}lo(n,t,e)}function ho(e,t,n){const r=e.shape.length;Ye(r===t.length,(()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`)),Ye(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let a=0;a<r;++a)Ye(t[a]+n[a]<=e.shape[a],(()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`))}function po(e,t,n){const r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function fo(e,t,n,r){const a=[...e];for(let e=a.length;e<r.length;e++)a.push(1);for(let e=0;e<n;e++)0===e?a[t]=1:(a.splice(t,0,1),a.pop());return a}function mo(e,t,n){return n<=e?n:n-(t-1)}function go(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function yo(e,t,n,r,a){const o=[...a],s=go(n,t);for(let a=0;a<o.length;a++)if(s.indexOf(a)>-1)o[a]=0;else{const s=mo(t,n,a);let i=r[s];e&1<<s&&(i=0),o[a]=i}return o}function bo(e,t,n,r,a){const o=[...a],s=go(n,t);for(let a=0;a<o.length;a++)if(s.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const s=mo(t,n,a);let i=r[s];e&1<<s&&(i=Number.MAX_SAFE_INTEGER),o[a]=i}for(let e=0;e<o.length;e++){const t=a[e];o[e]<0&&(o[e]+=t),o[e]=Ke(0,o[e],a[e])}return o}function vo(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function xo(e,t,n,r,a,o){let s=t[a];const i=n[a]||1;(e&1<<a||o&1<<a||null==s)&&(s=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[a];return s<0&&(s+=u),s=Ke(0,s,u-1),s}function wo(e,t,n,r,a,o){let s=t[a];const i=n[a]||1;(e&1<<a||o&1<<a||null==s)&&(s=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[a];return s<0&&(s+=u),s=i>0?Ke(0,s,u):Ke(-1,s,u-1),s}function _o(e,t,n){let r=n.length;for(let e=0;e<n.length;e++)if(n[e]>1){r=e;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function To(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Eo(e,t,n){let r;const a=e.shape.length;let o;return r="number"==typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),r.forEach((e=>{Ye(-1!==e,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(a).fill(-1):"number"==typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,o=o.map(((t,n)=>t>=0?t:(Ye(-1===t,(()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`)),e.shape[n]-r[n]))),[r,o]}function So(e,t,n,r,a,o,s,i,u){let l;if(null==r?(l=new Array(t.length),l.fill(1)):l=r,null!=s&&0!=(s&s-1))throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:a,endMask:o,ellipsisMask:s,newAxisMask:i,shrinkAxisMask:u};for(let e=0;e<h.dims;e++)c&&0!=(1<<e&i)&&h.numAddAxisAfterEllipsis++,1<<e&s&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const p={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,p);let f=!0,d=!0,m=!0;const g=[],y=[];for(let t=0;t<e.length;++t){if(0===p.strides[t])throw Error(`strides[${t}] must be non-zero`);const n=!!(p.shrinkAxisMask&1<<t),r=e[t];if(-1===r){g.push(n?1:-1);continue}const a=[p.beginMask&1<<t,p.endMask&1<<t],o=[p.strides[t]>0?0:-1,p.strides[t]>0?r:r-1];if(n&&p.strides[t]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===p.strides[t];const s=!!(p.beginMask&1<<t&&p.endMask&1<<t);if(p.beginValid&&p.endValid){if(n){const e=p.begin[t]<0?r+p.begin[t]:p.begin[t];if(p.begin[t]=e,p.end[t]=p.begin[t]+1,e<0||e>=r)throw Error(`slice index ${p.begin[t]} of dimension ${t} out of bounds.`)}else p.begin[t]=Io(p.begin[t],0,p.strides[t],r,a,o),p.end[t]=Io(p.end[t],1,p.strides[t],r,a,o);const e=1===p.strides[t]&&0===p.begin[t]&&p.end[t]===r;f=f&&e,d=d&&(0===t&&1===p.strides[t]||e)}else f=f&&1===p.strides[t]&&s,d=d&&(0===t&&1===p.strides[t]||s);let i,u=!1;if(p.beginValid&&p.endValid?(i=p.end[t]-p.begin[t],u=!0):n?(i=1,u=!0):s&&r>=0&&(i=p.strides[t]<0?-r:r,u=!0),u){let e;e=0===i||i<0!=p.strides[t]<0?0:Math.trunc(i/p.strides[t])+(i%p.strides[t]!=0?1:0),g.push(e)}else g.push(-1)}for(let e=0;e<p.finalShapeGatherIndices.length;++e){const t=p.finalShapeGatherIndices[e];t>=0?y.push(g[t]):-2===t&&y.push(1)}const b=y.filter(((e,t)=>-2!==p.finalShapeGatherIndices[t]));return{finalShapeSparse:b,finalShape:y,isIdentity:f,sliceDim0:d,isSimpleSlice:m,begin:p.begin,end:p.end,strides:p.strides}}function Io(e,t,n,r,a,o){if(a[t])return n>0?o[t]:o[t+1&1];{const t=e<0?r+e:e;return t<o[0]?o[0]:t>o[1]?o[1]:t}}var ko=Object.freeze({__proto__:null,assertParamsValid:ho,maskToAxes:function(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t},computeOutShape:po,stridesWithElidedDims:fo,getNormalizedAxes:function(e,t,n,r,a,o,s,i,u){const l=e.length;let c=new Array(l),h=new Array(l),p=new Array(l);if(t.length&&n>0){const u=t[0],l=n+1;c=yo(s,u,l,r,e),h=bo(i,u,l,a,e),p=fo(o,u,l,e)}else for(let t=0;t<l;t++)c[t]=xo(s,r,o,e,t,u),h[t]=wo(i,a,o,e,t,u),p[t]=vo(o,t,u);return{begin:c,end:h,strides:p}},startIndicesWithElidedDims:yo,stopIndicesWithElidedDims:bo,stridesForAxis:vo,startForAxis:xo,stopForAxis:wo,isSliceContinous:_o,computeFlatOffset:To,parseSliceParams:Eo,sliceInfo:So});const Co=pa({add_:function(e,t){let n=ca(e,"a","add"),r=ca(t,"b","add");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("Add",a)}}),No=pa({floorDiv_:function(e,t){let n=ca(e,"a","floorDiv"),r=ca(t,"b","floorDiv");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("FloorDiv",a)}}),Ao=pa({div_:function(e,t){let n=ca(e,"a","div"),r=ca(t,"b","div");if([n,r]=Zn(n,r),"int32"===n.dtype&&"int32"===r.dtype)return No(n,r);const a={a:n,b:r};return sr.runKernel("RealDiv",a,{})}}),$o=pa({mul_:function(e,t){let n=ca(e,"a","mul"),r=ca(t,"b","mul");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("Multiply",a)}}),Ro=pa({abs_:function(e){const t=ca(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return sr.runKernel("ComplexAbs",e)}{const e={x:t};return sr.runKernel("Abs",e)}}}),Fo=pa({acos_:function(e){const t={x:ca(e,"x","acos")};return sr.runKernel("Acos",t)}}),Oo=pa({acosh_:function(e){const t={x:ca(e,"x","acosh")};return sr.runKernel("Acosh",t)}}),Do=pa({addN_:function(e){Ye(Array.isArray(e),(()=>"The argument passed to tf.addN() must be a list of tensors")),Ye(e.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`));const t=e.map(((e,t)=>ca(e,`tensors${t}`,"addN"))),n=t[0];t.forEach((e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((e=>{if(!tt(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=t;return sr.runKernel("AddN",r)}}),Mo=pa({all_:function(e,t=null,n=!1){const r={x:ca(e,"x","all","bool")},a={axis:t,keepDims:n};return sr.runKernel("All",r,a)}}),Lo=pa({any_:function(e,t=null,n=!1){const r={x:ca(e,"x","any","bool")},a={axis:t,keepDims:n};return sr.runKernel("Any",r,a)}}),Po=pa({argMax_:function(e,t=0){const n={x:ca(e,"x","argMax")},r={axis:t};return sr.runKernel("ArgMax",n,r)}}),Bo=pa({argMin_:function(e,t=0){const n={x:ca(e,"x","argMin")},r={axis:t};return sr.runKernel("ArgMin",n,r)}}),Uo=pa({asin_:function(e){const t={x:ca(e,"x","asin")};return sr.runKernel("Asin",t)}}),zo=pa({asinh_:function(e){const t={x:ca(e,"x","asinh")};return sr.runKernel("Asinh",t)}}),Vo=pa({atan_:function(e){const t={x:ca(e,"x","atan")};return sr.runKernel("Atan",t)}}),Wo=pa({atan2_:function(e,t){let n=ca(e,"a","atan2"),r=ca(t,"b","atan2");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("Atan2",a)}}),jo=pa({atanh_:function(e){const t={x:ca(e,"x","atanh")};return sr.runKernel("Atanh",t)}});function Go(e,t,n,r,a,o,s="channelsLast"){const[i,u]=Xo(t);let l;if("channelsLast"===s)l=[i,u,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);l=[i,u,e[1],e[1]]}return Ho(e,l,n,r,a,o,!1,s)}function Ho(e,t,n,r,a,o,s=!1,i="channelsLast"){let[u,l,c,h]=[-1,-1,-1,-1];if("channelsLast"===i)[u,l,c,h]=e;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,l,c]=e}const[p,f,,d]=t,[m,g]=Xo(n),[y,b]=Xo(r),v=Qo(p,y),x=Qo(f,b),{padInfo:w,outHeight:_,outWidth:T}=function(e,t,n,r,a,o,s,i,u){let l,c,h;if("number"==typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,a){null==r&&(r=qo(e,t,n));const o=e[1];return[Jo((e[0]-t+2*r)/n+1,a),Jo((o-t+2*r)/n+1,a)]}([t,n],o,r,e,i);c=a[0],h=a[1]}else if("same"===e){c=Math.ceil(t/r),h=Math.ceil(n/a);const e=Math.max(0,(c-1)*r+o-t),i=Math.max(0,(h-1)*a+s-n),u=Math.floor(e/2),p=e-u,f=Math.floor(i/2);l={top:u,bottom:p,left:f,right:i-f,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-o+1)/r),h=Math.ceil((n-s+1)/a);else{if("object"!=typeof e)throw Error(`Unknown padding parameter: ${e}`);{const p="channelsLast"===u?e[1][0]:e[2][0],f="channelsLast"===u?e[1][1]:e[2][1],d="channelsLast"===u?e[2][0]:e[3][0],m="channelsLast"===u?e[2][1]:e[3][1];l={top:p,bottom:f,left:d,right:m,type:0===p&&0===f&&0===d&&0===m?"VALID":"EXPLICIT"},c=Jo((t-o+p+f)/r+1,i),h=Jo((n-s+d+m)/a+1,i)}}return{padInfo:l,outHeight:c,outWidth:h}}(a,l,c,m,g,v,x,o,i),E=s?d*h:d;let S;return"channelsFirst"===i?S=[u,E,_,T]:"channelsLast"===i&&(S=[u,_,T,E]),{batchSize:u,dataFormat:i,inHeight:l,inWidth:c,inChannels:h,outHeight:_,outWidth:T,outChannels:E,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:e,outShape:S,filterShape:t}}function Ko(e,t,n,r,a,o=!1,s="channelsLast",i){let[u,l,c,h,p]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[u,l,c,h,p]=e;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[u,p,l,c,h]=e}const[f,d,m,,g]=t,[y,b,v]=Yo(n),[x,w,_]=Yo(r),T=Qo(f,x),E=Qo(d,w),S=Qo(m,_),{padInfo:I,outDepth:k,outHeight:C,outWidth:N}=function(e,t,n,r,a,o,s,i,u,l,c){let h,p,f,d;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const o=function(e,t,n,r,a,o){null==a&&(a=qo(e,t,r));const s=e[1],i=e[2];return[Jo((e[0]-t+2*a)/r+1,o),Jo((s-t+2*a)/r+1,o),Jo((i-t+2*a)/r+1,o),1]}([t,n,r,1],i,0,a,e,c);p=o[0],f=o[1],d=o[2]}else if("same"===e){p=Math.ceil(t/a),f=Math.ceil(n/o),d=Math.ceil(r/s);const e=(p-1)*a+i-t,c=(f-1)*o+u-n,m=(d-1)*s+l-r,g=Math.floor(e/2),y=e-g,b=Math.floor(c/2),v=c-b,x=Math.floor(m/2);h={top:b,bottom:v,left:x,right:m-x,front:g,back:y,type:"SAME"}}else{if("valid"!==e)throw Error(`Unknown padding parameter: ${e}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-i+1)/a),f=Math.ceil((n-u+1)/o),d=Math.ceil((r-l+1)/s)}return{padInfo:h,outDepth:p,outHeight:f,outWidth:d}}(a,l,c,h,y,b,v,T,E,S,i),A=o?g*p:g;let $;return"channelsFirst"===s?$=[u,A,k,C,N]:"channelsLast"===s&&($=[u,k,C,N,A]),{batchSize:u,dataFormat:s,inDepth:l,inHeight:c,inWidth:h,inChannels:p,outDepth:k,outHeight:C,outWidth:N,outChannels:A,padInfo:I,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:f,filterHeight:d,filterWidth:m,effectiveFilterDepth:T,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:x,dilationHeight:w,dilationWidth:_,inShape:e,outShape:$,filterShape:t}}function qo(e,t,n,r=1){const a=Qo(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Xo(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Yo(e){return"number"==typeof e?[e,e,e]:e}function Qo(e,t){return t<=1?e:e+(e-1)*(t-1)}function Jo(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Zo(e){const[t,n,r]=Xo(e);return 1===t&&1===n&&1===r}function es(e,t){return Zo(e)||Zo(t)}function ts(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function ns(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)Ye(nt(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`));else{if("object"!=typeof t)throw Error(`Error in ${e}: Unknown padding parameter: ${t}`);t.forEach((t=>{t.forEach((t=>{Ye(nt(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`))}))}))}}}const rs=pa({reshape_:function(e,t){const n={x:ca(e,"x","reshape","string_or_numeric")},r={shape:t};return sr.runKernel("Reshape",n,r)}}),as=pa({avgPool_:function(e,t,n,r,a){const o=ca(e,"x","avgPool","float32");Ye(es(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let s=o,i=!1;3===o.rank&&(i=!0,s=rs(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Ye(4===s.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`)),ns("avgPool",r,a);const u={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a};let c=sr.runKernel("AvgPool",u,l);return c=Ka(c,o.dtype),i?rs(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),os=pa({avgPool3d_:function(e,t,n,r,a,o="NDHWC"){const s=ca(e,"x","avgPool3d","float32");let i=s,u=!1;4===s.rank&&(u=!0,i=rs(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Ye(5===i.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${i.rank}.`)),Ye("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),ns("avgPool3d",r,a);const l={x:i},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:o};let h=sr.runKernel("AvgPool3D",l,c);return h=Ka(h,i.dtype),u?rs(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),ss=pa({clone_:function(e){const t={x:ca(e,"x","clone","string_or_numeric")};return sr.runKernel("Identity",t)}}),is=pa({concat_:function(e,t=0){Ye(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=ha(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)})),1===n.length)return ss(n[0]);const r=n,a={axis:t};return sr.runKernel("Concat",r,a)}}),us=pa({sigmoid_:function(e){const t={x:ca(e,"x","sigmoid","float32")};return sr.runKernel("Sigmoid",t)}}),ls=pa({slice_:function(e,t,n){const r=ca(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const a={x:r},o={begin:t,size:n};return sr.runKernel("Slice",a,o)}}),cs=pa({tanh_:function(e){const t={x:ca(e,"x","tanh","float32")};return sr.runKernel("Tanh",t)}}),hs=pa({batchToSpaceND_:function(e,t,n){const r=ca(e,"x","batchToSpaceND"),a=t.reduce(((e,t)=>e*t));Ye(r.rank>=1+t.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`)),Ye(n.length===t.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`)),Ye(r.shape[0]%a==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`));const o={x:r},s={blockShape:t,crops:n};return sr.runKernel("BatchToSpaceND",o,s)}}),ps=pa({batchNorm_:function(e,t,n,r,a,o){null==o&&(o=.001);const s=ca(e,"x","batchNorm"),i=ca(t,"mean","batchNorm"),u=ca(n,"variance","batchNorm");let l,c;null!=a&&(l=ca(a,"scale","batchNorm")),null!=r&&(c=ca(r,"offset","batchNorm")),Ye(i.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Ye(null==c||i.rank===c.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Ye(null==l||i.rank===l.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const h=function(e){let t;return t=0===e.rank||1===e.rank?rs(e,[1,1,1,e.size]):2===e.rank?rs(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?rs(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(s),p={x:h,scale:l,offset:c,mean:i,variance:u},f={varianceEpsilon:o},d=sr.runKernel("FusedBatchNorm",p,f);return rs(d,s.shape)}}),fs=pa({bincount_:function(e,t,n){const r=ca(e,"x","bincount"),a=ca(t,"weights","bincount");Ye("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),Ye(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Ye(a.size===r.size||0===a.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`));const o={x:r,weights:a},s={size:n};return sr.runKernel("Bincount",o,s)}}),ds=pa({broadcastArgs_:function(e,t){const n=ca(e,"s0","broadcastArgs","int32"),r=ca(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const a={s0:n,s1:r};return sr.runKernel("BroadcastArgs",a)}}),ms=pa({broadcastTo_:function(e,t){let n=ca(e,"broadcastTo","x");const r=n.shape;if(t.some((e=>!(e>0)||e%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=rs(n,e)}const a=n.shape,o=Array.from(t);for(let e=t.length-1;e>=0;e--)if(a[e]===t[e])o[e]=1;else if(1!==n.shape[e])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);const s=o.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0));if(0===s.length)return ss(n);const i={x:n},u={reps:o};return sr.runKernel("Tile",i,u)}});function gs(e,t="float32",n){return t=t||"float32",Tt(e),new Un(e,t,n)}const ys=pa({ceil_:function(e){const t={x:ca(e,"x","ceil","float32")};return sr.runKernel("Ceil",t)}}),bs=pa({clipByValue_:function(e,t,n){const r=ca(e,"x","clipByValue");Ye(t<=n,(()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`));const a={x:r},o={clipValueMin:t,clipValueMax:n};return sr.runKernel("ClipByValue",a,o)}}),vs=pa({conv2d_:function(e,t,n,r,a="NHWC",o=[1,1],s){const i=ca(e,"x","conv2d","float32"),u=ca(t,"filter","conv2d","float32");let l=i,c=!1;3===i.rank&&(c=!0,l=rs(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Ye(4===l.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`)),Ye(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),ns("conv2d",r,s);const h="NHWC"===a?l.shape[3]:l.shape[1];Ye(h===u.shape[2],(()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`)),Ye(es(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const p={x:l,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s},d=sr.runKernel("Conv2D",p,f);return c?rs(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),xs=pa({conv1d_:function(e,t,n,r,a="NWC",o=1,s){const i=ca(e,"x","conv1d"),u=ca(t,"filter","conv1d");let l=i,c=!1;2===i.rank&&(c=!0,l=rs(i,[1,i.shape[0],i.shape[1]])),Ye(3===l.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`)),Ye(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),ns("conv1d",r,s),Ye(l.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),Ye(es(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),Ye("NWC"===a,(()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`));const h=rs(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=rs(l,[l.shape[0],1,l.shape[1],l.shape[2]]),f=vs(p,h,[1,n],r,"NHWC",[1,o],s);return rs(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),ws=pa({conv2DBackpropInput_:function(e,t,n,r,a,o="NHWC",s){Ye(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let i=e,u=t,l=!1;3===t.rank&&(l=!0,u=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]]),i=[1,e[0],e[1],e[2]]),Ye(4===i.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${i.length}.`)),Ye(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),Ye(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const c="NHWC"===o?i[3]:i[1],h="NHWC"===o?u.shape[3]:u.shape[1];Ye(c===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`)),Ye(h===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`)),ns("conv2dDerInput",a,s);const p={dy:u,filter:n},f={strides:r,pad:a,dataFormat:o,dimRoundingMode:s,inputShape:i},d=sr.runKernel("Conv2DBackpropInput",p,f);return l?rs(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),_s=pa({conv2dTranspose_:function(e,t,n,r,a,o){const s=ca(e,"x","conv2dTranspose"),i=ca(t,"filter","conv2dTranspose");return ws(n,s,i,r,a,"NHWC",o)}}),Ts=pa({conv3d_:function(e,t,n,r,a="NDHWC",o=[1,1,1]){const s=ca(e,"x","conv3d"),i=ca(t,"filter","conv3d");let u=s,l=!1;4===s.rank&&(l=!0,u=rs(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Ye(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),Ye(5===i.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${i.rank}.`)),Ye(u.shape[4]===i.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${i.shape[3]}.`)),Ye(es(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),Ye("NDHWC"===a,(()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`));const c={x:u,filter:i},h={strides:n,pad:r,dataFormat:a,dilations:o},p=sr.runKernel("Conv3D",c,h);return l?rs(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),Es=pa({cos_:function(e){const t={x:ca(e,"x","cos","float32")};return sr.runKernel("Cos",t)}}),Ss=pa({cosh_:function(e){const t={x:ca(e,"x","cosh","float32")};return sr.runKernel("Cosh",t)}}),Is=pa({cumprod_:function(e,t=0,n=!1,r=!1){const a={x:ca(e,"x","cumprod")},o={axis:t,exclusive:n,reverse:r};return sr.runKernel("Cumprod",a,o)}}),ks=pa({cumsum_:function(e,t=0,n=!1,r=!1){const a={x:ca(e,"x","cumsum")},o={axis:t,exclusive:n,reverse:r};return sr.runKernel("Cumsum",a,o)}}),Cs=pa({denseBincount_:function(e,t,n,r=!1){const a=ca(e,"x","denseBincount"),o=ca(t,"weights","denseBincount");Ye("int32"===a.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`)),Ye(a.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`)),Ye(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Ye(o.size===a.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${o.shape}.`));const s={x:a,weights:o},i={size:n,binaryOutput:r};return sr.runKernel("DenseBincount",s,i)}}),Ns=pa({depthToSpace_:function(e,t,n="NHWC"){const r=ca(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];Ye(t>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`)),Ye(a*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${a} and ${t}  for depthToSpace with input shape\n    ${r.shape}`)),Ye(o*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${t} for depthToSpace with input shape\n        ${r.shape}`)),Ye(s%(t*t)==0,(()=>`Dimension size must be evenly divisible by ${t*t} but is ${s} for depthToSpace with input shape ${r.shape}`));const i={x:r},u={blockSize:t,dataFormat:n};return sr.runKernel("DepthToSpace",i,u)}}),As=pa({depthwiseConv2d_:function(e,t,n,r,a="NHWC",o=[1,1],s){const i=ca(e,"x","depthwiseConv2d","float32"),u=ca(t,"filter","depthwiseConv2d","float32");let l=i,c=!1;3===i.rank&&(c=!0,l=rs(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Ye(4===l.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`)),Ye(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),Ye(l.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),ns("depthwiseConv2d",r,s);const h={x:l,filter:u},p={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s},f=sr.runKernel("DepthwiseConv2dNative",h,p);return c?rs(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),$s=pa({dilation2d_:function(e,t,n,r,a=[1,1],o="NHWC"){const s=ca(e,"x","dilation2d"),i=ca(t,"filter","dilation2d");Ye(3===s.rank||4===s.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`)),Ye(3===i.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${i.rank}.`)),Ye("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=s,l=!1;3===s.rank&&(u=rs(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=!0);const c={x:u,filter:i},h={strides:n,pad:r,dilations:a},p=sr.runKernel("Dilation2D",c,h);return l?rs(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),Rs=pa({equal_:function(e,t){let n=ca(e,"a","equal","string_or_numeric"),r=ca(t,"b","equal","string_or_numeric");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("Equal",a)}}),Fs=pa({where_:function(e,t,n){const r=ca(t,"a","where"),a=ca(n,"b","where"),o=ca(e,"condition","where","bool"),s=so(so(o.shape,r.shape),a.shape),i={condition:ms(o,s),t:ms(r,s),e:ms(a,s)};return sr.runKernel("Select",i)}}),Os=pa({zerosLike_:function(e){const t={x:ca(e,"x","zerosLike")};return sr.runKernel("ZerosLike",t)}}),Ds=pa({divNoNan_:function(e,t){let n=ca(e,"a","div"),r=ca(t,"b","div");[n,r]=Zn(n,r);const a=Ao(n,r),o=Os(a),s=Rs(r,o);return Fs(s,o,a)}}),Ms=pa({einsum_:function(e,...t){const n=t.map(((e,t)=>ca(e,`tensors${t}`,"einsum"))),r={equation:e};return sr.runKernel("Einsum",n,r)}}),Ls=pa({elu_:function(e){const t={x:ca(e,"x","elu","float32")};return sr.runKernel("Elu",t)}}),Ps=pa({erf_:function(e){let t=ca(e,"x","erf");Ye("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=Ka(t,"float32"));const n={x:t};return sr.runKernel("Erf",n)}});function Bs(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Us(e,t,n){const r=e.length+t.length,a=[];let o=0,s=0;for(let i=0;i<r;i++)-1===n.indexOf(i)?a.push(e[o++]):a.push(t[s++]);return a}function zs(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((t=>e[t]))]}function Vs(e,t){return Us(e,t.map((e=>1)),t)}function Ws(e,t,n){Ye(Bs(t,n),(()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`))}function js(e,t){if(Bs(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function Gs(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const Hs=pa({max_:function(e,t=null,n=!1){const r={x:ca(e,"x","max")},a={reductionIndices:t,keepDims:n};return sr.runKernel("Max",r,a)}}),Ks=pa({min_:function(e,t=null,n=!1){const r={x:ca(e,"x","min")},a={axis:t,keepDims:n};return sr.runKernel("Min",r,a)}}),qs=pa({pow_:function(e,t){let n=ca(e,"base","pow"),r=ca(t,"exp","pow");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("Pow",a)}});function Xs(e,t){if((pt(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&pt(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return da(e,[],[],t)}const Ys=pa({sqrt_:function(e){const t={x:ca(e,"x","sqrt","float32")};return sr.runKernel("Sqrt",t)}}),Qs=pa({square_:function(e){const t=ca(e,"x","square");return sr.runKernel("Square",{x:t},{})}}),Js=pa({sum_:function(e,t=null,n=!1){let r=ca(e,"x","sum");"bool"===r.dtype&&(r=Ka(r,"int32"));const a={x:r},o={axis:t,keepDims:n};return sr.runKernel("Sum",a,o)}});function Zs(e,t,n=null){if(0===e.rank)return Ro(e);if(1!==e.rank&&null===n)return Zs(rs(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Js(Ro(e),n);if(t===1/0)return Hs(Ro(e),n);if(t===-1/0)return Ks(Ro(e),n);if("euclidean"===t||2===t)return Ys(Js(qs(Ro(e),Xs(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return Hs(Js(Ro(e),n[0]),n[1]-1);if(t===1/0)return Hs(Js(Ro(e),n[1]),n[0]);if(t===-1/0)return Ks(Js(Ro(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Ys(Js(Qs(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ei=pa({norm_:function(e,t="euclidean",n=null,r=!1){const a=Zs(e=ca(e,"x","norm"),t,n);let o=a.shape;if(r){const t=it(n,e.shape);o=Vs(a.shape,t)}return rs(a,o)}}),ti=pa({euclideanNorm_:function(e,t=null,n=!1){return ei(e,"euclidean",t,n)}}),ni=pa({exp_:function(e){const t={x:ca(e,"x","exp")};return sr.runKernel("Exp",t)}}),ri=pa({expandDims_:function(e,t=0){const n=ca(e,"x","expandDims","string_or_numeric");Ye(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},a={dim:t};return sr.runKernel("ExpandDims",r,a)}}),ai=pa({expm1_:function(e){const t={x:ca(e,"x","expm1")};return sr.runKernel("Expm1",t)}}),oi=pa({tile_:function(e,t){const n=ca(e,"x","tile","string_or_numeric");Ye(n.rank===t.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`));const r={x:n},a={reps:t};return sr.runKernel("Tile",r,a)}}),si=pa({eye_:function(e,t,n,r="float32"){null==t&&(t=e);const a=gs([e,t],r),o=e<=t?e:t;for(let e=0;e<o;++e)a.set(1,e,e);const s=rs(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return oi(ri(s,0),[n[0],1,1]);if(2===n.length)return oi(ri(ri(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return oi(ri(ri(ri(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});function ii(e,t,n){const r={shape:e,value:t,dtype:n};return sr.runKernel("Fill",{},r)}const ui=pa({floor_:function(e){const t={x:ca(e,"x","floor","float32")};return sr.runKernel("Floor",t)}}),li=pa({gather_:function(e,t,n=0,r=0){const a={x:ca(e,"x","gather"),indices:ca(t,"indices","gather","int32")},o={axis:n,batchDims:r};return sr.runKernel("GatherV2",a,o)}}),ci=pa({greater_:function(e,t){let n=ca(e,"a","greater","string_or_numeric"),r=ca(t,"b","greater","string_or_numeric");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("Greater",a)}}),hi=pa({greaterEqual_:function(e,t){let n=ca(e,"a","greaterEqual","string_or_numeric"),r=ca(t,"b","greaterEqual","string_or_numeric");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("GreaterEqual",a)}}),pi=pa({isNaN_:function(e){const t={x:ca(e,"x","isNaN")};return sr.runKernel("IsNan",t)}}),fi=pa({leakyRelu_:function(e,t=.2){const n={x:ca(e,"x","leakyRelu")},r={alpha:t};return sr.runKernel("LeakyRelu",n,r)}}),di=pa({less_:function(e,t){let n=ca(e,"a","less","string_or_numeric"),r=ca(t,"b","less","string_or_numeric");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("Less",a)}}),mi=pa({lessEqual_:function(e,t){let n=ca(e,"a","lessEqual","string_or_numeric"),r=ca(t,"b","lessEqual","string_or_numeric");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("LessEqual",a)}});function gi(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return sr.runKernel("LinSpace",{},r)}const yi=pa({localResponseNormalization_:function(e,t=5,n=1,r=1,a=.5){const o=ca(e,"x","localResponseNormalization");Ye(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),Ye(nt(t),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`));let s=o,i=!1;3===o.rank&&(i=!0,s=rs(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:s},l={depthRadius:t,bias:n,alpha:r,beta:a},c=sr.runKernel("LRN",u,l);return i?rs(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),bi=pa({log_:function(e){const t={x:ca(e,"x","log","float32")};return sr.runKernel("Log",t)}}),vi=pa({log1p_:function(e){const t={x:ca(e,"x","log1p")};return sr.runKernel("Log1p",t)}});function xi(e){return sr.customGrad(e)}const wi=pa({softplus_:function(e){const t={x:ca(e,"x","softplus")};return sr.runKernel("Softplus",t)}}),_i=pa({sub_:function(e,t){let n=ca(e,"a","sub"),r=ca(t,"b","sub");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("Sub",a)}}),Ti=pa({logSoftmax_:function(e,t=-1){const n=ca(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);const r=xi(((e,n)=>{const r=Hs(e,t,!0),a=_i(e,r),o=_i(Ka(a,"float32"),bi(Js(ni(a),t,!0)));return n([o]),{value:o,gradFunc:(e,n)=>{const[r]=n,a=ni(r);return _i(e,$o(Js(e,t,!0),a))}}}));return r(n)}}),Ei=pa({logSumExp_:function(e,t=null,n=!1){const r=ca(e,"x","logSumExp"),a=it(t,r.shape),o=Hs(r,a,!0),s=_i(r,o),i=ni(s),u=Js(i,a),l=bi(u),c=Co(rs(o,l.shape),l);if(n){const e=Vs(c.shape,a);return rs(c,e)}return c}}),Si=pa({logicalAnd_:function(e,t){const n=ca(e,"a","logicalAnd","bool"),r=ca(t,"b","logicalAnd","bool");so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("LogicalAnd",a)}}),Ii=pa({logicalNot_:function(e){const t={x:ca(e,"x","logicalNot","bool")};return sr.runKernel("LogicalNot",t)}}),ki=pa({logicalOr_:function(e,t){const n=ca(e,"a","logicalOr","bool"),r=ca(t,"b","logicalOr","bool");so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("LogicalOr",a)}}),Ci=pa({searchSorted_:function(e,t,n="left"){const r=ca(e,"sortedSequence","searchSorted"),a=ca(t,"values","searchSorted"),o=r.shape[r.shape.length-1],s=a.shape[a.shape.length-1],i=rs(r,[-1,o]),u=rs(a,[-1,s]);if(i.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(i.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(et(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(i.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${i.shape[1]}`);const l={sortedSequence:i,values:u},c={side:n};return sr.runKernel("SearchSorted",l,c)}});function Ni(e,t){return Ci(e,t,"left")}const Ai=pa({maxPool_:function(e,t,n,r,a){const o=ca(e,"x","maxPool");let s=o,i=!1;3===o.rank&&(i=!0,s=rs(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Ye(4===s.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`)),Ye(es(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),ns("maxPool",r,a);const u={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=sr.runKernel("MaxPool",u,l);return i?rs(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),$i=pa({maxPool3d_:function(e,t=[1,1,1],n,r,a,o="NDHWC"){const s=ca(e,"x","maxPool3d");let i=s,u=!1;4===s.rank&&(u=!0,i=rs(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Ye(5===i.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${i.rank}.`)),Ye("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),ns("maxPool3d",r,a);const l={x:i},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:o},h=sr.runKernel("MaxPool3D",l,c);return u?rs(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),Ri=pa({maxPoolWithArgmax_:function(e,t,n,r,a=!1){const o={x:ca(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},i=sr.runKernel("MaxPoolWithArgmax",o,s);return{result:i[0],indexes:i[1]}}}),Fi=pa({maximum_:function(e,t){let n=ca(e,"a","maximum"),r=ca(t,"b","maximum");[n,r]=Zn(n,r),"bool"===n.dtype&&(n=Ka(n,"int32"),r=Ka(r,"int32")),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("Maximum",a)}}),Oi=pa({mean_:function(e,t=null,n=!1){const r={x:ca(e,"x","mean")},a={axis:t,keepDims:n};return sr.runKernel("Mean",r,a)}});function Di(e,t="float32"){if("complex64"===t){const t=Di(e,"float32"),n=Di(e,"float32");return fa(t,n)}const n=_t(et(e),t);return sr.makeTensor(n,e,t)}function Mi(e,t="float32"){if("complex64"===t){const t=Mi(e,"float32"),n=Di(e,"float32");return fa(t,n)}const n=wt(et(e),t);return sr.makeTensor(n,e,t)}const Li=pa({minimum_:function(e,t){let n=ca(e,"a","minimum"),r=ca(t,"b","minimum");[n,r]=Zn(n,r),"bool"===n.dtype&&(n=Ka(n,"int32"),r=Ka(r,"int32")),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("Minimum",a)}}),Pi=pa({mirrorPad_:function(e,t,n){Ye("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=ca(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Ye(t.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`));const a="reflect"===n?1:0;for(let e=0;e<r.rank;e++)Ye(2===t[e].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ye(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(()=>`Padding in dimension ${e} cannot be greater than or equal to ${r.shape[e]-a} or less than 0 for input of shape ${r.shape}`));const o={paddings:t,mode:n},s={x:r};return sr.runKernel("MirrorPad",s,o)}}),Bi=pa({mod_:function(e,t){let n=ca(e,"a","mod"),r=ca(t,"b","mod");[n,r]=Zn(n,r);const a={a:n,b:r};return sr.runKernel("Mod",a)}}),Ui=pa({multinomial_:function(e,t,n,r=!1){const a=ca(e,"logits","multinomial"),o=a.size,s=a.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(s>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${s}`);n=n||Math.random();const i={logits:1===s?rs(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},l=sr.runKernel("Multinomial",i,u);return 1===s?rs(l,[l.size]):l}}),zi=pa({notEqual_:function(e,t){let n=ca(e,"a","notEqual","string_or_numeric"),r=ca(t,"b","notEqual","string_or_numeric");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("NotEqual",a)}}),Vi=pa({onesLike_:function(e){const t={x:ca(e,"x","onesLike")};return sr.runKernel("OnesLike",t)}}),Wi=pa({pad_:function(e,t,n=0){const r=ca(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const a={paddings:t,constantValue:n},o={x:r};return sr.runKernel("PadV2",o,a)}}),ji=pa({spaceToBatchND_:function(e,t,n){const r=ca(e,"x","spaceToBatchND");Ye(r.rank>=1+t.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`)),Ye(n.length===t.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`)),Ye(r.shape.reduce(((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`));const a={x:r},o={blockShape:t,paddings:n};return sr.runKernel("SpaceToBatchND",a,o)}}),Gi=pa({prelu_:function(e,t){const n={x:ca(e,"x","prelu"),alpha:ca(t,"alpha","prelu")};return sr.runKernel("Prelu",n)}}),Hi=pa({prod_:function(e,t=null,n=!1){let r=ca(e,"x","prod");"bool"===r.dtype&&(r=Ka(r,"int32"));const a={x:r},o={axis:t,keepDims:n};return sr.runKernel("Prod",a,o)}});function Ki(e){var t={exports:{}};return e(t,t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self;var qi=Ki((function(e){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,o&&("object"==typeof o&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.alea=o}(0,e)})),Xi=Ki((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==typeof o&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xor128=o}(0,e)})),Yi=Ki((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==typeof o&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)})),Qi=Ki((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&(o.x&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)})),Ji=Ki((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,o=t.i;return t.w=r=r+1640531527|0,n=a[o+34&127],e=a[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,a,o,s,i=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,a=0==(n=i[127&o]^=r+s)?a+1:0);for(a>=128&&(i[127&(t&&t.length||0)]=-1),a=127,o=512;o>0;--o)r=i[a+34&127],n=i[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[a]=r^n;e.w=s,e.X=i,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&(o.X&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)})),Zi=Ki((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,o&&("object"==typeof o&&a(o,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=o:this.tychei=o}(0,e)})),eu=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(Object.freeze({__proto__:null,default:{}})),tu=Ki((function(e){!function(t,n){var r,a=this,o=256,s=n.pow(o,6),i=n.pow(2,52),u=2*i,l=255;function c(e,l,c){var g=[],y=d(f((l=1==l?{entropy:!0}:l||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,s=n&&n.plugins;return[+new Date,a,s,a.screen,m(t)]}}():e,3),g),b=new h(g),v=function(){for(var e=b.g(6),t=s,n=0;e<i;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|b.g(4)},v.quick=function(){return b.g(4)/4294967296},v.double=v,d(m(b.S),t),(l.pass||c||function(e,t,r,a){return a&&(a.S&&p(a,b),e.state=function(){return p(b,{})}),r?(n.random=e,t):e})(v,y,"global"in l?l.global:this==n,l.state)}function h(e){var t,n=e.length,r=this,a=0,s=r.i=r.j=0,i=r.S=[];for(n||(e=[n++]);a<o;)i[a]=a++;for(a=0;a<o;a++)i[a]=i[s=l&s+e[a%n]+(t=i[a])],i[s]=t;(r.g=function(e){for(var t,n=0,a=r.i,s=r.j,i=r.S;e--;)t=i[a=l&a+1],n=n*o+i[l&(i[a]=i[s=l&s+t])+(i[s]=t)];return r.i=a,r.j=s,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(f(e[n],t-1))}catch(e){}return r.length?r:"string"==a?e:e+"\0"}function d(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n.seedrandom=c,d(n.random(),t),e.exports){e.exports=c;try{r=eu}catch(e){}}}([],Math)}));tu.alea=qi,tu.xor128=Xi,tu.xorwow=Yi,tu.xorshift7=Qi,tu.xor4096=Ji,tu.tychei=Zi;var nu=tu;class ru{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=a||Math.random();this.random=nu.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,o;do{r=2*this.random()-1,a=2*this.random()-1,o=r*r+a*a}while(o>=1||0===o);const s=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class au{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=nu.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const ou=pa({randomUniform_:function(e,t=0,n=1,r="float32",a){const o=gs(e,r),s=new au(t,n,null,a);for(let e=0;e<o.values.length;e++)o.values[e]=s.nextValue();return o.toTensor()}});function su(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const a={start:e,stop:t,step:n,dtype:r};return sr.runKernel("Range",{},a)}const iu=pa({reciprocal_:function(e){const t={x:ca(e,"x","reciprocal")};return sr.runKernel("Reciprocal",t)}}),uu=pa({relu_:function(e){const t={x:ca(e,"x","relu")};return sr.runKernel("Relu",t)}}),lu=pa({relu6_:function(e){const t={x:ca(e,"x","relu6")};return sr.runKernel("Relu6",t)}}),cu=pa({reverse_:function(e,t){const n={x:ca(e,"x","reverse")},r={dims:t};return sr.runKernel("Reverse",n,r)}}),hu=pa({round_:function(e){const t={x:ca(e,"x","round")};return sr.runKernel("Round",t)}}),pu=pa({rsqrt_:function(e){const t={x:ca(e,"x","rsqrt","float32")};return sr.runKernel("Rsqrt",t)}}),fu=pa({selu_:function(e){const t={x:ca(e,"x","selu")};return sr.runKernel("Selu",t)}}),du=pa({sign_:function(e){const t={x:ca(e,"x","sign")};return sr.runKernel("Sign",t)}}),mu=pa({sin_:function(e){const t={x:ca(e,"x","sin","float32")};return sr.runKernel("Sin",t)}}),gu=pa({sinh_:function(e){const t={x:ca(e,"x","sinh")};return sr.runKernel("Sinh",t)}}),yu=pa({softmax_:function(e,t=-1){const n=ca(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const r={logits:n},a={dim:t};return sr.runKernel("Softmax",r,a)}}),bu=pa({fft_:function(e){Ye("complex64"===e.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`));const t={input:e};return sr.runKernel("FFT",t)}}),vu=pa({ifft_:function(e){Ye("complex64"===e.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`));const t={input:e};return sr.runKernel("IFFT",t)}}),xu=pa({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const a=rs(e,[n,t]);r=vu(a)}else{const a=[n,2*(t-1)],o=rs(no(e),[n,t]),s=rs(eo(e),[n,t]),i=cu(ls(o,[0,1],[n,t-2]),1),u=$o(cu(ls(s,[0,1],[n,t-2]),1),Xs(-1)),l=is([o,i],1),c=is([s,u],1),h=rs(fa(l,c),[a[0],a[1]]);r=vu(h)}if(r=no(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=rs(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}}),wu=pa({split_:function(e,t,n=0){const r={x:ca(e,"x","split")},a={numOrSizeSplits:t,axis:n};return sr.runKernel("SplitV",r,a)}}),_u=pa({rfft_:function(e,t){Ye("float32"===e.dtype,(()=>`The dtype for rfft() must be real value but got ${e.dtype}`));let n=e.shape[e.shape.length-1];const r=e.size/n;let a;if(null!=t&&t<n){const r=e.shape.map((e=>0)),o=e.shape.map((e=>e));o[e.shape.length-1]=t,a=ls(e,r,o),n=t}else if(null!=t&&t>n){const r=e.shape.map((e=>e));r[e.shape.length-1]=t-n,a=is([e,Di(r)],e.shape.length-1),n=t}else a=e;const o=Os(a),s=rs(fa(a,o),[r,n]),i=bu(s),u=Math.floor(n/2)+1,l=no(i),c=eo(i),h=wu(l,[u,n-u],l.shape.length-1),p=wu(c,[u,n-u],c.shape.length-1),f=a.shape.slice();return f[a.shape.length-1]=u,rs(fa(h[0],p[0]),f)}}),Tu=pa({squaredDifference_:function(e,t){let n=ca(e,"a","squaredDifference"),r=ca(t,"b","squaredDifference");[n,r]=Zn(n,r),so(n.shape,r.shape);const a={a:n,b:r};return sr.runKernel("SquaredDifference",a,{})}}),Eu=pa({squeeze_:function(e,t){const n=ca(e,"x","squeeze");return rs(n,ut(n.shape,t).newShape)}}),Su=pa({stack_:function(e,t=0){const n=ha(e,"tensors","stack","string_or_numeric");Ye(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&Ye(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,a={axis:t};return sr.runKernel("Pack",r,a)}}),Iu=pa({step_:function(e,t=0){const n={x:ca(e,"x","step")},r={alpha:t};return sr.runKernel("Step",n,r)}}),ku=pa({stridedSlice_:function(e,t,n,r,a=0,o=0,s=0,i=0,u=0){const l={x:ca(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:a,endMask:o,ellipsisMask:s,newAxisMask:i,shrinkAxisMask:u};return sr.runKernel("StridedSlice",l,c)}}),Cu=pa({tan_:function(e){const t={x:ca(e,"x","tan","float32")};return sr.runKernel("Tan",t)}});function Nu(e,t){Je(e);const n=ia(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return da(e,null,n,t)}function Au(e,t,n){if(Je(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=ia(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return da(e,t,r,n)}const $u=pa({topk_:function(e,t=1,n=!0){const r=ca(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);const o={x:r},s={k:t,sorted:n},[i,u]=sr.runKernel("TopK",o,s);return{values:i,indices:u}}}),Ru=pa({truncatedNormal_:function(e,t=0,n=1,r,a){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new ru(t,n,r,!0,a),s=gs(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=o.nextValue();return s.toTensor()}}),Fu=pa({unique_:function(e,t=0){const n=ca(e,"x","unique","string_or_numeric");Ye(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},a={axis:t},[o,s]=sr.runKernel("Unique",r,a);return{values:o,indices:s}}}),Ou=pa({unstack_:function(e,t=0){const n=ca(e,"x","unstack","string_or_numeric");Ye(t>=-n.shape.length&&t<n.shape.length,(()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},a={axis:t};return sr.runKernel("Unpack",r,a)}});function Du(e,t){return Ci(e,t,"right")}function Mu(e,t){const n=[];for(let e=0;e<t.length;e++)t[e]&&n.push(e);const r=gs(e,"int32"),a=gs([n.length,e.length],"int32");for(let t=0;t<n.length;t++){const o=r.indexToLoc(n[t]),s=t*e.length;a.values.set(o,s)}return a.toTensor()}const Lu=async function(e){const t=ca(e,"condition","whereAsync","bool"),n=await t.data(),r=Mu(t.shape,n);return e!==t&&t.dispose(),r},Pu=pa({scatterND_:function(e,t,n){const r=ca(e,"indices","scatterND","int32"),a=ca(t,"updates","scatterND");co(a,r,n);const o={indices:r,updates:a},s={shape:n};return sr.runKernel("ScatterNd",o,s)}}),Bu=pa({sparseToDense_:function(e,t,n,r=0){const a=ca(e,"sparseIndices","sparseToDense","int32"),o=ca(t,"sparseValues","sparseToDense","string_or_numeric"),s=ca(r,"defaultValue","sparseToDense",o.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const a=e.rank>0?e.shape[0]:1,o=e.rank>1?e.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const s=t.size;if(0!==t.rank&&(1!==t.rank||s!==a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,o,n,s);const i={sparseIndices:a,sparseValues:o,defaultValue:s},u={outputShape:n};return sr.runKernel("SparseToDense",i,u)}}),Uu=pa({gatherND_:function(e,t){const n=ca(t,"indices","gatherND","int32"),r={params:ca(e,"x","gatherND","string_or_numeric"),indices:n};return sr.runKernel("GatherNd",r)}});function zu(e,t,n){const r=1-e%2,a=new Float32Array(e);for(let o=0;o<e;++o){const s=2*Math.PI*o/(e+r-1);a[o]=t-n*Math.cos(s)}return Nu(a,"float32")}const Vu=pa({conv2DBackpropFilter_:function(e,t,n,r,a,o="NHWC",s){let i=e;3===e.rank&&(i=rs(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;3===u.rank&&(u=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Ye(4===i.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${i.shape}.`)),Ye(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),Ye(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const l="NHWC"===o?i.shape[3]:i.shape[1],c="NHWC"===o?u.shape[3]:u.shape[1];Ye(l===n[2],(()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`)),Ye(c===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`)),ns("conv2dDerFilter",a,s);const h={x:i,dy:u},p={strides:r,pad:a,dataFormat:o,dimRoundingMode:s,filterShape:n};return sr.runKernel("Conv2DBackpropFilter",h,p)}});function Wu(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return $o(e,Iu(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function ju(e,t){let n=t;const r=oo(e.shape,t.shape);return r.length>0&&(n=Js(n,r)),rs(n,e.shape)}function Gu(e,t,n,r){if("linear"===t)return e;if("relu"===t)return uu(e);if("elu"===t)return Ls(e);if("relu6"===t)return lu(e);if("prelu"===t)return Gi(e,n);if("leakyrelu"===t)return fi(e,r);if("sigmoid"===t)return us(e);throw new Error(`Unknown fused activation ${t}.`)}const Hu=(e,t)=>!(e>0)||"linear"===t,Ku=pa({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:i,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",!1===Hu(sr.state.gradientDepth,u)){Ye("NHWC"===a,(()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let h=vs(e,t,n,r,a,o,s);return null!=i&&(h=Co(h,i)),Gu(h,u,l,c)}const h=ca(e,"x","conv2d","float32"),p=ca(t,"filter","conv2d","float32");let f=h,d=!1;3===h.rank&&(d=!0,f=rs(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Ye(4===f.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`)),Ye(4===p.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`)),ns("fused conv2d",r,s);const m="NHWC"===a?f.shape[3]:f.shape[1];Ye(p.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${p.shape[2]}.`)),Ye(es(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const g=Ho(f.shape,p.shape,n,o,r,s);let y,b;if(null!=i&&(y=ca(i,"bias","fused conv2d"),[y]=Zn(y,h),"NHWC"===a?so(g.outShape,y.shape):(Ye(y.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`)),Ye(0===y.shape.length||y.shape[0]===g.outChannels||1===y.shape[0],(()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)))),null!=l){const e=l.shape;if(Ye(e.length<=1||3===e.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${e.length}.`)),1===e.length)Ye(1===e[0]||e[0]===g.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the number of output channels (${g.outChannels}).`));else if(3===e.length)try{so(e,g.outShape)}catch(t){const n=`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(n)}b=ca(l,"prelu weights","fused conv2d")}const v=(e,t)=>{Ye("NHWC"===a,(()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`));const[s,i,l,c]=t,h=Wu(e,l,u);Ye(Zo(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const p=[ws(i.shape,h,s,n,r),Vu(i,h,s.shape,n,r)];if(null!=c){const e=ju(c,h);p.push(e)}return p},x={x:f,filter:p,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:c};if(null==i){const e=xi(((e,t,n)=>{let r=sr.runKernel("FusedConv2D",x,w);return n([t,e,r]),d&&(r=rs(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return e(f,p)}{const e=xi(((e,t,n,r)=>{let a=sr.runKernel("FusedConv2D",x,w);return r([t,e,a,n]),d&&(a=rs(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:v}}));return e(f,p,y)}}}),qu=pa({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a,o=[1,1],s){let i=e;3===e.rank&&(i=rs(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;3===u.rank&&(u=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:i,dy:u},c={strides:r,pad:a,dimRoundingMode:s,dilations:o,filterShape:n};return sr.runKernel("DepthwiseConv2dNativeBackpropFilter",l,c)}}),Xu=pa({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a,o=[1,1],s){let i=t,u=!1;3===t.rank&&(u=!0,i=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:i,filter:n},c={strides:r,pad:a,dimRoundingMode:s,dilations:o,inputShape:e},h=sr.runKernel("DepthwiseConv2dNativeBackpropInput",l,c);return u?rs(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),Yu=pa({fusedDepthwiseConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:i,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(!1===Hu(sr.state.gradientDepth,u)){let h=As(e,t,n,r,a,o,s);return null!=i&&(h=Co(h,i)),Gu(h,u,l,c)}const h=ca(e,"x","depthwiseConv2d","float32"),p=ca(t,"filter","depthwiseConv2d","float32");let f=h,d=!1;3===h.rank&&(d=!0,f=rs(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Ye(4===f.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`)),Ye(4===p.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),Ye(f.shape[3]===p.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),null==o&&(o=[1,1]),Ye(es(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),ns("fused depthwiseConv2d",r,s);const m=Ho(f.shape,p.shape,n,o,r,s,!0);let g,y;null!=i&&(g=ca(i,"bias","fused conv2d"),[g]=Zn(g,h),so(m.outShape,g.shape)),null!=l&&(y=ca(l,"prelu weights","fused depthwiseConv2d"));const b=(e,t)=>{Ye(Zo(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[a,i,l,c]=t,h=Wu(e,l,u),p=Xu(i.shape,h,a,n,r,o,s),f=qu(i,h,a.shape,n,r,o,s);return null!=c?[p,f,ju(g,h)]:[p,f]},v={x:f,filter:p,bias:g,preluActivationWeights:y},x={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:c};if(null==i){const e=xi(((e,t,n)=>{let r=sr.runKernel("FusedDepthwiseConv2D",v,x);return n([t,e,r]),d&&(r=rs(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return e(f,p)}{const e=xi(((e,t,n,r)=>{let a=sr.runKernel("FusedDepthwiseConv2D",v,x);return r([t,e,a,n]),d&&(a=rs(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:b}}));return e(f,p,g)}}}),Qu=pa({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:o="linear",preluActivationWeights:s,leakyreluAlpha:i}){if(!1===Hu(sr.state.gradientDepth,o)){let u=qa(e,t,n,r);return null!=a&&(u=Co(u,a)),Gu(u,o,s,i)}let u=ca(e,"a","fused matMul"),l=ca(t,"b","fused matMul");[u,l]=Zn(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],h=r?l.shape[l.rank-1]:l.shape[l.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-2]:l.shape[l.rank-1],d=u.shape.slice(0,-2),m=l.shape.slice(0,-2),g=et(d),y=et(m);Ye(c===h,(()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=so(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([p,f]),v=rs(u,n?[g,c,p]:[g,p,c]),x=rs(l,r?[y,f,h]:[y,h,f]);let w,_;null!=a&&(w=ca(a,"bias","fused matMul"),[w]=Zn(w,u),so(b,w.shape)),null!=s&&(_=ca(s,"prelu weights","fused matMul"));const T=(e,t)=>{const[s,i,u,l]=t,c=Wu(rs(e,u.shape),u,o);let h,p;return n||r?!n&&r?(h=qa(c,i,!1,!1),p=qa(c,s,!0,!1)):n&&!r?(h=qa(i,c,!1,!0),p=qa(s,c,!1,!1)):(h=qa(i,c,!0,!0),p=qa(c,s,!0,!0)):(h=qa(c,i,!1,!0),p=qa(s,c,!0,!1)),null!=a?[h,p,ju(l,c)]:[h,p]},E={a:v,b:x,bias:w,preluActivationWeights:_},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:i};if(null==a){const e=xi(((e,t,n)=>{const r=sr.runKernel("_FusedMatMul",E,S);return n([e,t,r]),{value:rs(r,b),gradFunc:T}}));return e(v,x)}{const e=xi(((e,t,n,r)=>{const a=sr.runKernel("_FusedMatMul",E,S);return r([e,t,a,n]),{value:rs(a,b),gradFunc:T}}));return e(v,x,w)}}});pa({hammingWindow_:function(e){return zu(e,.54,.46)}});const Ju=pa({hannWindow_:function(e){return zu(e,.5,.5)}}),Zu=pa({frame_:function(e,t,n,r=!1,a=0){let o=0;const s=[];for(;o+t<=e.size;)s.push(ls(e,o,t)),o+=n;if(r)for(;o<e.size;){const r=o+t-e.size,i=is([ls(e,o,t-r),ii([r],a)]);s.push(i),o+=n}return 0===s.length?Au([],[0,t]):rs(is(s),[s.length,t])}});pa({stft_:function(e,t,n,r,a=Ju){var o;null==r&&(o=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));const s=Zu(e,t,n),i=$o(s,a(t));return _u(i,r)}});const el=pa({cropAndResize_:function(e,t,n,r,a="bilinear",o=0){const s=ca(e,"image","cropAndResize"),i=ca(t,"boxes","cropAndResize","float32"),u=ca(n,"boxInd","cropAndResize","int32"),l=i.shape[0];Ye(4===s.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`)),Ye(2===i.rank&&4===i.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${i.shape}.`)),Ye(1===u.rank&&u.shape[0]===l,(()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${i.shape}.`)),Ye(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),Ye(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),Ye("bilinear"===a||"nearest"===a,(()=>`method must be bilinear or nearest, but was ${a}`));const c={image:s,boxes:i,boxInd:u},h={method:a,extrapolationValue:o,cropSize:r};return sr.runKernel("CropAndResize",c,h)}}),tl=pa({flipLeftRight_:function(e){const t=ca(e,"image","flipLeftRight","float32");Ye(4===t.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`));const n={image:t};return sr.runKernel("FlipLeftRight",n,{})}}),nl=pa({grayscaleToRGB_:function(e){const t=ca(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];Ye(t.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`)),Ye(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,oi(t,a)}}),rl=pa({rotateWithOffset_:function(e,t,n=0,r=.5){const a=ca(e,"image","rotateWithOffset","float32");Ye(4===a.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`));const o={image:a},s={radians:t,fillValue:n,center:r};return sr.runKernel("RotateWithOffset",o,s)}});function al(e,t,n,r,a,o){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==o&&(o=0);const s=e.shape[0];return n=Math.min(n,s),Ye(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),Ye(2===e.rank,(()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`)),Ye(4===e.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`)),Ye(1===t.rank,(()=>"scores must be a 1D tensor")),Ye(t.shape[0]===s,(()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${t.shape[0]}`)),Ye(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:o}}const ol=pa({nonMaxSuppression_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){const o=ca(e,"boxes","nonMaxSuppression","float32"),s=ca(t,"scores","nonMaxSuppression","float32"),i=al(o,s,n,r,a),u={maxOutputSize:n=i.maxOutputSize,iouThreshold:r=i.iouThreshold,scoreThreshold:a=i.scoreThreshold};return sr.runKernel("NonMaxSuppressionV3",{boxes:o,scores:s},u)}});function sl(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,a=e.length,o=0,s=!1;for(;r<a;){o=r+(a-r>>>1);const i=n(t,e[o]);i>0?r=o+1:(a=o,s=!i)}return s?r:-r-1}(e,t,n||il)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function il(e,t){return e>t?1:e<t?-1:0}function ul(e,t,n,r,a,o,s=!1,i=!1,u=!1){const l=[];for(let e=0;e<t.length;e++)t[e]>a&&l.push({score:t[e],boxIndex:e,suppressBeginIndex:0});l.sort(hl);const c=o>0?-.5/o:0,h=[],p=[];for(;h.length<n&&l.length>0;){const t=l.pop(),{score:n,boxIndex:o,suppressBeginIndex:s}=t;if(n<a)break;let i=!1;for(let n=h.length-1;n>=s;--n){const s=ll(e,o,h[n]);if(s>=r){i=!0;break}if(t.score=t.score*cl(r,c,s),t.score<=a)break}t.suppressBeginIndex=h.length,i||(t.score===n?(h.push(o),p.push(t.score)):t.score>a&&sl(l,t,hl))}const f=h.length,d=n-f;i&&d>0&&(h.push(...new Array(d).fill(0)),p.push(...new Array(d).fill(0)));const m={selectedIndices:h};return s&&(m.selectedScores=p),u&&(m.validOutputs=f),m}function ll(e,t,n){const r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),f=(i-o)*(u-s),d=(h-l)*(p-c);if(f<=0||d<=0)return 0;const m=Math.max(o,l),g=Math.max(s,c),y=Math.min(i,h),b=Math.min(u,p),v=Math.max(y-m,0)*Math.max(b-g,0);return v/(f+d-v)}function cl(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function hl(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const pl=pa({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,o=0){const s=ca(e,"boxes","nonMaxSuppression"),i=ca(t,"scores","nonMaxSuppression"),u=al(s,i,n,r,a,o),l={boxes:s,scores:i},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},h=sr.runKernel("NonMaxSuppressionV5",l,c);return{selectedIndices:h[0],selectedScores:h[1]}}}),fl=pa({nonMaxSuppressionPadded_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,o=!1){const s=ca(e,"boxes","nonMaxSuppression"),i=ca(t,"scores","nonMaxSuppression"),u=al(s,i,n,r,a,null),l={boxes:s,scores:i},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},h=sr.runKernel("NonMaxSuppressionV4",l,c);return{selectedIndices:h[0],validOutputs:h[1]}}}),dl=pa({resizeBilinear_:function(e,t,n=!1,r=!1){const a=ca(e,"images","resizeBilinear");Ye(3===a.rank||4===a.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`)),Ye(2===t.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`)),Ye(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=a,s=!1;3===a.rank&&(s=!0,o=rs(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const i={images:o},u={alignCorners:n,halfPixelCenters:r,size:t},l=sr.runKernel("ResizeBilinear",i,u);return s?rs(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),ml=pa({resizeNearestNeighbor_:function(e,t,n=!1,r=!1){const a=ca(e,"images","resizeNearestNeighbor");Ye(3===a.rank||4===a.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`)),Ye(2===t.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`)),Ye("float32"===a.dtype||"int32"===a.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),Ye(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=a,s=!1;3===a.rank&&(s=!0,o=rs(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const i={images:o},u={alignCorners:n,halfPixelCenters:r,size:t},l=sr.runKernel("ResizeNearestNeighbor",i,u);return s?rs(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),gl=pa({threshold_:function(e,t="binary",n=!1,r=.5){const a=ca(e,"image","threshold"),o=a.shape[0]*a.shape[1];let s,i,u,l,c=$o(Nu([r]),255);if(Ye(3===a.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`)),Ye(3===a.shape[2]||1===a.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`)),Ye("int32"===a.dtype||"float32"===a.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`)),Ye("otsu"===t||"binary"===t,(()=>`Method must be binary or otsu, but was ${t}`)),3===a.shape[2]){[s,i,u]=wu(a,[1,1,1],-1);const e=$o(s,.2989),t=$o(i,.587),n=$o(u,.114);l=Co(Co(e,t),n)}else l=e;"otsu"===t&&(c=function(e,t){let n,r,a,o,s,i,u=Nu([-1]),l=Nu([0]),c=Nu([0]);for(let h=0;h<e.size-1;h++){n=ls(e,0,h+1),r=ls(e,h+1),s=Ao(Js(n),t),i=Ao(Js(r),t);const p=Js($o(n,su(0,n.size)));a=Ao(p,Js(n));const f=ii(r.shape,n.size),d=Co(su(0,r.size),f),m=$o(r,d);o=Ao(Js(m),Js(r));const g=_i(a,o),y=_i(a,o),b=$o(s,i);c=$o($o(b,g),y);const v=ci(c,l);l=Fs(v,c,l),u=Fs(v,Nu([h]),u)}return u}(fs(Ka(hu(l),"int32"),ma([]),256),o));const h=n?mi(l,c):ci(l,c);return Ka($o(h,255),"int32")}}),yl=pa({transform_:function(e,t,n="nearest",r="constant",a=0,o){const s=ca(e,"image","transform","float32"),i=ca(t,"transforms","transform","float32");Ye(4===s.rank,(()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`)),Ye(2===i.rank&&(i.shape[0]===s.shape[0]||1===i.shape[0])&&8===i.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),Ye(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:s,transforms:i},l={interpolation:n,fillMode:r,fillValue:a,outputShape:o};return sr.runKernel("Transform",u,l)}});function bl(e,t=!1){return sr.tidy((()=>{Ye(2===e.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`));const n=e.shape[0],r=e.shape[1];let a=si(n),o=ss(e);const s=Au([[1]],[1,1]);let i=ss(s);const u=n>=r?r:n;for(let e=0;e<u;++e){const t=o,u=i,l=a;[i,o,a]=sr.tidy((()=>{const t=ls(o,[e,e],[n-e,1]),u=ei(t),l=ls(o,[e,e],[1,1]),c=Fs(ci(l,0),Au([[-1]]),Au([[1]])),h=_i(l,$o(c,u)),p=Ao(t,h);i=1===p.shape[0]?ss(s):is([s,ls(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);const f=to(Ao(qa(c,h),u)),d=ls(o,[e,0],[n-e,r]),m=$o(f,i),g=ro(i);if(0===e)o=_i(d,qa(m,qa(g,d)));else{const t=_i(d,qa(m,qa(g,d)));o=is([ls(o,[0,0],[e,r]),t],0)}const y=ro(m),b=ls(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=_i(b,qa(qa(b,i),y));else{const t=_i(b,qa(qa(b,i),y));a=is([ls(a,[0,0],[n,e]),t],1)}return[i,o,a]})),er([t,u,l]).forEach((e=>e.dispose()))}return!t&&n>r&&(a=ls(a,[0,0],[n,r]),o=ls(o,[0,0],[r,r])),[a,o]}))}var vl;pa({bandPart_:function(e,t,n){Ye(t%1==0,(()=>`bandPart(): numLower must be an integer, got ${t}.`)),Ye(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=ca(e,"a","bandPart");Ye(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const a=r.shape,[o,s]=r.shape.slice(-2);if(!(t<=o))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${o}).`);if(!(n<=s))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${s}).`);t<0&&(t=o),n<0&&(n=s);const i=rs(su(0,o,1,"int32"),[-1,1]),u=su(0,s,1,"int32"),l=_i(i,u),c=Si(mi(l,Xs(+t,"int32")),hi(l,Xs(-n,"int32"))),h=Di([o,s],r.dtype);return rs(Su(Ou(rs(r,[-1,o,s])).map((e=>Fs(c,e,h)))),a)}}),pa({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,Ye(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)Ye(e[t].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`))}else t=!0,e=wu(e,e.shape[0],0).map((e=>Eu(e,[0])));Ye(e.length<=e[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`));const n=[],r=e;for(let t=0;t<e.length;++t)n.push(sr.tidy((()=>{let e=r[t];if(t>0)for(let r=0;r<t;++r){const t=$o(Js($o(n[r],e)),n[r]);e=_i(e,t)}return Ao(e,ei(e,"euclidean"))})));return t?Su(n,0):n}}),pa({qr_:function(e,t=!1){if(Ye(e.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`)),2===e.rank)return bl(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=Ou(rs(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],o=[];return r.forEach((e=>{const[n,r]=bl(e,t);a.push(n),o.push(r)})),[rs(Su(a,0),e.shape),rs(Su(o,0),e.shape)]}}}),function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(vl||(vl={}));const xl=pa({computeWeightedLoss_:function(e,t,n=vl.SUM_BY_NONZERO_WEIGHTS){const r=ca(e,"losses","computeWeightedLoss");let a=null;null!=t&&(a=ca(t,"weights","computeWeightedLoss"));const o=null==a?r:$o(r,a);if(n===vl.NONE)return o;if(n===vl.SUM)return Js(o);if(n===vl.MEAN){if(null==a)return Oi(o);{const e=r.size/a.size,t=Ao(Js(o),Js(a));return e>1?Ao(t,Xs(e)):t}}if(n===vl.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Ao(Js(o),Xs(r.size));{const e=$o(a,Mi(r.shape)),t=Ka(Js(zi(e,Xs(0))),"float32");return Ao(Js(o),t)}}throw Error(`Unknown reduction: ${n}`)}});pa({absoluteDifference_:function(e,t,n,r=vl.SUM_BY_NONZERO_WEIGHTS){const a=ca(e,"labels","absoluteDifference"),o=ca(t,"predictions","absoluteDifference");let s=null;null!=n&&(s=ca(n,"weights","absoluteDifference")),Qe(a.shape,o.shape,"Error in absoluteDifference: ");const i=Ro(_i(a,o));return xl(i,s,r)}}),pa({cosineDistance_:function(e,t,n,r,a=vl.SUM_BY_NONZERO_WEIGHTS){const o=ca(e,"labels","cosineDistance"),s=ca(t,"predictions","cosineDistance");let i=null;null!=r&&(i=ca(r,"weights","cosineDistance")),Qe(o.shape,s.shape,"Error in cosineDistance: ");const u=Xs(1),l=_i(u,Js($o(o,s),n,!0));return xl(l,i,a)}}),pa({hingeLoss_:function(e,t,n,r=vl.SUM_BY_NONZERO_WEIGHTS){let a=ca(e,"labels","hingeLoss");const o=ca(t,"predictions","hingeLoss");let s=null;null!=n&&(s=ca(n,"weights","hingeLoss")),Qe(a.shape,o.shape,"Error in hingeLoss: ");const i=Xs(1);a=_i($o(Xs(2),a),i);const u=uu(_i(i,$o(a,o)));return xl(u,s,r)}}),pa({huberLoss_:function(e,t,n,r=1,a=vl.SUM_BY_NONZERO_WEIGHTS){const o=ca(e,"labels","huberLoss"),s=ca(t,"predictions","huberLoss");let i=null;null!=n&&(i=ca(n,"weights","huberLoss")),Qe(o.shape,s.shape,"Error in huberLoss: ");const u=Xs(r),l=Ro(_i(s,o)),c=Li(l,u),h=_i(l,c),p=Co($o(Xs(.5),Qs(c)),$o(u,h));return xl(p,i,a)}}),pa({logLoss_:function(e,t,n,r=1e-7,a=vl.SUM_BY_NONZERO_WEIGHTS){const o=ca(e,"labels","logLoss"),s=ca(t,"predictions","logLoss");let i=null;null!=n&&(i=ca(n,"weights","logLoss")),Qe(o.shape,s.shape,"Error in logLoss: ");const u=Xs(1),l=Xs(r),c=to($o(o,bi(Co(s,l)))),h=$o(_i(u,o),bi(Co(_i(u,s),l))),p=_i(c,h);return xl(p,i,a)}}),pa({meanSquaredError_:function(e,t,n,r=vl.SUM_BY_NONZERO_WEIGHTS){const a=ca(e,"labels","meanSquaredError"),o=ca(t,"predictions","meanSquaredError");let s=null;null!=n&&(s=ca(n,"weights","meanSquaredError")),Qe(a.shape,o.shape,"Error in meanSquaredError: ");const i=Tu(a,o);return xl(i,s,r)}}),pa({sigmoidCrossEntropy_:function(e,t,n,r=0,a=vl.SUM_BY_NONZERO_WEIGHTS){let o=ca(e,"multiClassLabels","sigmoidCrossEntropy");const s=ca(t,"logits","sigmoidCrossEntropy");let i=null;if(null!=n&&(i=ca(n,"weights","sigmoidCrossEntropy")),Qe(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=Xs(r),t=Xs(1),n=Xs(.5);o=Co($o(o,_i(t,e)),$o(n,e))}const u=function(e,t){const n=ca(e,"labels","sigmoidCrossEntropyWithLogits"),r=ca(t,"logits","sigmoidCrossEntropyWithLogits");Qe(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const a=uu(r),o=$o(r,n),s=vi(ni(to(Ro(r))));return Co(_i(a,o),s)}(o,s);return xl(u,i,a)}}),pa({softmaxCrossEntropy_:function(e,t,n,r=0,a=vl.SUM_BY_NONZERO_WEIGHTS){let o=ca(e,"onehotLabels","softmaxCrossEntropy");const s=ca(t,"logits","softmaxCrossEntropy");let i=null;if(null!=n&&(i=ca(n,"weights","softmaxCrossEntropy")),Qe(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const e=Xs(r),t=Xs(1),n=Xs(o.shape[1]);o=Co($o(o,_i(t,e)),Ao(e,n))}const u=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);const r=xi(((e,t,r)=>{const a=Ei(t,[n],!0),o=_i(Ka(t,"float32"),a);r([e,o]);const s=to($o(o,e));return{value:Js(s,[n]),gradFunc:(e,t)=>{const[r,a]=t,o=Vs(e.shape,[n]);return[$o(rs(e,o),_i(Ka(r,"float32"),ni(a))),$o(rs(e,o),_i(ni(a),Ka(r,"float32")))]}}}));return r(e,t)}(o,s);return xl(u,i,a)}});const wl=pa({sparseFillEmptyRows_:function(e,t,n,r){const a=ca(e,"indices","sparseFillEmptyRows","int32"),o=ca(t,"values","sparseFillEmptyRows"),s=ca(n,"denseShape","sparseFillEmptyRows","int32"),i=ca(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==a.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${a.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==s.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${s.shape}`);if(0!==i.rank)throw new Error(`Default value should be a scalar but received shape ${i.shape}`);const u={indices:a,values:o,denseShape:s,defaultValue:i},l=sr.runKernel("SparseFillEmptyRows",u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}}),_l=pa({sparseReshape_:function(e,t,n){const r=ca(e,"inputIndices","sparseReshape","int32"),a=ca(t,"inputShape","sparseReshape","int32"),o=ca(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==a.rank)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const s={inputIndices:r,inputShape:a,newShape:o},i=sr.runKernel("SparseReshape",s);return{outputIndices:i[0],outputShape:i[1]}}}),Tl=pa({sparseSegmentMean_:function(e,t,n){const r=ca(e,"data","sparseSegmentMean"),a=ca(t,"indices","sparseSegmentMean","int32"),o=ca(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${a.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const s={data:r,indices:a,segmentIds:o};return sr.runKernel("SparseSegmentMean",s)}}),El=pa({sparseSegmentSum_:function(e,t,n){const r=ca(e,"data","sparseSegmentSum"),a=ca(t,"indices","sparseSegmentSum","int32"),o=ca(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${a.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const s={data:r,indices:a,segmentIds:o};return sr.runKernel("SparseSegmentSum",s)}}),Sl=pa({stringNGrams_:function(e,t,n,r,a,o,s,i){const u=ca(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=ca(t,"dataSplits","stringNGrams");if("int32"!==l.dtype)throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:a,rightPad:o,padWidth:s,preserveShortSequences:i},h={data:u,dataSplits:l},p=sr.runKernel("StringNGrams",h,c);return{nGrams:p[0],nGramsSplits:p[1]}}}),Il=pa({stringSplit_:function(e,t,n=!0){const r=ca(e,"input","stringSplit","string"),a=ca(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==a.rank)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);const o={skipEmpty:n},s={input:r,delimiter:a},i=sr.runKernel("StringSplit",s,o);return{indices:i[0],values:i[1],shape:i[2]}}}),kl=pa({stringToHashBucketFast_:function(e,t){const n=ca(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const a={input:n};return sr.runKernel("StringToHashBucketFast",a,r)}}),Cl={flipLeftRight:tl,grayscaleToRGB:nl,resizeNearestNeighbor:ml,resizeBilinear:dl,rotateWithOffset:rl,cropAndResize:el,nonMaxSuppression:ol,nonMaxSuppressionAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){const o=ca(e,"boxes","nonMaxSuppressionAsync"),s=ca(t,"scores","nonMaxSuppressionAsync"),i=al(o,s,n,r,a);n=i.maxOutputSize,r=i.iouThreshold,a=i.scoreThreshold;const u=await Promise.all([o.data(),s.data()]),l=u[0],c=u[1],{selectedIndices:h}=function(e,t,n,r,a){return ul(e,t,n,r,a,0)}(l,c,n,r,a);return o!==e&&o.dispose(),s!==t&&s.dispose(),Nu(h,"int32")},nonMaxSuppressionWithScore:pl,nonMaxSuppressionWithScoreAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,o=0){const s=ca(e,"boxes","nonMaxSuppressionAsync"),i=ca(t,"scores","nonMaxSuppressionAsync"),u=al(s,i,n,r,a,o);n=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,o=u.softNmsSigma;const l=await Promise.all([s.data(),i.data()]),c=l[0],h=l[1],{selectedIndices:p,selectedScores:f}=function(e,t,n,r,a,o){return ul(e,t,n,r,a,o,!0)}(c,h,n,r,a,o);return s!==e&&s.dispose(),i!==t&&i.dispose(),{selectedIndices:Nu(p,"int32"),selectedScores:Nu(f)}},nonMaxSuppressionPadded:fl,nonMaxSuppressionPaddedAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,o=!1){const s=ca(e,"boxes","nonMaxSuppressionAsync"),i=ca(t,"scores","nonMaxSuppressionAsync"),u=al(s,i,n,r,a,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,[p,f]=await Promise.all([s.data(),i.data()]),{selectedIndices:d,validOutputs:m}=function(e,t,n,r,a,o){return ul(e,t,n,r,a,0,!1,o,!0)}(p,f,l,c,h,o);return s!==e&&s.dispose(),i!==t&&i.dispose(),{selectedIndices:Nu(d,"int32"),validOutputs:Xs(m,"int32")}},threshold:gl,transform:yl},Nl={sparseFillEmptyRows:wl,sparseReshape:_l,sparseSegmentMean:Tl,sparseSegmentSum:El},Al={stringNGrams:Sl,stringSplit:Il,stringToHashBucketFast:kl},$l="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function Rl(e,t){const n=e[0].length;e.forEach(((e,t)=>{Ye(e.length===n,(()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`))})),Ye(t>=0&&t<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=e[0];e.forEach(((e,a)=>{for(let o=0;o<n;o++)Ye(o===t||e[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${a}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${a}.`))}))}function Fl(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Ol(e){return e<=30?e:yt(e,Math.floor(Math.sqrt(e)))}function Dl(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)a=a.concat([e[r+1]/t[r],t[r]]);a=a.concat(e.slice(n+1))}return a}function Ml(e,t,n=!0){const r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{const n=[],a=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?a.push(r):n.push(r);r.push(...n),r.push(0),r.push(...a)}return r}function Ll(e,t,n,r=!0){const a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let n=1;n<e.length;++n)n<=t.length?r?a.push(t[n-1]*e[n]):a.push(e[n]/t[n-1]):a.push(e[n]);return a}function Pl(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function Bl(e,t,n){const r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function Ul(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}const zl=/->/g;function Vl(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function Wl(e){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${e}`}function jl(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function Gl(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function Hl(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Kl(e,t){return`size ${e} must be non-negative, not ${t}`}function ql(e,t){return`Input to reshape is a SparseTensor with ${et(e)}\n  dense values, but the requested shape requires a multiple of ${et(t)}. inputShape=${e} outputShape= ${t}`}function Xl(e,t){return`Input to reshape is a tensor with ${et(e)} dense values, but the requested shape has ${et(t)}. inputShape=${e} outputShape=${t}`}function Yl(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Ql(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}var Jl=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:function(e,t){let n,r=!1;for(e<=30?(n=e,r=!0):n=yt(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=yt(e,n+1);return n},computeOutShape:function(e,t,n){const r=[],a=e.length;for(let o=0;o<a;o++)o!==t?r.push(e[o]):r.push(n);return r},collectGatherOpShapeInfo:function(e,t,n,r){const a=t.shape.length,o=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(e.shape[n]!==t.shape[n])throw new Error(`x.shape[${n}]: ${e.shape[n]} should be equal to indices.shape[${n}]: ${t.shape[n]}.`);const s=e.shape[n],i=[];let u=1,l=1,c=1;for(let t=0;t<r;++t)i.push(e.shape[t]),u*=e.shape[t];for(let t=r;t<n;t++)i.push(e.shape[t]),l*=e.shape[t];for(let e=r;e<a;e++)i.push(t.shape[e]);for(let t=n+1;t<o;t++)i.push(e.shape[t]),c*=e.shape[t];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:s,outputShape:i}}});function Zl(e){try{return e.map((e=>$n(e)))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function ec(e){return e.map((e=>An(e)))}var tc=Object.freeze({__proto__:null,slice_util:ko,segment_util:Jl,fromUint8ToStringArray:Zl,fromStringArrayToUint8:ec,upcastType:Jn,axesAreInnerMostDims:Bs,combineLocations:Us,computeOutAndReduceShapes:zs,expandShapeToKeepDim:Vs,assertAxesAreInnerMostDims:Ws,getAxesPermutation:js,getUndoAxesPermutation:function(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))},getInnerMostAxes:Gs,getBroadcastDims:ao,getReductionAxes:oo,assertAndGetBroadcastShape:so,assertParamsConsistent:Rl,computeOutShape:Fl,computeDilation2DInfo:function(e,t,n,r,a="NHWC",o){return Ho(e,[...t,e[3]],n,o,r,null,null,ts(a))},computePool2DInfo:Go,computePool3DInfo:function(e,t,n,r,a,o,s="NDHWC"){const[i,u,l]=Yo(t);let c,h;if("NDHWC"===s)h="channelsLast",c=[i,u,l,e[4],e[4]];else{if("NCDHW"!==s)throw new Error(`Unknown dataFormat ${s}`);h="channelsFirst",c=[i,u,l,e[1],e[1]]}return Ko(e,c,n,r,a,!1,h,o)},computeConv2DInfo:Ho,computeConv3DInfo:Ko,computeDefaultPad:qo,tupleValuesAreOne:Zo,eitherStridesOrDilationsAreOne:es,convertConv2DDataFormat:ts,checkPadOnDimRoundingMode:ns,getFusedDyActivation:Wu,getFusedBiasGradient:ju,applyActivation:Gu,shouldFuse:Hu,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Ol,getImageCenter:function(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]},getReshaped:Dl,getPermuted:Ml,getReshapedPermuted:Ll,getSliceBeginCoords:Pl,getSliceSize:Bl,prepareAndValidate:function(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===et(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const a=t.shape,o=a[a.length-1];let s=1;for(let e=0;e<a.length-1;++e)s*=a[e];const i=e.shape,u=a.slice();u.pop();let l=1;for(let e=o;e<n;++e)l*=i[e],u.push(i[e]);const c=[...bt(e.shape).map((e=>e/l)),1].slice(0,o);return[u,s,l,c]},validateUpdateShape:lo,validateInput:co,calculateShapes:function(e,t,n){const r=t.shape.length,a=r>1?t.shape[r-1]:1,o=n.length;let s=1;for(let e=a;e<o;++e)s*=n[e];const i=a<1?1:a;return{sliceRank:a,numUpdates:et(t.shape)/i,sliceSize:s,strides:[...bt(n.slice(0,a)),1],outputSize:et(n)}},SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Ot,log:function(...e){Nt().getBool("IS_TEST")||Nt().getBool("PROD")||console.log(...e)},mergeRealAndImagArrays:Ul,splitRealAndImagArrays:function(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}},complexWithEvenIndex:function(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=0;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}},complexWithOddIndex:function(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=2;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}},getComplexWithIndex:function(e,t){return{real:e[2*t],imag:e[2*t+1]}},assignToTypedArray:function(e,t,n,r){e[2*r]=t,e[2*r+1]=n},exponents:function(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){const o=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(o),r[a]=Math.sin(o)}return{real:n,imag:r}},exponent:function(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(zl,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,a]=e.split("->");Ye(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),s=o.length;if(t!==s)throw new Error(`Expected ${s} input tensors, received ${t}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const i=[];for(let e=0;e<a.length;++e){const t=a[e];if(!o.some((e=>-1!==e.indexOf(t))))throw new Error(`Output subscripts contain the label ${t} not present in the input subscripts.`);-1===i.indexOf(t)&&i.push(t)}for(let e=0;e<r.length;++e){const t=r[e];-1===i.indexOf(t)&&","!==t&&i.push(t)}const u=new Array(o.length);for(let e=0;e<s;++e){if(new Set(o[e].split("")).size!==o[e].length)throw new Error(`Found duplicate axes in input component ${o[e]}. Support for duplicate axes in input is not implemented yet.`);u[e]=[];for(let t=0;t<o[e].length;++t)u[e].push(i.indexOf(o[e][t]))}const l=i.length,c=[];for(let e=a.length;e<l;++e)c.push(e);return{allDims:i,summedDims:c,idDims:u}},getEinsumPermutation:function(e,t){let n=new Array(e);n.fill(-1);for(let e=0;e<t.length;++e)n[t[e]]=e;const r=[];for(let t=0;t<e;++t)-1===n[t]&&r.push(t);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(e,t,n){const r=new Array(e);for(let e=0;e<n.length;++e){const a=n[e].shape;for(let n=0;n<t[e].length;++n)void 0===r[t[e][n]]?r[t[e][n]]=a[n]:Ye(r[t[e][n]]===a[n],(()=>`Expected dimension ${r[t[e][n]]} at axis ${n} of input shaped ${JSON.stringify(a)}, but got dimension ${a[n]}`))}},getEinsumComputePath:function(e,t){const n=e,r=[];let a=0;0===e.length&&n.push(-1),a=e.length+1;for(let e=0;e<a;++e)r.push([]);const o=[];for(let e=0;e<n.length;++e){const a=Vl(t,n[e]);for(const t of a)-1===o.indexOf(t)&&(r[e].push(t),o.push(t))}return{path:n,steps:r}},isIdentityPermutation:function(e){return e.every(((e,t)=>e===t))},prepareSplitSize:function(e,t,n=0){let r=[];if("number"==typeof t)Ye(e.shape[n]%t==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{Ye(t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0)<=1,(()=>"There should be only one negative value in split array."));const a=t.indexOf(-1);if(-1!==a){const r=t.reduce(((e,t)=>t>0?e+t:e));t[a]=e.shape[n]-r}Ye(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r},getSparseFillEmptyRowsIndicesDenseShapeMismatch:Wl,getSparseFillEmptyRowsNegativeIndexErrorMessage:jl,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Gl,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Hl,getSparseReshapeNegativeOutputDimErrorMessage:Kl,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:ql,getSparseReshapeInputOutputMismatchErrorMessage:Xl,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Yl,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Ql});class nc{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}if(Nt().get("IS_BROWSER")){Nt().setPlatform("browser",new nc);try{Ha.registerManager(La.URL_SCHEME,new Ba)}catch(Yn){}try{Ha.registerManager(Sa.URL_SCHEME,new ka)}catch(Yn){}}let rc;Nt().get("IS_NODE")&&!Nt().get("IS_BROWSER")&&Nt().setPlatform("node",new class{constructor(){this.util=n(345),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=Nt().global.fetch?Nt().global.fetch(e,t):(null==rc&&(rc=n(683)),rc(e,t))}now(){const e=We.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}),or();const ac={buffer:gs,cast:Ka,clone:ss,print:function(e,t=!1){console.log(e.toString(t))}};var oc,sc;Vn=ac,Nt().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(oc||(oc={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(sc||(sc={}));const ic={};function uc(e){return ic[e]}function lc(e,t,n,r,a){const o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){const e=o.inputIndexStart,s=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?e+1:o.inputIndexEnd;if("tensor"===o.type)return cc(t.inputNames[o.inputIndexStart],n,r,a);if("tensors"===o.type)return t.inputNames.slice(e,s).map((e=>cc(e,n,r,a)));const i=cc(t.inputNames.slice(e)[0],n,r,a),u=i.dataSync();return"number"===o.type?u[0]:xt(i.shape,u)}const s=t.attrParams[e];return s&&s.value}function cc(e,t,n,r){const[a,o]=fc(e);if(null!=r){const e=r.getHashTableHandleByName(a);if(null!=e)return e}const s=n.currentContextIds.find((e=>!!t[pc(a,e)]));return void 0!==s?t[pc(a,s)][o]:void 0}function hc(e,t){const[n,r,a]=fc(e);return[pc(n,t&&t.currentContextId),r,a]}function pc(e,t){return t?`${e}-${t}`:e}function fc(e){const t=e.split(":");if(1===t.length)return[e,0,void 0];const n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function dc(e,t,n){let r=lc("pad",e,t,n);if("explicit"===r){r=lc("explicitPaddings",e,t,n);const a=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)a[e][0]=r[2*e],a[e][1]=r[2*e+1];return a}return r}function mc(e){return e.kept?e:ss(e)}var gc=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),yc=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),bc=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]}),vc=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]}),xc=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),wc=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),_c=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]}),Tc=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),Ec=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]}),Sc=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]}),Ic=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),kc=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]}),Cc=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Nc=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]}),Ac=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),$c=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]}),Rc=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Fc=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]}),Oc=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class Dc{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[gc,yc,bc,vc,xc,wc,_c,Tc,Ec,Sc,Ic,kc,Cc,Nc,Ac,$c,Rc,Fc,Oc].map((e=>e.json)));this.opMappers=e.reduce(((e,t)=>(e[t.tfOpName]=t,e)),{})}transformGraph(e,t={}){const n=e.node,r=[],a=[],o=[],s=n.reduce(((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?a.push(e[t.name]):null!=t.input&&0!==t.input.length||o.push(e[t.name]),e)),{});let i=[];const u=[];let l={},c={};null!=t&&(l=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));const h=Object.keys(s);h.forEach((e=>{const t=s[e];t.inputNames.forEach(((e,n)=>{const[r,,a]=hc(e),o=s[r];if(null!=o.outputs){const e=o.outputs.indexOf(a);if(-1!==e){const a=`${r}:${e}`;t.inputNames[n]=a}}t.inputs.push(o),o.children.push(t)}))})),0===Object.keys(c).length?h.forEach((e=>{const t=s[e];0===t.children.length&&u.push(t)})):Object.keys(c).forEach((e=>{const[t]=hc(e),n=s[t];null!=n&&(n.signatureKey=c[e],u.push(n))})),Object.keys(l).length>0?Object.keys(l).forEach((e=>{const[t]=hc(e),n=s[t];n&&(n.signatureKey=l[e],i.push(n))})):i=r;let p={};null!=e.library&&null!=e.library.function&&(p=e.library.function.reduce(((e,t)=>(e[t.signature.name]=this.mapFunction(t),e)),{}));const f={nodes:s,inputs:i,outputs:u,weights:a,placeholders:r,signature:t,functions:p};return o.length>0&&(f.initNodes=o),f}mapSignatureEntries(e){return Object.keys(e||{}).reduce(((t,n)=>(t[e[n].name]=n,t)),{})}mapNode(e){const t=uc(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((e=>e.startsWith("^")?e.slice(1):e)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce(((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e)),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce(((t,n)=>{const r=n.type;let a;switch(n.type){case"string":a=Lc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Lc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":a=Kc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Kc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":a=Bc(e.attr,n.tfName,n.defaultValue||0),void 0===a&&n.tfDeprecatedName&&(a=Bc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":a=Hc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Hc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":a=Pc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Pc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":a=Xc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Xc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":a=Gc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Gc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":a=qc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=qc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":a=Vc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Vc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":a=Wc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Wc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":a=zc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=zc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${e.op}`)}return t[n.name]={value:a,type:r},t}),{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce(((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e)),{}));const a=[],o=[];e.signature.inputArg.forEach((e=>{const[t]=hc(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Uc(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,a.push(n),r[t]=n})),Object.keys(r).forEach((e=>{const t=r[e];t.inputNames.forEach(((e,n)=>{const[a,,o]=hc(e),s=r[a];if(null!=s.outputs){const e=s.outputs.indexOf(o);if(-1!==e){const r=`${a}:${e}`;t.inputNames[n]=r}}t.inputs.push(s),s.children.push(t)}))}));const s=e.ret;e.signature.outputArg.forEach((e=>{const[t,n]=hc(s[e.name]),a=r[t];null!=a&&(a.defaultOutput=n,o.push(a))}));const i=this.mapArgsToSignature(e);return{nodes:r,inputs:a,outputs:o,weights:n,placeholders:[],signature:i}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e)),{}),outputs:e.signature.outputArg.reduce(((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t)),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function Mc(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=Nt().global;return void 0!==t.atob?t.atob(e):new Er(e,"base64").toString()}(e);return t?n:n.toLowerCase()}function Lc(e,t,n,r=!1){const a=e[t];return null!=a?Mc(a.s,r):n}function Pc(e,t,n){const r=e[t];return r?r.b:n}function Bc(e,t,n){const r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function Uc(e){switch("string"==typeof e&&(e=oc[e]),e){case oc.DT_FLOAT:case oc.DT_HALF:return"float32";case oc.DT_INT32:case oc.DT_INT64:case oc.DT_INT8:case oc.DT_UINT8:return"int32";case oc.DT_BOOL:return"bool";case oc.DT_DOUBLE:return"float32";case oc.DT_STRING:return"string";default:return null}}function zc(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function Vc(e,t,n){const r=e[t];return r&&r.type?Uc(r.type):n}function Wc(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map((e=>Uc(e))):n}function jc(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((e=>"number"==typeof e.size?e.size:parseInt(e.size,10))):[]}function Gc(e,t,n){const r=e[t];return r&&r.shape?jc(r.shape):n}function Hc(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((e=>"number"==typeof e?e:parseInt(e,10))):n}function Kc(e,t,n,r=!1){const a=e[t];return a&&a.list&&a.list.s?a.list.s.map((e=>Mc(e,r))):n}function qc(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((e=>jc(e))):n}function Xc(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}class Yc{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((e=>this.getInput(e))),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce(((e,t)=>(e[t]=this.getAttr(t),e)),{}))}getInput(e){return cc(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return cc(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Bc(this.node.rawAttrs,e,t);if(null!=n.s)return Lc(this.node.rawAttrs,e,t);if(null!=n.b)return Pc(this.node.rawAttrs,e,t);if(null!=n.shape)return Gc(this.node.rawAttrs,e,t);if(null!=n.type)return Vc(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Hc(this.node.rawAttrs,e,t);if(null!=n.list.s)return Kc(this.node.rawAttrs,e,t);if(null!=n.list.shape)return qc(this.node.rawAttrs,e,t);if(null!=n.list.b)return Xc(this.node.rawAttrs,e,t);if(null!=n.list.type)return Wc(this.node.rawAttrs,e,t)}return t}}function Qc(e,t,n=""){if("number"!=typeof e&&"number"!=typeof t){Ye(e.length===t.length,(()=>n+` Shapes ${e} and ${t} must match`));for(let r=0;r<e.length;r++){const a=e[r],o=t[r];Ye(a<0||o<0||a===o,(()=>n+` Shapes ${e} and ${t} must match`))}}}function Jc(e){return"number"!=typeof e&&!e.some((e=>e<0))}function Zc(e,t,n){let r=eh(e,n);const a=!Jc(r);if(a&&0===t.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach((e=>{r=eh(e.shape,r)})),!Jc(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function eh(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);const n=[];for(let r=0;r<e.length;++r){const a=e[r],o=t[r];if(a>=0&&o>=0&&a!==o)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:o}return n}class th{constructor(e,t,n,r,a,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Xs(0),Ja(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach((t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map((e=>this.read(e)))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},\n          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),Qc(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,Ja(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach(((e,n)=>this.write(e,t[n])))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return ma([],[0].concat(this.elementShape));const n=this.readMany(e);return Qc(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Su(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(0===this.size())return ma([],[0].concat(this.elementShape));const t=[];for(let e=0;e<this.size();e++)t.push(e);const n=this.readMany(t);return Qc(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),is(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,Ou(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0;const r=e.map((e=>(n+=e,n)));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const a=0===n?0:t.size/n,o=[];Qa((()=>{t=rs(t,[1,n,a]);for(let n=0;n<e.length;++n){const s=[0,0===n?0:r[n-1],0],i=[1,e[n],a];o[n]=rs(ls(t,s,i),this.elementShape)}return o}));const s=[];for(let t=0;t<e.length;t++)s[t]=t;this.writeMany(s,o)}}class nh{constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach((e=>{if(n!==e.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);Qc(t,e.shape,"TensorList shape mismatch: "),Ja(e)})),this.idTensor=Xs(0),this.maxNumElements=r,Ja(this.idTensor)}get id(){return this.idTensor.id}copy(){return new nh([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach((t=>{null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);Qc(e,this.elementShape,"TensorList shape mismatch: ");const r=Zc(this.elementShape,this.tensors,e);return Qa((()=>{const e=this.tensors.map((e=>rs(e,r)));return Su(e,0)}))}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=Zc(this.elementShape,this.tensors,e),r=this.tensors.pop();return Qc(r.shape,e,"TensorList shape mismatch: "),rs(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Qc(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Ja(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new nh([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw new Error(`element at index ${e} is null.`);Qc(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=Zc(this.elementShape,this.tensors,t);return rs(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Qc(this.elementShape,t.shape,"TensorList shape mismatch: "),Ja(t),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);Qc(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=Zc(this.elementShape,this.tensors,n);return 0===e.length?ma([],[0].concat(r)):Qa((()=>{const t=e.map((e=>rs(this.tensors[e],r)));return Su(t,0)}))}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Qc(this.elementShape,t,"TensorList shape mismatch: ");const n=Zc(this.elementShape,this.tensors,t);return 0===this.size()?ma([],[0].concat(n)):Qa((()=>{const e=this.tensors.map((e=>rs(e,n)));return is(e,0)}))}}function rh(e,t,n){const[r,a]=lc("fusedOps",e,t,n),o="biasadd"===r,s=!o,i="prelu"===a,u="fusedbatchnorm"===r,l=lc("numArgs",e,t,n);if(o){if(i&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&o&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=lc("strides",e,t,n),h=dc(e,t,n),p=lc("dataFormat",e,t,n).toUpperCase(),f=lc("dilations",e,t,n);let[d,m]=lc("args",e,t,n);return s&&(m=d,d=void 0),{stride:c,pad:h,dataFormat:p,dilations:f,biasArg:d,preluArg:m,activationFunc:a,leakyreluAlpha:lc("leakyreluAlpha",e,t,n)}}function ah(e,t,n){return{boxes:lc("boxes",e,t,n),scores:lc("scores",e,t,n),maxOutputSize:lc("maxOutputSize",e,t,n),iouThreshold:lc("iouThreshold",e,t,n),scoreThreshold:lc("scoreThreshold",e,t,n),softNmsSigma:lc("softNmsSigma",e,t,n)}}class oh{constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Xs(0),this.tensorMap=new Map,Ja(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Xs(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),Qa((()=>{const e=Ou(t),r=n.length,a=e.length;Ye(r===a,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${a} elements.`));for(let t=0;t<r;t++){const r=n[t],a=e[t];Ja(a),this.tensorMap.set(r,a)}return this.handle}))}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return Qa((()=>{const e=[];for(let r=0;r<n.length;r++){const a=n[r],o=this.findWithDefault(a,t);e.push(o)}return Su(e)}))}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}function sh(e,t,n,r){const a=((e,t,n)=>{switch(e.category){case"arithmetic":return Qa((()=>((e,t,n)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[Co(lc("a",e,t,n),lc("b",e,t,n))];case"AddN":return[Do(lc("tensors",e,t,n))];case"FloorMod":case"Mod":return[Bi(lc("a",e,t,n),lc("b",e,t,n))];case"Mul":return[$o(lc("a",e,t,n),lc("b",e,t,n))];case"RealDiv":case"Div":return[Ao(lc("a",e,t,n),lc("b",e,t,n))];case"DivNoNan":return[Ds(lc("a",e,t,n),lc("b",e,t,n))];case"FloorDiv":return[No(lc("a",e,t,n),lc("b",e,t,n))];case"Sub":return[_i(lc("a",e,t,n),lc("b",e,t,n))];case"Minimum":return[Li(lc("a",e,t,n),lc("b",e,t,n))];case"Maximum":return[Fi(lc("a",e,t,n),lc("b",e,t,n))];case"Pow":return[qs(lc("a",e,t,n),lc("b",e,t,n))];case"SquaredDifference":return[Tu(lc("a",e,t,n),lc("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"basic_math":return Qa((()=>((e,t,n)=>{switch(e.op){case"Abs":case"ComplexAbs":return[Ro(lc("x",e,t,n))];case"Acos":return[Fo(lc("x",e,t,n))];case"Acosh":return[Oo(lc("x",e,t,n))];case"Asin":return[Uo(lc("x",e,t,n))];case"Asinh":return[zo(lc("x",e,t,n))];case"Atan":return[Vo(lc("x",e,t,n))];case"Atan2":return[Wo(lc("x",e,t,n),lc("y",e,t,n))];case"Atanh":return[jo(lc("x",e,t,n))];case"Ceil":return[ys(lc("x",e,t,n))];case"Complex":return[fa(lc("real",e,t,n),lc("imag",e,t,n))];case"Cos":return[Es(lc("x",e,t,n))];case"Cosh":return[Ss(lc("x",e,t,n))];case"Elu":return[Ls(lc("x",e,t,n))];case"Erf":return[Ps(lc("x",e,t,n))];case"Exp":return[ni(lc("x",e,t,n))];case"Expm1":return[ai(lc("x",e,t,n))];case"Floor":return[ui(lc("x",e,t,n))];case"Log":return[bi(lc("x",e,t,n))];case"Log1p":return[vi(lc("x",e,t,n))];case"Imag":return[eo(lc("x",e,t,n))];case"Neg":return[to(lc("x",e,t,n))];case"Reciprocal":return[iu(lc("x",e,t,n))];case"Real":return[no(lc("x",e,t,n))];case"Relu":return[uu(lc("x",e,t,n))];case"Round":return[hu(lc("x",e,t,n))];case"Selu":return[fu(lc("x",e,t,n))];case"Sigmoid":return[us(lc("x",e,t,n))];case"Sin":return[mu(lc("x",e,t,n))];case"Sign":return[du(lc("x",e,t,n))];case"Sinh":return[gu(lc("x",e,t,n))];case"Softplus":return[wi(lc("x",e,t,n))];case"Sqrt":return[Ys(lc("x",e,t,n))];case"Square":return[Qs(lc("x",e,t,n))];case"Tanh":return[cs(lc("x",e,t,n))];case"Tan":return[Cu(lc("x",e,t,n))];case"ClipByValue":return[bs(lc("x",e,t,n),lc("clipValueMin",e,t,n),lc("clipValueMax",e,t,n))];case"Relu6":return[lu(lc("x",e,t,n))];case"Rsqrt":return[pu(cc(e.inputNames[0],t,n))];case"Prod":return[Hi(lc("x",e,t,n),lc("axes",e,t,n))];case"LeakyRelu":return[fi(lc("x",e,t,n),lc("alpha",e,t,n))];case"Prelu":return[Gi(lc("x",e,t,n),lc("alpha",e,t,n))];case"IsNan":return[pi(cc(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"control":return(async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=lc("thenBranch",e,t,n),a=lc("elseBranch",e,t,n),o=lc("cond",e,t,n),s=lc("args",e,t,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=lc("body",e,t,n),a=lc("cond",e,t,n),o=lc("args",e,t,n),s=await n.functionMap[a].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),i=o.map((e=>e.id));let u=await s[0].data();s.forEach((e=>{e.kept||-1!==i.indexOf(e.id)||e.dispose()}));let l=o;for(;u[0];){const e=l;l=await n.functionMap[r].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap);const t=l.map((e=>e.id));e.forEach((e=>{e.kept||-1!==i.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}));const o=await n.functionMap[a].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((e=>{e.kept||-1!==i.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}))}return l}case"LoopCond":return[mc(lc("pred",e,t,n))];case"Switch":{const r=lc("pred",e,t,n);let a=lc("data",e,t,n);return a.kept||(a=mc(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{const r=e.inputNames.find((e=>void 0!==cc(e,t,n)));return r?[mc(cc(r,t,n))]:void 0}case"Enter":{const r=lc("frameName",e,t,n),a=lc("tensor",e,t,n);return n.enterFrame(r),[mc(a)]}case"Exit":{const r=lc("tensor",e,t,n);return n.exitFrame(),[mc(r)]}case"NextIteration":{const r=lc("tensor",e,t,n);return n.nextIteration(),[mc(r)]}case"TensorArrayV3":{const r=lc("size",e,t,n),a=lc("dtype",e,t,n),o=lc("elementShape",e,t,n),s=lc("dynamicSize",e,t,n),i=lc("clearAfterRead",e,t,n),u=lc("identicalElementShapes",e,t,n),l=lc("name",e,t,n),c=new th(l,a,r,o,u,s,i);return n.addTensorArray(c),[c.idTensor,Xs(1)]}case"TensorArrayWriteV3":{const r=lc("tensorArrayId",e,t,n),a=lc("index",e,t,n),o=lc("tensor",e,t,n),s=n.getTensorArray(r.id);return s.write(a,o),[s.idTensor]}case"TensorArrayReadV3":{const r=lc("tensorArrayId",e,t,n),a=lc("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{const r=lc("tensorArrayId",e,t,n),a=lc("indices",e,t,n),o=lc("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,o)]}case"TensorArrayScatterV3":{const r=lc("tensorArrayId",e,t,n),a=lc("indices",e,t,n),o=lc("tensor",e,t,n),s=n.getTensorArray(r.id);return s.scatter(a,o),[s.idTensor]}case"TensorArrayConcatV3":{const r=lc("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),o=lc("dtype",e,t,n);return[a.concat(o)]}case"TensorArraySplitV3":{const r=lc("tensorArrayId",e,t,n),a=lc("tensor",e,t,n),o=lc("lengths",e,t,n),s=n.getTensorArray(r.id);return s.split(o,a),[s.idTensor]}case"TensorArraySizeV3":{const r=lc("tensorArrayId",e,t,n);return[Xs(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=lc("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{const r=lc("tensorListId",e,t,n),a=lc("index",e,t,n),o=lc("tensor",e,t,n),s=n.getTensorList(r.id);return s.setItem(a,o),[s.idTensor]}case"TensorListGetItem":{const r=lc("tensorListId",e,t,n),a=lc("index",e,t,n),o=lc("elementShape",e,t,n),s=lc("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,o,s)]}case"TensorListScatterV2":case"TensorListScatter":{const r=lc("indices",e,t,n),a=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const a=Math.max(...t);if(null!=r&&-1!==r&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);const o=new nh([],n,e.dtype,r),s=Ou(e,0);return t.forEach(((e,t)=>{o.setItem(e,s[t])})),o}(lc("tensor",e,t,n),r,lc("elementShape",e,t,n),lc("numElements",e,t,n));return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=lc("elementShape",e,t,n),a=lc("elementDType",e,t,n);let o;o="TensorListReserve"===e.op?"numElements":"maxNumElements";const s=function(e,t,n){return new nh([],e,t,n)}(r,a,lc(o,e,t,n));return n.addTensorList(s),[s.idTensor]}case"TensorListGather":{const r=lc("tensorListId",e,t,n),a=lc("indices",e,t,n),o=lc("elementShape",e,t,n),s=lc("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,s,o)]}case"TensorListStack":{const r=lc("tensorListId",e,t,n),a=lc("elementShape",e,t,n),o=lc("elementDType",e,t,n),s=lc("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,o,s)]}case"TensorListFromTensor":{const r=function(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);Qc(e.shape.slice(1),t,"TensorList shape mismatch: ");const a=Ou(e);return new nh(a,t,r)}(lc("tensor",e,t,n),lc("elementShape",e,t,n),lc("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=lc("tensorListId",e,t,n),a=n.getTensorList(r.id),o=lc("dtype",e,t,n),s=lc("elementShape",e,t,n);return[a.concat(o,s)]}case"TensorListPushBack":{const r=lc("tensorListId",e,t,n),a=lc("tensor",e,t,n),o=n.getTensorList(r.id);return o.pushBack(a),[o.idTensor]}case"TensorListPopBack":{const r=lc("tensorListId",e,t,n),a=lc("elementShape",e,t,n),o=lc("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,o)]}case"TensorListSplit":{const r=lc("tensor",e,t,n),a=lc("elementShape",e,t,n),o=function(e,t,n){let r=0;const a=t.map((e=>(r+=e,r)));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${e.shape}`);const o=eh(e.shape.slice(1),n),s=0===r?0:e.size/r,i=Qa((()=>{const n=[];e=rs(e,[1,r,s]);for(let r=0;r<t.length;++r){const i=[0,0===r?0:a[r-1],0],u=[1,t[r],s];n[r]=rs(ls(e,i,u),o)}return e.dispose(),n})),u=new nh([],n,e.dtype,t.length);for(let e=0;e<i.length;e++)u.setItem(e,i[e]);return u}(r,lc("lengths",e,t,n),a);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=lc("tensorListId",e,t,n);return[Xs(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=lc("tensorListId",e,t,n),a=lc("size",e,t,n),o=n.getTensorList(r.id).resize(a);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"convolution":return Qa((()=>((e,t,n)=>{switch(e.op){case"Conv1D":{const r=lc("stride",e,t,n),a=lc("pad",e,t,n),o=lc("dataFormat",e,t,n).toUpperCase(),s=lc("dilation",e,t,n);return[xs(lc("x",e,t,n),lc("filter",e,t,n),r,a,o,s)]}case"Conv2D":{const r=lc("strides",e,t,n),a=dc(e,t,n),o=lc("dataFormat",e,t,n).toUpperCase(),s=lc("dilations",e,t,n);return[vs(lc("x",e,t,n),lc("filter",e,t,n),[r[1],r[2]],a,o,[s[1],s[2]])]}case"_FusedConv2D":{const{stride:r,pad:a,dataFormat:o,dilations:s,biasArg:i,preluArg:u,activationFunc:l,leakyreluAlpha:c}=rh(e,t,n);return[Ku({x:lc("x",e,t,n),filter:lc("filter",e,t,n),strides:[r[1],r[2]],pad:a,dataFormat:o,dilations:[s[1],s[2]],bias:i,activation:l,preluActivationWeights:u,leakyreluAlpha:c})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:a,dataFormat:o,dilations:s,biasArg:i,preluArg:u,activationFunc:l,leakyreluAlpha:c}=rh(e,t,n);return[Yu({x:lc("x",e,t,n),filter:lc("filter",e,t,n),strides:[r[1],r[2]],pad:a,dataFormat:o,dilations:[s[1],s[2]],bias:i,activation:l,preluActivationWeights:u,leakyreluAlpha:c})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=lc("outputShape",e,t,n),a=lc("strides",e,t,n),o=dc(e,t,n);return[_s(lc("x",e,t,n),lc("filter",e,t,n),r,[a[1],a[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=lc("strides",e,t,n),a=dc(e,t,n),o=lc("dilations",e,t,n),s=lc("dataFormat",e,t,n).toUpperCase();return[As(lc("input",e,t,n),lc("filter",e,t,n),[r[1],r[2]],a,s,[o[1],o[2]])]}case"Conv3D":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("dataFormat",e,t,n).toUpperCase(),s=lc("dilations",e,t,n);return[Ts(lc("x",e,t,n),lc("filter",e,t,n),[r[1],r[2],r[3]],a,o,[s[1],s[2],s[3]])]}case"AvgPool":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("kernelSize",e,t,n);return[as(lc("x",e,t,n),[o[1],o[2]],[r[1],r[2]],a)]}case"MaxPool":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("kernelSize",e,t,n);return[Ai(lc("x",e,t,n),[o[1],o[2]],[r[1],r[2]],a)]}case"MaxPoolWithArgmax":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("kernelSize",e,t,n),s=lc("includeBatchInIndex",e,t,n),{result:i,indexes:u}=Ri(lc("x",e,t,n),[o[1],o[2]],[r[1],r[2]],a,s);return[i,u]}case"AvgPool3D":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("kernelSize",e,t,n);return[os(lc("x",e,t,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],a)]}case"MaxPool3D":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("kernelSize",e,t,n);return[$i(lc("x",e,t,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],a)]}case"Dilation2D":{const r=lc("strides",e,t,n),a=lc("pad",e,t,n),o=lc("dilations",e,t,n),s=r[1],i=r[2],u=o[1],l=o[2];return[$s(lc("x",e,t,n),lc("filter",e,t,n),[s,i],a,[u,l],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"creation":return Qa((()=>((e,t,n)=>{switch(e.op){case"Fill":{const r=lc("shape",e,t,n),a=lc("dtype",e,t,n);return[ii(r,lc("value",e,t,n),a)]}case"LinSpace":return[gi(lc("start",e,t,n),lc("stop",e,t,n),lc("num",e,t,n))];case"Multinomial":{const r=lc("logits",e,t,n),a=lc("numSamples",e,t,n),o=lc("seed",e,t,n);return[Ui(r,a,o)]}case"OneHot":{const r=lc("indices",e,t,n),a=lc("depth",e,t,n),o=lc("onValue",e,t,n),s=lc("offValue",e,t,n);return[Xa(r,a,o,s)]}case"Ones":return[Mi(lc("shape",e,t,n),lc("dtype",e,t,n))];case"OnesLike":return[Vi(lc("x",e,t,n))];case"RandomUniform":return[ou(lc("shape",e,t,n),lc("minval",e,t,n),lc("maxval",e,t,n),lc("dtype",e,t,n))];case"Range":return[su(lc("start",e,t,n),lc("stop",e,t,n),lc("step",e,t,n),lc("dtype",e,t,n))];case"TruncatedNormal":{const r=lc("shape",e,t,n),a=lc("mean",e,t,n),o=lc("stdDev",e,t,n),s=lc("seed",e,t,n);return[Ru(r,a,o,lc("dtype",e,t,n),s)]}case"Zeros":return[Di(lc("shape",e,t,n),lc("dtype",e,t,n))];case"ZerosLike":return[Os(lc("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"dynamic":return(async(e,t,n)=>{switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:a,maxOutputSize:o,iouThreshold:s,scoreThreshold:i,softNmsSigma:u}=ah(e,t,n),l=await Cl.nonMaxSuppressionWithScoreAsync(r,a,o,s,i,u);return[l.selectedIndices,l.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:a,maxOutputSize:o,iouThreshold:s,scoreThreshold:i}=ah(e,t,n),u=lc("padToMaxOutputSize",e,t,n),l=await Cl.nonMaxSuppressionPaddedAsync(r,a,o,s,i,u);return[l.selectedIndices,l.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:a,maxOutputSize:o,iouThreshold:s,scoreThreshold:i}=ah(e,t,n);return[await Cl.nonMaxSuppressionAsync(r,a,o,s,i)]}case"Where":{const r=Ka(lc("condition",e,t,n),"bool"),a=[await Lu(r)];return r.dispose(),a}case"ListDiff":return async function(e,t){const n=ca(e,"x","setdiff1d"),r=ca(t,"y","setdiff1d");Ye(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),Ye(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),Ye(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const a=await n.data(),o=await r.data(),s=new Set(o);let i=0;for(let e=0;e<a.length;e++)s.has(a[e])||i++;const u=new Un([i],n.dtype),l=new Un([i],"int32");for(let e=0,t=0;e<a.length;e++)s.has(a[e])||(u.values[t]=a[e],l.values[t]=e,t++);return[u.toTensor(),l.toTensor()]}(lc("x",e,t,n),lc("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"evaluation":return Qa((()=>((e,t,n)=>{switch(e.op){case"LowerBound":return[Ni(lc("sortedSequence",e,t,n),lc("values",e,t,n))];case"TopKV2":{const r=lc("x",e,t,n),a=lc("k",e,t,n),o=lc("sorted",e,t,n),s=$u(r,a,o);return[s.values,s.indices]}case"UpperBound":return[Du(lc("sortedSequence",e,t,n),lc("values",e,t,n))];case"Unique":{const r=lc("x",e,t,n),a=Fu(r);return[a.values,a.indices]}case"UniqueV2":{const r=lc("x",e,t,n),a=lc("axis",e,t,n),o=Fu(r,a);return[o.values,o.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"image":return Qa((()=>((e,t,n)=>{switch(e.op){case"ResizeBilinear":{const r=lc("images",e,t,n),a=lc("size",e,t,n),o=lc("alignCorners",e,t,n),s=lc("halfPixelCenters",e,t,n);return[Cl.resizeBilinear(r,[a[0],a[1]],o,s)]}case"ResizeNearestNeighbor":{const r=lc("images",e,t,n),a=lc("size",e,t,n),o=lc("alignCorners",e,t,n),s=lc("halfPixelCenters",e,t,n);return[Cl.resizeNearestNeighbor(r,[a[0],a[1]],o,s)]}case"CropAndResize":{const r=lc("image",e,t,n),a=lc("boxes",e,t,n),o=lc("boxInd",e,t,n),s=lc("cropSize",e,t,n),i=lc("method",e,t,n),u=lc("extrapolationValue",e,t,n);return[Cl.cropAndResize(r,a,o,s,i,u)]}case"ImageProjectiveTransformV3":{const r=lc("images",e,t,n),a=lc("transforms",e,t,n),o=lc("outputShape",e,t,n),s=lc("fillValue",e,t,n),i=lc("interpolation",e,t,n),u=lc("fillMode",e,t,n);return[Cl.transform(r,a,i.toLowerCase(),u.toLowerCase(),s,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"graph":return Qa((()=>((e,t,n)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const r=lc("default",e,t,n);return[cc(e.name,t,n)||r];case"Placeholder":return[cc(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[mc(lc("x",e,t,n))];case"IdentityN":return lc("x",e,t,n).map((e=>mc(e)));case"Shape":return[Nu(lc("x",e,t,n).shape,"int32")];case"ShapeN":return lc("x",e,t,n).map((e=>Nu(e.shape)));case"Size":return[Xs(lc("x",e,t,n).size,"int32")];case"Rank":return[Xs(lc("x",e,t,n).rank,"int32")];case"NoOp":return[Xs(1)];case"Print":const a=lc("x",e,t,n),o=lc("data",e,t,n),s=lc("message",e,t,n),i=lc("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(let e=0;e<o.length;e++)console.log(Array.prototype.slice.call(o[e].dataSync()).slice(0,i));return[a];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"logical":return Qa((()=>((e,t,n)=>{switch(e.op){case"Equal":return[Rs(lc("a",e,t,n),lc("b",e,t,n))];case"NotEqual":return[zi(lc("a",e,t,n),lc("b",e,t,n))];case"Greater":return[ci(lc("a",e,t,n),lc("b",e,t,n))];case"GreaterEqual":return[hi(lc("a",e,t,n),lc("b",e,t,n))];case"Less":return[di(lc("a",e,t,n),lc("b",e,t,n))];case"LessEqual":return[mi(lc("a",e,t,n),lc("b",e,t,n))];case"LogicalAnd":return[Si(lc("a",e,t,n),lc("b",e,t,n))];case"LogicalNot":return[Ii(lc("a",e,t,n))];case"LogicalOr":return[ki(lc("a",e,t,n),lc("b",e,t,n))];case"Select":case"SelectV2":return[Fs(lc("condition",e,t,n),lc("a",e,t,n),lc("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"matrices":return Qa((()=>((e,t,n)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[qa(lc("a",e,t,n),lc("b",e,t,n),lc("transposeA",e,t,n),lc("transposeB",e,t,n))];case"Einsum":return[Ms(lc("equation",e,t,n),...lc("tensors",e,t,n))];case"Transpose":return[ro(lc("x",e,t,n),lc("perm",e,t,n))];case"_FusedMatMul":const[r,a]=lc("fusedOps",e,t,n),o="biasadd"===r,s="prelu"===a,i=lc("numArgs",e,t,n),u=lc("leakyreluAlpha",e,t,n);if(o){if(s&&2!==i)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==i)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[l,c]=lc("args",e,t,n);return[Qu({a:lc("a",e,t,n),b:lc("b",e,t,n),transposeA:lc("transposeA",e,t,n),transposeB:lc("transposeB",e,t,n),bias:l,activation:a,preluActivationWeights:c,leakyreluAlpha:u})];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"normalization":return Qa((()=>((e,t,n)=>{switch(e.op){case"EuclideanNorm":return[ti(lc("x",e,t,n),lc("axis",e,t,n),lc("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[ps(lc("x",e,t,n),lc("mean",e,t,n),lc("variance",e,t,n),lc("offset",e,t,n),lc("scale",e,t,n),lc("epsilon",e,t,n))];case"LRN":return[yi(lc("x",e,t,n),lc("radius",e,t,n),lc("bias",e,t,n),lc("alpha",e,t,n),lc("beta",e,t,n))];case"Softmax":return[yu(lc("x",e,t,n))];case"LogSoftmax":return[Ti(lc("x",e,t,n))];case"SparseToDense":return[Bu(lc("sparseIndices",e,t,n),lc("outputShape",e,t,n),lc("sparseValues",e,t,n),lc("defaultValue",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"reduction":return Qa((()=>((e,t,n)=>{switch(e.op){case"Max":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Hs(lc("x",e,t,n),r,a)]}case"Mean":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Oi(lc("x",e,t,n),r,a)]}case"Min":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Ks(lc("x",e,t,n),r,a)]}case"Sum":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Js(lc("x",e,t,n),r,a)]}case"All":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Mo(lc("x",e,t,n),r,a)]}case"Any":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Lo(lc("x",e,t,n),r,a)]}case"ArgMax":{const r=lc("axis",e,t,n);return[Po(lc("x",e,t,n),r)]}case"ArgMin":{const r=lc("axis",e,t,n);return[Bo(lc("x",e,t,n),r)]}case"Prod":{const r=lc("axis",e,t,n),a=lc("keepDims",e,t,n);return[Hi(lc("x",e,t,n),r,a)]}case"Cumprod":{const r=lc("axis",e,t,n),a=lc("exclusive",e,t,n),o=lc("reverse",e,t,n);return[Is(lc("x",e,t,n),r,a,o)]}case"Cumsum":{const r=lc("axis",e,t,n),a=lc("exclusive",e,t,n),o=lc("reverse",e,t,n);return[ks(lc("x",e,t,n),r,a,o)]}case"Bincount":const r=lc("x",e,t,n),a=lc("weights",e,t,n),o=lc("size",e,t,n);return[fs(r,a,o)];case"DenseBincount":{const r=lc("x",e,t,n),a=lc("weights",e,t,n),o=lc("size",e,t,n),s=lc("binaryOutput",e,t,n);return[Cs(r,a,o,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"slice_join":return Qa((()=>((e,t,n)=>{switch(e.op){case"ConcatV2":case"Concat":{const r=lc("n",e,t,n),a=lc("axis",e,t,n);let o=lc("tensors",e,t,n);return o=o.slice(0,r),[is(o,a)]}case"Gather":{const r=lc("x",e,t,n),a=lc("indices",e,t,n);return[li(r,Ka(a,"int32"),0)]}case"GatherV2":{const r=lc("axis",e,t,n),a=lc("batchDims",e,t,n),o=lc("x",e,t,n),s=lc("indices",e,t,n);return[li(o,Ka(s,"int32"),r,a)]}case"Reverse":{const r=lc("dims",e,t,n),a=[];for(let e=0;e<r.length;e++)r[e]&&a.push(e);const o=lc("x",e,t,n);return[cu(o,a)]}case"ReverseV2":{const r=lc("axis",e,t,n),a=lc("x",e,t,n);return[cu(a,r)]}case"Slice":{const r=lc("begin",e,t,n),a=lc("size",e,t,n);return[ls(lc("x",e,t,n),r,a)]}case"StridedSlice":{const r=lc("begin",e,t,n),a=lc("end",e,t,n),o=lc("strides",e,t,n),s=lc("beginMask",e,t,n),i=lc("endMask",e,t,n),u=lc("ellipsisMask",e,t,n),l=lc("newAxisMask",e,t,n),c=lc("shrinkAxisMask",e,t,n),h=lc("x",e,t,n);return[ku(h,r,a,o,s,i,u,l,c)]}case"Pack":return Qa((()=>{const r=lc("axis",e,t,n),a=lc("tensors",e,t,n),o=a[0].shape,s=Eu(a[0]).shape,i=a.map((e=>{const t=tt(e.shape,o);if(!t&&!tt(Eu(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:rs(e,o)}));return[Su(i,r)]}));case"Unpack":{const r=lc("axis",e,t,n),a=lc("tensor",e,t,n);return Ou(a,r)}case"Tile":{const r=lc("reps",e,t,n);return[oi(lc("x",e,t,n),r)]}case"Split":case"SplitV":{const r=lc("axis",e,t,n),a=lc("numOrSizeSplits",e,t,n),o=lc("x",e,t,n);return wu(o,a,r)}case"ScatterNd":{const r=lc("indices",e,t,n),a=lc("values",e,t,n),o=lc("shape",e,t,n);return[Pu(r,a,o)]}case"GatherNd":{const r=lc("x",e,t,n),a=lc("indices",e,t,n);return[Uu(r,a)]}case"SparseToDense":{const r=lc("sparseIndices",e,t,n),a=lc("outputShape",e,t,n),o=lc("sparseValues",e,t,n),s=lc("defaultValue",e,t,n);return[Bu(r,o,a,o.dtype===s.dtype?s:Ka(s,o.dtype))]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"sparse":return Qa((()=>((e,t,n)=>{switch(e.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:a,emptyRowIndicator:o,reverseIndexMap:s}=Nl.sparseFillEmptyRows(lc("indices",e,t,n),lc("values",e,t,n),lc("denseShape",e,t,n),lc("defaultValue",e,t,n));return[r,a,o,s]}case"SparseReshape":{const{outputIndices:r,outputShape:a}=Nl.sparseReshape(lc("inputIndices",e,t,n),lc("inputShape",e,t,n),lc("newShape",e,t,n));return[r,a]}case"SparseSegmentMean":return[Nl.sparseSegmentMean(lc("data",e,t,n),lc("indices",e,t,n),lc("segmentIds",e,t,n))];case"SparseSegmentSum":return[Nl.sparseSegmentSum(lc("data",e,t,n),lc("indices",e,t,n),lc("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"spectral":return Qa((()=>((e,t,n)=>{switch(e.op){case"FFT":return[bu(lc("x",e,t,n))];case"IFFT":return[vu(lc("x",e,t,n))];case"RFFT":return[_u(lc("x",e,t,n))];case"IRFFT":return[xu(lc("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"string":return Qa((()=>((e,t,n)=>{switch(e.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:a}=Al.stringNGrams(lc("data",e,t,n),lc("dataSplits",e,t,n),lc("separator",e,t,n),lc("nGramWidths",e,t,n),lc("leftPad",e,t,n),lc("rightPad",e,t,n),lc("padWidth",e,t,n),lc("preserveShortSequences",e,t,n));return[r,a]}case"StringSplit":{const{indices:r,values:a,shape:o}=Al.stringSplit(lc("input",e,t,n),lc("delimiter",e,t,n),lc("skipEmpty",e,t,n));return[r,a,o]}case"StringToHashBucketFast":return[Al.stringToHashBucketFast(lc("input",e,t,n),lc("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"transformation":return Qa((()=>((e,t,n)=>{switch(e.op){case"Cast":return[Ka(lc("x",e,t,n),lc("dtype",e,t,n))];case"ExpandDims":{const r=lc("axis",e,t,n);return[ri(lc("x",e,t,n),r)]}case"Squeeze":{const r=lc("axis",e,t,n);return[Eu(lc("x",e,t,n),r)]}case"Reshape":return[rs(lc("x",e,t,n),lc("shape",e,t,n))];case"MirrorPad":return[Pi(lc("x",e,t,n),lc("padding",e,t,n),lc("mode",e,t,n))];case"PadV2":case"Pad":return[Wi(lc("x",e,t,n),lc("padding",e,t,n),lc("constantValue",e,t,n))];case"SpaceToBatchND":{const r=lc("blockShape",e,t,n),a=lc("paddings",e,t,n);return[ji(lc("x",e,t,n),r,a)]}case"BatchToSpaceND":{const r=lc("blockShape",e,t,n),a=lc("crops",e,t,n);return[hs(lc("x",e,t,n),r,a)]}case"DepthToSpace":{const r=lc("blockSize",e,t,n),a=lc("dataFormat",e,t,n).toUpperCase();return[Ns(lc("x",e,t,n),r,a)]}case"BroadcastTo":return[ms(lc("x",e,t,n),lc("shape",e,t,n))];case"BroadcastArgs":return[ds(lc("s0",e,t,n),lc("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"hash_table":return(async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const a=lc("keyDType",e,t,n),o=lc("valueDType",e,t,n),s=new oh(a,o);return r.addHashTable(e.name,s),[s.handle]}case"LookupTableImport":case"LookupTableImportV2":{const a=lc("tableHandle",e,t,n,r),o=lc("keys",e,t,n),s=lc("values",e,t,n),i=r.getHashTableById(a.id);return[await i.import(o,s)]}case"LookupTableFind":case"LookupTableFindV2":{const a=lc("tableHandle",e,t,n,r),o=lc("keys",e,t,n),s=lc("defaultValue",e,t,n),i=r.getHashTableById(a.id);return[await i.find(o,s)]}case"LookupTableSize":case"LookupTableSizeV2":{const a=lc("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n,r);case"custom":const a=uc(e.op);if(a&&a.customExecutor)return a.customExecutor(new Yc(e,t,n));throw TypeError(`Custom op ${e.op} is not registered.`);default:throw TypeError(`Unknown op '${e.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return It(a)?a.then((e=>[].concat(e))):[].concat(a)}class ih{constructor(e={},t={},n={},r={}){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map((e=>0===e.id&&0===e.iterationId?"":`${e.frameName}-${e.iterationId}`)).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function uh(e,t,n,r){const a=new Set,o=[];let s=null,i=null;const u=new Set,l=Object.keys(e).map((e=>fc(e)[0]));let c=[];null!=r&&(c=r.map((e=>fc(e.name)[0])));const h=[...t];for(;h.length>0;){const e=h.pop();(ph(e)||fh(e)||dh(e))&&null==s&&(s=e,i=s.children.map((e=>e.name)).filter((e=>a.has(e)))),a.add(e.name),null==n[e.name]&&-1===l.indexOf(e.name)&&-1===c.indexOf(e.name)&&(0!==e.inputs.length?e.inputs.forEach((e=>{u.has(e.name)||(u.add(e.name),h.push(e))})):o.push(e.name))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:o,dynamicNode:s,syncInputs:i}}const lh=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],ch=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],hh=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function ph(e){return lh.indexOf(e.op)>=0}function fh(e){return ch.indexOf(e.op)>=0}function dh(e){return hh.indexOf(e.op)>=0}class mh{constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach((t=>{this._functionExecutorMap[t]=new mh(e.functions[t],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map((t=>e[t].map((e=>e.id))));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((e=>e.signatureKey||e.name))}get outputNodes(){return this._outputs.map((e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t}))}get functions(){return Object.keys(this._functions).reduce(((e,t)=>(e[t]=this._functions[t].signature,e)),{})}getCompilationKey(e,t){const n=e.map((e=>e.name)).sort(),r=t.map((e=>e.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(e,t){const n=uh(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:a,syncInputs:o}=n;if(null!=a)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=t.map((e=>e.name)),a=Object.keys(e);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${a}]. Missing the following inputs: [${r}]`)}return function(e,t,n){const{usedNodes:r,inputs:a}=n,o=[],s=Object.keys(a).map((e=>fc(e)[0])).map((t=>e.nodes[t])),i=e.initNodes;s.forEach((e=>{r.has(e.name)&&o.push(e)})),e.weights.forEach((e=>{r.has(e.name)&&o.push(e)})),null!=i&&i.forEach((e=>{r.has(e.name)&&o.push(e)}));const u=new Set,l=[];for(;o.length>0;){const e=o.pop();u.add(e.name),t[e.name]||l.push(e),e.children.forEach((e=>{!u.has(e.name)&&r.has(e.name)&&e.inputs.every((e=>u.has(e.name)))&&o.push(e)}))}return l}(this.graph,this.weightMap,n)}execute(e,t){e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=n.map((e=>this.graph.nodes[fc(e)[0]])),a=t.map((e=>fc(e)[0]));let o=a.map((e=>this.graph.nodes[e]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const s=this.getCompilationKey(r,o);let i=this.compiledMap.get(s);null==i&&(i=this.compile(e,o),this.compiledMap.set(s,i));const u={},l={};return Qa((()=>{const n=new ih(this.weightMap,u,l,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{const[n,a]=fc(t),o=[];o[a]=e[t],r[n]=o}));const o=this.getFrozenTensorIds(r),s={};for(let e=0;e<i.length;e++){const t=i[e];if(!r[t.name]){const e=sh(t,r,n,this._resourceManager);if(It(e))throw new Error(`The execution of the op '${t.op}' returned a promise. Please use model.executeAsync() instead.`);r[t.name]=e,this.checkTensorForDisposal(t.name,t,r,n,o,a,s)}}return null==this.parent&&n.dispose(o),t.map((e=>cc(e,r,n)))}))}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map((t=>e[t])).map((e=>e.map((e=>e.id)))));return new Set(t)}checkTensorForDisposal(e,t,n,r,a,o,s){"control"!==t.category&&-1===o.indexOf(e)&&(n[e].forEach((e=>{null!=e&&(s[e.id]=(s[e.id]||0)+t.children.length)})),t.inputs.forEach((e=>{if("control"!==e.category){const o=function(e,t,n){return t[pc(e,n.currentContextId)]}(e.name,n,r);null!=o&&o.forEach((e=>{if(e&&!e.kept&&!a.has(e.id)){const n=s[e.id];if(1===n){if(this.keepTensorForDebug){const[n,a]=hc(t.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][a]=e}else e.dispose();delete s[e.id]}else null!=n&&s[e.id]--}}))}})))}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((e=>this.intermediateTensors[e].forEach((e=>e.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((e=>{this.tensorsMap[e].forEach((e=>{!e||e.kept||e.isDisposed||this.keepIds.has(e.id)||e.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const e in this.intermediateTensors)this.intermediateTensors[e].forEach((e=>e.dispose())),delete this.intermediateTensors[e]}async _executeAsync(e,t,n=!1,r={},a={}){n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepTensorForDebug=Nt().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e){console.warn(e.message)}this.resetIntermediateTensors();const o=new ih(this.weightMap,r,a,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(e,o,t,n);const s=t.map((e=>cc(e,this.tensorsMap,o))),i=s.map((e=>e.id)),u=Object.keys(e).map((t=>e[t].id));return this.keepIds=new Set([...i,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),s}async executeFunctionAsync(e,t,n){const r=e.reduce(((e,t,n)=>(e[this.inputs[n].name]=t,e)),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const a=Object.keys(e),o=a.map((e=>this.graph.nodes[fc(e)[0]])),s=n.map((e=>fc(e)[0]));let i=s.map((e=>this.graph.nodes[e]));0===i.length&&(i=this._outputs);const{usedNodes:u,missingInputs:l,dynamicNode:c,syncInputs:h}=uh(e,i,this.weightMap,this._initNodes),p=[...o,...this.graph.weights,...this._initNodes||[]].map((e=>({node:e,contexts:t.currentContext}))),f=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{const[n,r]=fc(t),a=[];a[r]=e[t],f[n]=a}));const d={},m=this.getFrozenTensorIds(f),g={};for(;p.length>0;){const e=this.processStack(o,p,t,f,g,m,s,d,u);await Promise.all(e)}null!=c||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const y=i.filter((e=>!ph(e)&&!cc(e.name,f,t))).map((e=>e.name));if(y.length>0){let e="";throw null!=c&&(e=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${y}] from the provided inputs [${a}]. Consider providing the following inputs: [${l}]. ${e}`)}return f}processStack(e,t,n,r,a,o,s,i,u){const l=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let c="";if("Enter"===e.node.op&&lc("isConstant",e.node,r,n)&&([c]=hc(e.node.name,n)),null==r[e.node.name]){const h=sh(e.node,r,n,this._resourceManager);c||([c]=hc(e.node.name,n));const p=n.currentContext;It(h)?l.push(h.then((l=>(r[c]=l,n.currentContext=p,this.checkTensorForDisposal(c,e.node,r,n,o,s,i),this.processChildNodes(e.node,t,n,r,a,u),l)))):(r[c]=h,this.checkTensorForDisposal(c,e.node,r,n,o,s,i),this.processChildNodes(e.node,t,n,r,a,u))}else this.processChildNodes(e.node,t,n,r,a,u)}return l}processChildNodes(e,t,n,r,a,o){e.children.forEach((e=>{const[s]=hc(e.name,n);!a[s]&&o.has(e.name)&&("Merge"===e.op?e.inputNames.some((e=>!!cc(e,r,n)))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((e=>!!cc(e,r,n)))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}dispose(){Object.keys(this.weightMap).forEach((e=>this.weightMap[e].forEach((e=>e.dispose()))))}checkInputShapeAndType(e){Object.keys(e).forEach((t=>{const n=e[t],[r]=fc(t),a=this.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){const e=a.attrParams.shape.value;Ye(e.length===n.shape.length&&n.shape.every(((t,n)=>-1===e[n]||e[n]===t)),(()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${e}], but was [${n.shape}]`))}a.attrParams.dtype&&a.attrParams.dtype.value&&Ye(n.dtype===a.attrParams.dtype.value,(()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(e){const t={};for(const n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}checkInputs(e){const t=Object.keys(e).filter((e=>{const[t]=fc(e);return null==this.graph.nodes[t]}));if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map((e=>null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[e]?this._signature.outputs[e].name:e),{})}checkOutputs(e){e.forEach((e=>{const[t]=fc(e);if(!this.graph.nodes[t])throw new Error(`The output '${e}' is not found in the graph`)}))}}class gh{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}class yh{constructor(e,t={}){this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={}),this.resourceManager=new gh}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=Ga(e,this.loadOptions);else{const r=(t=e,n=this.loadOptions,_a.getLoadHandlers(t,n));if(0===r.length)r.push(Ga(e,this.loadOptions));else if(r.length>1)throw new Error(`Found more than one (${r.length}) load handlers for URL '${[e]}'`);this.handler=r[0]}var t,n}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return It(e)?e.then((e=>this.loadSync(e))):this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=function(e,t){const n={};let r,a=0;for(const o of t){const t=o.name,s=o.dtype,i=o.shape,u=et(i);let l;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==s)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${s}.`)}const i=ga[n.dtype],c=e.slice(a,a+u*i),h="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===s)if("uint8"===n.dtype||"uint16"===n.dtype){l=new Float32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];l[e]=t*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=wa()),l=r(h)}else{if("int32"!==s)throw new Error(`Unsupported dtype in weight '${t}': ${s}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);l=new Int32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];l[e]=Math.round(t*n.scale+n.min)}}a+=u*i}else if("string"===s){const t=et(o.shape);l=[];for(let n=0;n<t;n++){const t=new Uint32Array(e.slice(a,a+4))[0];a+=4;const n=new Uint8Array(e.slice(a,a+t));l.push(n),a+=t}}else{const r=ga[s],o=e.slice(a,a+u*r);if("float32"===s)l=new Float32Array(o);else if("int32"===s)l=new Int32Array(o);else if("bool"===s)l=new Uint8Array(o);else{if("complex64"!==s)throw new Error(`Unsupported dtype in weight '${t}': ${s}`);{l=new Float32Array(o);const e=new Float32Array(l.length/2),r=new Float32Array(l.length/2);for(let t=0;t<e.length;t++)e[t]=l[2*t],r[t]=l[2*t+1];const a=ma(e,i,"float32"),s=ma(r,i,"float32");n[t]=fa(a,s),a.dispose(),s.dispose()}}a+=u*r}"complex64"!==s&&(n[t]=ma(l,i,s))}return n}(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new mh(Dc.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=Dc.Instance.transformGraph(e.modelInitializer);this.initializer=new mh(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,t){if("string"==typeof e){const t=(n=e,_a.getSaveHandlers(n));if(0===t.length)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Error(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}var n;if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,t){return this.execute(e,this.outputNodes)}normalizeInputs(e){if(!(e instanceof Wn||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce(((t,n,r)=>(t[n]=e[r],t)),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce(((t,n)=>(t[n]=[e[n]],t)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function bh(e,t={}){if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&"string"==typeof e&&(e=function(e){return e.endsWith("/")||(e+="/"),`${e}model.json?tfjs-format=file`}(e));const n=new yh(e,t);return await n.load(),n}function vh(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Ye("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the CPU backend.`))}))}const xh=Mu;class wh extends Ge{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new je(this,Ya())}nextDataId(){return wh.nextDataId++}write(e,t,n){this.firstUse&&(this.firstUse=!1,Nt().get("IS_NODE")&&Ot("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&dt(n[0])){const a=n.map((e=>An(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){this.data.get(e).refCount++}decRef(e){this.data.has(e)&&this.data.get(e).refCount--}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);return"complex64"===t?Ul(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>$n(e)));return gs(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return gs(e.shape,e.dtype,t)}makeOutput(e,t,n){return Ya().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Nn();return e(),{kernelMs:Nn()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){vh([e],"where");const t=this.readSync(e.dataId);return xh(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function _h(e){return(t,n,r,a,o)=>{const s=so(t,n),i=s.length,u=bt(s),l=lt(o,et(s)),c=t.length,h=n.length,p=bt(t),f=bt(n),d=ao(t,s),m=ao(n,s);if(d.length+m.length===0)for(let t=0;t<l.length;++t)l[t]=e(r[t%r.length],a[t%a.length]);else for(let t=0;t<l.length;++t){const n=St(t,i,u),o=n.slice(-c);d.forEach((e=>o[e]=0));const s=Et(o,c,p),g=n.slice(-h);m.forEach((e=>g[e]=0));const y=Et(g,h,f);l[t]=e(r[s],a[y])}return[l,s]}}function Th(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,i=n.makeTensorInfo(r.shape,"complex64");return n.data.get(i.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",o),imag:n.makeTensorInfo(a.shape,"float32",s)},i}function Eh(e,t,n="float32"){if("complex64"===n)return Th({inputs:{real:Eh(e,t,"float32"),imag:Eh(e,t,"float32")},backend:e});const r=_t(et(t),n);return e.makeTensorInfo(t,n,r)}function Sh(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}wh.nextDataId=0;const Ih={kernelName:"Identity",backendName:"cpu",kernelFunc:Sh};function kh(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,o=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,o)}function Ch(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:o}=r;if("complex64"===o){if("complex64"===a.dtype)return Sh({inputs:{x:a},backend:n});const e=Eh(n,a.shape,a.dtype),t=Ch({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=Th({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=kh({inputs:{input:a},backend:n}),t=Ch({inputs:{x:e},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(e),t}if(!ht(a.dtype,o)){const e=Sh({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:o}}if("int32"===o){const e=n.data.get(a.dataId).values,t=Int32Array.from(e);return n.makeTensorInfo(a.shape,"int32",t)}if("bool"===o){const e=n.data.get(a.dataId).values,t=Cn([0],a.dtype),[r,o]=_h(((e,t)=>e!==t?1:0))(a.shape,[],e,t,"bool");return n.makeTensorInfo(o,"bool",r)}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${o}`)}const Nh={kernelName:"Cast",backendName:"cpu",kernelFunc:Ch};function Ah(e,t,n,r){return null==n?({inputs:n,backend:a})=>{const{a:o,b:s}=n,i=a;vh([o,s],e);const u=i.data.get(o.dataId).values,l=i.data.get(s.dataId).values,c="string"===o.dtype?Zl(u):u,h="string"===o.dtype?Zl(l):l,p=r||o.dtype,[f,d]=t(o.shape,s.shape,c,h,p);return i.makeTensorInfo(d,p,f)}:({inputs:e,backend:a})=>{const{a:o,b:s}=e,i=a;if("complex64"===o.dtype||"complex64"===s.dtype){const e=Ch({inputs:{x:o},backend:i,attrs:{dtype:"complex64"}}),t=i.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,u=i.data.get(r.dataId).values,l=i.data.get(a.dataId).values,c=Ch({inputs:{x:s},backend:i,attrs:{dtype:"complex64"}}),h=i.data.get(c.dataId),p=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,d=i.data.get(p.dataId).values,m=i.data.get(f.dataId).values,[g,y,b]=n(o.shape,s.shape,u,l,d,m),v=i.makeTensorInfo(b,"float32",g),x=i.makeTensorInfo(b,"float32",y),w=Th({inputs:{real:v,imag:x},backend:i});return i.disposeIntermediateTensorInfo(e),i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),w}{const e=i.data.get(o.dataId).values,n=i.data.get(s.dataId).values,a=r||o.dtype,[u,l]=t(o.shape,s.shape,e,n,a);return i.makeTensorInfo(l,a,u)}}}function $h(e){return(t,n,r,a,o,s)=>{const i=so(t,n),u=et(i),l=i.length,c=bt(i),h=lt("float32",u),p=lt("float32",u),f=ao(t,i),d=ao(n,i),m=Ul(r,a),g=Ul(o,s),y=t.length,b=bt(t),v=n.length,x=bt(n);if(f.length+d.length===0)for(let t=0;t<h.length;t++){const n=t%m.length,r=t%g.length,a=e(m[2*n],m[2*n+1],g[2*r],g[2*r+1]);h[t]=a.real,p[t]=a.imag}else for(let t=0;t<h.length;t++){const n=St(t,l,c),r=n.slice(-y);f.forEach((e=>r[e]=0));const a=Et(r,y,b),o=n.slice(-v);d.forEach((e=>o[e]=0));const s=Et(o,v,x),i=e(m[2*a],m[2*a+1],g[2*s],g[2*s+1]);h[t]=i.real,p[t]=i.imag}return[h,p,i]}}const Rh=_h(((e,t)=>e+t)),Fh=Ah("Add",Rh,$h(((e,t,n,r)=>({real:e+n,imag:t+r})))),Oh={kernelName:"Add",backendName:"cpu",kernelFunc:Fh};function Dh(e){return(t,n,r)=>{const a=lt(n,t.length);for(let n=0;n<t.length;++n)a[n]=e(t[n],r);return a}}function Mh(e,t,n){return({inputs:r,attrs:a,backend:o})=>{const{x:s}=r;if(vh(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const i=o,u=i.data.get(s.dataId).values,l=et(s.shape),c=n||s.dtype,h=ct(c,l);for(let e=0;e<l;++e)h[e]=t(u[e],a);return i.makeTensorInfo(s.shape,c,h)}}const Lh=Dh((e=>Math.ceil(e)));function Ph(e,t,n,r){const a=ct(n,et(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{const n=et(e.shape);a.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{const o="string"===n?Zl(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const i=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[i+t]=o[s++]}r+=e.shape[1]}))}return a}const Bh=_h(((e,t)=>e===t?1:0)),Uh=Dh((e=>Math.exp(e))),zh=Dh((e=>Math.expm1(e))),Vh=Dh((e=>Math.floor(e))),Wh=_h(((e,t)=>e>t?1:0)),jh=_h(((e,t)=>e>=t?1:0)),Gh=_h(((e,t)=>e<t?1:0)),Hh=_h(((e,t)=>e<=t?1:0)),Kh=Dh((e=>Math.log(e))),qh=_h(((e,t)=>Math.max(e,t))),Xh=_h(((e,t)=>Math.min(e,t))),Yh=_h(((e,t)=>e*t)),Qh=$h(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),Jh={kernelName:"Multiply",backendName:"cpu",kernelFunc:Ah("Multiply",Yh,Qh)},Zh=_h(((e,t)=>e!==t?1:0));function ep(e,t,n,r,a){const o=t.length,s=et(t),i=bt(t),u=bt(a),l=lt(n,et(a));for(let t=0;t<s;++t){const n=St(t,o,i),a=new Array(n.length);for(let e=0;e<a.length;e++)a[e]=n[r[e]];l[Et(a,o,u)]=e[t]}return l}function tp(e){const{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:o}=n;vh(a,"transpose");const s=a.shape.length,i=new Array(s);for(let e=0;e<i.length;e++)i[e]=a.shape[o[e]];const u=ep(r.data.get(a.dataId).values,a.shape,a.dtype,o,i);return{dataId:r.write(u,i,a.dtype),shape:i,dtype:a.dtype}}const np=Dh((e=>1/Math.sqrt(e))),rp=Dh((e=>1/(1+Math.exp(-e)))),ap=Mh("Sigmoid",(e=>1/(1+Math.exp(-e)))),op={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:ap};function sp(e,t,n,r,a){const o=_o(r,t,n),s=et(n),i=bt(r);if(o){const n=To(t,i);return"string"===a?e.slice(n,n+s):e.subarray(n,n+s)}const u=gs(r,a,"string"===a?Zl(e):e),l=gs(n,a);for(let e=0;e<l.size;++e){const n=l.indexToLoc(e),r=n.map(((e,n)=>e+t[n]));l.set(u.get(...r),...n)}return"string"===a?ec(l.values):l.values}function ip(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:o,size:s}=r;vh(a,"slice");const[i,u]=Eo(a,o,s);ho(a,i,u);const l=sp(n.data.get(a.dataId).values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}const up=Dh((e=>Math.sqrt(e))),lp=_h(((e,t)=>{const n=e-t;return n*n}));function cp(e,t,n,r){const a=gs(e,t.dtype);for(let e=0;e<a.size;e++){const o=a.indexToLoc(e),s=new Array(o.length);for(let e=0;e<s.length;e++)s[e]=o[e]*n[e]+r[e];a.set(t.get(...s),...o)}return a}class hp{constructor(e,t,n,r,a,o){this.separator=An(e),this.nGramWidths=t,this.leftPad=An(n),this.rightPad=An(r),this.padWidth=a,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,o){for(let s=0;s<a;++s){const i=this.getPadWidth(o),u=Math.max(0,i-s),l=Math.max(0,i-(a-(s+1))),c=o-(u+l),h=t+(u>0?0:s-i);let p=0;p+=u*this.leftPad.length;for(let t=0;t<c;++t)p+=e[h+t].length;p+=l*this.rightPad.length,p+=(u+l+c-1)*this.separator.length,n[r+s]=new Uint8Array(p);const f=n[r+s];let d=0;const m=e=>e.forEach((e=>f[d++]=e));for(let e=0;e<u;++e)m(this.leftPad),m(this.separator);for(let t=0;t<c-1;++t)m(e[h+t]),m(this.separator);if(c>0){m(e[h+c-1]);for(let e=0;e<l;++e)m(this.separator),m(this.rightPad)}else{for(let e=0;e<l-1;++e)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error(`Invalid split value ${t[a]}, must be in [${e}, ${n}]`);e=t[a]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}const a=r-1,o=ct("int32",r);if(0===n||0===r){const e=new Array(n);for(let e=0;e<=a;++e)o[e]=0;return[e,o]}o[0]=0;for(let e=1;e<=a;++e){const n=t[e]-t[e-1];let r=0;this.nGramWidths.forEach((e=>{r+=this.getNumNGrams(n,e)})),this.preserveShort&&n>0&&0===r&&(r=1),o[e]=o[e-1]+r}const s=new Array(o[a]);for(let n=0;n<a;++n){const r=t[n];let a=o[n];if(this.nGramWidths.forEach((o=>{const i=t[n+1]-t[n],u=this.getNumNGrams(i,o);this.createNGrams(e,r,s,a,u,o),a+=u})),this.preserveShort&&a===o[n]){const o=t[n+1]-t[n];if(0===o)continue;const i=o+2*this.padWidth,u=1;this.createNGrams(e,r,s,a,u,i)}}return[s,o]}}function pp(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const a=t[0];let o=e.indexOf(a);for(;-1!==o;){const t=e.subarray(0,o);n&&0===t.length||r.push(t),o=(e=e.subarray(o+1)).indexOf(a)}return void(n&&0===e.length||r.push(e))}let a=0;for(let o=0;o<e.length+1;o++)if(o===e.length||-1!==t.indexOf(e[o])){const t=e.subarray(a,o);n&&0===t.length||r.push(t),a=o+1}}const fp=_h(((e,t)=>e-t)),dp={kernelName:"Sub",backendName:"cpu",kernelFunc:Ah("Sub",fp,$h(((e,t,n,r)=>({real:e-n,imag:t-r}))))},mp=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function gp(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),i=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*i*(a-i)/a)*Math.sign(o-a/2);gp(e,t,Math.max(n,Math.floor(t-o*i/a+u)),Math.min(r,Math.floor(t+(a-o)*i/a+u)))}const a=e[t];let o=n,s=r;for(Xe(e,n,t),mp(e[r],a)>0&&Xe(e,n,r);o<s;){for(Xe(e,o,s),o++,s--;mp(e[o],a)<0;)o+=1;for(;mp(e[s],a)>0;)s-=1}0===mp(e[n],a)?Xe(e,n,s):(s+=1,Xe(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}var yp=Object.freeze({__proto__:null,simpleAbsImpl:function(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t},addImpl:Rh,bincountImpl:function(e,t,n,r,a){const o=et(r),s=_t(a,n);for(let n=0;n<e.length;n++){const r=e[n];if(r<0)throw new Error("Input x must be non-negative!");r>=a||(s[r]+=o>0?t[n]:1)}return s},bincountReduceImpl:function(e,t,n,r=!1){const a=e.shape[0],o=e.shape[1],s=gs([a,n],t.dtype);for(let i=0;i<a;i++)for(let a=0;a<o;a++){const o=e.get(i,a);if(o<0)throw new Error("Input x must be non-negative!");o>=n||(r?s.set(1,i,o):t.size>0?s.set(s.get(i,o)+t.get(i,a),i,o):s.set(s.get(i,o)+1,i,o))}return s},ceilImpl:Lh,concatImpl:Ph,equalImpl:Bh,expImpl:Uh,expm1Impl:zh,floorImpl:Vh,gatherNdImpl:function(e,t,n,r,a,o,s,i,u){const l=gs([r,o],n);for(let n=0;n<r;n++){const r=[];let c=0;for(let t=0;t<a;t++){const o=e[n*a+t];c+=o*s[t],r.push(o)}if(c<0||c>=u/o)throw new Error(`Invalid indices: ${r} does not index into ${i}`);for(let e=0;e<o;e++)l.values[n*o+e]=t.get(...t.indexToLoc(c*o+e))}return l},gatherV2Impl:function(e,t,n){const r=gs(n,e.dtype);for(let n=0;n<r.size;++n){const a=r.indexToLoc(n).slice(),o=a[0],s=a[2],i=t.locToIndex([o,s]);a[2]=t.values[i];const u=e.locToIndex(a);0<=u&&u<e.values.length&&(r.values[n]=e.values[u])}return r},greaterImpl:Wh,greaterEqualImpl:jh,lessImpl:Gh,lessEqualImpl:Hh,linSpaceImpl:function(e,t,n){const r=(t-e)/(n-1),a=_t(n,"float32");a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+r;return a},logImpl:Kh,maxImpl:function(e,t,n,r){const a=lt(r,et(n));for(let n=0;n<a.length;++n){const r=n*t;let o=e[r];for(let n=0;n<t;++n){const t=e[r+n];(Number.isNaN(t)||t>o)&&(o=t)}a[n]=o}return a},maximumImpl:qh,minimumImpl:Xh,multiplyImpl:Yh,negImpl:function(e,t,n){const r=kn(-1,n);return Yh([],t,r,e,n)},notEqualImpl:Zh,prodImpl:function(e,t,n,r){const[a,o]=zs(e,r),s=Jn(t,"int32"),i=_t(et(a),s),u=et(o);for(let e=0;e<i.length;++e){const t=e*u;let r=1;for(let e=0;e<u;++e)r*=n[t+e];i[e]=r}return{outVals:i,outShape:a,outDtype:s}},rangeImpl:function(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return _t(0,r);const a=_t(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+n;return a},rsqrtImpl:np,scatterImpl:function(e,t,n,r,a,o,s,i,u,l){const c=[r/a,a],h=e.values,p=t.values;if(0===r)return gs(n,t.dtype);const f=gs(c,t.dtype);"string"==typeof u||"number"==typeof u?f.values.fill(u):"boolean"==typeof u&&f.values.fill(+u);for(let e=0;e<o;e++){const o=[];let u=0;for(let t=0;t<s;t++){const n=h[e*s+t];o.push(n),u+=n*i[t]}if(u<0||u>=r/a)throw new Error(`Invalid indices: ${o} does not index into ${n}`);for(let n=0;n<a;n++)l?f.values[u*a+n]+=p[e*a+n]:f.values[u*a+n]=0===t.rank?p[0]:p[e*a+n]}return f},sigmoidImpl:rp,sliceImpl:sp,sparseFillEmptyRowsImpl:function(e,t,n,r,a,o,s){const i=t[0],u=o[0],l=new Array(u),c=new Array(i),h=t[1];if(0===u){if(0!==i)throw new Error(Wl(i));return[ct(n,0),[0,h],ct(a,0),l,c]}let p=!0,f=0;const d=new Array(u).fill(0);for(let t=0;t<i;++t){const n=e[t*h];if(n<0)throw new Error(jl(t,n));if(n>=u)throw new Error(Gl(t,n,u));++d[n],p=p&&n>=f,f=n}let m=!0;for(let e=0;e<u;++e){const t=0===d[e];l[e]=t,m=m&&!t,d[e]=Math.max(d[e],1),e>0&&(d[e]+=d[e-1])}if(m&&p){const t=e,n=r;for(let e=0;e<i;++e)c[e]=e;return[t,[i,h],n,l,c]}{const t=d[u-1],o=ct(n,t*h),p=ct(a,t),f=new Array(u).fill(0);for(let t=0;t<i;++t){const n=e[t*h],a=f[n],s=(0===n?0:d[n-1])+a;f[n]++;for(let n=0;n<h;++n)o[s*h+n]=e[t*h+n];p[s]=r[t],c[t]=s}for(let e=0;e<u;++e)if(0===f[e]){const t=0===e?0:d[e-1];o[t*h+0]=e;for(let e=1;e<h;++e)o[t*h+e]=0;p[t]=s}return[o,[t,h],p,l,c]}},sparseReshapeImpl:function(e,t,n,r,a){const o=et(r),s=t[0],i=a.length,u=[];let l=1,c=-1;for(let e=0;e<i;++e){const t=a[e];if(-1===t){if(-1!==c)throw new Error(Hl(c,e));c=e,u.push(1)}else{if(t<0)throw new Error(Kl(e,t));l*=t,u.push(t)}}if(-1!==c){if(l<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(o/l);if(l*e!==o)throw new Error(ql(r,u));u[c]=e}if(et(u)!==o)throw new Error(Xl(r,u));const h=r.length,p=[];if(h>0){p[h-1]=1;for(let e=h-2;e>=0;--e)p[e]=p[e+1]*r[e+1]}const f=[];if(i>0){f[i-1]=1;for(let e=i-2;e>=0;--e)f[e]=f[e+1]*u[e+1]}const d=ct(n,s*i);for(let t=0;t<s;++t){let n=0;for(let r=0;r<h;++r)n+=e[t*h+r]*p[r];for(let e=0;e<i;++e)d[t*i+e]=Math.trunc(n/f[e]),n%=f[e]}return[d,[s,i],u]},sparseSegmentReductionImpl:function(e,t,n,r,a,o=!1,s=0){const i=r.length,u=[t[0],e.length/t[0]],l=u[1],c=i>0?a[i-1]+1:0;if(c<0)throw new Error("segment ids must be >= 0");const h=t.slice();h[0]=c;const p=ct(n,h.reduce(((e,t)=>e*t),1));if(0===i)return c>0&&p.fill(s),[p,h];if(c<=0)throw new Error("segment ids must be >= 0");let f=0,d=1,m=0,g=a[f];for(;;){let t=0;if(d<i){if(t=a[d],g===t){++d;continue}if(g>=t)throw new Error("segment ids are not increasing")}if(g<0||g>=c)throw new Error(Yl(g,c));g>m&&p.fill(s,m*l,g*l);for(let t=f;t<d;++t){const n=r[t];if(n<0||n>=u[0])throw new Error(Ql(t,r[t],u[0]));for(let t=0;t<l;t++)p[g*l+t]+=e[n*l+t]}if(o)for(let e=0;e<l;e++)p[g*l+e]/=d-f;if(f=d,++d,m=g+1,g=t,d>i)break}return m<c&&p.fill(s,m*l,c*l),[p,h]},sqrtImpl:up,squaredDifferenceImpl:lp,stridedSliceImpl:cp,stringNGramsImpl:function(e,t,n,r,a,o,s,i){return new hp(n,r,a,o,s,i).compute(e,t)},stringSplitImpl:function(e,t,n){const r=e.length,a=[];let o=0,s=0;const i=new Array(r);for(let u=0;u<r;++u){const r=a.length;pp(e[u],t,n,a);const l=a.length-r;i[u]=l,o+=l,s=Math.max(s,l)}const u=ct("int32",2*o),l=new Array(o),c=[r,s];let h=0;for(let e=0;e<r;++e)for(let t=0;t<i[e];++t)u[2*h]=e,u[2*h+1]=t,l[h]=a[h],++h;return[u,l,c]},stringToHashBucketFastImpl:function(e,t){const n=ct("int32",e.length);for(let r=0;r<e.length;++r)n[r]=In(e[r]).modulo(t).getLowBitsUnsigned();return n},subImpl:fp,tileImpl:function(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const r=gs(n,e.dtype);for(let t=0;t<r.values.length;++t){const n=r.indexToLoc(t),a=new Array(e.rank);for(let t=0;t<a.length;t++)a[t]=n[t]%e.shape[t];const o=e.locToIndex(a);r.values[t]=e.values[o]}return r},topKImpl:function(e,t,n,r,a){const o=t[t.length-1],[s,i]=[e.length/o,o],u=lt(n,s*r),l=lt("int32",s*r);for(let t=0;t<s;t++){const n=t*i,o=e.subarray(n,n+i);let s=new Array(o.length);o.forEach(((e,t)=>s[t]={value:e,index:t})),r<s.length&&(gp(s,r),s=s.slice(0,r)),a&&s.sort(mp);const c=t*r,h=u.subarray(c,c+r),p=l.subarray(c,c+r);for(let e=0;e<r;e++)h[e]=s[e].value,p[e]=s[e].index}const c=t.slice();return c[c.length-1]=r,[gs(c,n,u),gs(c,"int32",l)]},transposeImpl:ep,uniqueImpl:function(e,t,n,r){const a=it(t,n)[0],o=[1,n[0],1];for(let e=0;e<a;e++)o[0]*=n[e];o[1]=n[a];for(let e=a+1;e<n.length;e++)o[2]*=n[e];const s={},i=new Int32Array(n[a]),u=new Un(o,r,e),l=[],c=1===o[0]&&1===o[2];for(let t=0;t<n[a];t++){let n;if(c)n=e[t].toString();else{const e=[];for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)e.push(u.get(n,t,r));n=e.join(",")}if(void 0!==s[n])i[t]=s[n];else{const e=Object.keys(s).length;s[n]=e,i[t]=e,l.push(t)}}const h=o.slice();h[1]=Object.keys(s).length;const p=new Un(h,r);l.forEach(((e,t)=>{for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)p.set(u.get(n,e,r),n,t,r)}));const f=n.slice();return f[a]=h[1],{outputValues:p.values,outputShape:f,indices:i}}});function bp(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:o}=r,s=et(a.shape),i=st(o,s),u=et(i);Ye(s===u,(()=>`The new shape (${i}) has ${u} elements and the old shape (${a.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(a.dataId);const l=n.data.get(a.dataId);if(null!=l.complexTensorInfos){const e=l.complexTensorInfos.real,t=l.complexTensorInfos.imag;e.shape=i,t.shape=i}return{dataId:a.dataId,shape:i,dtype:a.dtype}}Za("cpu",(()=>new wh),1);const vp={kernelName:"Reshape",backendName:"cpu",kernelFunc:bp},xp={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:o,halfPixelCenters:s,size:i}=r;vh(a,"resizeBilinear");const u=bt(a.shape),[l,c]=i,[h,p,f,d]=a.shape,m=n.data.get(a.dataId).values,g=new Float32Array(et([h,l,c,d])),y=[o&&l>1?p-1:p,o&&c>1?f-1:f],b=[o&&l>1?l-1:l,o&&c>1?c-1:c];let v=0;const x=y[0]/b[0],w=y[1]/b[1];for(let e=0;e<h;e++)for(let t=0;t<l;t++){let n;n=s?x*(t+.5)-.5:x*t;const r=Math.max(0,Math.floor(n)),a=n-r,o=Math.min(p-1,Math.ceil(n)),i=e*u[0]+r*u[1],l=e*u[0]+o*u[1];for(let e=0;e<c;e++){let t;t=s?w*(e+.5)-.5:w*e;const n=Math.max(0,Math.floor(t)),r=t-n,o=Math.min(f-1,Math.ceil(t)),c=i+n*u[2],h=l+n*u[2],p=i+o*u[2],y=l+o*u[2];for(let e=0;e<d;e++){const t=m[c+e],n=m[h+e],o=t+(m[p+e]-t)*r,s=o+(n+(m[y+e]-n)*r-o)*a;g[v++]=s}}}return n.makeTensorInfo([h,l,c,d],"float32",g)}},wp={kernelName:"RealDiv",backendName:"cpu",kernelFunc:Ah("RealDiv",_h(((e,t)=>e/t)))},_p={kernelName:"PadV2",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:o,constantValue:s}=r;vh(a,"pad");const i=o.map(((e,t)=>e[0]+a.shape[t]+e[1])),u=o.map((e=>e[0])),l=n.data.get(a.dataId).values,c=et(a.shape),h=a.shape.length,p=bt(a.shape),f=et(i),d=i.length,m=bt(i),g=lt(a.dtype,f);0!==s&&g.fill(s);for(let e=0;e<c;e++)g[Et(St(e,h,p).map(((e,t)=>e+u[t])),d,m)]=l[e];return{dataId:n.write(g,i,a.dtype),shape:i,dtype:a.dtype}}},Tp=Mh("Elu",(e=>e>=0?e:Math.exp(e)-1)),Ep=_h(((e,t)=>e<0?t*e:e)),Sp=Mh("Relu",(e=>Math.max(0,e))),Ip={kernelName:"Relu",backendName:"cpu",kernelFunc:Sp},kp=Mh("Relu6",(e=>Math.min(Math.max(0,e),6))),Cp={kernelName:"Relu6",backendName:"cpu",kernelFunc:kp};function Np(e,t,n,r,a){if("linear"===n)return Sh({inputs:{x:t},backend:e});if("relu"===n)return Sp({inputs:{x:t},backend:e});if("elu"===n)return Tp({inputs:{x:t},backend:e});if("relu6"===n)return kp({inputs:{x:t},backend:e});if("prelu"===n)return function(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t;vh([r,a],"prelu");const o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,[i,u]=Ep(r.shape,a.shape,o,s,"float32");return n.makeTensorInfo(u,"float32",i)}({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:o}=r;vh([a],"leakyRelu");const s=et(a.shape),i=n.data.get(a.dataId).values,u=lt("float32",s);for(let e=0;e<i.length;e++)u[e]=i[e]<0?o*i[e]:i[e];return n.makeTensorInfo(a.shape,"float32",u)}({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return ap({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}const Ap={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o,bias:s,preluActivationWeights:i}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r;let m=function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o}=t,{strides:s,pad:i,dataFormat:u,dilations:l,dimRoundingMode:c}=r;vh([a,o],"conv2d");const h=ts(u),p=Ho(a.shape,o.shape,s,l,i,c,!1,h),f=p.filterHeight,d=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v="channelsLast"===p.dataFormat,x=new Un(p.outShape,a.dtype),w=bt(a.shape),_=bt(o.shape),T=w[0],E=v?w[1]:w[2],S=v?w[2]:1,I=v?1:w[1],k=x.strides[0],C=v?x.strides[1]:x.strides[2],N=v?x.strides[2]:1,A=v?1:x.strides[1],$=n.data.get(a.dataId).values,R=n.data.get(o.dataId).values,F=x.values;for(let e=0;e<p.batchSize;++e){const t=e*T,n=e*k;for(let e=0;e<p.outHeight;++e){const r=n+e*C,a=e*p.strideHeight-b;for(let e=0;e<f;++e){const n=a+e*m;if(n<0||n>=p.inHeight)continue;const o=e*_[0],s=t+n*E;for(let e=0;e<p.outWidth;++e){const t=r+e*N,n=e*p.strideWidth-y;for(let e=0;e<d;++e){const r=n+e*g;if(r<0||r>=p.inWidth)continue;const a=s+r*S;let i=o+e*_[1];for(let e=0;e<p.inChannels;++e){const n=$[a+e*I];for(let e=0;e<p.outChannels;++e)F[t+e*A]+=n*R[i+e];i+=p.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,F)}({inputs:{x:a,filter:o},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p}});if(s){const e=m;if("NCHW"===c&&1===s.shape.length&&1!==s.shape[0]){const e=bp({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=Fh({inputs:{a:m,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else m=Fh({inputs:{a:m,b:s},backend:n});n.disposeIntermediateTensorInfo(e)}if(f){const e=m;if("NCHW"===c&&"prelu"===f&&1===i.shape.length&&1!==i.shape[0]){const e=bp({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});m=Np(n,m,f,e,d),n.disposeIntermediateTensorInfo(e)}else m=Np(n,m,f,i,d);n.disposeIntermediateTensorInfo(e)}return m}};function $p(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o}=t,{strides:s,pad:i,dilations:u,dimRoundingMode:l}=r;vh([a,o],"depthwiseConv2DNative");const c=bt(a.shape),h=bt(o.shape);let p=u;null==p&&(p=[1,1]),Ye(es(s,p),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`));const f=Ho(a.shape,o.shape,s,p,i,l,!0),{filterHeight:d,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:b}=f,v=b.left,x=b.top,w=f.outChannels/f.inChannels,_=new Un(f.outShape,a.dtype),T=n.data.get(a.dataId).values,E=n.data.get(o.dataId).values,S=_.values;for(let e=0;e<f.batchSize;++e){const t=e*c[0],n=e*_.strides[0];for(let e=0;e<f.outHeight;++e){const r=n+e*_.strides[1],a=e*f.strideHeight-x;for(let e=0;e<d;++e){const n=a+e*g;if(n<0||n>=f.inHeight)continue;const o=e*h[0],s=t+n*c[1];for(let e=0;e<f.outWidth;++e){const t=r+e*_.strides[2],n=e*f.strideWidth-v;for(let e=0;e<m;++e){const r=n+e*y;if(r<0||r>=f.inWidth)continue;const a=o+e*h[1],i=s+r*f.inChannels;let u=t,l=a;for(let e=0;e<f.inChannels;++e){const t=T[i+e];for(let e=0;e<w;++e)S[u+e]+=t*E[l+e];u+=w,l+=w}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const Rp={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:$p},Fp={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o,bias:s,preluActivationWeights:i}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r;let m=$p({inputs:{x:a,filter:o},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p}});if(s){const e=m;m=Fh({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=m;m=Np(n,m,f,i,d),n.disposeIntermediateTensorInfo(e)}return m}},Op={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:o,paddings:s}=r;vh([a],"spaceToBatchND");const i=et(o),u=[[0,0]];u.push(...s);for(let e=1+o.length;e<a.shape.length;++e)u.push([0,0]);const l=_p.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),c=Dl(l.shape,o,i,!1),h=Ml(c.length,o.length,!1),p=Ll(l.shape,o,i,!1),f=bp({inputs:{x:l},backend:n,attrs:{shape:c}}),d=tp({inputs:{x:f},backend:n,attrs:{perm:h}}),m=bp({inputs:{x:d},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),m}},Dp={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:o,crops:s}=r;vh([a],"batchToSpaceND");const i=o.reduce(((e,t)=>e*t)),u=Dl(a.shape,o,i),l=Ml(u.length,o.length),c=Ll(a.shape,o,i),h=Pl(s,o.length),p=Bl(c,s,o.length),f=bp({inputs:{x:a},backend:n,attrs:{shape:u}}),d=tp({inputs:{x:f},backend:n,attrs:{perm:l}}),m=bp({inputs:{x:d},backend:n,attrs:{shape:c}}),g=ip({inputs:{x:m},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),g}},Mp={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:o,end:s,strides:i,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r;vh(a,"stridedSlice");const{finalShapeSparse:f,finalShape:d,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:v,strides:x}=So(a.shape,o,s,i,u,l,c,h,p);let w;if(m)w=bp({inputs:{x:a},backend:n,attrs:{shape:d}});else if(g||y){Ye(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));const e=po(b,v,x),t=ip({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});w=bp({inputs:{x:t},backend:n,attrs:{shape:d}}),n.disposeIntermediateTensorInfo(t)}else{const e=cp(f,n.bufferSync(a),x,b);w=n.makeTensorInfo(d,e.dtype,e.values)}return w}};function Lp(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,o=it(a,t[0].shape)[0];let s=Fl(t.map((e=>e.shape)),o);if(0===et(s))return n.makeTensorInfo(s,t[0].dtype,[]);const i=t.filter((e=>et(e.shape)>0));if(1===i.length)return Sh({inputs:{x:i[0]},backend:n});if(Rl(i.map((e=>e.shape)),o),"complex64"===i[0].dtype){const e=i.map((e=>kh({inputs:{input:e},backend:n}))),t=i.map((e=>function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,o=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,o)}({inputs:{input:e},backend:n}))),r=Lp({inputs:e,backend:n,attrs:{axis:o}}),a=Lp({inputs:t,backend:n,attrs:{axis:o}}),s=Th({inputs:{real:r,imag:a},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),s}const u=i.map((e=>{const t=et(e.shape.slice(o));return bp({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),l=u.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));s=Fl(u.map((e=>e.shape)),1);const c=1===u[0].shape[0],h=Ph(l,s,t[0].dtype,c),p=Fl(i.map((e=>e.shape)),o),f=n.makeTensorInfo(p,t[0].dtype,h);return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}const Pp={kernelName:"Concat",backendName:"cpu",kernelFunc:Lp};function Bp(e){const{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:o}=r,s=a.shape.length,i=a.shape.slice();let u=o;return o<0&&(Ye(-(s+1)<=o,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),u=s+o+1),i.splice(u,0,1),bp({inputs:{x:a},backend:n,attrs:{shape:i}})}const Up={kernelName:"Pack",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return Bp({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const o=t[0].shape,s=t[0].dtype;t.forEach((e=>{Qe(o,e.shape,"All tensors passed to stack must have matching shapes"),Ye(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const i=[],u=Lp({inputs:t.map((e=>{const t=Bp({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}},zp={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:o}=t,{inputShape:s,strides:i,pad:u,dataFormat:l,dimRoundingMode:c}=r;vh([a,o],"conv2dBackpropInput");const h=bt(o.shape),p=bt(a.shape);let f=ts(l);const d=Ho(s,o.shape,i,1,u,c,!1,f),m=new Un(d.inShape,"float32"),g=m.values,y=n.data.get(a.dataId).values,b=n.data.get(o.dataId).values,[v,x,w]=h,{batchSize:_,filterHeight:T,filterWidth:E,inChannels:S,inHeight:I,inWidth:k,outChannels:C,outHeight:N,outWidth:A,strideHeight:$,strideWidth:R}=d;f=d.dataFormat;const F=T-1-d.padInfo.top,O=E-1-d.padInfo.left,D="channelsLast"===f,M=m.strides[0],L=D?m.strides[1]:m.strides[2],P=D?m.strides[2]:1,B=D?1:m.strides[1],U=p[0],z=D?p[1]:p[2],V=D?p[2]:1,W=D?1:p[1];for(let e=0;e<_;++e)for(let t=0;t<S;++t)for(let n=0;n<I;++n){const r=n-F,a=Math.max(0,Math.ceil(r/$)),o=Math.min(N,(T+r)/$);for(let s=0;s<k;++s){const i=s-O,u=Math.max(0,Math.ceil(i/R)),l=Math.min(A,(E+i)/R);let c=0;for(let n=a;n<o;++n){const a=n*$-r;for(let r=u;r<l;++r){const o=U*e+z*n+V*r,s=v*(T-1-a)+x*(E-1-(r*R-i))+w*t;for(let e=0;e<C;++e)c+=y[o+W*e]*b[s+e]}}g[M*e+L*n+P*s+B*t]=c}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},Vp={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:o,boxInd:s}=t,{cropSize:i,method:u,extrapolationValue:l}=r,[c,h,p,f]=a.shape,d=o.shape[0],[m,g]=i,y=gs([d,m,g,f],"float32"),b=n.data.get(o.dataId).values,v=n.data.get(s.dataId).values,x=n.data.get(a.dataId).values,w=bt(a.shape),_=bt(y.shape);for(let e=0;e<d;e++){const t=4*e,n=b[t],r=b[t+1],a=b[t+2],o=b[t+3],s=v[e];if(s>=c)continue;const i=m>1?(a-n)*(h-1)/(m-1):0,d=g>1?(o-r)*(p-1)/(g-1):0;for(let t=0;t<m;t++){const c=m>1?n*(h-1)+t*i:.5*(n+a)*(h-1);if(c<0||c>h-1)for(let n=0;n<g;n++)for(let r=0;r<f;r++){const a=r+n*_[2]+t*_[1]+e*_[0];y.values[a]=l}else if("bilinear"===u){const n=Math.floor(c),a=Math.ceil(c),i=c-n;for(let u=0;u<g;u++){const c=g>1?r*(p-1)+u*d:.5*(r+o)*(p-1);if(c<0||c>p-1){for(let n=0;n<f;n++){const r=n+u*_[2]+t*_[1]+e*_[0];y.values[r]=l}continue}const h=Math.floor(c),m=Math.ceil(c),b=c-h;for(let r=0;r<f;r++){let o=r+h*w[2]+n*w[1]+s*w[0];const l=x[o];o=r+m*w[2]+n*w[1]+s*w[0];const c=x[o];o=r+h*w[2]+a*w[1]+s*w[0];const p=x[o];o=r+m*w[2]+a*w[1]+s*w[0];const f=l+(c-l)*b,d=p+(x[o]-p)*b;o=r+u*_[2]+t*_[1]+e*_[0],y.values[o]=f+(d-f)*i}}}else for(let n=0;n<g;++n){const a=g>1?r*(p-1)+n*d:.5*(r+o)*(p-1);if(a<0||a>p-1){for(let r=0;r<f;r++){const a=r+n*_[2]+t*_[1]+e*_[0];y.values[a]=l}continue}const i=Math.round(a),u=Math.round(c);for(let r=0;r<f;r++){const a=r+i*w[2]+u*w[1]+s*w[0],o=r+n*_[2]+t*_[1]+e*_[0];y.values[o]=x[a]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},Wp={kernelName:"Reverse",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:o}=r;vh(a,"reverse");const s=a.shape.length,i=it(o,a.shape);if(0===s)return Sh({inputs:{x:a},backend:n});const u=new Un(a.shape,a.dtype),l=n.bufferSync(a);for(let e=0;e<u.size;e++){const t=u.indexToLoc(e),n=t.slice();i.forEach((e=>n[e]=a.shape[e]-1-n[e])),u.set(l.get(...n),...t)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}},jp={kernelName:"Unpack",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:o}=r;o<0&&(o+=a.shape.length);const s=a.shape.length,i=a.shape[o],u=new Array(s-1);let l=0;for(let e=0;e<s;e++)e!==o&&(u[l++]=a.shape[e]);const c=new Array(s).fill(0),h=a.shape.slice();h[o]=1;const p=new Array(i);for(let e=0;e<p.length;e++){c[o]=e;const t=ip({inputs:{x:a},backend:n,attrs:{begin:c,size:h}});p[e]=bp({inputs:{x:t},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(t)}return p}},Gp={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:o}=r;vh(a,"argMax");let s=it(o,a.shape);const i=js(s,a.shape.length);let u=a;const l=[];null!=i&&(u=tp({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=Gs(s.length,u.shape.length)),s=[s[0]],Ws("argMax",s,u.shape.length);const[c,h]=zs(u.shape,s),p=_t(et(c),"int32"),f=et(h),d=n.data.get(u.dataId).values;for(let e=0;e<p.length;++e){const t=e*f;let n=d[t],r=0;for(let e=0;e<f;++e){const a=d[t+e];a>n&&(n=a,r=e)}p[e]=r}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c,"int32",p)}},Hp={},Kp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qp(e,t){if(!(e in Hp)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete Hp[e]}),!1),1===e?n.getContext("webgl",Kp)||n.getContext("experimental-webgl",Kp):n.getContext("webgl2",Kp)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;Hp[e]=n}const n=Hp[e];return null==n||n.isContextLost()?(delete Hp[e],qp(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Hp[e])}var Xp,Yp,Qp;function Jp(e,t){return[t,e]}function Zp(e){const t=et(e);return rt(Math.ceil(t/4))}function ef(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function tf(e,t){const n=e;let r,a,o,s,i,u,l,c,h,p;return 2===Nt().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,o=n.RGBA16F,s=n.RGBA32F,i=n.RED,l=4,c=1,h=n.HALF_FLOAT,p=n.FLOAT,u=n.RGBA8):(r=e.RGBA,a=e.RGBA,o=e.RGBA,s=n.RGBA,i=e.RGBA,l=4,c=4,h=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:s,textureFormatFloat:i,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:p}}function nf(e,t){const n=t();return Nt().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}(e,t))}(e),n}function rf(e){return!!(Nt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function af(e,t){return ff(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Xp||(Xp={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Yp||(Yp={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Qp||(Qp={}));const of=/ERROR: [0-9]+:([0-9]+):/g;function sf(e,t){const n=of.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);const r=+n[1],a=e.split("\n"),o=a.length.toString().length+2,s=a.map(((e,t)=>at((t+1).toString(),o)+e));let i=0;for(let e=0;e<s.length;e++)i=Math.max(s[e].length,i);const u=s.slice(0,r-1),l=s.slice(r-1,r),c=s.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${at(l[0],i)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}function uf(e,t){if(nf(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function lf(e,t,n,r,a,o,s){const i=e.getAttribLocation(t,n);return-1!==i&&(nf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),nf(e,(()=>e.vertexAttribPointer(i,a,e.FLOAT,!1,o,s))),nf(e,(()=>e.enableVertexAttribArray(i))),!0)}function cf(e,t,n){nf(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),nf(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function hf(e,t){nf(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),nf(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function pf(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}(e,t))}function ff(e,t,n){const r=nf(e,(()=>t()));if(null==r)throw new Error(n);return r}function df(e,t=2){return et(e.slice(0,e.length-t))}function mf(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function gf(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[df(e),...mf(e)]),t}function yf(e){return e%2==0}function bf(e,t){if(tt(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(yf(n)&&yf(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&yf(e[0])&&yf(t[0])}let vf,xf;function wf(e,t){return null!=e.getExtension(t)}function _f(e){try{if(null!=qp(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Tf(e){const t=tf(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}const Ef=Nt();function Sf(){let e,t,n,r,a,o,s,i,u,l;return 2===Nt().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",o="outputColor",s="out vec4 outputColor;",i="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",o="gl_FragColor",s="",i="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:o,defineOutput:s,defineSpecialNaN:i,defineSpecialInf:u,defineRound:l}}function If(e,t,n="index"){const r=bt(t);return r.map(((t,a)=>`int ${e[a]} = ${n} / ${t}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${t}`:`index -= ${e[a]} * ${t}`};`)).join("")}function kf(e,t,n="index"){const r=bt(t);return r.map(((t,a)=>`int ${e[a]} = ${n} / outShapeStrides[${a}]; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * outShapeStrides[${a}]`:`index -= ${e[a]} * outShapeStrides[${a}]`};`)).join("")}function Cf(e){const t=bt(e).map((e=>e.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}Ef.registerFlag("HAS_WEBGL",(()=>Ef.getNumber("WEBGL_VERSION")>0)),Ef.registerFlag("WEBGL_VERSION",(()=>_f(2)?2:_f(1)?1:0)),Ef.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),Ef.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===Ef.get("WEBGL_VERSION"))),Ef.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),Ef.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),Ef.registerFlag("WEBGL_PACK",(()=>Ef.getBool("HAS_WEBGL"))),Ef.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_CLIP",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_PACK_REDUCE",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_LAZILY_UNPACK",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_CONV_IM2COL",(()=>Ef.getBool("WEBGL_PACK"))),Ef.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(e){if(null==vf){const t=qp(e);vf=t.getParameter(t.MAX_TEXTURE_SIZE)}return vf}(Ef.getNumber("WEBGL_VERSION")))),Ef.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(e){if(null==xf){const t=qp(e);xf=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,xf)}(Ef.getNumber("WEBGL_VERSION")))),Ef.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=Ef.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=qp(e);return t=wf(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:wf(n,"EXT_disjoint_timer_query")?1:0,t}(e)})),Ef.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>Ef.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ur())),Ef.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(e){if(0===e)return!1;const t=qp(e);if(1===e){if(!wf(t,"OES_texture_float"))return!1}else if(!wf(t,"EXT_color_buffer_float"))return!1;return Tf(t)}(Ef.getNumber("WEBGL_VERSION")))),Ef.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!Ef.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ef.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),Ef.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>function(e){if(0===e)return!1;const t=qp(e);if(1!==e){if(wf(t,"EXT_color_buffer_float"))return Tf(t);const e="EXT_color_buffer_half_float";if(wf(t,e)){const n=t.getExtension(e);return function(e,t){const n=tf(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),o}(t,n)}return!1}return!!wf(t,"OES_texture_float")&&!!wf(t,"WEBGL_color_buffer_float")&&Tf(t)}(Ef.getNumber("WEBGL_VERSION")))),Ef.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(e=Ef.getNumber("WEBGL_VERSION"))&&null!=qp(e).fenceSync;var e})),Ef.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>Ef.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),Ef.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),Ef.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>ur()?1:-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),Ef.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),Ef.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),Ef.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),Ef.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128));const Nf="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:Af}=tc;function $f(e,t,n){const r=[];if(e.forEach((e=>{const t=et(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(r.push(`uniform sampler2D ${e.name};`),r.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){const{uniformShape:t}=zf(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push(`uniform int ${e.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${e.name}Shape;`)}r.push(`uniform ivec2 ${e.name}TexShape;`)}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{r.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)}));const a=r.join("\n"),o=e.map((e=>function(e,t,n=!1,r){let a="";a+=n?Ff(e,r):Rf(e,r);const o=e.shapeInfo.logicalShape,s=t.logicalShape;return o.length<=s.length&&(a+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,i=Af(e.shapeInfo.logicalShape,t.logicalShape),u=Uf(s),l=s-o;let c;const h=["x","y","z","w","u","v"];c=0===o?"":s<2&&i.length>=1?"coords = 0;":i.map((e=>`coords.${h[e+l]} = 0;`)).join("\n");let p="";p=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${h[t+l]}`)).join(", ");let f="return outputValue;";const d=1===et(e.shapeInfo.logicalShape),m=1===et(t.logicalShape);if(1!==o||d||m){if(d&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(i.length){const e=o-2,t=o-1;i.indexOf(e)>-1&&i.indexOf(t)>-1?f="return vec4(outputValue.x);":i.indexOf(e)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(t)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${a}() {\n      ${u} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${r}(${p});\n      ${f}\n    }\n  `}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=t.texShape,s=e.shapeInfo.texShape,i=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===u&&null==e.shapeInfo.flatOffset&&tt(s,o))return`\n      float ${a}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const l=Uf(u),c=Af(e.shapeInfo.logicalShape,t.logicalShape),h=u-i;let p;const f=["x","y","z","w","u","v"];p=0===i?"":u<2&&c.length>=1?"coords = 0;":c.map((e=>`coords.${f[e+h]} = 0;`)).join("\n");let d="";return d=u<2&&i>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${f[t+h]}`)).join(", "),`\n    float ${a}() {\n      ${l} coords = getOutputCoords();\n      ${p}\n      return get${r}(${d});\n    }\n  `}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),s=t.texShape,i=Sf(),u=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(i);let l,c,h=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${Of}\n    ${Df}\n    ${Mf}\n  `}(i);return t.isPacked?(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `:1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(tt(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),o=a*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${o};\n      index -= b * ${o};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),o=a*Math.ceil(e[e.length-2]/2);let s=o,i="",u="b, r, c";for(let t=2;t<e.length-1;t++)s*=e[e.length-t-1],i=`\n      int b${t} = index / ${s};\n      index -= b${t} * ${s};\n    `+i,u=`b${t}, `+u;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${i}\n\n      int b = index / ${o};\n      index -= b * ${o};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec${e.length}(${u});\n    }\n  `}(e,t,n)}}(t.logicalShape,s,n.enableShapeUniforms),c=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(i)):(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `:1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}(0,t,n);case 2:return function(e,t,n){return tt(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${kf(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`;const r=If(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(e,t,n);case 4:return function(e,t,n){if(n)return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${kf(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `;const r=If(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t,n);case 5:return function(e,t){const n=If(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=If(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}(t.logicalShape,s,n.enableShapeUniforms),c=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(i)),n.packedInputs&&(h+=Lf),[h,u,c,a,l,o,n.userCode].join("\n")}function Rf(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[a,o]=e.shapeInfo.texShape;if(1===a&&1===o)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const s=Pf(n);if(t)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[i,u]=e.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${i}, ${u}, ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${Bf(e)}\n      }\n    `;const a=e.shapeInfo.texShape,o=a[0],s=a[1];if(1===s&&1===o)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const i=Pf(n);return 1===s?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / ${o}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:1===o?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${i}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${i}) + 0.5) / ${s}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:t?`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${o}, ${s}, index + ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape;if(null!=o&&tt(n,o)){if(t)return`\n      float ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const e=o[0];return`\n    float ${a}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${o[1]}.0, ${e}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:s,keptDims:i}=ut(n),u=s;if(u.length<n.length){const n=["row","col"];return`\n      ${Rf(Vf(e,u),t)}\n      float ${a}(int row, int col) {\n        return ${a}(${Wf(n,i)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${Bf(e)}\n      }\n    `;const l=o[0],c=o[1],h=Pf(r);return 1===c?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:1===l?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `:t?`\n      float ${a}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n  float ${a}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${l}, ${c}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],s=n[2],{newShape:i,keptDims:u}=ut(n),l=i;if(l.length<n.length){const n=["row","col","depth"];return`\n        ${Rf(Vf(e,l),t)}\n        float ${a}(int row, int col, int depth) {\n          return ${a}(${Wf(n,u)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${o}, ${s}, 1)));\n        ${Bf(e)}\n      }\n    `;const c=e.shapeInfo.texShape,h=c[0],p=c[1],f=e.shapeInfo.flatOffset;if(p===o&&null==f)return t?`\n      float ${a}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${a}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${s}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${p}.0, ${h}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(p===s&&null==f)return t?`\n      float ${a}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const d=Pf(r);return t?`\n    float ${a}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * ${o} + col * ${s} + depth + ${d};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `:`\n      float ${a}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${o} + col * ${s} + depth + ${d};\n        vec2 uv = uvFromFlat(${h}, ${p}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],s=n[2]*o,i=n[1]*s,{newShape:u,keptDims:l}=ut(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${Rf(Vf(e,u),t)}\n      float ${a}(int row, int col, int depth, int depth2) {\n        return ${a}(${Wf(n,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${i}, ${s}, ${o}, 1)));\n        ${Bf(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1],d=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(f===i&&null==c)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        ${d}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${s}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(f===o&&null==c)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=Pf(r);return t?`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${d}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${i} + col * ${s} +\n          depth * ${o} + depth2;\n      vec2 uv = uvFromFlat(${p}, ${f}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],o=t[3]*a,s=t[2]*o,i=t[1]*s,{newShape:u,keptDims:l}=ut(t);if(u.length<t.length){const t=["row","col","depth","depth2","depth3"];return`\n      ${Rf(Vf(e,u))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${Wf(t,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${i}, ${s}, ${o}, ${a})) +\n          depth3;\n        ${Bf(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1];return f===i&&null==c?`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${s}, ${o}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:f===a&&null==c?`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${i} + col * ${s} + depth * ${o} +\n          depth2 * ${a} + depth3 + ${Pf(n)};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:o}=ut(t);if(a.length<t.length){const t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${Rf(Vf(e,a))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${Wf(t,o)});\n      }\n    `}const s=t[5],i=t[4]*s,u=t[3]*i,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${c}, ${l}, ${u}, ${i})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${s}, 1)));\n        ${Bf(e)}\n      }\n    `;const h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,f=p[0],d=p[1];return d===c&&null==h?`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${l}, ${u}, ${i}, ${s})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${d}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:d===s&&null==h?`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${d}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${c} + col * ${l} + depth * ${u} +\n          depth2 * ${i} + depth3 * ${s} + depth4 + ${Pf(n)};\n      vec2 uv = uvFromFlat(${f}, ${d}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Ff(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${Sf().texture2D}(${t}, halfCR);\n    }\n  `}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=Sf();if(t)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${o.texture2D}(${n}, uv);\n    }\n  `;const s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${s[0]}, ${s[1]}, index);\n      return ${o.texture2D}(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,s=o[0],i=o[1],u=Sf();if(null!=o&&tt(n,o))return t?`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}.0, ${s}.0);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `;if(t)return`\n    vec4 ${a}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`\n    vec4 ${a}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(n[1]/2)}, ${l[0]}, ${l[1]}, row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){const r=[1,2],o=["b","row","col"];return`\n        ${Ff(Vf(e,n.slice(1)),t)}\n        vec4 ${a}(int b, int row, int col) {\n          return ${a}(${Wf(o,r)});\n        }\n      `}const i=Sf();if(t)return`\n    vec4 ${a}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${i.texture2D}(${r}, uv);\n    }\n  `;const u=s[0],l=s[1],c=Math.ceil(n[2]/2);return`\n    vec4 ${a}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${l}, ${c*Math.ceil(n[1]/2)}, ${c}, b, row, col);\n      return ${i.texture2D}(${r}, uv);\n    }\n  `}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Sf();if(t)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);\n    }\n  `;const o=e.shapeInfo.logicalShape,s=o.length,i=e.shapeInfo.texShape,u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=u[0],c=u[1],h=Math.ceil(o[s-1]/2);let p=h*Math.ceil(o[s-2]/2),f="int b, int row, int col",d=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let e=2;e<s-1;e++)f=`int b${e}, `+f,p*=o[s-e-1],d=`b${e} * ${p} + `+d;return`\n    vec4 ${r}(${f}) {\n      int index = ${d};\n      int texR = index / ${c};\n      int texC = index - texR * ${c};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});\n      return ${a.texture2D}(${n}, uv);\n    }\n  `}(e,t)}}const Of="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Df="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Mf="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Lf="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Pf(e){return`offset${e}`}function Bf(e){const t=e.name,n=et(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function Uf(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function zf(e,t,n){const{newShape:r,keptDims:a}=ut(t),o=t.length,s=e&&3===o&&1===t[0],i=s?t.slice(1):r,u=!e&&o>1&&!tt(t,n)&&r.length<o||s;return{useSqueezeShape:u,uniformShape:u?i:t,keptDims:a}}function Vf(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Wf(e,t){return t.map((t=>e[t])).join(", ")}function jf(e,t,n){const r={},a={},o={},s=[];let i,u,l,c=null,h=null;h=e.getUniformLocation(n,"NAN",!1),1===Nt().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));const p=!1;for(let s=0;s<t.variableNames.length;s++){const i=t.variableNames[s];r[i]=e.getUniformLocation(n,i,p),r[`offset${i}`]=e.getUniformLocation(n,`offset${i}`,p),t.enableShapeUniforms&&(a[`${i}Shape`]=e.getUniformLocation(n,`${i}Shape`,p),o[`${i}TexShape`]=e.getUniformLocation(n,`${i}TexShape`,p))}return t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",p),l=e.getUniformLocation(n,"outShapeStrides",p),u=e.getUniformLocation(n,"outTexShape",p)),t.customUniforms&&t.customUniforms.forEach(((t,r)=>{s[r]=e.getUniformLocation(n,t.name,p)})),{uniformLocations:r,customUniformLocations:s,infLoc:c,nanLoc:h,inShapesLocations:a,inTexShapesLocations:o,outShapeLocation:i,outShapeStridesLocation:l,outTexShapeLocation:u}}function Gf(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{const r=e.logicalShape,a=t[n],o=a.shape;if(!tt(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(e.isUniform&&a.isUniform)return;const s=e.texShape,i=a.isUniform?null:a.texData.texShape;if(!tt(s,i))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${i} must match`)}))}function Hf(e){return Nt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class Kf{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Sf();this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?kf(["r","c","d"],e):If(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}class qf{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Sf();this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?kf(["r","c","d"],e):If(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}class Xf{constructor(e){this.variableNames=["A"],this.outTexUsage=Yp.DOWNLOAD;const t=Sf();this.outputShape=e,this.userCode=`\n      ${Nf}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class Yf{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Yp.DOWNLOAD;const t=Sf();this.outputShape=e,this.userCode=`\n      ${Nf}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}class Qf{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Sf();this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length);let r="result";t&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Cf(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}class Jf{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Sf();this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let a=0;a<=1;a++){const o=2*t+a;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${a};\n          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${t};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${o}] = values[0];\n            } else if (offset == 1) {\n              result[${o}] = values[1];\n            } else if (offset == 2) {\n              result[${o}] = values[2];\n            } else {\n              result[${o}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Cf(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${a};\n        }\n    `}}function Zf(e,t,n,r,a,o){!function(e,t){const n=Nt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const s=function(e){return ff(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}(e),i=e.TEXTURE_2D;return nf(e,(()=>e.bindTexture(i,s))),nf(e,(()=>e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),nf(e,(()=>e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),nf(e,(()=>e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST))),nf(e,(()=>e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===Nt().getNumber("WEBGL_VERSION")?nf(e,(()=>e.texImage2D(i,0,r,t,n,0,a,o,null))):nf(e,(()=>e.texStorage2D(i,1,r,t,n))),nf(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:s,texShape:[n,t]}}function ed(e){return e.internalFormatFloat}function td(e){return e.internalFormatHalfFloat}function nd(e){return e.downloadTextureFormat}function rd(e){return e.internalFormatPackedFloat}function ad(e){return e.internalFormatPackedHalfFloat}class od{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=Nt().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Hp[e]=t}(t,e)):this.gl=qp(t);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Nt().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=af(this.gl,e),wf(this.gl,t))this.textureHalfFloatExtension=af(this.gl,t);else if(Nt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),wf(this.gl,r))this.colorBufferHalfFloatExtension=af(this.gl,r);else if(Nt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",wf(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!wf(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=function(e){return function(e,t){const n=ff(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return nf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),nf(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){const n=ff(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return nf(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),nf(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return ff(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=tf(this.gl,this.textureHalfFloatExtension)}get debug(){return Nt().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;nf(e,(()=>e.finish())),nf(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),nf(e,(()=>e.deleteFramebuffer(this.framebuffer))),nf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),nf(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),nf(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,o]=Jp(t,n);return Zf(e,a,o,ed(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,o]=Jp(t,n);return Zf(e,a,o,td(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,o]=Jp(t,n);return Zf(e,a,o,nd(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){nf(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===Nt().getNumber("WEBGL_VERSION")?nf(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):nf(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===Nt().getNumber("WEBGL_VERSION")?nf(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):nf(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),nf(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,o){let s,i,u;nf(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),a instanceof Uint8Array?(s=new Uint8Array(n*r*4),i=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(n*r*4),i=e.FLOAT,u=o.internalFormatPackedFloat),s.set(a),2===Nt().getNumber("WEBGL_VERSION")?nf(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,i,s))):nf(e,(()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,i,s))),nf(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,o]=ef(t,n);return Zf(e,a,o,ad(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,o]=ef(t,n);return Zf(e,a,o,rd(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(hf(this.gl,this.framebuffer),this.outputTexture=null),nf(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n,r){const[a,o]=Jp(t,n),s=new Uint8Array(t*n*4);return nf(e,(()=>e.readPixels(0,0,a,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s))),new Float32Array(s.buffer)}(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,a,o){return function(e,t,n,r,a,o,s,i){const u=e,l=new Float32Array(function(e,t){const[n,r]=ef(e,t);return n*r*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,a,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n,r){const a=e.createBuffer();nf(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a)));const o=16*t*n;return nf(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ))),nf(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),nf(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Nt().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n){const r=new Float32Array(t*n*4);return nf(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=function(e){const t=Sf();return function(e,t){const n=ff(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(nf(e,(()=>e.shaderSource(n,t))),nf(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(t));const n=function(e){return ff(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}(t);return nf(t,(()=>t.attachShader(n,this.vertexShader))),nf(t,(()=>t.attachShader(n,e))),function(e,t){if(nf(e,(()=>e.linkProgram(t))),!Nt().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n),this.debug&&uf(t,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(e,t,n){return nf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),lf(e,t,"clipSpacePos",n,3,20,0)&&lf(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),n}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&nf(this.gl,(()=>this.gl.deleteProgram(e)))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&uf(this.gl,this.program),nf(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return ff(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),nf(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){nf(e,(()=>function(e,t,n){!function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)}(e,n),nf(e,(()=>e.activeTexture(e.TEXTURE0+n))),nf(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}(e,t,r))),nf(e,(()=>e.uniform1i(n,r)))}(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,a]=ef(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&uf(this.gl,this.program),pf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),nf(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),nf(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=af(this.gl,2===Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await ot((()=>this.disposed||this.isQueryAvailable(e,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||ot((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),cf(this.gl,e,this.framebuffer),this.debug&&pf(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(cf(this.gl,this.outputTexture,this.framebuffer),this.debug&&pf(this.gl)):hf(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;cf(r,e,this.framebuffer),this.debug&&pf(r),this.outputTexture=e,nf(r,(()=>r.viewport(0,0,t,n))),nf(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),nf(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:sd,bincountImpl:id,bincountReduceImpl:ud,ceilImpl:ld,concatImpl:cd,equalImpl:hd,expImpl:pd,expm1Impl:fd,floorImpl:dd,gatherNdImpl:md,gatherV2Impl:gd,greaterImpl:yd,greaterEqualImpl:bd,lessImpl:vd,lessEqualImpl:xd,linSpaceImpl:wd,logImpl:_d,maxImpl:Td,maximumImpl:Ed,minimumImpl:Sd,multiplyImpl:Id,negImpl:kd,notEqualImpl:Cd,prodImpl:Nd,rangeImpl:Ad,rsqrtImpl:$d,scatterImpl:Rd,sigmoidImpl:Fd,simpleAbsImpl:Od,sliceImpl:Dd,sparseFillEmptyRowsImpl:Md,sparseReshapeImpl:Ld,sparseSegmentReductionImpl:Pd,sqrtImpl:Bd,stridedSliceImpl:Ud,stringNGramsImpl:zd,stringSplitImpl:Vd,stringToHashBucketFastImpl:Wd,subImpl:jd,tileImpl:Gd,topKImpl:Hd,transposeImpl:Kd,uniqueImpl:qd}=yp;function Xd(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>`${e}.${t}`))}function Yd(e,t){return 1===t?[e]:Xd(e,t)}class Qd{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Hf(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=Yd("rc",this.rank),t=Uf(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode=`\n        void main() {\n          ${t} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${a}));\n          }\n        }\n      `}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let t=2;t<this.rank;t++)a=`${e[e.length-1-t]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${t[0]};\n      int c = ${t[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(e){const t=this.getSourceCoordsArr(e);return 1===this.rank?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),\n            cEdge ? 0. : getA(${t[1]}),\n            rEdge ? 0. : getA(${t[2]}),\n            rEdge || cEdge ? 0. : getA(${t[3]})`}}class Jd{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length);let n="";for(let e=0;e<4;e++){let t="thisRC = rc;";e%2==1&&(t+="thisRC.z += 1;"),e>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${e>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${e}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${e>0?"}":""}\n      `}var r,a;this.userCode=`\n      ${r=t,a=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${a?function(e,t,n="index"){const r=e.map(((e,t)=>t)),a=function(e,t){const n=e.length,r=e.map((e=>`${t}[${e}]`)),a=new Array(n-1);a[n-2]=r[n-1];for(let e=n-3;e>=0;--e)a[e]=`(${a[e+1]} * ${r[e+1]})`;return a}(r,t);return a.map(((t,r)=>`int ${e[r]} = ${n} / ${a[r]}; ${r===a.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * ${a[r]}`:`index -= ${e[r]} * ${a[r]}`};`)).join("")}(["r","c","d"],"inputShape"):If(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Cf(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class Zd{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const r=tm(t,n),a=nm(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const o=em(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const e=this.freeTextures[a].shift();return this.usedTextures[a].push(e),e}let s;return r===Qp.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Qp.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Qp.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Qp.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Qp.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(s),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),s}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const a=tm(n,r),o=nm(t,a,r);o in this.freeTextures||(this.freeTextures[o]=[]);const s=em(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),i=Nt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==i&&this._numBytesAllocated>i?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const u=this.usedTextures[o],l=u.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(l,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function em(e,t,n,r,a){const o=function(e,t){switch(e){case Qp.PACKED_2X2_FLOAT32:return rd(t);case Qp.PACKED_2X2_FLOAT16:return ad(t);case Qp.UNPACKED_FLOAT32:return ed(t);case Qp.UNPACKED_FLOAT16:return td(t);case Qp.PACKED_4X1_UNSIGNED_BYTE:return nd(t);default:throw new Error(`Unknown physical texture type ${e}`)}}(t,r);let s;if(a){const[t,n]=ef(e[0],e[1]);s=t*n}else{const[t,n]=Jp(e[0],e[1]);s=t*n}const i=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}(n,o);return s*i}function tm(e,t){if(e===Yp.UPLOAD)return Qp.PACKED_2X2_FLOAT32;if(e===Yp.RENDER||null==e)return function(e){return Nt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Qp.PACKED_2X2_FLOAT32:Qp.UNPACKED_FLOAT32:e?Qp.PACKED_2X2_FLOAT16:Qp.UNPACKED_FLOAT16}(t);if(e===Yp.DOWNLOAD||e===Yp.PIXELS)return Qp.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function nm(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class rm{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const am="return abs(x);",om="return x;";class sm{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class im{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length);const t=e.length,n=Yd("rc",t),r=Uf(t),a=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),o=n.slice(-2),s=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${a});\n\n        setOutput(getChannel(packedInput, ${s}));\n      }\n    `}}const um=Mu,lm={},cm=Nt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class hm extends Ge{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Nt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof od)t=e;else{const n=qp(Nt().getNumber("WEBGL_VERSION"),e);t=new od(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=qp(Nt().getNumber("WEBGL_VERSION"));t=new od(e),this.binaryCache=((n=Nt().getNumber("WEBGL_VERSION"))in lm||(lm[n]={}),lm[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Zd(this.gpgpu),this.numMBBeforeWarning=null==Nt().global.screen?1024:Nt().global.screen.height*Nt().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new je(this,Ya())}nextDataId(){return hm.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,n){if((Nt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Nt().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Yp.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,r,a){if(Nt().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Yp.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:o,shape:s,isPacked:i}=t;if(null!=o){let t;t=i?new sm(s,om):new rm(s,om);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const u=null!=this.activeTimers;let l,c;return u&&(l=Nn()),c="complex64"===r?Ul(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.getValuesFromTexture(e),u&&(this.downloadWaitMs+=Nn()-l),this.convertAndCacheOnCPU(e,c)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:o,complexTensorInfos:s,isPacked:i}=t;if(null!=a){let t;t=i?new sm(r,om):new rm(r,om);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:o}],o),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(Nt().getBool("DEBUG")&&!Nt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Nt().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,l,c=null;if("complex64"!==o&&Nt().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const t=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(t.texture.texture,...Zp(r))}if(this.pendingRead.set(e,[]),"complex64"!==o&&await this.gpgpu.createAndWaitForFence(),"complex64"===o){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);l=Ul(e[0],e[1])}else if(null==c)l=this.getValuesFromTexture(e);else{const e=et(r);l=this.gpgpu.downloadFloat32MatrixFromBuffer(c,e)}if(null!=u&&this.disposeIntermediateTensorInfo(u),null!=c){const e=this.gpgpu.gl;nf(e,(()=>e.deleteBuffer(c)))}const h=this.convertAndCacheOnCPU(e,l),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach((e=>e(h))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ya().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,t={}){const n=this.texData.get(e),{values:r,shape:a,slice:o,dtype:s,isPacked:i,texture:u}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=o){let n;n=i?new sm(a,om):new rm(a,om);const r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:s}],s),o=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),o}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const l=this.decode(e,t.customTexShape),c=Ya().makeTensorFromTensorInfo(l),h=this.texData.get(l.dataId);return Object.assign({tensorRef:c},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>$n(e)));return gs(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return gs(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!rf(n)){if(Nt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=et(t);if(Nt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),o=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...Zp(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),o}const o=Nt().getBool("WEBGL_PACK")&&!0===r,s=o?gf(t):t,i=o?new Yf(s):new Xf(s),u=this.runWebGLProgram(i,[{shape:s,dtype:n,dataId:e}],"float32"),l=this.texData.get(u.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture.texture,l.texShape[0],l.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(u),c}timerAvailable(){return Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=Ze(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),o=Ze(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);s.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),s.getExtraProfileInfo=()=>e.map(((e,t)=>({name:o[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Nn(),endMs:null}}endTimer(e){return Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Nn(),e)}async getQueryTime(e){if(Nt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:a,isPacked:o,slice:s}=this.texData.get(e),i=s&&s.origDataId||e,u=this.dataRefCount.get(i);u>1?this.dataRefCount.set(i,u-1):(this.dataRefCount.delete(i),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,o)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=cm){return Nt().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&et(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){Ot("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return um(e.shape,t)}packedUnaryOp(e,t,n){const r=new sm(e.shape,t),a=this.compileAndRun(r,[e],n);return Ya().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=Od(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,am,e.dtype);const t=new rm(e.shape,am),n=this.compileAndRun(t,[e]);return Ya().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&dt(n[0])){const a=n.map((e=>An(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return Ya().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new im(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Qd(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[df(e.shape),...mf(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[df(t),...mf(t)],o=new Jd(a,n),s=[n],i=this.runWebGLProgram(o,[r],e.dtype,s,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:a,dtype:o}=n;null!=t&&Ye(et(a)<=t[0]*t[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."));const s=gf(a);let i;i=r?new qf(s):new Kf(s);const u=[null!=t?t:Zp(s)];return{dtype:o,shape:a,dataId:this.runWebGLProgram(i,[{shape:s,dtype:o,dataId:e}],o,u,!0,t).dataId}}runWebGLProgram(e,t,n,r,a=!1,o){const s=this.makeTensorInfo(e.outputShape,n),i=this.texData.get(s.dataId);if(e.packedOutput&&(i.isPacked=!0),e.outPackingScheme===Xp.DENSE){const t=null!=o?o:Zp(e.outputShape);i.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(i.usage=e.outTexUsage),0===et(s.shape))return i.values=lt(s.dtype,0),s;const u=[],l=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&et(t.shape)<=Nt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),u.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!bf(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),u.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);const c={shape:s.shape,texData:i,isUniform:!1},h=function(e,t,n){let r="";t.concat(n).forEach((t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const o=t.texData.texShape,{useSqueezeShape:s,uniformShape:i,keptDims:u}=zf(e.packedInputs,t.shape,o);let l="",c="",h="";if(1===i.length&&e.packedInputs){const e=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];l=`${e[0]>1}_${e[1]>1}`}else if(2!==i.length||e.packedInputs){if(i.length>2&&!e.packedInputs){const e=bt(i);h=`${e[0]===o[1]}_${e[e.length-1]===o[1]}`}}else c=`${i[0]>1}_${i[1]>1}`;const p=t.shape.length,f=2===i.length&&tt(t.shape,o),d=1===et(t.shape),m=ao(t.shape,n.shape),g=!e.packedInputs&&p===n.shape.length&&tt(o,n.texData.texShape),y=e.packedInputs||i.length>2?"":`${o[0]>1}_${o[1]>1}`;r+=`${p}_${g}_${s?u:""}_${i.length}_${d}_${m}_${f}_${l}_${c}_${h}_${y}_${a}`}else{const e=t.isUniform?"uniform":t.texData.texShape;r+=`${t.shape}_${e}_${a}`}}));const a=e.userCode;let o=e.constructor.name;return o+="_"+r+"_"+a+`${Nt().getNumber("WEBGL_VERSION")}`,o}(e,l,c),p=this.getAndSaveBinary(h,(()=>function(e,t,n,r){const a=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((e=>e.shapeInfo)),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},i=$f(a,s,t),u=function(e,t){const n=ff(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(nf(e,(()=>e.shaderSource(n,t))),nf(e,(()=>e.compileShader(n))),Nt().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw sf(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,i),l=e.createProgram(u);return Nt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:i,webGLProgram:l,inShapeInfos:o,outShapeInfo:s,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:i,webGLProgram:l,inShapeInfos:o,outShapeInfo:s},jf(e,t,l))}(this.gpgpu,e,l,c))),f=null!=this.activeTimers;let d;f&&(d=this.startTimer()),Nt().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(Gf(t.inShapeInfos,n),Gf([t.outShapeInfo],[r]));const o=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(o.texture,s[0],s[1]):e.setOutputMatrixTexture(o.texture,s[0],s[1]),e.setProgram(t.webGLProgram),1===Nt().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(((n,r)=>{const a=t.program.variableNames[r],o=t.uniformLocations[a],s=t.uniformLocations[`offset${a}`],i=t.inShapesLocations[`${a}Shape`],u=t.inTexShapesLocations[`${a}TexShape`];if(i){const{uniformShape:r}=zf(t.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:e.gl.uniform1iv(i,new Int32Array(r));break;case 2:e.gl.uniform2iv(i,new Int32Array(r));break;case 3:e.gl.uniform3iv(i,new Int32Array(r));break;case 4:e.gl.uniform4iv(i,new Int32Array(r))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=o)if(n.isUniform)if(et(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(o,t)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,o,r)}));const i=t.outShapeLocation;if(i)switch(r.shape.length){case 1:e.gl.uniform1iv(i,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(i,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(i,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(i,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=bt(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach(((n,r)=>{const o=t.customUniformLocations[r],s=a[r];if("float"===n.type)e.gl.uniform1fv(o,s);else if("vec2"===n.type)e.gl.uniform2fv(o,s);else if("vec3"===n.type)e.gl.uniform3fv(o,s);else if("vec4"===n.type)e.gl.uniform4fv(o,s);else if("int"===n.type)e.gl.uniform1iv(o,s);else if("ivec2"===n.type)e.gl.uniform2iv(o,s);else if("ivec3"===n.type)e.gl.uniform3iv(o,s);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(o,s)}})),e.executeProgram()}(this.gpgpu,p,l,c,r),u.forEach((e=>this.disposeIntermediateTensorInfo(e))),f&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));const m=Nt().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=Nn();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!Nt().getBool("WEBGL_LAZILY_UNPACK")&&i.isPacked&&!1===a){const e=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),e}return s}compileAndRun(e,t,n,r,a=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Nt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Qa((()=>{if(!Nt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Nt().getBool("DEBUG");Nt().set("DEBUG",!1);const t=this.abs(Xs(1e-8)).dataSync()[0];if(Nt().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:o,usage:s,isPacked:i}=t;if(null!=o)return;const u=null!=this.activeTimers;let l;u&&(l=Nn());let c=t.texShape;if(null==c&&(c=function(e,t=!1){let n=Nt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map(((t,n)=>n>=e.length-2?qe(e[n]):e[n])),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=ut(e);e=t.newShape}let r=et(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=df(e);let n=2,a=2;return e.length&&([n,a]=mf(e)),r=t*(n/2)*(a/2),rt(r).map((e=>2*e))}return rt(r)}(n,i),t.texShape=c),null!=a){const e=gf(n);let o,s=c[1],h=c[0];const p=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!i&&p||([s,h]=ef(c[0],c[1])),o=i?new Jf(e,p):new Qf(e,p);const f=p?[h,s]:c,d=this.makeTensorInfo(f,r),m=this.texData.get(d.dataId);m.usage=p?Yp.PIXELS:Yp.UPLOAD,m.texShape=f,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(d.dataId),s,h,a);const g=[[h,s]],y=!0,b=this.runWebGLProgram(o,[d],r,g,y),v=this.texData.get(b.dataId);t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,Nt().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(t.texture=v.texture,t.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(d),u&&(this.uploadWaitMs+=Nn()-l)}else{const e=this.acquireTexture(c,s,r,i);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*ft(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(e){throw e}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await new Promise((e=>$l((()=>e())))),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw sf(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,inShapesLocations:o,inTexShapesLocations:s,outShapeLocation:i,outShapeStridesLocation:u,outTexShapeLocation:l}=jf(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.inShapesLocations=o,e.inTexShapesLocations=s,e.outShapeLocation=i,e.outShapeStridesLocation=u,e.outTexShapeLocation=l}}}hm.nextDataId=0,lr()&&Za("webgl",(()=>new hm),2);class pm{constructor(e){this.variableNames=["A"];const t=Sf(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class fm{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Sf(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}const dm={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:a}=t;const{numChannels:o}=r,s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,[u,l]=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=[l,u],h=[l,u,o];(i||s)&&(null==mm&&(mm=document.createElement("canvas").getContext("2d")),mm.canvas.width=u,mm.canvas.height=l,mm.drawImage(a,0,0,u,l),a=mm.canvas);const p=n.makeTensorInfo(c,"int32");n.texData.get(p.dataId).usage=Yp.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);const f=Nt().getBool("WEBGL_PACK")?new fm(h):new pm(h),d=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),d}};let mm;function gm(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:o}=r,s=n,i=et(a.shape),u=st(o,i),l=et(u);Ye(i===l,(()=>`The new shape (${u}) has ${l} elements and the old shape (${a.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`));const c=s.texData.get(a.dataId);return!c.isPacked||bf(a.shape,u)||null!==c.texture&&bf(c.shape,u)?(s.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){const r=[df(e.shape),...mf(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},o=[df(t),...mf(t)],s=new Jd(o,r),i=[r],u=n.runWebGLProgram(s,[a],e.dtype,i,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,s)}const ym={kernelName:"Reshape",backendName:"webgl",kernelFunc:gm};class bm{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[o,s,i,u]=e;this.outputShape=[o,t,n,u];const l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${i}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class vm{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,s,i,u]=e;this.outputShape=[o,t,n,u];const l=[r&&t>1?s-1:s,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${i}.0,\n                                     ${i}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}const xm={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:o,halfPixelCenters:s,size:i}=r,[u,l]=i,c=Nt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new vm(a.shape,u,l,o,s):new bm(a.shape,u,l,o,s);return n.runWebGLProgram(c,[a],"float32")}};function wm(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const _m={kernelName:"Identity",backendName:"webgl",kernelFunc:wm};function Tm(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,o=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(o.dataId),i=wm({inputs:{x:r},backend:n}),u=wm({inputs:{x:a},backend:n});return s.complexTensorInfos={real:i,imag:u},o}class Em{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=so(t,n),this.enableShapeUniforms=Hf(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}class Sm{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=so(t,n);const a=this.outputShape.length;this.enableShapeUniforms=Hf(a);let o="";if(r)if(0===a||1===et(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o=`\n          ${Uf(a)} coords = getOutputCoords();\n        `,1===a)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=Yd("coords",a);this.enableShapeUniforms?o+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= outShape[${a} - 2];\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= outShape[${a} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:o+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= ${this.outputShape[a-2]};\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= ${this.outputShape[a-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${o}\n\n        setOutput(result);\n      }\n    `}}function Im({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:o})=>{const{x:s}=a,i=o,u=r||s.dtype;if(i.shouldExecuteOnCPU([s])&&null!=n){const e=i.texData.get(s.dataId),t=n(e.values,u);return i.makeTensorInfo(s.shape,u,t)}let l;return l=Nt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new sm(s.shape,t):new rm(s.shape,e),i.runWebGLProgram(l,[s],u)}}function km({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:o}){return({inputs:s,backend:i})=>{const{a:u,b:l}=s,c=i;if(r&&"complex64"===u.dtype){const t=c.texData.get(u.dataId),n=c.texData.get(l.dataId),[r,a]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((t=>{const[n,r]=t,a={dataId:n.dataId,dtype:n.dtype,shape:u.shape},o={dataId:r.dataId,dtype:r.dtype,shape:l.shape},s=new Em(e,u.shape,l.shape);return c.runWebGLProgram(s,[a,o],Jn(n.dtype,r.dtype))})),o=Tm({inputs:{real:r,imag:a},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(a),o}const h=o||Jn(u.dtype,l.dtype);if(("string"===u.dtype||"string"===l.dtype||c.shouldExecuteOnCPU([u,l]))&&null!=a){const e=c.texData.get(u.dataId).values,t=c.texData.get(l.dataId).values,n="string"===u.dtype?Zl(e):e,r="string"===u.dtype?Zl(t):t,[o,s]=a(u.shape,l.shape,n,r,h),i=c.makeTensorInfo(s,h);return c.texData.get(i.dataId).values=o,i}let p;return p=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new Sm(t,u.shape,l.shape,n):new Em(e,u.shape,l.shape),c.runWebGLProgram(p,[u,l],h)}}function Cm(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?"\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n":"return (a < 0.) ? b * a : a;";if("leakyrelu"===e)return t?"\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n":"return (a < 0.) ? b * a : a;";if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}const Nm=km({opSnippet:"return float(a != b);",cpuKernelImpl:Cd,dtype:"bool"});function Am(e){const{inputs:t,backend:n}=e,{input:r}=t;return wm({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const $m={kernelName:"Cast",backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:a}=t,{x:o}=n,{dtype:s}=a;if("complex64"===s){if("complex64"===o.dtype)return wm({inputs:{x:o},backend:r});const t=Di(o.shape),n=e({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),a=Tm({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),a}if("complex64"===o.dtype){const t=Am({inputs:{input:o},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(t),n}if(!ht(o.dtype,s)){const e=wm({inputs:{x:o},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if("int32"===s)return function(e,t){const n=new rm(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,r);if("bool"===s){const e=r.makeTensorInfo([],"bool",lt("bool",1)),t=Nm({inputs:{a:o,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}},Rm=km({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Fm={kernelName:"RealDiv",backendName:"webgl",kernelFunc:Rm};class Om{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=Uf(r),o=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${a} start = ${a}(${o});\n      ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${a} coords = outC - start;\n          setOutput(getX(${i}));\n        }\n      }\n    `:`\n        int start = ${o};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class Dm{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=Uf(r),o=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),i=Yd("rc",r),u=Yd("source",r),l=`${i[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${u.slice(-2).join()})`,h=[`${a} rc = outputLoc;`,`${i[r-1]} += 1;\n       if(${l}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${i[r-2]} += 1;\n       if(${i[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${i[r-1]} += 1;\n         if(${l}) {`],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let e=0,t=1===r?2:4;e<t;e++)f+=`\n        ${h[e]}\n        if (${p}) {\n          result[${e}] = float(value);\n        } else {\n          ${a} source = rc - start;\n          result[${e}] = getChannel(getX(${u.join()}), ${c});\n        }\n      `;f+=1===r?"} ":"}}",this.userCode=`\n      const ${a} start = ${a}(${o});\n      const ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}class Mm{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}const Lm=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:o,constantValue:s}=r;if(0===et(a.shape)){const e=o.map(((e,t)=>e[0]+a.shape[t]+e[1]));return function(e){const{backend:t,attrs:n}=e,{shape:r,value:a}=n;let{dtype:o}=n;if(o=o||mt(a),"string"===o){const e=ct(o,et(r));return e.fill(a),t.makeTensorInfo(r,o,e)}{const e=new Mm(r,a),n=[[a]];return t.runWebGLProgram(e,[],o,n)}}({backend:n,attrs:{shape:e,value:s,dtype:a.dtype}})}const i=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Dm(a.shape,o,s):new Om(a.shape,o,s),u=[[s]];return n.runWebGLProgram(i,[a],a.dtype,u)},Pm={kernelName:"PadV2",backendName:"webgl",kernelFunc:Lm};class Bm{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,s=e.padInfo.left,i=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=4*Math.floor(e.inChannels/4),d=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1;let v="",x="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${i}, ${u});\n      const ivec2 pads = ivec2(${o}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${p}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===d}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===d}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===d}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class Um{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Hf(this.outputShape.length);const{dataFormat:n}=t,r=Sf(),a="channelsLast"===n,o=a?0:1,s=a?1:2,i=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${e[1]} && pos < ${e[0]}) {`;let u="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)u+=`\n          blockIndex = rc.y + ${t};\n          pos = rc.x + ${e};\n\n          ${i}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${o}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${s}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${a}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*e+t}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*e+t}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${r.output} = result;\n      }\n    `}}class zm{constructor(e,t,n,r=!1,a=!1,o=!1,s=null,i=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Hf(this.outputShape.length);const l=r?e[1]:e[2],c=Math.ceil(l/2),h=r?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";s&&(m=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${s}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${s}\n        }`:`vec4 activation(vec4 x) {\n          ${s}\n        }`,g="result = activation(result);");const y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<t[0]?b=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(v=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${c}; i++) {\n          int batchA = ${b};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${p});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${f[0]} * ${d[0]});\n          result += (${f[1]} * ${d[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}class Vm{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=so(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const Wm="return a * b;";function jm(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,o=Jn(r.dtype,a.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),o=new Vm("return areal * breal - aimag * bimag;",r.shape,a.shape),s=new Vm("return areal * bimag + aimag * breal;",r.shape,a.shape),i=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:a.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:a.shape}],u=n.runWebGLProgram(o,i,"float32"),l=n.runWebGLProgram(s,i,"float32"),c=Tm({inputs:{real:u,imag:l},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),c}if(n.shouldExecuteOnCPU([r,a])){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),[s,i]=Id(r.shape,a.shape,e.values,t.values,o),u=n.makeTensorInfo(i,o);return n.texData.get(u.dataId).values=s,u}let s;return s=Nt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm(Wm,r.shape,a.shape):new Em(Wm,r.shape,a.shape),n.runWebGLProgram(s,[r,a],o)}const Gm={kernelName:"Multiply",backendName:"webgl",kernelFunc:jm};class Hm{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:o}=e;this.outputShape=[r,o];const s=4*Math.floor(n/4),i=n%4;let u="sumValue += dot(values, ones);";if(null!=t){const e=1/t;u=`sumValue += dot(values * ${nt(e)?e.toPrecision(2):e}, ones);`}let l="";a%n>0&&(l=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${l}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===i}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===i}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===i}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}class Km{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:o}=e;this.outputShape=[r,o];let s="0.0",i="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",i="min"):"max"===t&&(s="-1.0 / 1e-20",i="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");const l=4*Math.floor(n/4),c=n%4;let h=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${i}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${i}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,p="vec4";"all"===t?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");let f="";a%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${s};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${s});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${l}; i += 4) {\n          int inIdx = inOffset + i;\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${l};\n        if (${1===c}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===c}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===c}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${u});\n      }\n    `}}function qm(e,t,n,r){const a=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=Ol(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let o=e;for(let s=0;s<a.length;s++){const{inSize:i,windowSize:u,outSize:l}=a[s];let c,h;c="mean"===n?0===s?new Hm({windowSize:u,inSize:i,batchSize:e.shape[0],outSize:l},i):new Hm({windowSize:u,inSize:i,batchSize:e.shape[0],outSize:l}):new Km({windowSize:u,inSize:i,batchSize:e.shape[0],outSize:l},n),h=o,o=r.runWebGLProgram(c,[o],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return o}class Xm{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;const r=Uf(this.rank),a=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let t=0;t<e.length;t++)r[e[t]]=n[t];return r.join()}(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${a}));\n    }\n    `}}class Ym{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Uf(this.rank),a=Xd("rc",this.rank),o=new Array(this.rank);for(let e=0;e<t.length;e++)o[t[e]]=a[e];const s=`vec2(${o.slice(-2).join()})`,i=`++${a[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${s})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${i}) {\n        result[1] = ${u};\n      }\n      --${a[this.rank-1]};\n      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${i}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function Qm(e,t,n){const r=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ym(e.shape,t):new Xm(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Jm(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:o,keepDims:s}=r;return function(e,t,n,r){const a=t,o=e.shape.length,s=it(a,e.shape);let i=s;const u=js(i,o),l=null!=u;let c=e;l&&(c=Qm(e,u,r),i=Gs(i.length,o)),Ws("sum",i,o);const[h,p]=zs(c.shape,i);let f=h;n&&(f=Vs(h,s));const d=et(p),m=gm({inputs:{x:c},attrs:{shape:[et(e.shape)/d,d]},backend:r}),g=qm(m,Jn(e.dtype,"int32"),"sum",r),y=gm({inputs:{x:g},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(c),y}(a,o,s,n)}function Zm(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:o}=r,s=n,i=a.shape.length,u=new Array(i);for(let e=0;e<u.length;e++)u[e]=a.shape[o[e]];let l;if(s.shouldExecuteOnCPU([a])){const e=s.texData.get(a.dataId).values,t=Kd(e,a.shape,a.dtype,o,u);l=s.makeTensorInfo(u,a.dtype),s.texData.get(l.dataId).values=t}else l=Qm(a,o,s);return l}function eg({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:u=null}){const l=e.shape.length,c=t.shape.length,h=n?e.shape[l-2]:e.shape[l-1],p=r?t.shape[c-1]:t.shape[c-2],f=n?e.shape[l-1]:e.shape[l-2],d=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),y=et(m),b=et(g),v=so(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,d]);Ye(h===p,(()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=n?[y,h,f]:[y,f,h],w=r?[b,d,p]:[b,p,d],_=gm({inputs:{x:e},backend:a,attrs:{shape:x}}),T=gm({inputs:{x:t},backend:a,attrs:{shape:w}}),E=[_,T],S=Math.max(y,b),I=n?_.shape[1]:_.shape[2],k=null!=o,C=null!=s,N="leakyrelu"===u,A=null!=u?Cm(u,!0):null;let $;if((1===f||1===d)&&I>1e3&&!1===(k||C||N||null!=A)){let e=_,t=T;n&&(e=Zm({inputs:{x:_},backend:a,attrs:{perm:[0,2,1]}}),E.push(e)),r&&(t=Zm({inputs:{x:T},backend:a,attrs:{perm:[0,2,1]}}),E.push(t));const o=1===d;let s=e;1!==d&&(s=gm({inputs:{x:e},backend:a,attrs:{shape:[S,I,1]}}),E.push(s));const i=1===d?2:1;let u=t;o&&(u=gm({inputs:{x:t},backend:a,attrs:{shape:[S,1,I]}}),E.push(u));const l=jm({inputs:{a:s,b:u},backend:a});$=Jm({inputs:{x:l},backend:a,attrs:{axis:i,keepDims:!0}}),E.push(l)}else{const u=Jn(e.dtype,t.dtype),l=new zm(x,w,[S,f,d],n,r,k,A,C,N),c=[_,T];if(null!=o&&c.push(o),C&&c.push(s),N){const e=a.makeTensorInfo([],"float32",kn(i,"float32"));c.push(e),E.push(e)}$=a.runWebGLProgram(l,c,u)}const R=gm({inputs:{x:$},backend:a,attrs:{shape:v}});E.push($);for(const e of E)a.disposeIntermediateTensorInfo(e);return R}function tg({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:i=null}){const u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,h=u[0]*u[1]*u[2],p=n.outChannels,f="channelsLast"===n.dataFormat;let d;const m=[];if(null!=o&&!f&&3===o.shape.length){const e=Zm({inputs:{x:o},backend:r,attrs:{perm:[1,2,0]}});m.push(e),o=e}if((1!==h&&1!==p||!(c>1e3))&&l.isPacked&&f&&null!=l.texture&&u[2]%2!=0&&tt(l.shape.slice(-3),u.slice(-3))){const c=u[0]*u[1]*(u[2]+1),h={dataId:e.dataId,shape:[1,c,n.inChannels],dtype:e.dtype},p=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,Ye(bf(l.shape,h.shape),(()=>`packed reshape ${l.shape} to ${h.shape} isn't free`));const f=gm({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(f);const g=eg({a:h,b:f,backend:r,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o,leakyreluAlpha:s}),y=r.texData.get(g.dataId);Ye(y.isPacked,(()=>"batchMatMul result is expected to be packed")),l.shape=p,y.shape=n.outShape,d=wm({inputs:{x:g},backend:r}),d.shape=n.outShape,m.push(g)}else{const u=f?e:Zm({inputs:{x:e},backend:r,attrs:{perm:[0,2,3,1]}}),l=u.shape,c=gm({inputs:{x:u},backend:r,attrs:{shape:[1,l[0]*l[1]*l[2],n.inChannels]}}),h=gm({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),p=eg({a:c,b:h,transposeA:!1,transposeB:!1,backend:r,bias:a,activation:i,preluActivationWeights:o,leakyreluAlpha:s}),g=gm({inputs:{x:p},backend:r,attrs:{shape:[n.batchSize,n.outHeight,n.outWidth,n.outChannels]}});d=f?g:Zm({inputs:{x:g},backend:r,attrs:{perm:[0,3,1,2]}}),f||(m.push(u),m.push(g)),m.push(c),m.push(h),m.push(p)}for(const e of m)r.disposeIntermediateTensorInfo(e);return d}function ng({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:i=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:h,outHeight:p,dataFormat:f}=n,d="channelsLast"===f,m=u*l*c,g=p*h,y=[m,g],b=[];if(null!=o&&!d&&3===o.shape.length){const e=Zm({inputs:{x:o},backend:r,attrs:{perm:[1,2,0]}});b.push(e),o=e}const v=gm({inputs:{x:e},backend:r,attrs:{shape:e.shape.slice(1)}}),x=gm({inputs:{x:t},backend:r,attrs:{shape:[1,m,et(t.shape)/m]}});b.push(v),b.push(x);const w=new Um(y,n),_=[v.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],T=r.runWebGLProgram(w,[v],"float32",_),E=gm({inputs:{x:T},backend:r,attrs:{shape:[1,y[0],y[1]]}});b.push(T),b.push(E);const S=null!=a,I=null!=o,k="leakyrelu"===i,C=i?Cm(i,!0):null,N=new zm(E.shape,x.shape,[1,g,n.outChannels],!0,!1,S,C,I,k),A=[E,x];if(a&&A.push(a),I&&A.push(o),k){const e=r.makeTensorInfo([],"float32",kn(s,"float32"));A.push(e),b.push(e)}const $=r.runWebGLProgram(N,A,"float32"),R=gm({inputs:{x:$},backend:r,attrs:{shape:[1,p,h,n.outChannels]}}),F=d?R:Zm({inputs:{x:R},backend:r,attrs:{perm:[0,3,1,2]}});d||b.push(R),b.push($);for(const e of b)r.disposeIntermediateTensorInfo(e);return F}const rg={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o,bias:s,preluActivationWeights:i}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r,m=ts(c),g=Ho(a.shape,o.shape,u,h,l,p,!1,m);let y;const b=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(Nt().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])y=ng({x:a,filter:o,convInfo:g,backend:n,bias:s,activation:f,preluActivationWeights:i,leakyreluAlpha:d});else{const e=null!=s,t=null!=i,r="leakyrelu"===f,u=f?Cm(f,!1):null,l=new Bm(g,e,u,t,r),h=[a,o],p=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=gm({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(e&&h.push(p(s,c)),t&&h.push(p(i,c)),r){const e=n.makeTensorInfo([],"float32",kn(d,"float32"));h.push(e),b.push(e)}y=n.runWebGLProgram(l,h,"float32")}else y=tg({x:a,filter:o,convInfo:g,backend:n,bias:s,activation:f,preluActivationWeights:i,leakyreluAlpha:d});const v=gm({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}};class ag{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Hf(this.outputShape.length);const o=e.filterHeight,s=e.filterWidth,i=e.outChannels/e.inChannels;let u="",l="";n&&(u=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,l="result = activation(result);");const c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${i};\n        int q = d2 - d1 * ${i};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${o}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${l}\n        setOutput(result);\n      }\n    `}}class og{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Hf(this.outputShape.length);const o=e.outChannels/e.inChannels,s=e.padInfo.left,i=e.strideWidth,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,h=c;let p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<c;e++)p+=`\n          vec4 xTexelC${2*e};\n          int xTexelC${2*e}Ready;\n          vec4 xTexelC${2*e+1};\n          int xTexelC${2*e+1}Ready;\n          vec4 xC${e};`;p+=`\n    for (int r = 0; r < ${l}; r++) {\n      `;for(let e=0;e<c;e++)p+=`\n          xTexelC${2*e} = vec4(0.0);\n          xTexelC${2*e}Ready = 0;\n          xTexelC${2*e+1} = vec4(0.0);\n          xTexelC${2*e+1}Ready = 0;\n          xC${e} = vec4(0.0);`;p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let e=0;e<(h+1)/2;e++){const t=2*e;if(p+=`\n          xC = xCCorner + ${t*u};\n          `,1===i){if(t<c&&(s%2==1?(p+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,p+=1===u&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):p+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<c)){const e=s%2==0?qe(u):u;u%2==0&&s%2==1||u%2!=0&&s%2!=1?(p+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,u>1&&(p+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                      xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${t}Ready = 1;\n                    }\n                    `),p+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                  `):p+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<c&&(s%2==1?(p+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<c&&(p+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(p+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<c&&(p+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<c&&(p+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<c&&(p+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}p+="\n    }\n  ",p+="\n      }\n    ";let f="",d="";n&&(f=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,d="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${f}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${p}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${d}\n        setOutput(result);\n      }\n    `}}const sg={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o,bias:s,preluActivationWeights:i}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=r,d=[];let m=c;null==m&&(m=[1,1]),Ye(es(u,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`));const g=Ho(a.shape,o.shape,u,m,l,h,!0),y=Nt().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,b=p?Cm(p,y):null,v=[a,o],x=null!=s,w=null!=i,_="leakyrelu"===p;if(x&&v.push(s),w&&v.push(i),_){const e=n.makeTensorInfo([],"float32",kn(f,"float32"));v.push(e),d.push(e)}let T;T=y?new og(g,x,b,w,_):new ag(g,x,b,w,_);const E=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],S=n.runWebGLProgram(T,v,"float32",E);return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),S}},ig="return a + b;",ug={kernelName:"Add",backendName:"webgl",kernelFunc:km({opSnippet:ig,packedOpSnippet:ig,supportsComplex:!0,cpuKernelImpl:sd})},lg={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:o,paddings:s}=r;Ye(a.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const i=o.reduce(((e,t)=>e*t)),u=[[0,0]];u.push(...s);for(let e=1+o.length;e<a.shape.length;++e)u.push([0,0]);const l=[],c=Lm({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=Dl(c.shape,o,i,!1),p=Ml(h.length,o.length,!1),f=Ll(c.shape,o,i,!1),d=gm({inputs:{x:c},backend:n,attrs:{shape:h}}),m=Zm({inputs:{x:d},backend:n,attrs:{perm:p}}),g=gm({inputs:{x:m},backend:n,attrs:{shape:f}});return l.push(c),l.push(d),l.push(m),l.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}},cg={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o}=t,{strides:s,pad:i,dilations:u,dimRoundingMode:l}=r;let c=u;null==c&&(c=[1,1]),Ye(es(s,c),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`));const h=Ho(a.shape,o.shape,s,c,i,l,!0);let p;p=Nt().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?new og(h):new ag(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,o],"float32",f)}};class hg{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Uf(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return pg.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);let r;const a=e.map(((e,t)=>`sourceLoc.${pg[t]} = start[${t}] + coords.${pg[t]};`));r=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${a.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const pg=["x","y","z","w","u","v"];class fg{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Uf(this.rank),n=Yd("coords",this.rank),r=Yd("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${a})`,s=`\n      result.x = ${o};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${o};\n        --${r[this.rank-1]};\n      }\n    `,i=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${o};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${o};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map(((e,t)=>`start[${t}]`)).join()});`:e.map(((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`)).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${s}\n        ${i}\n        setOutput(result);\n      }\n    `}}function dg(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:o,size:s}=r,[i,u]=Eo(a,o,s);if(ho(a,i,u),0===et(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){const e=n.texData.get(a.dataId),t=Dd(e.values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,t)}const{isPacked:l}=n.texData.get(a.dataId),c=_o(a.shape,i,u);if(l||!c){const e=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fg(u):new hg(u),t=[i];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),function(e,t,n,r){const a=r.texData.get(e.dataId),o=r.makeTensorInfo(n,e.dtype),s=r.texData.get(o.dataId);Object.assign(s,a),s.refCount=1,s.shape=n,s.dtype=e.dtype;let i=To(t,bt(e.shape));a.slice&&(i+=a.slice.flatOffset),s.slice={flatOffset:i,origDataId:a.slice&&a.slice.origDataId||e.dataId};const u=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,u+1),o}(a,i,u,n)}const mg={kernelName:"Slice",backendName:"webgl",kernelFunc:dg},gg={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:o,crops:s}=r;Ye(a.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const i=o.reduce(((e,t)=>e*t)),u=Dl(a.shape,o,i),l=Ml(u.length,o.length),c=Ll(a.shape,o,i),h=Pl(s,o.length),p=Bl(c,s,o.length),f=[],d=gm({inputs:{x:a},backend:n,attrs:{shape:u}}),m=Zm({inputs:{x:d},backend:n,attrs:{perm:l}}),g=gm({inputs:{x:m},backend:n,attrs:{shape:c}}),y=dg({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return f.push(d),f.push(m),f.push(g),f.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}},yg={kernelName:"Relu6",backendName:"webgl",kernelFunc:Im({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};class bg{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,a=Uf(n.length),o=Uf(n.length);let s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map(((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${a} begin = ${a}(${e});\n      ${a} strides = ${a}(${t});\n\n      void main() {\n        ${o} coords = getOutputCoords();\n        setOutput(getX(${s}));\n      }\n    `}}const vg={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:o,end:s,strides:i,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r,{finalShapeSparse:f,finalShape:d,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:v,strides:x}=So(a.shape,o,s,i,u,l,c,h,p);let w;if(m)w=gm({inputs:{x:a},backend:n,attrs:{shape:d}});else if(g||y){Ye(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));const e=po(b,v,x),t=dg({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});w=gm({inputs:{x:t},backend:n,attrs:{shape:d}}),n.disposeIntermediateTensorInfo(t)}else if(n.shouldExecuteOnCPU([a])){const e=n.readSync(a.dataId),t=gs(a.shape,a.dtype,e),r=Ud(f,t,x,b);w=n.makeTensorInfo(d,a.dtype,r.values)}else{const e=new bg(b,x,f);w=n.runWebGLProgram(e,[a],a.dtype)}const _=gm({inputs:{x:w},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(w),_}};class xg{constructor(e){this.outputShape=[],this.outputShape=Fl(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));const t=new Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){const r=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${r}));`)}const r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class wg{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Fl(e,t);const n=this.outputShape,r=n.length,a=Uf(r),o=Yd("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>`T${t}`));const i=new Array(e.length-1);i[0]=e[0][t];for(let n=1;n<i.length;n++)i[n]=i[n-1]+e[n][t];const u=s[t],l=s.slice(-2),c=s.join();let h=`if (${u} < ${i[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${l.join()}));\n        }`;for(let e=1;e<i.length;e++){const t=i[e-1];h+=`\n        if (${u} < ${i[e]}  && ${u} >= ${i[e-1]}) {\n          return getChannel(\n            getT${e}(${_g(s,u,t)}),\n            vec2(${_g(l,u,t)}));\n        }`}const p=i.length,f=i[i.length-1];h+=`\n        return getChannel(\n          getT${p}(${_g(s,u,f)}),\n          vec2(${_g(l,u,f)}));`,this.userCode=`\n      float getValue(${s.map((e=>"int "+e))}) {\n        ${h}\n      }\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${o}), 0., 0., 0.);\n\n        ${o[r-1]} = ${o[r-1]} + 1;\n        if (${o[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${o});\n        }\n\n        ${o[r-2]} = ${o[r-2]} + 1;\n        if (${o[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${o});\n        }\n\n        ${o[r-1]} = ${o[r-1]} - 1;\n        if (${o[r-2]} < ${n[r-2]} &&\n            ${o[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${o});\n        }\n        setOutput(result);\n      }\n    `}}function _g(e,t,n){const r=e.indexOf(t);return e.map(((e,t)=>t===r?`${e} - ${n}`:e)).join()}function Tg(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map((e=>Am({inputs:{input:e},backend:n}))),a=e.map((e=>function(e){const{inputs:t,backend:n}=e,{input:r}=t;return wm({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}({inputs:{input:e},backend:n}))),o=Tg(r,t,n),s=Tg(a,t,n),i=Tm({inputs:{real:o,imag:s},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),a.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),i}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){const a=e.map((e=>{const r=et(e.shape.slice(t));return gm({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),o=a.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),s=Fl(a.map((e=>e.shape)),1),i=1===a[0].shape[0],u=cd(o,s,r,i),l=Fl(e.map((e=>e.shape)),t),c=n.makeTensorInfo(l,r,u);return a.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}if(e.length>Nt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(e.length/2),a=Tg(e.slice(0,r),t,n),o=Tg(e.slice(r),t,n),s=Tg([a,o],t,n);return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),s}if(Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const a=new wg(e.map((e=>e.shape)),t);return n.runWebGLProgram(a,e,r)}const{tensors2D:o,outShape:s}=function(e,t,n){const r=Fl(e.map((e=>e.shape)),t),a=e.map((e=>gm({inputs:{x:e},attrs:{shape:[-1,et(e.shape.slice(t))]},backend:n})));return{tensors2D:a,outShape:r}}(e,t,n),i=new xg(o.map((e=>e.shape))),u=n.runWebGLProgram(i,o,r);o.forEach((e=>n.disposeIntermediateTensorInfo(e)));const l=gm({inputs:{x:u},attrs:{shape:s},backend:n});return n.disposeIntermediateTensorInfo(u),l}function Eg(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,o=it(a,t[0].shape)[0],s=Fl(t.map((e=>e.shape)),o);if(0===et(s))return n.makeTensorInfo(s,t[0].dtype,[]);const i=t.filter((e=>et(e.shape)>0));return 1===i.length?wm({inputs:{x:i[0]},backend:n}):(Rl(i.map((e=>e.shape)),o),Tg(i,o,n))}const Sg={kernelName:"Concat",backendName:"webgl",kernelFunc:Eg};function Ig(e){const{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:o}=t,s=o.shape.length,i=o.shape.slice();let u=a;return a<0&&(Ye(-(s+1)<=a,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),u=s+a+1),i.splice(u,0,1),gm({inputs:{x:o},backend:r,attrs:{shape:i}})}const kg={kernelName:"Pack",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return Ig({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const o=t[0].shape,s=t[0].dtype;t.forEach((e=>{Qe(o,e.shape,"All tensors passed to stack must have matching shapes"),Ye(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const i=[],u=Eg({inputs:t.map((e=>{const t=Ig({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}};class Cg{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,o="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,i=n-1-e.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${l}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${o}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Ng={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:o}=t,{inputShape:s,strides:i,pad:u,dataFormat:l,dimRoundingMode:c}=r,h=ts(l),p=Ho(s,o.shape,i,1,u,c,!1,h),f=new Cg(p);return n.runWebGLProgram(f,[a,o],"float32")}},Ag={kernelName:"Relu",backendName:"webgl",kernelFunc:Im({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},$g={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:Im({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Fd})};class Rg{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,s,i,u]=e,[l]=t,[c,h]=n;this.outputShape=[l,c,h,u];const p="bilinear"===r?1:0,[f,d]=[s-1+".0",i-1+".0"],[m,g,y]=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[b,v,x]=h>1?[""+(i-1)/(h-1),"(x2-x1) * width_ratio",`x1*${d} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${d}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${o}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${v};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${a}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${d} ) {\n          setOutput(float(${a}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${p} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}const Fg={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:o,boxInd:s}=t,{cropSize:i,method:u,extrapolationValue:l}=r,c=new Rg(a.shape,o.shape,i,u,l);return n.runWebGLProgram(c,[a,o,s],"float32")}};class Og{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),a=Uf(n);this.userCode=`\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class Dg{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=Yd("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,o=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,s=Uf(n);function i(n){const r=e.map(((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:`${r[n]}`}(a,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${a}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${s} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(e){return i(e)}(r.slice())};\n          if(${a}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",i(e)}(r.slice())};\n          }\n          if(${o}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice())};\n            if(${a}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}const Mg={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:o}=r,s=a.shape.length,i=it(o,a.shape);if(0===s)return wm({inputs:{x:a},backend:n});const u=Nt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Dg(a.shape,i):new Og(a.shape,i);return n.runWebGLProgram(u,[a],a.dtype)}},Lg="return a - b;",Pg=km({opSnippet:Lg,packedOpSnippet:Lg,supportsComplex:!0,cpuKernelImpl:jd}),Bg={kernelName:"Sub",backendName:"webgl",kernelFunc:Pg},Ug={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:o}=r;o<0&&(o+=a.shape.length);const s=a,i=s.shape.length,u=a.shape[o],l=new Array(i-1);let c=0;for(let e=0;e<i;e++)e!==o&&(l[c++]=s.shape[e]);const h=[],p=new Array(i).fill(0),f=s.shape.slice();f[o]=1;const d=new Array(u);for(let e=0;e<d.length;e++){p[o]=e;const t=dg({inputs:{x:s},backend:n,attrs:{begin:p,size:f}}),r=gm({inputs:{x:t},backend:n,attrs:{shape:l}});d[e]=r,h.push(t)}return h.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}};class zg{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:o}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];const s="max"===t?">":"<",i=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${i};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${s} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}class Vg{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Ye(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const a=e[e.length-1],o=Math.ceil(a/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const s=this.outputShape,i=s.length,u=Uf(i),l=Yd("coords",i);let c,h;if(1===o){h=i+1;const e=Uf(h);c=`\n        ${e} sourceLocR = ${e}(${l.join()}, 0);\n        ++${l[i-1]};\n        ${e} sourceLocG = ${e}(${l.join()}, 0);\n        ++${l[i-2]};\n        ${e} sourceLocA = ${e}(${l.join()}, 0);\n        --${l[i-1]};\n        ${e} sourceLocB = ${e}(${l.join()}, 0);\n        --${l[i-2]};`}else h=i,c=`\n        ${u} sourceLocR = coords;\n        ++${l[i-1]};\n        ${u} sourceLocG = coords;\n        ++${l[i-2]};\n        ${u} sourceLocA = coords;\n        --${l[i-1]};\n        ${u} sourceLocB = coords;\n        --${l[i-2]};`;const p=["x","y","z","w","u","v"].slice(0,h),f="."+p[h-1],d=p.map((e=>"int "+e)),m=Yd("sourceLocR",h-1).concat("inIdx.r"),g=Yd("sourceLocG",h-1).concat("inIdx.g"),y=Yd("sourceLocB",h-1).concat("inIdx.b"),b=Yd("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",x=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,w=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,_=r?"":`\n      float getBestIndicesAChannel(${d.join()}) {\n        return getChannel(getBestIndicesA(${p.join()}),\n                                          vec2(${p.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${d.join()}) {\n        return getChannel(getA(${p.join()}),\n                               vec2(${p.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${l[i-1]} < ${s[i-1]-1};\n        bool hasNextRow = ${l[i-2]} < ${s[i-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${w};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${w};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}function Wg(e,t,n,r=null){let a=t.shape[0],o=t.shape[1];null!=r&&(a=r.shape[0],o=r.shape[1]);const s=Ol(o),i={windowSize:s,inSize:o,batchSize:a,outSize:Math.ceil(o/s)},u=new zg(i,n,null==r),l=[t];null!=r&&l.push(r);const c=e.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;const h=Wg(e,t,n,c);return e.disposeIntermediateTensorInfo(c),h}function jg(e,t,n,r=null){const a=null!=r?r.shape:t.shape,o=Ol(a[a.length-1]),s=new Vg(a,o,n,null==r),i=null==r?[t]:[t,r],u=e.runWebGLProgram(s,i,"int32");if(u.shape.length===t.shape.length){const r=jg(e,t,n,u);return e.disposeIntermediateTensorInfo(u),r}return u}function Gg(e,t,n,r){const a=[n];if(Ws("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Nt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],o=e.texData.get(t.dataId);let s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),n.push(s));const[i,u]=zs(s.shape,a),l=et(u),c=gm({inputs:{x:s},backend:e,attrs:{shape:[-1,l]}});n.push(c);const h=Wg(e,c,r);n.push(h);const p=gm({inputs:{x:h},backend:e,attrs:{shape:i}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),p}return jg(e,t,r)}const Hg={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:o}=r;let s=it(o,a.shape);const i=js(s,a.shape.length);let u=a;const l=[];null!=i&&(u=Zm({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),s=Gs(s.length,u.shape.length)),Ws("argMax",[s[0]],u.shape.length);const c=Gg(n,u,s[0],"max");return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}},Kg={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:a,axis:o}=t,s=n,i=r.shape.length,u=it(o,r.shape);let l=u;const c=js(l,i),h=null!=c,p=s.shouldExecuteOnCPU([r]),f=[];let d=r;if(h){if(p){const e=s.texData.get(d.dataId).values,t=new Array(i);for(let e=0;e<t.length;e++)t[e]=r.shape[c[e]];const n=Kd(e,r.shape,r.dtype,c,t);d=s.makeTensorInfo(t,r.dtype),s.texData.get(d.dataId).values=n}else d=Qm(r,c,s);f.push(d),l=Gs(l.length,i)}Ws("sum",l,i);const[m,g]=zs(d.shape,l);let y=m;a&&(y=Vs(m,u));const b=function(e,t,n,r){const a=et(t),o=gm({inputs:{x:e},attrs:{shape:[et(e.shape)/a,a]},backend:r}),s=qm(o,"float32","mean",r),i=gm({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),i}(d,g,y,s);for(const e of f)s.disposeIntermediateTensorInfo(e);return b}},qg={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a,b:o}=t,{transposeA:s,transposeB:i}=r;return eg({a,b:o,transposeA:s,transposeB:i,backend:n})}};class Xg{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,s=e.strideHeight,i=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const d="avg"===t,m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(d||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${s}, ${i});\n        const ivec2 pads = ivec2(${p}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${l}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?a?m:g:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(b="avgValue / count");const v=4*Math.floor(o/4),x=o%4,w=`\n      if (${d}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${s}, ${i});\n      const ivec2 pads = ivec2(${p}, ${f});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${l};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              getValue(batch, xR, xC + 3 * ${l}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}const Yg={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;!function(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Ye("complex64"!==e.dtype,(()=>"avgPool does not support complex64 tensors in the WebGL backend."))}))}(a);const{filterSize:o,strides:s,pad:i,dimRoundingMode:u}=r;Ye(es(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const l=Go(a.shape,o,s,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&tt(l.inShape,l.outShape))return wm({inputs:{x:a},backend:n});const c=new Xg(l,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}};class Qg{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class Jg{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const Zg={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:o,clipValueMax:s}=r;let i;i=Nt().getBool("WEBGL_PACK_CLIP")?new Jg(a.shape):new Qg(a.shape);const u=[[o],[s]];return n.runWebGLProgram(i,[a],a.dtype,u)}},ey={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:o}=t,{strides:s,pad:i,dataFormat:u,dilations:l,dimRoundingMode:c}=r,h=ts(u),p=Ho(a.shape,o.shape,s,l,i,c,!1,h);let f;if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(Nt().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])f=ng({x:a,filter:o,convInfo:p,backend:n});else{const e=new Bm(p);f=n.runWebGLProgram(e,[a,o],"float32")}else f=tg({x:a,filter:o,convInfo:p,backend:n});const d=gm({inputs:{x:f},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(f),d}},ty=Im({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:pd,dtype:"float32"}),ny={kernelName:"Softmax",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:o}=r,s=it([o],a.shape),i=function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:o,keepDims:s}=r,i=a.shape.length,u=it(o,a.shape);let l=u;const c=js(l,i),h=null!=c,p=n.shouldExecuteOnCPU([a]);let f=a;if(h){if(p){const e=n.texData.get(f.dataId).values,t=new Array(i);for(let e=0;e<t.length;e++)t[e]=a.shape[c[e]];const r=Kd(e,a.shape,a.dtype,c,t);f=n.makeTensorInfo(t,a.dtype),n.texData.get(f.dataId).values=r}else f=Qm(a,c,n);l=Gs(l.length,i)}Ws("max",l,i);const[d,m]=zs(f.shape,l);let g,y=d;if(s&&(y=Vs(d,u)),p){const e=n.texData.get(f.dataId).values,t=Td(e,et(m),y,a.dtype);g=n.makeTensorInfo(y,a.dtype),n.texData.get(g.dataId).values=t}else g=function(e,t,n,r){const a=et(t),o=gm({inputs:{x:e},attrs:{shape:[et(e.shape)/a,a]},backend:r}),s=qm(o,e.dtype,"max",r),i=gm({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),i}(f,m,y,n);return h&&n.disposeIntermediateTensorInfo(f),g}({inputs:{x:a},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),u=Vs(i.shape,s),l=gm({inputs:{x:i},backend:n,attrs:{shape:u}}),c=Pg({inputs:{a,b:l},backend:n}),h=ty({inputs:{x:c},backend:n}),p=Jm({inputs:{x:h},backend:n,attrs:{axis:s,keepDims:!1}}),f=gm({inputs:{x:p},backend:n,attrs:{shape:u}}),d=Rm({inputs:{a:h,b:f},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),d}};Ut(vp),Ut(xp),Ut(Nh),Ut(wp),Ut(_p),Ut(Ap),Ut(Fp),Ut(Oh),Ut(Op),Ut(Rp),Ut(Dp),Ut(Jh),Ut(Cp),Ut(Mp),Ut(Up),Ut(zp),Ut(Ip),Ut(op),Ut(Ih),Ut(Vp),Ut(Wp),Ut(Pp),Ut(dp),Ut(jp),Ut(Gp),Ut(dm),Ut(ym),Ut(xm),Ut($m),Ut(Fm),Ut(Pm),Ut(rg),Ut(sg),Ut(ug),Ut(lg),Ut(cg),Ut(gg),Ut(Gm),Ut(yg),Ut(vg),Ut(kg),Ut(Ng),Ut(Ag),Ut($g),Ut(_m),Ut(Fg),Ut(Mg),Ut(Sg),Ut(Bg),Ut(Ug),Ut(Hg),Ut(Kg),Ut(qg),Ut(Yg),Ut(Zg),Ut(ey),Ut(ny),Ut(mg);var ry={};function ay(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(d(n))return oy(n,null);if(m(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return oy(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var a=e.pop();return oy(e=1===e.length&&d(e[0])?e[0]:e,null).pipe(K((function(e){return a.apply(void 0,e)})))}return oy(e,null)}function oy(e,t){return new I((function(n){var r=e.length;if(0!==r)for(var a=new Array(r),o=0,s=0,i=function(i){var u=G(e[i]),l=!1;n.add(u.subscribe({next:function(e){l||(l=!0,s++),a[i]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&l||(s===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},u=0;u<r;u++)i(u);else n.complete()}))}var sy="undefined"!=typeof window&&window,iy="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,uy=sy||void 0!==be&&be||iy;function ly(e,t){return void 0===t&&(t=null),new gy({method:"GET",url:e,headers:t})}function cy(e,t,n){return new gy({method:"POST",url:e,body:t,headers:n})}function hy(e,t){return new gy({method:"DELETE",url:e,headers:t})}function py(e,t,n){return new gy({method:"PUT",url:e,body:t,headers:n})}function fy(e,t,n){return new gy({method:"PATCH",url:e,body:t,headers:n})}var dy=K((function(e,t){return e.response}));function my(e,t){return dy(new gy({method:"GET",url:e,responseType:"json",headers:t}))}var gy=function(e){function t(t){var n=e.call(this)||this,r={async:!0,createXHR:function(){return this.crossDomain?function(){if(uy.XMLHttpRequest)return new uy.XMLHttpRequest;if(uy.XDomainRequest)return new uy.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(uy.XMLHttpRequest)return new uy.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(e=t[n],new uy.ActiveXObject(e))break}catch(e){}return new uy.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)r.url=t;else for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);return n.request=r,n}var n;return u(t,e),t.prototype._subscribe=function(e){return new yy(e,this.request)},t.create=((n=function(e){return new t(e)}).get=ly,n.post=cy,n.delete=hy,n.put=py,n.patch=fy,n.getJSON=my,n),t}(I),yy=function(e){function t(t,n){var r=e.call(this,t)||this;r.request=n,r.done=!1;var a=n.headers=n.headers||{};return n.crossDomain||r.getHeader(a,"X-Requested-With")||(a["X-Requested-With"]="XMLHttpRequest"),r.getHeader(a,"Content-Type")||uy.FormData&&n.body instanceof uy.FormData||void 0===n.body||(a["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=r.serializeBody(n.body,r.getHeader(n.headers,"Content-Type")),r.send(),r}return u(t,e),t.prototype.next=function(e){this.done=!0;var t,n=this,r=n.xhr,a=n.request,o=n.destination;try{t=new by(e,r,a)}catch(e){return o.error(e)}o.next(t)},t.prototype.send=function(){var e=this.request,t=this.request,n=t.user,r=t.method,a=t.url,o=t.async,s=t.password,i=t.headers,u=t.body;try{var l=this.xhr=e.createXHR();this.setupEvents(l,e),n?l.open(r,a,o,n,s):l.open(r,a,o),o&&(l.timeout=e.timeout,l.responseType=e.responseType),"withCredentials"in l&&(l.withCredentials=!!e.withCredentials),this.setHeaders(l,i),u?l.send(u):l.send()}catch(e){this.error(e)}},t.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(uy.FormData&&e instanceof uy.FormData)return e;if(t){var n=t.indexOf(";");-1!==n&&(t=t.substring(0,n))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])},t.prototype.getHeader=function(e,t){for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n]},t.prototype.setupEvents=function(e,t){var n,r,a=t.progressSubscriber;function o(e){var t,n=o,r=n.subscriber,a=n.progressSubscriber,s=n.request;a&&a.error(e);try{t=new wy(this,s)}catch(e){t=e}r.error(t)}function s(e){}function i(e){var t=i,n=t.subscriber,r=t.progressSubscriber,a=t.request;if(4===this.readyState){var o=1223===this.status?204:this.status,s="text"===this.responseType?this.response||this.responseText:this.response;if(0===o&&(o=s?200:0),o<400)r&&r.complete(),n.next(e),n.complete();else{r&&r.error(e);var u=void 0;try{u=new vy("ajax error "+o,this,a)}catch(e){u=e}n.error(u)}}}e.ontimeout=o,o.request=t,o.subscriber=this,o.progressSubscriber=a,e.upload&&"withCredentials"in e&&(a&&(n=function(e){n.progressSubscriber.next(e)},uy.XDomainRequest?e.onprogress=n:e.upload.onprogress=n,n.progressSubscriber=a),r=function(e){var t,n=r,a=n.progressSubscriber,o=n.subscriber,s=n.request;a&&a.error(e);try{t=new vy("ajax error",this,s)}catch(e){t=e}o.error(t)},e.onerror=r,r.request=t,r.subscriber=this,r.progressSubscriber=a),e.onreadystatechange=s,s.subscriber=this,s.progressSubscriber=a,s.request=t,e.onload=i,i.subscriber=this,i.progressSubscriber=a,i.request=t},t.prototype.unsubscribe=function(){var t=this.done,n=this.xhr;!t&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},t}(w),by=function(e,t,n){this.originalEvent=e,this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=xy(this.responseType,t)},vy=function(){function e(e,t,n){return Error.call(this),this.message=e,this.name="AjaxError",this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=xy(this.responseType,t),this}return e.prototype=Object.create(Error.prototype),e}();function xy(e,t){switch(e){case"json":return function(e){return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null")}(t);case"xml":return t.responseXML;default:return"response"in t?t.response:t.responseText}}var wy=function(e,t){return vy.call(this,"ajax timeout",e,t),this.name="AjaxTimeoutError",this},_y=gy.create,Ty=Uint8Array,Ey=Uint16Array,Sy=Uint32Array,Iy=new Ty([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ky=new Ty([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Cy=new Ty([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ny=function(e,t){for(var n=new Ey(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var a=new Sy(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)a[o]=o-n[r]<<5|r;return[n,a]},Ay=Ny(Iy,2),$y=Ay[0],Ry=Ay[1];$y[28]=258,Ry[258]=28;for(var Fy=Ny(ky,0)[0],Oy=new Ey(32768),Dy=0;Dy<32768;++Dy){var My=(43690&Dy)>>>1|(21845&Dy)<<1;My=(61680&(My=(52428&My)>>>2|(13107&My)<<2))>>>4|(3855&My)<<4,Oy[Dy]=((65280&My)>>>8|(255&My)<<8)>>>1}var Ly=function(e,t,n){for(var r=e.length,a=0,o=new Ey(t);a<r;++a)++o[e[a]-1];var s,i=new Ey(t);for(a=0;a<t;++a)i[a]=i[a-1]+o[a-1]<<1;if(n){s=new Ey(1<<t);var u=15-t;for(a=0;a<r;++a)if(e[a])for(var l=a<<4|e[a],c=t-e[a],h=i[e[a]-1]++<<c,p=h|(1<<c)-1;h<=p;++h)s[Oy[h]>>>u]=l}else for(s=new Ey(r),a=0;a<r;++a)e[a]&&(s[a]=Oy[i[e[a]-1]++]>>>15-e[a]);return s},Py=new Ty(288);for(Dy=0;Dy<144;++Dy)Py[Dy]=8;for(Dy=144;Dy<256;++Dy)Py[Dy]=9;for(Dy=256;Dy<280;++Dy)Py[Dy]=7;for(Dy=280;Dy<288;++Dy)Py[Dy]=8;var By=new Ty(32);for(Dy=0;Dy<32;++Dy)By[Dy]=5;var Uy=Ly(Py,9,1),zy=Ly(By,5,1),Vy=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Wy=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},jy=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Gy=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Ey?Ey:e instanceof Sy?Sy:Ty)(n-t);return r.set(e.subarray(t,n)),r},Hy=new Ty(0),Ky=function(e,t){return e[t]|e[t+1]<<8},qy=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Xy=function(e,t){return qy(e,t)+4294967296*qy(e,t+4)};function Yy(e,t){return function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Ty(0);var a=!t||n,o=!n||n.i;n||(n={}),t||(t=new Ty(3*r));var s,i=function(e){var n=t.length;if(e>n){var r=new Ty(Math.max(2*n,e));r.set(t),t=r}},u=n.f||0,l=n.p||0,c=n.b||0,h=n.l,p=n.d,f=n.m,d=n.n,m=8*r;do{if(!h){n.f=u=Wy(e,l,1);var g=Wy(e,l+1,3);if(l+=3,!g){var y=e[(C=((s=l)/8|0)+(7&s&&1)+4)-4]|e[C-3]<<8,b=C+y;if(b>r){if(o)throw"unexpected EOF";break}a&&i(c+y),t.set(e.subarray(C,b),c),n.b=c+=y,n.p=l=8*b;continue}if(1==g)h=Uy,p=zy,f=9,d=5;else{if(2!=g)throw"invalid block type";var v=Wy(e,l,31)+257,x=Wy(e,l+10,15)+4,w=v+Wy(e,l+5,31)+1;l+=14;for(var _=new Ty(w),T=new Ty(19),E=0;E<x;++E)T[Cy[E]]=Wy(e,l+3*E,7);l+=3*x;var S=Vy(T),I=(1<<S)-1,k=Ly(T,S,1);for(E=0;E<w;){var C,N=k[Wy(e,l,I)];if(l+=15&N,(C=N>>>4)<16)_[E++]=C;else{var A=0,$=0;for(16==C?($=3+Wy(e,l,3),l+=2,A=_[E-1]):17==C?($=3+Wy(e,l,7),l+=3):18==C&&($=11+Wy(e,l,127),l+=7);$--;)_[E++]=A}}var R=_.subarray(0,v),F=_.subarray(v);f=Vy(R),d=Vy(F),h=Ly(R,f,1),p=Ly(F,d,1)}if(l>m){if(o)throw"unexpected EOF";break}}a&&i(c+131072);for(var O=(1<<f)-1,D=(1<<d)-1,M=l;;M=l){var L=(A=h[jy(e,l)&O])>>>4;if((l+=15&A)>m){if(o)throw"unexpected EOF";break}if(!A)throw"invalid length/literal";if(L<256)t[c++]=L;else{if(256==L){M=l,h=null;break}var P=L-254;if(L>264){var B=Iy[E=L-257];P=Wy(e,l,(1<<B)-1)+$y[E],l+=B}var U=p[jy(e,l)&D],z=U>>>4;if(!U)throw"invalid distance";if(l+=15&U,F=Fy[z],z>3&&(B=ky[z],F+=jy(e,l)&(1<<B)-1,l+=B),l>m){if(o)throw"unexpected EOF";break}a&&i(c+131072);for(var V=c+P;c<V;c+=4)t[c]=t[c-F],t[c+1]=t[c+1-F],t[c+2]=t[c+2-F],t[c+3]=t[c+3-F];c=V}}n.l=h,n.p=M,n.b=c,h&&(u=1,n.m=f,n.d=p,n.n=d)}while(!u);return c==t.length?t:Gy(t,0,c)}(e,t)}var Qy="undefined"!=typeof TextDecoder&&new TextDecoder;try{Qy.decode(Hy,{stream:!0})}catch(Yn){}function Jy(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Qy)return Qy.decode(e);var a=function(e){for(var t="",n=0;;){var r=e[n++],a=(r>127)+(r>223)+(r>239);if(n+a>e.length)return[t,Gy(e,n-1)];a?3==a?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&a?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}}(e),o=a[0];if(a[1].length)throw"invalid utf-8 data";return o}var Zy=function(e,t){return t+30+Ky(e,t+26)+Ky(e,t+28)},eb=function(e,t,n){var r=Ky(e,t+28),a=Jy(e.subarray(t+46,t+46+r),!(2048&Ky(e,t+8))),o=t+46+r,s=qy(e,t+20),i=n&&4294967295==s?tb(e,o):[s,qy(e,t+24),qy(e,t+42)],u=i[0],l=i[1],c=i[2];return[Ky(e,t+10),u,l,a,o+Ky(e,t+30)+Ky(e,t+32),c]},tb=function(e,t){for(;1!=Ky(e,t);t+=4+Ky(e,t+2));return[Xy(e,t+12),Xy(e,t+4),Xy(e,t+20)]};function nb(e){if(e)for(var t=0;t<e.length;t++)e[t]=~e[t];return e}var rb=function(){function e(e,t){this.jsonModel=e,this.weights=t}return e.prototype.load=function(){return t(this,void 0,void 0,(function(){var e,t,n,r;return a(this,(function(a){switch(a.label){case 0:return e={modelTopology:this.jsonModel.modelTopology,format:this.jsonModel.format,generatedBy:this.jsonModel.generatedBy,convertedBy:this.jsonModel.convertedBy},null==this.jsonModel.weightsManifest?[3,2]:[4,this.loadWeights()];case 1:t=a.sent(),n=t[0],r=t[1],e.weightSpecs=n,e.weightData=r,a.label=2;case 2:return null!=this.jsonModel.trainingConfig&&(e.trainingConfig=this.jsonModel.trainingConfig),null!=this.jsonModel.userDefinedMetadata&&(e.userDefinedMetadata=this.jsonModel.userDefinedMetadata),[2,e]}}))}))},e.prototype.loadWeights=function(){return t(this,void 0,void 0,(function(){var e,t,n,r,o,s,i,u;return a(this,(function(a){for(e=[],t=[],n=0,r=this.jsonModel.weightsManifest;n<r.length;n++){for(o=r[n],s=0,i=o.paths;s<i.length;s++){if(u=i[s],!this.weights[u])throw new Error("Error loading weights: cannot find ".concat(u));e.push(this.weights[u])}t.push.apply(t,o.weights)}return[2,[t,this.toArrayBuffer(e)]]}))}))},e.prototype.toArrayBuffer=function(e){if(Array.isArray(e)){for(var t=0,n=0,r=e;n<r.length;n++)t+=r[n].length;for(var a=new ArrayBuffer(t),o=new Uint8Array(a),s=0,i=0,u=e;i<u.length;i++)s+=u[i].copy(o,s);return a}return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)},e}();function ab(e,t){var n=new ie(0),r=new ie(0),a=new ie(0),o=new ie(0),s=V([n,r,a,o]).pipe(K((function(e){return e.reduce((function(t,n){return t+n/e.length}),0)})));if("string"==typeof e){var i=function(e,t){return _y({url:e,method:"GET",responseType:"arraybuffer",async:!0,progressSubscriber:new w((function(e){return t.next(e.loaded/e.total)}),(function(e){}),(function(){return t.next(1)}))}).pipe(ue(2))}(e,n).pipe(he((function(e){return ob(e.response)})),he((function(e){return sb(e,t,r).pipe(K((function(t){return{jszip:e,config:t}})))})),he((function(e){var t=e.jszip,n=e.config;return ib(t,n,a).pipe(K((function(e){return{jszip:t,config:n,jsonModel:e}})))})),he((function(e){var t=e.jszip,n=e.config,r=e.jsonModel;return ub(t,r,o).pipe(K((function(e){return{config:n,jsonModel:r,weights:e}})))})),he((function(e){var t=e.config,n=e.jsonModel,r=e.weights;return G(bh(new rb(n,r))).pipe(K((function(e){return{config:t,graphModel:e}})))})));return{model$:i,progress$:s}}return i=ob(e).pipe(he((function(e){return sb(e,t,r).pipe(K((function(t){return{jszip:e,config:t}})))})),he((function(e){var t=e.jszip,n=e.config;return ib(t,n,a).pipe(K((function(e){return{jszip:t,config:n,jsonModel:e}})))})),he((function(e){var t=e.jszip,n=e.config,r=e.jsonModel;return ub(t,r,o).pipe(K((function(e){return{config:n,jsonModel:r,weights:e}})))})),he((function(e){var t=e.config,n=e.jsonModel,r=e.weights;return G(bh(new rb(n,r))).pipe(K((function(e){return{config:t,graphModel:e}})))}))),{model$:i,progress$:s}}function ob(e){return H(function(e){for(var t={},n=e.length-22;101010256!=qy(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=Ky(e,n+8);if(!r)return{};var a=qy(e,n+16),o=4294967295==a;if(o){if(n=qy(e,n-12),101075792!=qy(e,n))throw"invalid zip file";r=qy(e,n+32),a=qy(e,n+48)}for(var s=0;s<r;++s){var i=eb(e,a,o),u=i[0],l=i[1],c=i[2],h=i[3],p=i[4],f=i[5],d=Zy(e,f);if(a=p,u){if(8!=u)throw"unknown compression type "+u;t[h]=Yy(e.subarray(d,d+l),new Ty(c))}else t[h]=Gy(e,d,d+l)}return t}(new Uint8Array(e)))}function sb(e,t,n){return e[t]?ye((function(){return n.next(1),H(JSON.parse(Jy(e[t])))})):Q("Unable to retrieve model config: ".concat(t," is missing"))}function ib(e,t,n){return t?e[t.filename]?ye((function(){return n.next(1),H(JSON.parse(Jy(nb(e[t.filename]))))})):Q("Error extracting model: ".concat(t.filename," is missing")):Q("Invalid model config")}function ub(e,t,n){if(!t)return Q("Unable to extract weights: model is undefined");if(!t.weightsManifest)return n.next(1),H({});for(var r=0,a=0,o=t.weightsManifest;a<o.length;a++){var s=o[a];r+=s.paths.length}for(var i=new Array(r).fill(0),u={},l=0,c=0,h=t.weightsManifest;c<h.length;c++)for(var p=function(t){if(!e[t])return{value:Q("Error extracting weight: ".concat(t," is missing"))};u[t]=ye((function(){var a=e[t];return i[l]=1,n.next(i.reduce((function(e,t){return e+t}),0)/r),H(nb(Er.from(a,a.byteOffset,a.byteLength)))})),l++},f=0,d=(s=h[c]).paths;f<d.length;f++){var m=p(d[f]);if("object"==typeof m)return m.value}return ay(u)}var lb,cb,hb=function(){function n(){this._initialized=!1}return n.prototype.getWidth=function(){return this._modelConfig?this._modelConfig.inWidth:0},n.prototype.getHeight=function(){return this._modelConfig?this._modelConfig.inHeight:0},n.prototype.isInitialized=function(){return this._initialized},n.prototype.getOutput=function(){return this._cnnOutputData},n.prototype.initialize=function(n,r,o){return t(this,void 0,void 0,(function(){var t,s,i,u,l=this;return a(this,(function(a){switch(a.label){case 0:if(null==n)throw"Invalid parameter";return this.release(),this._videoManager=n,this._config=r?e(e({},ry),r):ry,t=ab(this._config.filename,"config.json"),s=t.model$,i=t.progress$,u=i.pipe(K((function(e){return o&&o(e)}))).subscribe(),[4,s.pipe(K((function(e){var t=e.config,n=e.graphModel;l._modelConfig=t,l._model=n;var r=Di([1,l._modelConfig.inHeight,l._modelConfig.inWidth,l._modelConfig.inChannels]),a=l._model.predict(r,{batchSize:1,verbose:!0});l._cnnOutput=Di([1,l._modelConfig.inHeight,l._modelConfig.inWidth,1]),a.dispose(),r.dispose(),l._initialized=!0})),Z((function(){return u.unsubscribe()}))).toPromise()];case 1:return a.sent(),[2]}}))}))},n.prototype.processSync=function(){var e;if(this._initialized){var t=this._videoManager.getLastBuffer();if(null!=t){var n,r=uo(t),a=Cl.resizeBilinear(r,[this._modelConfig.inHeight,this._modelConfig.inWidth]),o=Ka(a,"float32"),s=rs(o,[1,this._modelConfig.inHeight,this._modelConfig.inWidth,3]),i=Xs(255);if(4==this._modelConfig.inChannels){var u=rs(this._cnnOutput,[1,this._modelConfig.inHeight,this._modelConfig.inWidth,1]),l=Ao(s,i);n=is([l,u],3),l.dispose(),u.dispose()}else n=Ao(s,i);var c=this._model.predict(n);null===(e=this._cnnOutput)||void 0===e||e.dispose();var h=c.shape;if(h&&h[3]>1){var p=yu(c);this._cnnOutput=ls(p,[0,0,0,1],[-1,-1,-1,1]),p.dispose(),this._cnnOutputData=this._cnnOutput.dataSync()}else this._cnnOutput=bs(c,0,1),this._cnnOutputData=this._cnnOutput.dataSync();r.dispose(),a.dispose(),o.dispose(),s.dispose(),i.dispose(),n.dispose(),c.dispose()}else console.error("No video frame to process")}else console.error("Foot must be initialized to track")},n.prototype.release=function(){var e,t;null===(e=this._cnnOutput)||void 0===e||e.dispose(),null===(t=this._model)||void 0===t||t.dispose(),this._initialized=!1},n}(),pb=(lb="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,r;e=e||{},t||(t=void 0!==e?e:{}),t.ready=new Promise((function(e,t){n=e,r=t}));var a,o={};for(a in t)t.hasOwnProperty(a)&&(o[a]=t[a]);var s="./this.program",i="";"undefined"!=typeof document&&document.currentScript&&(i=document.currentScript.src),lb&&(i=lb),i=0!==i.indexOf("blob:")?i.substr(0,i.lastIndexOf("/")+1):"";var u,l=t.print||console.log.bind(console),c=t.printErr||console.warn.bind(console);for(a in o)o.hasOwnProperty(a)&&(t[a]=o[a]);o=null,t.thisProgram&&(s=t.thisProgram),t.wasmBinary&&(u=t.wasmBinary),t.noExitRuntime&&t.noExitRuntime,"object"!=typeof WebAssembly&&D("no native wasm support detected");var h,p=!1;function f(e){var n=t["_"+e];return n||D("Assertion failed: Cannot call unknown function "+e+", make sure it is exported"),n}function d(e,t,n,r){var a,o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);t=tt(n),S(e,y,t,n)}return t},array:function(e){var t=tt(e.length);return g.set(e,t),t}},s=f(e),i=[];if(e=0,r)for(var u=0;u<r.length;u++){var l=o[n[u]];l?(0===e&&(e=Ze()),i[u]=l(r[u])):i[u]=r[u]}return a=n=s.apply(null,i),n="string"===t?E(a):"boolean"===t?!!a:a,0!==e&&et(e),n}var m,g,y,b,v,x,w,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function T(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.subarray&&_)return _.decode(e.subarray(t,n));for(r="";t<n;){var a=e[t++];if(128&a){var o=63&e[t++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|o);else{var s=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|o<<6|s:(7&a)<<18|o<<12|s<<6|63&e[t++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function E(e){return e?T(y,e,void 0):""}function S(e,t,n,r){if(!(0<r))return 0;var a=n;r=n+r-1;for(var o=0;o<e.length;++o){var s=e.charCodeAt(o);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),127>=s){if(n>=r)break;t[n++]=s}else{if(2047>=s){if(n+1>=r)break;t[n++]=192|s>>6}else{if(65535>=s){if(n+2>=r)break;t[n++]=224|s>>12}else{if(n+3>=r)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63}t[n++]=128|s>>6&63}t[n++]=128|63&s}}return t[n]=0,n-a}function I(){var e=h.buffer;m=e,t.HEAP8=g=new Int8Array(e),t.HEAP16=b=new Int16Array(e),t.HEAP32=v=new Int32Array(e),t.HEAPU8=y=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAPU32=new Uint32Array(e),t.HEAPF32=x=new Float32Array(e),t.HEAPF64=w=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var k,C=[],N=[],A=[],$=[];function R(){var e=t.preRun.shift();C.unshift(e)}var F=0,O=null;function D(e){throw t.onAbort&&t.onAbort(e),c(e),p=!0,e=new WebAssembly.RuntimeError("abort("+e+"). Build with -s ASSERTIONS=1 for more info."),r(e),e}function M(){var e=B;return String.prototype.startsWith?e.startsWith("data:application/octet-stream;base64,"):0===e.indexOf("data:application/octet-stream;base64,")}t.preloadedImages={},t.preloadedAudios={};var L,P,B="libxzimgPoseEstimation.wasm";if(!M()){var U=B;B=t.locateFile?t.locateFile(U,i):i+U}function z(){var e=B;try{if(e==B&&u)return new Uint8Array(u);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function V(e){for(;0<e.length;){var n=e.shift();if("function"==typeof n)n(t);else{var r=n.ha;"number"==typeof r?void 0===n.P?k.get(r)():k.get(r)(n.P):r(void 0===n.P?null:n.P)}}}function W(e){this.C=e-16,this.sa=function(e){v[this.C+8>>2]=e},this.pa=function(e){v[this.C+0>>2]=e},this.qa=function(){v[this.C+4>>2]=0},this.oa=function(){g[this.C+12>>0]=0},this.ra=function(){g[this.C+13>>0]=0},this.ia=function(e,t){this.sa(e),this.pa(t),this.qa(),this.oa(),this.ra()}}function j(e,t){for(var n=0,r=e.length-1;0<=r;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e}function G(e){var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=j(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function H(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function K(e){if("/"===e)return"/";var t=(e=(e=G(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)}function q(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if("string"!=typeof(t=0<=n?arguments[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=j(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var X=[];function Y(e,t){X[e]={input:[],i:[],B:t},we(e,Q)}var Q={open:function(e){var t=X[e.node.K];if(!t)throw new ue(43);e.h=t,e.seekable=!1},close:function(e){e.h.B.flush(e.h)},flush:function(e){e.h.B.flush(e.h)},read:function(e,t,n,r){if(!e.h||!e.h.B.Z)throw new ue(60);for(var a=0,o=0;o<r;o++){try{var s=e.h.B.Z(e.h)}catch(e){throw new ue(29)}if(void 0===s&&0===a)throw new ue(6);if(null==s)break;a++,t[n+o]=s}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,n,r){if(!e.h||!e.h.B.S)throw new ue(60);try{for(var a=0;a<r;a++)e.h.B.S(e.h,t[n+a])}catch(e){throw new ue(29)}return r&&(e.node.timestamp=Date.now()),a}},J={Z:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=qe(t,!0)}return e.input.shift()},S:function(e,t){null===t||10===t?(l(T(e.i,0)),e.i=[]):0!=t&&e.i.push(t)},flush:function(e){e.i&&0<e.i.length&&(l(T(e.i,0)),e.i=[])}},Z={S:function(e,t){null===t||10===t?(c(T(e.i,0)),e.i=[]):0!=t&&e.i.push(t)},flush:function(e){e.i&&0<e.i.length&&(c(T(e.i,0)),e.i=[])}},ee={l:null,o:function(){return ee.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(24576==(61440&n)||4096==(61440&n))throw new ue(63);return ee.l||(ee.l={dir:{node:{u:ee.c.u,m:ee.c.m,F:ee.c.F,I:ee.c.I,da:ee.c.da,fa:ee.c.fa,ea:ee.c.ea,ca:ee.c.ca,L:ee.c.L},stream:{A:ee.f.A}},file:{node:{u:ee.c.u,m:ee.c.m},stream:{A:ee.f.A,read:ee.f.read,write:ee.f.write,U:ee.f.U,$:ee.f.$,ba:ee.f.ba}},link:{node:{u:ee.c.u,m:ee.c.m,G:ee.c.G},stream:{}},V:{node:{u:ee.c.u,m:ee.c.m},stream:xe}}),16384==(61440&(n=de(e,t,n,r)).mode)?(n.c=ee.l.dir.node,n.f=ee.l.dir.stream,n.b={}):32768==(61440&n.mode)?(n.c=ee.l.file.node,n.f=ee.l.file.stream,n.g=0,n.b=null):40960==(61440&n.mode)?(n.c=ee.l.link.node,n.f=ee.l.link.stream):8192==(61440&n.mode)&&(n.c=ee.l.V.node,n.f=ee.l.V.stream),n.timestamp=Date.now(),e&&(e.b[t]=n),n},Da:function(e){if(e.b&&e.b.subarray){for(var t=[],n=0;n<e.g;++n)t.push(e.b[n]);return t}return e.b},Ea:function(e){return e.b?e.b.subarray?e.b.subarray(0,e.g):new Uint8Array(e.b):new Uint8Array(0)},W:function(e,t){var n=e.b?e.b.length:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)>>>0),0!=n&&(t=Math.max(t,256)),n=e.b,e.b=new Uint8Array(t),0<e.g&&e.b.set(n.subarray(0,e.g),0))},ma:function(e,t){if(e.g!=t)if(0==t)e.b=null,e.g=0;else{if(!e.b||e.b.subarray){var n=e.b;e.b=new Uint8Array(t),n&&e.b.set(n.subarray(0,Math.min(t,e.g)))}else if(e.b||(e.b=[]),e.b.length>t)e.b.length=t;else for(;e.b.length<t;)e.b.push(0);e.g=t}},c:{u:function(e){var t={};return t.Ca=8192==(61440&e.mode)?e.id:1,t.Ga=e.id,t.mode=e.mode,t.Ia=1,t.uid=0,t.Fa=0,t.K=e.K,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.g:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.za=new Date(e.timestamp),t.Ha=new Date(e.timestamp),t.Ba=new Date(e.timestamp),t.ga=4096,t.Aa=Math.ceil(t.size/t.ga),t},m:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&ee.ma(e,t.size)},F:function(){throw le[44]},I:function(e,t,n,r){return ee.createNode(e,t,n,r)},da:function(e,t,n){if(16384==(61440&e.mode)){try{var r=fe(t,n)}catch(e){}if(r)for(var a in r.b)throw new ue(55)}delete e.parent.b[e.name],e.name=n,t.b[n]=e,e.parent=t},fa:function(e,t){delete e.b[t]},ea:function(e,t){var n,r=fe(e,t);for(n in r.b)throw new ue(55);delete e.b[t]},ca:function(e){var t,n=[".",".."];for(t in e.b)e.b.hasOwnProperty(t)&&n.push(t);return n},L:function(e,t,n){return(e=ee.createNode(e,t,41471,0)).link=n,e},G:function(e){if(40960!=(61440&e.mode))throw new ue(28);return e.link}},f:{read:function(e,t,n,r,a){var o=e.node.b;if(a>=e.node.g)return 0;if(8<(e=Math.min(e.node.g-a,r))&&o.subarray)t.set(o.subarray(a,a+e),n);else for(r=0;r<e;r++)t[n+r]=o[a+r];return e},write:function(e,t,n,r,a,o){if(t.buffer===g.buffer&&(o=!1),!r)return 0;if((e=e.node).timestamp=Date.now(),t.subarray&&(!e.b||e.b.subarray)){if(o)return e.b=t.subarray(n,n+r),e.g=r;if(0===e.g&&0===a)return e.b=t.slice(n,n+r),e.g=r;if(a+r<=e.g)return e.b.set(t.subarray(n,n+r),a),r}if(ee.W(e,a+r),e.b.subarray&&t.subarray)e.b.set(t.subarray(n,n+r),a);else for(o=0;o<r;o++)e.b[a+o]=t[n+o];return e.g=Math.max(e.g,a+r),r},A:function(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.node.mode)&&(t+=e.node.g),0>t)throw new ue(28);return t},U:function(e,t,n){ee.W(e.node,t+n),e.node.g=Math.max(e.node.g,t+n)},$:function(e,t,n,r,a,o){if(0===t||D("Assertion failed: undefined"),32768!=(61440&e.node.mode))throw new ue(43);if(e=e.node.b,2&o||e.buffer!==m){for((0<r||r+n<e.length)&&(e=e.subarray?e.subarray(r,r+n):Array.prototype.slice.call(e,r,r+n)),r=!0,o=16384*Math.ceil(n/16384),t=Qe(o);n<o;)g[t+n++]=0;if(!(n=t))throw new ue(48);g.set(e,n)}else r=!1,n=e.byteOffset;return{C:n,ya:r}},ba:function(e,t,n,r,a){if(32768!=(61440&e.node.mode))throw new ue(43);return 2&a||ee.f.write(e,t,0,r,n,!1),0}}},te=null,ne={},re=[],ae=1,oe=null,se=!0,ie={},ue=null,le={};function ce(e,t){if(t=t||{},!(e=q("/",e)))return{path:"",node:null};var n,r={Y:!0,T:0};for(n in r)void 0===t[n]&&(t[n]=r[n]);if(8<t.T)throw new ue(32);e=j(e.split("/").filter((function(e){return!!e})),!1);var a=te;for(r="/",n=0;n<e.length;n++){var o=n===e.length-1;if(o&&t.parent)break;if(a=fe(a,e[n]),r=G(r+"/"+e[n]),a.J&&(!o||o&&t.Y)&&(a=a.J.root),!o||t.X)for(o=0;40960==(61440&a.mode);)if(a=ke(r),a=ce(r=q(H(r),a),{T:t.T}).node,40<o++)throw new ue(32)}return{path:r,node:a}}function he(e){for(var t;;){if(e===e.parent)return e=e.o.aa,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function pe(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%oe.length}function fe(e,t){var n;if(n=(n=ye(e,"x"))?n:e.c.F?0:2)throw new ue(n,e);for(n=oe[pe(e.id,t)];n;n=n.la){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.c.F(e,t)}function de(e,t,n,r){return t=pe((e=new Ke(e,t,n,r)).parent.id,e.name),e.la=oe[t],oe[t]=e}var me={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090};function ge(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function ye(e,t){return se||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:2}function be(e,t){try{return fe(e,t),20}catch(e){}return ye(e,"wx")}var ve,xe={open:function(e){e.f=ne[e.node.K].f,e.f.open&&e.f.open(e)},A:function(){throw new ue(70)}};function we(e,t){ne[e]={f:t}}function _e(e,t){var n="/"===t,r=!t;if(n&&te)throw new ue(10);if(!n&&!r){var a=ce(t,{Y:!1});if(t=a.path,(a=a.node).J)throw new ue(10);if(16384!=(61440&a.mode))throw new ue(54)}t={type:e,Ja:{},aa:t,ka:[]},(e=e.o(t)).o=t,t.root=e,n?te=e:a&&(a.J=t,a.o&&a.o.ka.push(t))}function Te(e,t,n){var r=ce(e,{parent:!0}).node;if(!(e=K(e))||"."===e||".."===e)throw new ue(28);var a=be(r,e);if(a)throw new ue(a);if(!r.c.I)throw new ue(63);return r.c.I(r,e,t,n)}function Ee(e){Te(e,16895,0)}function Se(e,t,n){void 0===n&&(n=t,t=438),Te(e,8192|t,n)}function Ie(e,t){if(!q(e))throw new ue(44);var n=ce(t,{parent:!0}).node;if(!n)throw new ue(44);var r=be(n,t=K(t));if(r)throw new ue(r);if(!n.c.L)throw new ue(63);n.c.L(n,t,e)}function ke(e){if(!(e=ce(e).node))throw new ue(44);if(!e.c.G)throw new ue(28);return q(he(e.parent),e.c.G(e))}function Ce(e,n,r){if(""===e)throw new ue(44);if("string"==typeof n){var a=me[n];if(void 0===a)throw Error("Unknown file open mode: "+n);n=a}if(r=64&n?4095&(void 0===r?438:r)|32768:0,"object"==typeof e)var o=e;else{e=G(e);try{o=ce(e,{X:!(131072&n)}).node}catch(e){}}if(a=!1,64&n)if(o){if(128&n)throw new ue(20)}else o=Te(e,r,0),a=!0;if(!o)throw new ue(44);if(8192==(61440&o.mode)&&(n&=-513),65536&n&&16384!=(61440&o.mode))throw new ue(54);if(!a&&(r=o?40960==(61440&o.mode)?32:16384==(61440&o.mode)&&("r"!==ge(n)||512&n)?31:ye(o,ge(n)):44))throw new ue(r);if(512&n){var s;if(!(s="string"==typeof(r=o)?ce(r,{X:!0}).node:r).c.m)throw new ue(63);if(16384==(61440&s.mode))throw new ue(31);if(32768!=(61440&s.mode))throw new ue(28);if(r=ye(s,"w"))throw new ue(r);s.c.m(s,{size:0,timestamp:Date.now()})}n&=-131713,(o=function(e){Fe||((Fe=function(){}).prototype={});var t,n=new Fe;for(t in e)n[t]=e[t];return e=n,n=function(){for(var e=0;e<=4096;e++)if(!re[e])return e;throw new ue(33)}(),e.v=n,re[n]=e}({node:o,path:he(o),flags:n,seekable:!0,position:0,f:o.f,xa:[],error:!1})).f.open&&o.f.open(o),!t.logReadFiles||1&n||(Oe||(Oe={}),e in Oe||(Oe[e]=1,c("FS.trackingDelegate error on read file: "+e)));try{ie.onOpenFile&&(s=0,1!=(2097155&n)&&(s|=1),0!=(2097155&n)&&(s|=2),ie.onOpenFile(e,s))}catch(t){c("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return o}function Ne(e,t,n){if(null===e.v)throw new ue(8);if(!e.seekable||!e.f.A)throw new ue(70);if(0!=n&&1!=n&&2!=n)throw new ue(28);e.position=e.f.A(e,t,n),e.xa=[]}function Ae(){ue||((ue=function(e,t){this.node=t,this.na=function(e){this.s=e},this.na(e),this.message="FS error"}).prototype=Error(),ue.prototype.constructor=ue,[44].forEach((function(e){le[e]=new ue(e),le[e].stack="<generic error, no stack>"})))}function $e(e,t,n){e=G("/dev/"+e);var r=function(e,t){var n=0;return e&&(n|=365),t&&(n|=146),n}(!!t,!!n);Re||(Re=64);var a=Re++<<8|0;we(a,{open:function(e){e.seekable=!1},close:function(){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,n,r,a){for(var o=0,s=0;s<a;s++){try{var i=t()}catch(e){throw new ue(29)}if(void 0===i&&0===o)throw new ue(6);if(null==i)break;o++,n[r+s]=i}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,r,a){for(var o=0;o<a;o++)try{n(t[r+o])}catch(e){throw new ue(29)}return a&&(e.node.timestamp=Date.now()),o}}),Se(e,r,a)}var Re,Fe,Oe,De={},Me=void 0;function Le(){return v[(Me+=4)-4>>2]}function Pe(e){if(!(e=re[e]))throw new ue(8);return e}var Be,Ue={};function ze(){if(!Be){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(e in Ue)t[e]=Ue[e];var n=[];for(e in t)n.push(e+"="+t[e]);Be=n}return Be}function Ve(e){return 0==e%4&&(0!=e%100||0==e%400)}function We(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var je=[31,29,31,30,31,30,31,31,30,31,30,31],Ge=[31,28,31,30,31,30,31,31,30,31,30,31];function He(e,t){for(e=new Date(e.getTime());0<t;){var n=e.getMonth(),r=(Ve(e.getFullYear())?je:Ge)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return e}function Ke(e,t,n,r){e||(e=this),this.parent=e,this.o=e.o,this.J=null,this.id=ae++,this.name=t,this.mode=n,this.c={},this.f={},this.K=r}function qe(e,t){for(var n=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++r)),127>=a?++n:n=2047>=a?n+2:65535>=a?n+3:n+4}return e=S(e,n=Array(n+1),0,n.length),t&&(n.length=e),n}Object.defineProperties(Ke.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}}}),Ae(),oe=Array(4096),_e(ee,"/"),Ee("/tmp"),Ee("/home"),Ee("/home/web_user"),function(){Ee("/dev"),we(259,{read:function(){return 0},write:function(e,t,n,r){return r}}),Se("/dev/null",259),Y(1280,J),Y(1536,Z),Se("/dev/tty",1280),Se("/dev/tty1",1536);var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){D("randomDevice")}}();$e("random",e),$e("urandom",e),Ee("/dev/shm"),Ee("/dev/shm/tmp")}(),Ee("/proc"),Ee("/proc/self"),Ee("/proc/self/fd"),_e({o:function(){var e=de("/proc/self","fd",16895,73);return e.c={F:function(e,t){var n=re[+t];if(!n)throw new ue(8);return(e={parent:null,o:{aa:"fake"},c:{G:function(){return n.path}}}).parent=e}},e}},"/proc/self/fd"),N.push({ha:function(){Ye()}});var Xe={__assert_fail:function(e,t,n,r){D("Assertion failed: "+E(e)+", at: "+[t?E(t):"unknown filename",n,r?E(r):"unknown function"])},__cxa_allocate_exception:function(e){return Qe(e+16)+16},__cxa_atexit:function(){},__cxa_throw:function(e,t,n){throw new W(e).ia(t,n),e},__sys_ioctl:function(e,t,n){Me=n;try{var r=Pe(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return r.h?0:-59;case 21519:if(!r.h)return-59;var a=Le();return v[a>>2]=0;case 21520:return r.h?-28:-59;case 21531:if(e=a=Le(),!r.f.ja)throw new ue(59);return r.f.ja(r,t,e);default:D("bad ioctl syscall "+t)}}catch(e){return void 0!==De&&e instanceof ue||D(e),-e.s}},__sys_open:function(e,t,n){Me=n;try{return Ce(E(e),t,n?Le():0).v}catch(e){return void 0!==De&&e instanceof ue||D(e),-e.s}},abort:function(){D()},emscripten_memcpy_big:function(e,t,n){y.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){e>>>=0;var t=y.length;if(2147483648<e)return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296),0<(r=Math.max(16777216,e,r))%65536&&(r+=65536-r%65536);e:{try{h.grow(Math.min(2147483648,r)-m.byteLength+65535>>>16),I();var a=1;break e}catch(e){}a=void 0}if(a)return!0}return!1},environ_get:function(e,t){try{var n=0;return ze().forEach((function(r,a){var o=t+n;for(a=v[e+4*a>>2]=o,o=0;o<r.length;++o)g[a++>>0]=r.charCodeAt(o);g[a>>0]=0,n+=r.length+1})),0}catch(e){return void 0!==De&&e instanceof ue||D(e),e.s}},environ_sizes_get:function(e,t){try{var n=ze();v[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),v[t>>2]=r,0}catch(e){return void 0!==De&&e instanceof ue||D(e),e.s}},fd_close:function(e){try{var t=Pe(e);if(null===t.v)throw new ue(8);t.R&&(t.R=null);try{t.f.close&&t.f.close(t)}catch(e){throw e}finally{re[t.v]=null}return t.v=null,0}catch(e){return void 0!==De&&e instanceof ue||D(e),e.s}},fd_read:function(e,t,n,r){try{e:{for(var a=Pe(e),o=e=0;o<n;o++){var s=v[t+(8*o+4)>>2],i=a,u=v[t+8*o>>2],l=s,c=void 0,h=g;if(0>l||0>c)throw new ue(28);if(null===i.v)throw new ue(8);if(1==(2097155&i.flags))throw new ue(8);if(16384==(61440&i.node.mode))throw new ue(31);if(!i.f.read)throw new ue(28);var p=void 0!==c;if(p){if(!i.seekable)throw new ue(70)}else c=i.position;var f=i.f.read(i,h,u,l,c);p||(i.position+=f);var d=f;if(0>d){var m=-1;break e}if(e+=d,d<s)break}m=e}return v[r>>2]=m,0}catch(e){return void 0!==De&&e instanceof ue||D(e),e.s}},fd_seek:function(e,t,n,r,a){try{var o=Pe(e);return-9007199254740992>=(e=4294967296*n+(t>>>0))||9007199254740992<=e?-61:(Ne(o,e,r),P=[o.position>>>0,(L=o.position,1<=+Math.abs(L)?0<L?(0|Math.min(+Math.floor(L/4294967296),4294967295))>>>0:~~+Math.ceil((L-+(~~L>>>0))/4294967296)>>>0:0)],v[a>>2]=P[0],v[a+4>>2]=P[1],o.R&&0===e&&0===r&&(o.R=null),0)}catch(e){return void 0!==De&&e instanceof ue||D(e),e.s}},fd_write:function(e,t,n,r){try{e:{for(var a=Pe(e),o=e=0;o<n;o++){var s=a,i=v[t+8*o>>2],u=v[t+(8*o+4)>>2],l=void 0,h=g;if(0>u||0>l)throw new ue(28);if(null===s.v)throw new ue(8);if(0==(2097155&s.flags))throw new ue(8);if(16384==(61440&s.node.mode))throw new ue(31);if(!s.f.write)throw new ue(28);s.seekable&&1024&s.flags&&Ne(s,0,2);var p=void 0!==l;if(p){if(!s.seekable)throw new ue(70)}else l=s.position;var f=s.f.write(s,h,i,u,l,void 0);p||(s.position+=f);try{s.path&&ie.onWriteToFile&&ie.onWriteToFile(s.path)}catch(e){c("FS.trackingDelegate['onWriteToFile']('"+s.path+"') threw an exception: "+e.message)}var d=f;if(0>d){var m=-1;break e}e+=d}m=e}return v[r>>2]=m,0}catch(e){return void 0!==De&&e instanceof ue||D(e),e.s}},setTempRet0:function(){},strftime_l:function(e,t,n,r){return function(e,t,n,r){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function o(e,t){return a(e,t,"0")}function s(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function i(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function u(e){e=He(new Date(e.j+1900,0,1),e.O);var t=new Date(e.getFullYear()+1,0,4),n=i(new Date(e.getFullYear(),0,4));return t=i(t),0>=s(n,e)?0>=s(t,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var l=v[r+40>>2];for(var c in r={va:v[r>>2],ua:v[r+4>>2],M:v[r+8>>2],H:v[r+12>>2],D:v[r+16>>2],j:v[r+20>>2],N:v[r+24>>2],O:v[r+28>>2],Ka:v[r+32>>2],ta:v[r+36>>2],wa:l?E(l):""},n=E(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(c,"g"),l[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(c in l={"%a":function(e){return h[e.N].substring(0,3)},"%A":function(e){return h[e.N]},"%b":function(e){return p[e.D].substring(0,3)},"%B":function(e){return p[e.D]},"%C":function(e){return o((e.j+1900)/100|0,2)},"%d":function(e){return o(e.H,2)},"%e":function(e){return a(e.H,2," ")},"%g":function(e){return u(e).toString().substring(2)},"%G":function(e){return u(e)},"%H":function(e){return o(e.M,2)},"%I":function(e){return 0==(e=e.M)?e=12:12<e&&(e-=12),o(e,2)},"%j":function(e){return o(e.H+We(Ve(e.j+1900)?je:Ge,e.D-1),3)},"%m":function(e){return o(e.D+1,2)},"%M":function(e){return o(e.ua,2)},"%n":function(){return"\n"},"%p":function(e){return 0<=e.M&&12>e.M?"AM":"PM"},"%S":function(e){return o(e.va,2)},"%t":function(){return"\t"},"%u":function(e){return e.N||7},"%U":function(e){var t=new Date(e.j+1900,0,1),n=0===t.getDay()?t:He(t,7-t.getDay());return 0>s(n,e=new Date(e.j+1900,e.D,e.H))?o(Math.ceil((31-n.getDate()+(We(Ve(e.getFullYear())?je:Ge,e.getMonth()-1)-31)+e.getDate())/7),2):0===s(n,t)?"01":"00"},"%V":function(e){var t=new Date(e.j+1901,0,4),n=i(new Date(e.j+1900,0,4));t=i(t);var r=He(new Date(e.j+1900,0,1),e.O);return 0>s(r,n)?"53":0>=s(t,r)?"01":o(Math.ceil((n.getFullYear()<e.j+1900?e.O+32-n.getDate():e.O+1-n.getDate())/7),2)},"%w":function(e){return e.N},"%W":function(e){var t=new Date(e.j,0,1),n=1===t.getDay()?t:He(t,0===t.getDay()?1:7-t.getDay()+1);return 0>s(n,e=new Date(e.j+1900,e.D,e.H))?o(Math.ceil((31-n.getDate()+(We(Ve(e.getFullYear())?je:Ge,e.getMonth()-1)-31)+e.getDate())/7),2):0===s(n,t)?"01":"00"},"%y":function(e){return(e.j+1900).toString().substring(2)},"%Y":function(e){return e.j+1900},"%z":function(e){var t=0<=(e=e.ta);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.wa},"%%":function(){return"%"}})0<=n.indexOf(c)&&(n=n.replace(new RegExp(c,"g"),l[c](r)));return(c=qe(n,!1)).length>t?0:(g.set(c,e),c.length-1)}(e,t,n,r)}};!function(){function e(e){t.asm=e.exports,h=t.asm.memory,I(),k=t.asm.__indirect_function_table,F--,t.monitorRunDependencies&&t.monitorRunDependencies(F),0==F&&O&&(e=O,O=null,e())}function n(t){e(t.instance)}function a(e){return(u||"function"!=typeof fetch?Promise.resolve().then((function(){return z()})):fetch(B,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+B+"'";return e.arrayBuffer()})).catch((function(){return z()}))).then((function(e){return WebAssembly.instantiate(e,o)})).then(e,(function(e){c("failed to asynchronously prepare wasm: "+e),D(e)}))}var o={env:Xe,wasi_snapshot_preview1:Xe};if(F++,t.monitorRunDependencies&&t.monitorRunDependencies(F),t.instantiateWasm)try{return t.instantiateWasm(o,e)}catch(e){return c("Module.instantiateWasm callback failed with error: "+e),!1}(u||"function"!=typeof WebAssembly.instantiateStreaming||M()||"function"!=typeof fetch?a(n):fetch(B,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,o).then(n,(function(e){return c("wasm streaming compile failed: "+e),c("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}();var Ye=t.___wasm_call_ctors=function(){return(Ye=t.___wasm_call_ctors=t.asm.__wasm_call_ctors).apply(null,arguments)},Qe=t._malloc=function(){return(Qe=t._malloc=t.asm.malloc).apply(null,arguments)};t._free=function(){return(t._free=t.asm.free).apply(null,arguments)},t._xzimgInitializeCamera=function(){return(t._xzimgInitializeCamera=t.asm.xzimgInitializeCamera).apply(null,arguments)},t._xzimgPoseEstimationInitializeFacePose=function(){return(t._xzimgPoseEstimationInitializeFacePose=t.asm.xzimgPoseEstimationInitializeFacePose).apply(null,arguments)},t._xzimgPoseEstimationInitialize=function(){return(t._xzimgPoseEstimationInitialize=t.asm.xzimgPoseEstimationInitialize).apply(null,arguments)},t._xzimgPoseEstimationRelease=function(){return(t._xzimgPoseEstimationRelease=t.asm.xzimgPoseEstimationRelease).apply(null,arguments)},t._xzimgPoseEstimationPrepareCrop=function(){return(t._xzimgPoseEstimationPrepareCrop=t.asm.xzimgPoseEstimationPrepareCrop).apply(null,arguments)},t._xzimgPoseEstimationEstimateFacePose=function(){return(t._xzimgPoseEstimationEstimateFacePose=t.asm.xzimgPoseEstimationEstimateFacePose).apply(null,arguments)},t._xzimgGetHeatmapsLocations=function(){return(t._xzimgGetHeatmapsLocations=t.asm.xzimgGetHeatmapsLocations).apply(null,arguments)},t._xzimgEstimateRigidPose=function(){return(t._xzimgEstimateRigidPose=t.asm.xzimgEstimateRigidPose).apply(null,arguments)},t._xzimgEstimateGetSimilarity=function(){return(t._xzimgEstimateGetSimilarity=t.asm.xzimgEstimateGetSimilarity).apply(null,arguments)},t._xzimgWarpAffine=function(){return(t._xzimgWarpAffine=t.asm.xzimgWarpAffine).apply(null,arguments)},t._xzimgMatchRecKeypsInit=function(){return(t._xzimgMatchRecKeypsInit=t.asm.xzimgMatchRecKeypsInit).apply(null,arguments)},t._xzimgMatchRecKeyps=function(){return(t._xzimgMatchRecKeyps=t.asm.xzimgMatchRecKeyps).apply(null,arguments)},t._xzimgEstimateInitNonRigidPose=function(){return(t._xzimgEstimateInitNonRigidPose=t.asm.xzimgEstimateInitNonRigidPose).apply(null,arguments)},t._xzimgEstimateNonRigidPose=function(){return(t._xzimgEstimateNonRigidPose=t.asm.xzimgEstimateNonRigidPose).apply(null,arguments)},t._xzimgEstimateBodyNonRigidPose=function(){return(t._xzimgEstimateBodyNonRigidPose=t.asm.xzimgEstimateBodyNonRigidPose).apply(null,arguments)},t._xzimgEstimateNonRigidPoseBase=function(){return(t._xzimgEstimateNonRigidPoseBase=t.asm.xzimgEstimateNonRigidPoseBase).apply(null,arguments)},t._xzimgEstimateGetNumVertices=function(){return(t._xzimgEstimateGetNumVertices=t.asm.xzimgEstimateGetNumVertices).apply(null,arguments)},t._xzimgEstimateGetDenseVertices=function(){return(t._xzimgEstimateGetDenseVertices=t.asm.xzimgEstimateGetDenseVertices).apply(null,arguments)},t.___errno_location=function(){return(t.___errno_location=t.asm.__errno_location).apply(null,arguments)},t._emscripten_main_thread_process_queued_calls=function(){return(t._emscripten_main_thread_process_queued_calls=t.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)};var Je,Ze=t.stackSave=function(){return(Ze=t.stackSave=t.asm.stackSave).apply(null,arguments)},et=t.stackRestore=function(){return(et=t.stackRestore=t.asm.stackRestore).apply(null,arguments)},tt=t.stackAlloc=function(){return(tt=t.stackAlloc=t.asm.stackAlloc).apply(null,arguments)};function nt(){function e(){if(!Je&&(Je=!0,t.calledRun=!0,!p)){if(t.noFSInit||ve||(ve=!0,Ae(),t.stdin=t.stdin,t.stdout=t.stdout,t.stderr=t.stderr,t.stdin?$e("stdin",t.stdin):Ie("/dev/tty","/dev/stdin"),t.stdout?$e("stdout",null,t.stdout):Ie("/dev/tty","/dev/stdout"),t.stderr?$e("stderr",null,t.stderr):Ie("/dev/tty1","/dev/stderr"),Ce("/dev/stdin",0),Ce("/dev/stdout",1),Ce("/dev/stderr",1)),V(N),se=!1,V(A),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;){var e=t.postRun.shift();$.unshift(e)}V($)}}if(!(0<F)){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)R();V(C),0<F||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),e()}),1)):e())}}if(t._setThrew=function(){return(t._setThrew=t.asm.setThrew).apply(null,arguments)},t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.dynCall_jiji).apply(null,arguments)},t.dynCall_viijii=function(){return(t.dynCall_viijii=t.asm.dynCall_viijii).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.dynCall_iiiiiijj).apply(null,arguments)},t.dynCall_iiiiij=function(){return(t.dynCall_iiiiij=t.asm.dynCall_iiiiij).apply(null,arguments)},t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.dynCall_iiiiijj).apply(null,arguments)},t.ccall=d,t.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?f(e):function(){return d(e,t,n,arguments)}},t.setValue=function(e,t,n){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":g[e>>0]=t;break;case"i16":b[e>>1]=t;break;case"i32":v[e>>2]=t;break;case"i64":P=[t>>>0,(L=t,1<=+Math.abs(L)?0<L?(0|Math.min(+Math.floor(L/4294967296),4294967295))>>>0:~~+Math.ceil((L-+(~~L>>>0))/4294967296)>>>0:0)],v[e>>2]=P[0],v[e+4>>2]=P[1];break;case"float":x[e>>2]=t;break;case"double":w[e>>3]=t;break;default:D("invalid type for setValue: "+n)}},t.getValue=function(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return g[e>>0];case"i16":return b[e>>1];case"i32":case"i64":return v[e>>2];case"float":return x[e>>2];case"double":return w[e>>3];default:D("invalid type for getValue: "+t)}return null},O=function e(){Je||nt(),Je||(O=e)},t.run=nt,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();return nt(),e.ready}),fb={modelFilename:"",featuresFilename:"",objFilename:"",fovY:50,detection_score_t:.2,tracking_score_t:.4,footToDetect:"RIGHT_FOOT",filteringLevel:2,filteringShift:.5};function db(e,t){e.length;var n=function(e,t){var n=e.length/2,r=bb(n,t),a=r[0],o=r[1],s=[e[a],e[a+n]],i=[e[o],e[o+n]],u=[(s[0]+i[0])/2,(s[1]+i[1])/2],l=-Math.atan2(s[1]-i[1],i[0]-s[0]),c=Math.sqrt((s[0]-i[0])*(s[0]-i[0])+(s[1]-i[1])*(s[1]-i[1]));return[u[0],u[1],l,c]}(e,t),r=n[0],a=n[1],o=n[2],s=n[3],i=[Math.cos(o),Math.sin(o)],u=[-i[1],i[0]],l=s/1,c=s/2;return[r+i[0]*l+u[0]*c,a+i[1]*l+u[1]*c,r+i[0]*l-u[0]*c,a+i[1]*l-u[1]*c,r-i[0]*l-u[0]*c,a-i[1]*l-u[1]*c,r-i[0]*l+u[0]*c,a-i[1]*l+u[1]*c]}function mb(e,t){for(var n=1e4,r=1e4,a=-1e4,o=-1e4,s=0;s<t;s++){var i=e[s],u=e[t+s];i>a&&(a=i),u>o&&(o=u),i<n&&(n=i),u<r&&(r=u)}return[Math.floor(n),Math.floor(a+1),Math.floor(r),Math.floor(o+1)]}function gb(e,t){var n=0,r=e.length;if(6==r&&"RIGHT_FOOT"==t){for(var a=3;a<r;a++)n+=e[a];n/=3}else if(6==r&&"LEFT_FOOT"==t){for(a=0;a<3;a++)n+=e[a];n/=3}else{for(a=0;a<r;a++)n+=e[a];n/=r}return n}function yb(e,t,n,r){var a=Float32Array.from(e),o=e.length/2;if(n)for(var s=0;s<o;s++)a[s+o]=r-1-a[s+o];for(s=0;s<o;s++){var i=a[s],u=a[s+o];a[s]=t[0]*i+t[1]*u+t[2],a[s+o]=t[3]*i+t[4]*u+t[5]}return a}function bb(e,t){if(void 0===t&&(t="face"),"face"==t){if(5==e)return[0,1];if(19==e)return[6,11];if(21==e)return[17,20];if(51==e)return[19,28];if(68==e)return[36,45];if(16==e)return[6,9]}return"eye"==t?[0,1]:6==e&&"RIGHT_FOOT"==t?[3,5]:6==e&&"LEFT_FOOT"==t?[0,2]:18!=e||"RIGHT_FOOT"!=t&&"LEFT_FOOT"!=t?13!=e||"RIGHT_FOOT"!=t&&"LEFT_FOOT"!=t?"hand"==t&&8==e?[7,0]:(console.error("no type or number of feature match"),[0,1]):[0,6]:[0,9]}function vb(e,t){var n=e.length/2,r=bb(n,t),a=r[0],o=r[1],s=[e[a],e[a+n]],i=[e[o],e[o+n]],u=[(4*s[0]+i[0])/5,(4*s[1]+i[1])/5],l=-Math.atan2(s[1]-i[1],i[0]-s[0]);return[u[0],u[1],l]}function xb(e,t,n){for(var r=n[0],a=n[1],o=n[2],s=n[3],i=n[4],u=n[5],l=e.width,c=e.height,h=4*e.width,p=t.width,f=t.height,d=4*t.width,m=0;m<f;m++)for(var g=a*m+o,y=i*m+u,b=m*d,v=0;v<p;v++){var x=4*v,w=Math.floor(g),_=Math.floor(y),T=g-w,E=y-_,S=void 0,I=void 0;if(w>0&&w<l-1&&_>0&&_<c-1){for(var k=_*h+4*w,C=0;C<3;C++,k++){var N=e.data[k];S=N+T*(e.data[k+4]-N),I=e.data[k+h]+T*(e.data[k+h+4]-e.data[k+h]),t.data[b+x+C]=S+E*(I-S)}t.data[b+x+3]=255}else{for(C=0;C<3;C++)t.data[b+x+C]=0;t.data[b+x+3]=255}g+=r,y+=s}return t}function wb(e,t,n,r,a,o,s){var i,u,l=e.length/2;6!=l&&13!=l&&18!=l&&console.log("foot detection should return 6 features");var c=null,h=0;6==l?((i=vb(e,s))[0],i[1],h=i[2],c=mb("RIGHT_FOOT"==s?[e[3],e[4],e[5],e[3+l],e[4+l],e[5+l]]:[e[0],e[1],e[2],e[0+l],e[1+l],e[2+l]],3)):((u=vb(e,s))[0],u[1],h=u[2],c=mb(e,l)),c[2],c[0],c[3],c[1];var p=Math.cos(h),f=Math.sin(h),d=Math.sqrt((c[1]-c[0])*(c[1]-c[0])+(c[3]-c[2])*(c[3]-c[2])),m=(d+=.25*d)/Math.max(n,t),g=t/2,y=n/2,b=(c[0]+c[1])/2-(p*m*g-f*m*y),v=(c[2]+c[3])/2-(f*m*g+p*m*y);if(null!=o){var x=Math.sqrt((b-o[2])*(b-o[2])+(v-o[5])*(v-o[5])),w=1;x>20&&(w=.1),x>=10&&x<=20&&(w=1-.09*(x-5)),b=(1-w)*b+w*o[2],v=(1-w)*v+w*o[5],h=Math.abs(h-o[6])>1?(1-w)*h-w*o[6]:(1-w)*h+w*o[6],m=(1-w)*m+w*o[7],p=Math.cos(h),f=Math.sin(h)}return[p*m,-f*m,b,f*m,p*m,v,h,m]}function _b(e,t){var n=e._malloc(4*t.length);return e.HEAPF32.set(t,n/4),n}function Tb(e,t,n){var r=new Float32Array(n),a=t/4;return r.set(e.HEAPF32.subarray(a,a+n)),r.slice()}function Eb(e,t,n){var r=new Uint32Array(t.data.buffer),a=r.length,o=n/4;e.HEAPU32.subarray(o,o+a).set(r)}function Sb(e,t,n,r){var a=e._malloc(28);return e.setValue(a,n,"i32"),e.setValue(a+4,r,"i32"),e.setValue(a+8,t,"i32"),e.setValue(a+12,0,"i32"),e.setValue(a+16,4,"i32"),e.setValue(a+20,0,"i32"),e.setValue(a+24,0,"i32"),a}function Ib(e,t,n,r){var a=e.cwrap("xzimgMatchRecKeyps","number",["number","number","number","number","number"]),o=r.length/2;Eb(e,t,n);var s=Sb(e,n,t.width,t.height),i=_b(e,r),u=_b(e,r.slice()),l=e._malloc(4*o),c=e._malloc(16);a(s,i,u,o,l,c);for(var h=Tb(e,l,o),p=Tb(e,u,r.length),f=Tb(e,c,4),d=0;d<o;d++)0==h[d]&&(p[d]=r[d],p[d+o]=r[d+o]);return e._free(s),e._free(i),e._free(u),e._free(l),e._free(c),[p,f,h]}function kb(e,t,n,r){var a=_b(e,t),o=_b(e,n),s=e._malloc(16);e.cwrap("xzimgEstimateGetSimilarity","number",["number","number","number","number"])(a,o,t.length/2,s);var i=Tb(e,s,4);return e._free(a),e._free(o),e._free(s),i}function Cb(e,t,n,r,a){var o=t/4,s=new Float32Array(18);s.set(e.HEAPF32.subarray(o,o+18)),s[9]+=n[2]*s[11]/r,s[10]+=n[3]*s[11]/a,e.HEAPF32.set(s,t/4)}function Nb(e,t,n,r,a,o,s){void 0===a&&(a=null);for(var i=new Float32Array(2),u=n.length/2,l=0,c=0;c<u;c++)(null==a||a[c]>0)&&(i[0]+=r[c]-n[c],i[1]+=r[c+u]-n[c+u],l+=1);l>0&&(i[0]/=l,i[1]/=l);var h=t/4,p=new Float32Array(18);p.set(e.HEAPF32.subarray(h,h+18)),p[9]+=i[0]*p[11]/o,p[10]+=i[1]*p[11]/s,e.HEAPF32.set(p,t/4)}function Ab(e,t,n,r,a){void 0===a&&(a=!1);var o=function(e,t,n,r){for(var a=new Float32Array(r).fill(0),o=new Int32Array(2*r),s=t*n,i=0;i<s;i++)for(var u=0;u<r;u++){var l=e[i*r+u];l>a[u]&&(a[u]=l,o[u]=i%n,o[r+u]=Math.floor(i/n))}return[o,a]}(e,t,n,r),s=function(e,t,n,r,a){for(var o=[-r*a-a,-r*a,-r*a+a,-a,0,a,r*a-a,r*a,r*a+a],s=new Float32Array(a),i=new Float32Array(2*a),u=0;u<a;u++){var l=t[u],c=t[a+u];i[u]=l,i[a+u]=c;var h=c*r*a+l*a+u,p=0;p=0;for(var f=0;f<9;f++)p+=e[h+o[f]];p/=9,s[u]=p;var d=Math.min(l+2,r-1),m=Math.max(l-2,0),g=Math.min(c+2,n-1),y=Math.max(c-2,0),b=0,v=0,x=c*r*a+m*a+u,w=c*r*a+d*a+u;for(f=0;f<9;f++)b+=e[x+o[f]],v+=e[w+o[f]];var _=2*(2*p-((b/=9)+(v/=9)));if(Math.abs(_)>1e-5){var T=2*(v-b)/_;i[u]+=T}var E=0,S=0,I=y*r*a+l*a+u,k=g*r*a+l*a+u;for(f=0;f<9;f++)E+=e[I+o[f]],S+=e[k+o[f]];_=2*(2*p-((E/=9)+(S/=9))),Math.abs(_)>1e-5&&(T=2*(S-E)/_,i[a+u]+=T)}return[i,s]}(e,o[0],t,n,r),i=s[0],u=s[1];if(a)for(var l=0;l<r;l++)i[l]=n-1-i[l];return[i,u]}function $b(e,t){var n,r,a,o,s={vertices:new Float32Array,uvs:new Float32Array,faces:new Uint16Array},i=e.match(/^v( -?\d+(\.\d+)?){3}$/gm);if(i){var u=i.map((function(e){var t=e.split(" ");return t.shift(),t.map((function(e){return+e}))})),l=(n=[]).concat.apply(n,u);s.vertices=new Float32Array(l)}var c=e.match(/^vt( -?\d+(\.\d+)?){2}$/gm);if(c){var h=c.map((function(e){var t=e.split(" ");return t.shift(),t.map((function(e){return+e}))})),p=(r=[]).concat.apply(r,h);s.uvs=new Float32Array(p)}var f=e.match(/^f( \d+\/\d*\/\d*){3}$/gm);if(f){var d=f.map((function(e){var t=e.split(" ");return t.shift(),[+t[0].split("/")[0]-1,+t[1].split("/")[0]-1,+t[2].split("/")[0]-1]})),m=(a=[]).concat.apply(a,d);if(s.faces=new Uint16Array(m),t){var g=f.map((function(e){var t=e.split(" ");return t.shift(),[+t[0].split("/")[1]-1,+t[1].split("/")[1]-1,+t[2].split("/")[1]-1]})),y=new Uint16Array((o=[]).concat.apply(o,g)),b=s.uvs;s.uvs=new Float32Array(b.length);for(var v=0;v<y.length;v++){var x=y[v],w=b[2*x],_=b[2*x+1],T=s.faces[v];s.uvs[2*T]=w,s.uvs[2*T+1]=_}}}if(t){for(v=0;v<s.faces.length;v+=3){var E=s.faces[v];s.faces[v]=s.faces[v+1],s.faces[v+1]=E}for(v=0;v<s.vertices.length;v+=3)s.vertices[v]=-s.vertices[v]}return s}!function(e){e.Detection="DETECTION",e.Detected="DETECTED",e.Tracking="TRACKING"}(cb||(cb={}));var Rb,Fb=function(){function e(e,t){this._trackingState=cb.Detection,this._type=0,this._R=Float32Array.from(e),this._t=Float32Array.from(t),this._trackingState=cb.Detection}return e.prototype.setTrackingState=function(e){this._trackingState=e},e.prototype.getTrackingState=function(){return this._trackingState},e.prototype.isDetected=function(){return this._trackingState==cb.Tracking},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!1,configurable:!0}),e.prototype.setRt=function(e,t){this._R=e.slice(0),this._t=t.slice(0)},e.prototype.R=function(){return this._R},e.prototype.t=function(){return this._t},e.prototype.getPosition=function(){return[this._t[0],this._t[1],this._t[2]]},e.prototype.getRotation=function(){return[[this._R[0],this._R[1],this._R[2]],[this._R[3],this._R[4],this._R[5]],[this._R[6],this._R[7],this._R[8]]]},e.prototype.reset=function(){this._R=new Float32Array([1,0,0,0,-1,0,0,0,-1]),this._t=new Float32Array([0,0,0])},e.getQuatFromRotMat=function(e){var t=new Float32Array(4);return t[0]=Math.sqrt(Math.max(0,1+e[0]+e[4]+e[8]))/2,t[1]=Math.sqrt(Math.max(0,1+e[0]-e[4]-e[8]))/2,t[2]=Math.sqrt(Math.max(0,1-e[0]+e[4]-e[8]))/2,t[3]=Math.sqrt(Math.max(0,1-e[0]-e[4]+e[8]))/2,t[1]=e[7]-e[5]<0?-Math.abs(t[1]):Math.abs(t[1]),t[2]=e[2]-e[6]<0?-Math.abs(t[2]):Math.abs(t[2]),t[3]=e[3]-e[1]<0?-Math.abs(t[3]):Math.abs(t[3]),t},e.getRotMatFromQuat=function(e){var t=new Float32Array(9);return t[0]=1-2*e[2]*e[2]-2*e[3]*e[3],t[1]=2*e[1]*e[2]-2*e[3]*e[0],t[2]=2*e[1]*e[3]+2*e[2]*e[0],t[3]=2*e[1]*e[2]+2*e[3]*e[0],t[4]=1-2*e[1]*e[1]-2*e[3]*e[3],t[5]=2*e[2]*e[3]-2*e[1]*e[0],t[6]=2*e[1]*e[3]-2*e[2]*e[0],t[7]=2*e[2]*e[3]+2*e[1]*e[0],t[8]=1-2*e[1]*e[1]-2*e[2]*e[2],t},e.slerp=function(e,t,n){var r,a,o=new Float32Array(4),s=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0],i=Math.abs(s);if(i>=.99999)r=1-n,a=n;else{var u=Math.acos(i),l=Math.sin(u);r=Math.sin((1-n)*u)/l,a=Math.sin(n*u)/l}return s<0&&(a=-a),o[1]=r*e[1]+a*t[1],o[2]=r*e[2]+a*t[2],o[3]=r*e[3]+a*t[3],o[0]=r*e[0]+a*t[0],o},e.getCameraMat=function(e,t,n){var r=n/2/Math.tan(e*Math.PI/180/2),a=r,o=(t-1)/2,s=(n-1)/2,i=new Float32Array(9);return i[0]=a,i[2]=o,i[4]=r,i[5]=s,i[8]=1,i},e.getCameraParams=function(e,t,n){var r=n/2/Math.tan(e*Math.PI/180/2);return[r,r,(t-1)/2,(n-1)/2]},e.MatMultVec=function(e,t){var n=new Float32Array(3);return n[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n[1]=e[3]*t[0]+e[4]*t[1]+e[5]*t[2],n[2]=e[6]*t[0]+e[7]*t[1]+e[8]*t[2],n},e.MatMult=function(e,t){var n=new Float32Array(9);return n[0]=e[0]*t[0]+e[1]*t[3]+e[2]*t[6],n[1]=e[0]*t[1]+e[1]*t[4]+e[2]*t[7],n[2]=e[0]*t[2]+e[1]*t[5]+e[2]*t[8],n[3]=e[3]*t[0]+e[4]*t[3]+e[5]*t[6],n[4]=e[3]*t[1]+e[4]*t[4]+e[5]*t[7],n[5]=e[3]*t[2]+e[4]*t[5]+e[5]*t[8],n[6]=e[6]*t[0]+e[7]*t[3]+e[8]*t[6],n[7]=e[6]*t[1]+e[7]*t[4]+e[8]*t[7],n[8]=e[6]*t[2]+e[7]*t[5]+e[8]*t[8],n},e.prototype.project=function(t,n){for(var r=new Float32Array(t.length/3*2),a=0;a<t.length/3;a++){var o=e.MatMultVec(this._R,new Float32Array([t[3*a],t[3*a+1],t[3*a+2]])),s=new Float32Array(3);s[0]=o[0]+this._t[0],s[1]=o[1]+this._t[1],s[2]=o[2]+this._t[2];var i=n[6]*s[0]+n[7]*s[1]+n[8]*s[2];r[2*a]=(n[0]*s[0]+n[1]*s[1]+n[2]*s[2])/i,r[2*a+1]=(n[3]*s[0]+n[4]*s[1]+n[5]*s[2])/i}return r},e.prototype.transform=function(t,n){for(var r=new Float32Array(t.length/3*2),a=0;a<t.length/3;a++){var o=e.MatMultVec(this._R,new Float32Array([t[3*a],t[3*a+1],t[3*a+2]]));r[3*a+0]=o[0]+this._t[0],r[3*a+1]=o[1]+this._t[1],r[3*a+2]=o[2]+this._t[2]}return r},e}(),Ob=function(){function e(e){this.NB_BUFFERS=6,this._poses=[],this._nbFramesDelay=0,this._interpolation=0,this._filteringLevel=2,this._filterThreshold=-1,e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=this._nbFramesDelay:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS)}return e.prototype.setNbFramesDelay=function(e){this._nbFramesDelay=e},e.prototype.setInterpolation=function(e){this._interpolation=e},e.prototype.setFilteringLevel=function(e){this._filteringLevel=e},e.prototype.setFilterThreshold=function(e){this._filterThreshold=e},e.prototype.reset=function(){this._poses=[]},e.prototype.setPose=function(e){this._poses.length===this.NB_BUFFERS&&(this._poses=this._poses.slice(0,-1)),this._poses=o([e],this._poses,!0)},e.prototype.getPose=function(){return this._poses.length>0?this._nbFramesDelay<this._poses.length?this._poses[this._nbFramesDelay]:this._poses[this._poses.length-1]:null},e.prototype.getInterpolatedPoseAtDelay=function(e){if(e>0&&e+1<this._poses.length){var t=this._poses[e-1],n=this._poses[e],r=this._poses[e+1];if(t.getTrackingState()!==cb.Tracking||r.getTrackingState()!==cb.Tracking)return n;for(var a=Fb.getQuatFromRotMat(t.R()),o=Fb.getQuatFromRotMat(r.R()),s=Fb.slerp(a,o,.5),i=Fb.getRotMatFromQuat(s),u=t.t(),l=r.t(),c=new Float32Array(3),h=0;h<3;h++)c[h]=.5*u[h]+.5*l[h];var p=new Fb(i,c);return p.setTrackingState(n.getTrackingState()),p.type=n.type,p}return this._poses.length>0?this.getPose():this.getLastPose()},e.prototype.dst=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2]))},e.prototype.mvts=function(e,t,n){return(this.dst(e,t)+this.dst(t,n))/2},e.prototype.getInterpolatedPose=function(){if(1==this._filteringLevel)return this.getInterpolatedPoseAtDelay(this._nbFramesDelay);if(2==this._filteringLevel){var e=this.getInterpolatedPoseAtDelay(this._nbFramesDelay-1),t=this.getInterpolatedPoseAtDelay(this._nbFramesDelay+1);if(null==e||null==t)return this.getInterpolatedPoseAtDelay(this._nbFramesDelay);if(e.getTrackingState()!==cb.Tracking||t.getTrackingState()!==cb.Tracking)return this.getInterpolatedPoseAtDelay(this._nbFramesDelay);var n=this._poses[this._nbFramesDelay],r=e.t(),a=t.t();if(this._filterThreshold>0){var o=this.dst(r,n.t()),s=this.dst(a,n.t());if(o>this._filterThreshold||s>this._filterThreshold)return n}for(var i=Fb.getQuatFromRotMat(e.R()),u=Fb.getQuatFromRotMat(t.R()),l=Fb.slerp(i,u,this._interpolation),c=Fb.getRotMatFromQuat(l),h=new Float32Array(3),p=0;p<3;p++)h[p]=(1-this._interpolation)*r[p]+this._interpolation*a[p];var f=new Fb(c,h);return f.setTrackingState(n.getTrackingState()),f.type=n.type,f}return this.getLastPose()},e.prototype.updateDelay=function(e){e!=this._nbFramesDelay&&(e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=e:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS))},e.prototype.getLastPose=function(){return this._poses.length>0?this._poses[0]:null},e}();!function(e){e.Left="LEFT_FOOT",e.Right="RIGHT_FOOT",e.Both="BOTH_FOOT",e.Single="SINGLE_FOOT"}(Rb||(Rb={}));var Db,Mb=function(){function n(){this._initialized=!1,this._currentWidth=0,this._currentHeight=0,this._trackingState=cb.Detection,this._useWasmForHeatmaps=!0,this._useWasmForPose=!0,this._float_size=4,this._bufferHeatmaps=null,this._bufferKeypsDet=null,this._bufferFeatureScores=null,this._bufferInOutPose_L=null,this._bufferInOutPose_R=null,this._bufferSimToImage=null,this._bufferKeyps3D_R=null,this._bufferKeyps3D_L=null,this._footToDetect=Rb.Right,this._leftFootState=cb.Detection,this._rightFootState=cb.Detection,this._bufferKeypsTrack_L=null,this._bufferKeypsTrack_R=null,this._bufferHeatmaps_L=null,this._bufferHeatmaps_R=null,this._fastMovements_L=!1,this._fastMovements_R=!1,this._cnnOutputDataInvMask=null,this._debug=!1,this._debugInitialized=!1,this._reproj_t=15,this._reproj_fast_t=30,this._time_e=0,this._isDetected=!1}return n.prototype.getDebugImage=function(){return this._debugInitialized?this._debugImage:null},n.prototype.isDetected=function(){return this._isDetected},n.prototype.getPosition=function(e){void 0===e&&(e=Rb.Right);var t=null;return(t=e==Rb.Right?this._poseManager_R.getInterpolatedPose():this._poseManager_L.getInterpolatedPose())?t.getPosition():null},n.prototype.getRotation=function(e){void 0===e&&(e=Rb.Right);var t=null;return(t=e==Rb.Right?this._poseManager_R.getInterpolatedPose():this._poseManager_L.getInterpolatedPose())?t.getRotation():null},n.prototype.getPose=function(e){return void 0===e&&(e=Rb.Right),e==Rb.Right?this._pose_L:this._pose_R},n.prototype.getInterpolatedPose=function(e){return void 0===e&&(e=Rb.Right),e==Rb.Right?this._poseManager_R.getInterpolatedPose():this._poseManager_L.getInterpolatedPose()},n.prototype.isInitialized=function(){return this._initialized},n.prototype.initialize=function(n,r,o){return t(this,void 0,void 0,(function(){var t,s,i,u,l,c,h,p,f,d,m,g,y=this;return a(this,(function(a){switch(a.label){case 0:if(null==n)throw"Invalid parameter";return this.release(),this._videoManager=n,this._config=r?e(e({},fb),r):fb,"BOTH"!==this._config.footToDetect&&"BOTH_FEET"!==this._config.footToDetect||(this._footToDetect=Rb.Both),this._poseManager_R=new Ob(this._videoManager.getNbFramesDelay()),this._poseManager_R.setInterpolation(this._config.filteringShift),this._poseManager_R.setFilteringLevel(this._config.filteringLevel),this._poseManager_R.setFilterThreshold(.1),this._poseManager_L=new Ob(this._videoManager.getNbFramesDelay()),this._poseManager_L.setInterpolation(this._config.filteringShift),this._poseManager_L.setFilteringLevel(this._config.filteringLevel),this._poseManager_L.setFilterThreshold(.1),t=new ie(0),s=G(pb({locateFile:function(e,t){return y._config.poseEstimationWasmFilename||t+e}})).pipe((b=function(){return t.next(1)},function(e){return e.lift(new me(b,void 0,void 0))})),i=ab(this._config.modelFilename,"config.json"),u=i.model$,l=i.progress$,c=ab(this._config.featuresFilename,"config.json"),h=c.model$,p=c.progress$,f=function(e,t){var n=new ie(0),r=n.asObservable();if("string"==typeof e)return{model$:a=_y({url:e,method:"GET",responseType:"text",async:!0,progressSubscriber:new w((function(e){return n.next(e.loaded/e.total)}),(function(e){}),(function(){return n.next(1)}))}).pipe(ue(2),K((function(e){return $b(e.response,t)}))),progress$:r};var a=ye((function(){return n.next(1),H($b(function(e){var t,n,r="",a=0,o=new Uint8Array(e);for(a=0;a<o.length;a++)if(o[a]<128)r+=String.fromCharCode(o[a]);else{o[a]<224?(t=(63&o[a])<<6,n=a+1):o[a]<240?(t=(31&o[a])<<12,n=a+2):o[a]<248?(t=(15&o[a])<<18,n=a+3):o[a]<252?(t=(7&o[a])<<24,n=a+4):(t=(3&o[a])<<30,n=a+5);do{t|=(127&o[++a])<<6*(n-a)}while(a!=n);r+=String.fromCharCode(t)}return r}(e),t))}));return{model$:a,progress$:r}}(this._config.objFilename,!1),d=f.model$,m=f.progress$,g=V([t,l,p,m]).pipe(K((function(e){return e.reduce((function(t,n){return t+n/e.length}),0)})),K((function(e){return o&&o(e)}))).subscribe(),[4,ay({poseModule:s,model:u,features:h,footObjModel:d}).pipe(K((function(e){y._poseModule=e.poseModule,y._footObjModel=e.footObjModel,y._tfFootDetector=e.model.graphModel,y._footDetectorConfig=e.model.config,y._tfFootFeatures=e.features.graphModel,y._footFeaturesConfig=e.features.config,console.log("(DEBUG) XZIMG BACKEND",sr.backendName);var t=Di([1,y._footDetectorConfig.inHeight,y._footDetectorConfig.inWidth,3]),n=y._tfFootDetector.predict(t);y._footDetectorShape=n.shape,n.dispose(),t.dispose(),t=Di([1,y._footFeaturesConfig.inHeight,y._footFeaturesConfig.inWidth,3]),(n=y._tfFootFeatures.predict(t)).dispose(),t.dispose(),t=Di([2,y._footFeaturesConfig.inHeight,y._footFeaturesConfig.inWidth,3]),n=y._tfFootFeatures.predict(t),y._footFeaturesShape=n.shape,n.dispose(),t.dispose();var r=Math.max(y._footDetectorShape[1]*y._footDetectorShape[2]*y._footDetectorShape[3],y._footFeaturesShape[1]*y._footFeaturesShape[2]*y._footFeaturesShape[3]),a=Math.max(y._footDetectorShape[3],y._footFeaturesShape[3]),o=function(e,t){var n=[54,210,295,415,416,425,463,582,644,721,726,730,813];18==t&&(n=[54,210,295,406,415,416,417,423,425,463,518,582,644,657,721,726,730,813]);for(var r=n.length,a=new Array(3*r),o=0;o<r;o++){var s=n[o];a[3*o]=e[3*s],a[3*o+1]=e[3*s+1],a[3*o+2]=e[3*s+2]}var i=new Array(3*r);for(o=0;o<r;o++)i[3*o]=-a[3*o],i[3*o+1]=a[3*o+1],i[3*o+2]=a[3*o+2];return[a,i]}(y._footObjModel.vertices,y._footFeaturesShape[3]),s=o[0],i=o[1];null==y._bufferKeyps3D_R&&(y._bufferKeyps3D_R=y._poseModule._malloc(s.length*y._float_size),y._poseModule.HEAPF32.set(s,y._bufferKeyps3D_R/4)),null==y._bufferKeyps3D_L&&(y._bufferKeyps3D_L=y._poseModule._malloc(i.length*y._float_size),y._poseModule.HEAPF32.set(i,y._bufferKeyps3D_L/4)),y._bufferHeatmaps=y._poseModule._malloc(r*y._float_size),y._bufferHeatmaps_L=y._poseModule._malloc(r*y._float_size),y._bufferHeatmaps_R=y._poseModule._malloc(r*y._float_size),y._bufferKeypsDet=y._poseModule._malloc(2*y._footDetectorShape[3]*y._float_size),y._bufferKeypsTrack_L=y._poseModule._malloc(2*y._footFeaturesShape[3]*y._float_size),y._bufferKeypsTrack_R=y._poseModule._malloc(2*y._footFeaturesShape[3]*y._float_size),y._bufferFeatureScores=y._poseModule._malloc(a*y._float_size),y._bufferInOutPose_L=y._poseModule._malloc(18*y._float_size),y._bufferInOutPose_R=y._poseModule._malloc(18*y._float_size),y._bufferSimToImage=y._poseModule._malloc(8*y._float_size),y._initialized=!0})),Z((function(){return g.unsubscribe()}))).toPromise()];case 1:return a.sent(),[2]}var b}))}))},n.prototype.release=function(){this._initialized&&(this._poseModule._free(this._bufferHeatmaps),this._poseModule._free(this._bufferHeatmaps_L),this._poseModule._free(this._bufferHeatmaps_R),this._poseModule._free(this._bufferKeypsDet),this._poseModule._free(this._bufferKeypsTrack_L),this._poseModule._free(this._bufferKeypsTrack_R),this._poseModule._free(this._bufferFeatureScores),this._poseModule._free(this._bufferInOutPose_L),this._poseModule._free(this._bufferInOutPose_R),this._poseModule._free(this._bufferSimToImage),this._poseModule._free(this._bufferKeyps3D_R),this._poseModule._free(this._bufferKeyps3D_L),this._hptrImageBuffer&&this._poseModule._free(this._hptrImageBuffer))},n.prototype.trackSync=function(e){var t;if(this._initialized){var n=this._videoManager.getVideoCanvas();n.width===this._currentWidth&&n.height===this._currentHeight||(this._currentWidth=n.width,this._currentHeight=n.height,t=Fb.getCameraParams(this._config.fovY,this._currentWidth,this._currentHeight),this._fx=t[0],this._fy=t[1],this._cx=t[2],this._cy=t[3],this._poseModule.cwrap("xzimgInitializeCamera","number",["number","number","number"])(this._config.fovY,this._currentWidth,this._currentHeight)),this._poseManager_L.setNbFramesDelay(this._videoManager.getNbFramesDelay()),this._poseManager_R.setNbFramesDelay(this._videoManager.getNbFramesDelay());var r=e;null==e&&(r=this._videoManager.getLastBuffer()),null!=r?this._footToDetect===Rb.Left||this._footToDetect===Rb.Right?this.trackSingleFootSync(r):(this.trackBothFeetSync(r),performance.now()):console.error("No video frame to process")}else console.error("Foot must be initialized to track")},n.prototype.trackSingleFootSync=function(e){var t=-1;if(this._trackingState===cb.Detection){var n=this.detectFeetSync(e),r=n.refinedFeatures,a=n.scores;this._initShape=r;var o=gb(a,"LEFT_FOOT"),s=gb(a,"RIGHT_FOOT");s>o&&s>=this._config.detection_score_t?(this._footToDetect=Rb.Right,this.computePose(this._trackingState,this._footToDetect),this._trackingState=cb.Detected):o>=this._config.detection_score_t&&(this._footToDetect=Rb.Left,this.computePose(this._trackingState,this._footToDetect),this._trackingState=cb.Detected)}else{var i;i=this._trackingState==cb.Detected?this._initShape:this._footToDetect==Rb.Right?this._rightFootRecShape:this._leftFootRecShape;var u=this.detectFootFeaturesSync(e,this._trackingState,i,this._footToDetect);this._footToDetect==Rb.Right?this._rightFootRecShape=u.refinedFeatures:this._leftFootRecShape=u.refinedFeatures,gb(u.scores,this._footToDetect)>=this._config.tracking_score_t?(t=this.computePose(this._trackingState,this._footToDetect),this._trackingState=cb.Tracking,t>this._reproj_t&&(this._trackingState=cb.Detection)):this._trackingState=cb.Detection}this._isDetected=this._trackingState===cb.Tracking,this._trackingState===cb.Detection&&(this._pose_R=new Fb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0])),this._pose_L=new Fb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0])),this._pose_L.setTrackingState(cb.Detection),this._pose_R.setTrackingState(cb.Detection),this._pose_R.type=0,this._pose_L.type=1),this._footToDetect==Rb.Right?(this._pose_R.setTrackingState(this._trackingState),this._poseManager_R.setPose(this._pose_R)):this._footToDetect==Rb.Left&&(this._pose_L.setTrackingState(this._trackingState),this._poseManager_L.setPose(this._pose_L))},n.prototype.trackBothFeetSync=function(e){var t=-1;if(this._rightFootState!=cb.Detection&&this._leftFootState!=cb.Detection){var n=this.detectBothFeetFeaturesSync(e,this._leftFootState,this._rightFootState,this._leftFootState==cb.Detected?this._initShape:this._leftFootRecShape,this._rightFootState==cb.Detected?this._initShape:this._rightFootRecShape),r=gb(n.scores_R,"RIGHT_FOOT");this._rightFootRecShape=n.refinedFeatures_R;var a=gb(n.scores_L,"LEFT_FOOT");this._leftFootRecShape=n.refinedFeatures_L;var o=this._config.tracking_score_t;this._fastMovements_R&&(o=.1);var s=this._reproj_t;this._fastMovements_R&&(s=this._reproj_fast_t),r>=o?(t=this.computePose(this._rightFootState,"RIGHT_FOOT"),this._rightFootState=cb.Tracking,t>s&&(this._rightFootState=cb.Detection)):this._rightFootState=cb.Detection,o=this._config.tracking_score_t,this._fastMovements_L&&(o=.1),s=this._reproj_t,this._fastMovements_L&&(s=this._reproj_fast_t),a>=o?(t=this.computePose(this._leftFootState,"LEFT_FOOT"),this._leftFootState=cb.Tracking,t>s&&(this._leftFootState=cb.Detection)):this._leftFootState=cb.Detection}else if(this._rightFootState!==cb.Detection&&this._leftFootState===cb.Detection){var i=this.detectFootFeaturesSync(e,this._rightFootState,this._rightFootState==cb.Detected?this._initShape:this._rightFootRecShape,"RIGHT_FOOT");this._rightFootRecShape=i.refinedFeatures,r=gb(i.scores,"RIGHT_FOOT"),o=this._config.tracking_score_t,this._fastMovements_R&&(o=.1),s=this._reproj_t,this._fastMovements_R&&(s=this._reproj_fast_t),r>=o?(t=this.computePose(this._rightFootState,"RIGHT_FOOT"),this._rightFootState=cb.Tracking,t>s&&(this._rightFootState=cb.Detection)):this._rightFootState=cb.Detection,i=this.detectFeetSync(e),this._initShape=i.refinedFeatures,a=gb(i.scores,"LEFT_FOOT"),r=gb(i.scores,"RIGHT_FOOT");var u=!1;if(!this._fastMovements_R&&null!=this._cnnOutputDataInvMask){var l=Ab(this._cnnOutputDataInvMask,this._footDetectorShape[1],this._footDetectorShape[2],this._footDetectorShape[3],!1);l[0];var c=gb(f=l[1],"LEFT_FOOT"),h=gb(f,"RIGHT_FOOT");r>a&&r>h+.1&&c>h&&(u=!0)}u&&r>this._config.detection_score_t?(this.invertFoot(),this.computePose(this._rightFootState,"RIGHT_FOOT"),this._rightFootRecShape=i.refinedFeatures,this._rightFootState=cb.Detected):a>=this._config.detection_score_t&&(this.computePose(this._leftFootState,"LEFT_FOOT"),this._leftFootRecShape=i.refinedFeatures,this._leftFootState=cb.Detected)}else if(this._leftFootState!==cb.Detection&&this._rightFootState===cb.Detection){var p=this.detectFootFeaturesSync(e,this._leftFootState,this._leftFootState==cb.Detected?this._initShape:this._leftFootRecShape,"LEFT_FOOT");if(this._leftFootRecShape=p.refinedFeatures,a=gb(p.scores,"LEFT_FOOT"),o=this._config.tracking_score_t,this._fastMovements_L&&(o=.1),s=this._reproj_t,this._fastMovements_L&&(s=this._reproj_fast_t),a>=o?(t=this.computePose(this._leftFootState,"LEFT_FOOT"),this._leftFootState=cb.Tracking,t>s&&(this._leftFootState=cb.Detection)):this._leftFootState=cb.Detection,p=this.detectFeetSync(e),this._initShape=p.refinedFeatures,r=gb(p.scores,"RIGHT_FOOT"),a=gb(p.scores,"LEFT_FOOT"),u=!1,!this._fastMovements_L&&null!=this._cnnOutputDataInvMask){var f,d=Ab(this._cnnOutputDataInvMask,this._footDetectorShape[1],this._footDetectorShape[2],this._footDetectorShape[3],!1);d[0],c=gb(f=d[1],"LEFT_FOOT"),h=gb(f,"RIGHT_FOOT"),a>r&&a>c+.1&&h>c&&(u=!0)}u&&a>this._config.detection_score_t?(this.invertFoot(),this.computePose(this._leftFootState,"LEFT_FOOT"),this._leftFootRecShape=p.refinedFeatures,this._leftFootState=cb.Detected):r>=this._config.detection_score_t&&(this.computePose(this._rightFootState,"RIGHT_FOOT"),this._rightFootRecShape=p.refinedFeatures,this._rightFootState=cb.Detected)}else if(this._leftFootState===cb.Detection||this._rightFootState===cb.Detection){this._fastMovements_L=!0,this._fastMovements_R=!0;var m=this._poseModule.cwrap("xzimgMatchRecKeypsInit","number",["number"]);null==this._hptrImageBuffer&&(this._hptrImageBuffer=this._poseModule._malloc(e.width*e.height*4)),Eb(this._poseModule,e,this._hptrImageBuffer);var g=Sb(this._poseModule,this._hptrImageBuffer,e.width,e.height);m(g),this._poseModule._free(g);var y=this.detectFeetSync(e);this._initShape=y.refinedFeatures;var b=gb(y.scores,"LEFT_FOOT"),v=gb(y.scores,"RIGHT_FOOT");b>=this._config.detection_score_t&&(this.computePose(this._trackingState,"LEFT_FOOT"),this._leftFootState=cb.Detected),v>=this._config.detection_score_t&&(this.computePose(this._trackingState,"RIGHT_FOOT"),this._rightFootState=cb.Detected),this._rightFootState!=cb.Detection&&this._leftFootState!=cb.Detection&&this.bothFeetSamePlaceInit()&&(this._rightFootState==cb.Detected?this._rightFootState=cb.Detection:this._leftFootState=cb.Detection)}this._leftFootState===cb.Detection&&(this._pose_L=new Fb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0]))),this._rightFootState==cb.Detection&&(this._pose_R=new Fb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0]))),this._pose_R.setTrackingState(this._rightFootState),this._pose_R.type=0,this._poseManager_R.setPose(this._pose_R),this._pose_L.setTrackingState(this._leftFootState),this._pose_L.type=1,this._poseManager_L.setPose(this._pose_L)},n.prototype.detectFeetSync=function(e){var t,n,r,a,o=function(e,t){var n,r;return{crop:e>t?[(r=0)/t,(n=(e-t)/2)/e,1,(e-n)/e]:[(r=(t-e)/2)/t,(n=0)/e,(t-r)/t,1],deltaY:r,deltaX:n}}(this._currentWidth,this._currentHeight),s=o.crop,i=o.deltaY,u=o.deltaX,l=uo(e),c=Ka(l,"float32"),h=rs(c,[1,this._currentHeight,this._currentWidth,3]),p=Cl.cropAndResize(h,[s],[0],[this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth]),f=Xs(255),d=Ao(p,f),m=null;if(this._footToDetect==Rb.Both&&(this._leftFootState===cb.Tracking||this._rightFootState===cb.Tracking)){var g=function(e,t,n,r,a,o,s,i){for(var u=e.length/2,l=new Float32Array(2*u),c=0;c<u;c++)l[c]=(e[c]-a)/s,l[c+u]=(e[c+u]-r)/o;for(var h=db(l,i),p=h[0],f=h[1],d=h[2]-p,m=h[3]-f,g=h[6]-p,y=h[7]-f,b=d*d+m*m,v=g*g+y*y,x=new Float32Array(n*t),w=0;w<t;w++)for(var _=0;_<n;_++){var T=_-p,E=w-f,S=T*d+E*m,I=T*g+E*y;S>0&&I>0&&S<b&&I<v||(x[w*n+_]=1)}return x}(this._leftFootState===cb.Tracking?this._leftFootRecShape:this._rightFootRecShape,this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth,i,u,(this._currentHeight-2*i)/this._footDetectorConfig.inWidth,(this._currentWidth-2*u)/this._footDetectorConfig.inHeight,this._leftFootState===cb.Tracking?"LEFT_FOOT":"RIGHT_FOOT");this._debug&&(this._debugInitialized=!0,this._debugImage=function(e,t,n){for(var r=new Uint8ClampedArray(e*t*4),a=e*t,o=0;o<a;o++){var s=n[o],i=4*o;r[i+0]=Math.round(255*s),r[i+1]=Math.round(255*s),r[i+2]=Math.round(255*s),r[i+3]=255}return new ImageData(r,t,e)}(this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth,g));var y=Nu(g,"float32");m=rs(y,[1,this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth,1]),y.dispose()}var b=this._tfFootDetector.predict(d);if(null!=m){var v=_i(1,m),x=$o(b,v);this._cnnOutputDataInvMask=x.dataSync(),v.dispose(),x.dispose();var w=$o(b,m);b.dispose(),b=w,m.dispose()}var _,T,E=null!==(n=null==b?void 0:b.shape[3])&&void 0!==n?n:this._footDetectorConfig.outChannels,S=null!==(r=null==b?void 0:b.shape[1])&&void 0!==r?r:this._footDetectorConfig.outHeight,I=null!==(a=null==b?void 0:b.shape[2])&&void 0!==a?a:this._footDetectorConfig.outWidth,k=b.dataSync();_=(t=Ab(k,S,I,E))[0],T=t[1];var C=this._bufferKeypsDet/4;this._poseModule.HEAPF32.subarray(C,C+2*E).set(_),this._debug&&(this._debugInitialized=!0,this._debugImage=function(e,t,n,r){for(var a=new Uint8ClampedArray(e*t*4),o=e*t,s=0;s<o;s++){for(var i=s*n,u=r[i],l=1;l<n;l++){var c=r[i+l];u=Math.max(u,c)}var h=4*s;a[h+0]=Math.round(255*(1-u)),a[h+1]=Math.round(255*(1-u)),a[h+2]=Math.round(255*(1-u)),a[h+3]=255}return new ImageData(a,t,e)}(b.shape[1],b.shape[2],b.shape[3],k)),l.dispose(),c.dispose(),f.dispose(),p.dispose(),d.dispose(),h.dispose(),b.dispose();var N=Math.min(this._currentWidth,this._currentHeight),A=N/this._footDetectorConfig.inWidth,$=N/this._footDetectorConfig.inHeight;return this._simToImage_Det=function(e,t,n,r){var a=new Float32Array(6);return a[0]=r,a[1]=0,a[2]=t,a[3]=0,a[4]=n,a[5]=e,a}(i,u,$,A),{refinedFeatures:yb(_,this._simToImage_Det,!1,b.shape[1]),scores:T}},n.prototype.detectFootFeaturesSync=function(e,t,n,r){var a,o,s,i,u,l,c,h,p,f,d="LEFT_FOOT"==r?this._simToImage_L:this._simToImage_R;t!=cb.Detected?(p=(a=Ib(this._poseModule,e,this._hptrImageBuffer,n))[0],f=a[1],Math.sqrt(f[2]*f[2]+f[3]*f[3])>10?"LEFT_FOOT"==r?this._fastMovements_L=!0:this._fastMovements_R=!0:"LEFT_FOOT"==r?this._fastMovements_L=!1:this._fastMovements_R=!1,"LEFT_FOOT"==r?Cb(this._poseModule,this._bufferInOutPose_L,f,this._fx,this._fy):"RIGHT_FOOT"==r&&Cb(this._poseModule,this._bufferInOutPose_R,f,this._fx,this._fy)):p=n,d=wb(p,this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,t==cb.Detected?null:d,r);var m=new ImageData(this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight);m=xb(e,m,d);var g=uo(m),y=Ka(g,"float32"),b=rs(y,[1,this._footFeaturesConfig.inHeight,this._footFeaturesConfig.inWidth,3]),v=Xs(255),x=Ao(b,v),w=null;w="LEFT_FOOT"==r?cu(x,1):x;var _,T,E=this._tfFootFeatures.predict(w),S=E.dataSync();if(this._useWasmForHeatmaps){var I=this._poseModule.cwrap("xzimgGetHeatmapsLocations","number",["number","number","number","number","number","number","number","number"]),k=(N=null!==(s=null==E?void 0:E.shape[3])&&void 0!==s?s:this._footFeaturesConfig.outChannels)*(A=null!==(i=null==E?void 0:E.shape[1])&&void 0!==i?i:this._footFeaturesConfig.outHeight)*($=null!==(u=null==E?void 0:E.shape[2])&&void 0!==u?u:this._footFeaturesConfig.outWidth),C="LEFT_FOOT"==r?this._bufferHeatmaps_L/4:this._bufferHeatmaps_R/4;this._poseModule.HEAPF32.subarray(C,C+k).set(S),I("LEFT_FOOT"==r?this._bufferHeatmaps_L:this._bufferHeatmaps_R,A,$,N,0,2,"LEFT_FOOT"==r?this._bufferKeypsTrack_L:this._bufferKeypsTrack_R,this._bufferFeatureScores),T=new Float32Array(this._poseModule.HEAPF32.buffer,"LEFT_FOOT"==r?this._bufferKeypsTrack_L:this._bufferKeypsTrack_R,2*N),_=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferFeatureScores,N)}else{var N,A,$,R=(N=null!==(l=null==E?void 0:E.shape[3])&&void 0!==l?l:this._footFeaturesConfig.outChannels)*(A=null!==(c=null==E?void 0:E.shape[1])&&void 0!==c?c:this._footFeaturesConfig.outHeight)*($=null!==(h=null==E?void 0:E.shape[2])&&void 0!==h?h:this._footFeaturesConfig.outWidth);T=(o=Ab(S,A,$,N))[0],_=o[1],C="LEFT_FOOT"==r?this._bufferKeypsTrack_L/4:this._bufferKeypsTrack_R/4,this._poseModule.HEAPF32.subarray(C,C+2*N).set(T),C="LEFT_FOOT"==r?this._bufferHeatmaps_L/4:this._bufferHeatmaps_R/4,this._poseModule.HEAPF32.subarray(C,C+R).set(S)}g.dispose(),y.dispose(),v.dispose(),x.dispose(),b.dispose(),E.dispose(),"LEFT_FOOT"==r&&w.dispose();var F=yb(T,d,"LEFT_FOOT"==r,E.shape[1]);return"LEFT_FOOT"==r?this._simToImage_L=d:this._simToImage_R=d,{refinedFeatures:F,scores:_}},n.prototype.detectBothFeetFeaturesSync=function(e,t,n,r,a){var o,s,i,u,l,c,h,p;if(t!=cb.Detected&&n!=cb.Detected){var f=Ib(this._poseModule,e,this._hptrImageBuffer,function(e,t){for(var n=e.length/2,r=t.length/2,a=n+r,o=new Float32Array(e.length+t.length),s=0;s<n;s++)o[s]=e[s],o[s+a]=e[s+n];for(s=0;s<r;s++)o[s+n]=t[s],o[s+a+n]=t[s+r];return o}(r,a)),d=f[0];f[1];var m=f[2];o=function(e,t,n){var r=new Float32Array(2*t),a=new Float32Array(2*n),o=e.length/2;t+n!=o&&console.log("ERROR (separateShapes): shapes not correct dims");for(var s=0;s<t;s++)r[s]=e[s],r[s+t]=e[s+o];for(s=0;s<n;s++)a[s]=e[s+t],a[s+n]=e[s+o+t];return[r,a]}(d,r.length/2,a.length/2),h=o[0],p=o[1];var g=m.slice(0,r.length/2),y=m.slice(r.length/2,r.length),b=kb(this._poseModule,r,h),v=kb(this._poseModule,a,p);Math.sqrt(b[2]*b[2]+b[3]*b[3])>10?this._fastMovements_L=!0:this._fastMovements_L=!1,Math.sqrt(v[2]*v[2]+v[3]*v[3])>10?this._fastMovements_R=!0:this._fastMovements_R=!1,Nb(this._poseModule,this._bufferInOutPose_L,r,h,g,this._fx,this._fy),Nb(this._poseModule,this._bufferInOutPose_R,a,p,y,this._fx,this._fy)}else h=r,p=a;this._simToImage_L=wb(h,this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,t==cb.Detected?null:this._simToImage_L,"LEFT_FOOT");var x=new ImageData(this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight);x=xb(e,x,this._simToImage_L),this._simToImage_R=wb(p,this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,n==cb.Detected?null:this._simToImage_R,"RIGHT_FOOT");var w=new ImageData(this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight);w=xb(e,w,this._simToImage_R);var _=uo(x),T=Ka(_,"float32"),E=rs(T,[1,this._footFeaturesConfig.inHeight,this._footFeaturesConfig.inWidth,3]),S=Xs(255),I=Ao(E,S),k=cu(I,1);_=uo(w),T=Ka(_,"float32"),E=rs(T,[1,this._footFeaturesConfig.inHeight,this._footFeaturesConfig.inWidth,3]);var C,N,A,$,R=Ao(E,S),F=is([k,R]),O=this._tfFootFeatures.predict(F),D=Ou(O,0),M=D[0].dataSync(),L=D[1].dataSync(),P=null!==(u=null==O?void 0:O.shape[3])&&void 0!==u?u:this._footFeaturesConfig.outChannels,B=null!==(l=null==O?void 0:O.shape[1])&&void 0!==l?l:this._footFeaturesConfig.outHeight,U=null!==(c=null==O?void 0:O.shape[2])&&void 0!==c?c:this._footFeaturesConfig.outWidth,z=P*B*U,V=M,W=L;C=(s=Ab(V,B,U,P,!1))[0],A=s[1],N=(i=Ab(W,B,U,P,!1))[0],$=i[1];var j=this._bufferKeypsTrack_L/4,G=this._poseModule.HEAPF32.subarray(j,j+2*P);return G.set(C),j=this._bufferKeypsTrack_R/4,(G=this._poseModule.HEAPF32.subarray(j,j+2*P)).set(N),j=this._bufferHeatmaps_L/4,(G=this._poseModule.HEAPF32.subarray(j,j+z)).set(V),j=this._bufferHeatmaps_R/4,(G=this._poseModule.HEAPF32.subarray(j,j+z)).set(W),_.dispose(),T.dispose(),S.dispose(),I.dispose(),k.dispose(),R.dispose(),E.dispose(),O.dispose(),D.forEach((function(e){return e.dispose()})),F.dispose(),{refinedFeatures_L:yb(C,this._simToImage_L,!0,O.shape[1]),refinedFeatures_R:yb(N,this._simToImage_R,!1,O.shape[1]),scores_L:A,scores_R:$}},n.prototype.computePose=function(e,t){var n=-1,r=null;if(this._useWasmForPose&&(r=this._poseModule.cwrap("xzimgEstimateRigidPose","number",["number","number","number","number","number","number","number","number","number","number","number","number"])),e==cb.Detection){var a=function(e,t){var n,r,a,o,s,i=e.length/2;o=(n=vb(e,t))[0],a=n[1],s=n[2];var u=null;if(6==i&&"RIGHT_FOOT"==t)u=[e[3],e[4],e[5],e[3+i],e[4+i],e[5+i]];else{if(6!=i||"LEFT_FOOT"!=t)return console.error("missing case"),null;u=[e[0],e[1],e[2],e[0+i],e[1+i],e[2+i]]}return r=mb(u,3),[o,a,Math.sqrt((r[1]-r[0])*(r[1]-r[0])+(r[3]-r[2])*(r[3]-r[2])),s]}(this._initShape,t),o=a[0],s=a[1],i=a[2],u=function(e,t,n,r,a,o,s){var i,u,l,c=new Float32Array([1,0,0,0,-1,0,0,0,-1]),h=Math.cos(e+Math.PI/2),p=Math.sin(e+Math.PI/2),f=(a+o)/2*2.4/t;return[(i=new Float32Array([h,-p,0,p,h,0,0,0,1]),u=c,(l=new Float32Array(9))[0]=i[0]*u[0]+i[1]*u[3]+i[2]*u[6],l[1]=i[0]*u[1]+i[1]*u[4]+i[2]*u[7],l[2]=i[0]*u[2]+i[1]*u[5]+i[2]*u[8],l[3]=i[3]*u[0]+i[4]*u[3]+i[5]*u[6],l[4]=i[3]*u[1]+i[4]*u[4]+i[5]*u[7],l[5]=i[3]*u[2]+i[4]*u[5]+i[5]*u[8],l[6]=i[6]*u[0]+i[7]*u[3]+i[8]*u[6],l[7]=i[6]*u[1]+i[7]*u[4]+i[8]*u[7],l[8]=i[6]*u[2]+i[7]*u[5]+i[8]*u[8],l),new Float32Array([f*n/a,f*r/o,f])]}(a[3],i,o-this._cx,s-this._cy,this._fx,this._fy),l=u[0],c=u[1];"LEFT_FOOT"==t?this._pose_L=new Fb(l,c):"RIGHT_FOOT"==t&&(this._pose_R=new Fb(l,c));var h=(d="LEFT_FOOT"==t?this._bufferInOutPose_L:this._bufferInOutPose_R)/4;return(m=this._poseModule.HEAPF32.subarray(h,h+9)).set(l),(m=this._poseModule.HEAPF32.subarray(h+9,h+12)).set(c),-1}if(e==cb.Detected||e==cb.Tracking){if(this._useWasmForPose){var p=1;e==cb.Detected&&(p=0);var f=3;"LEFT_FOOT"!=t||this._fastMovements_L||(f=1),"RIGHT_FOOT"!=t||this._fastMovements_R||(f=1);var d="LEFT_FOOT"==t?this._bufferInOutPose_L:this._bufferInOutPose_R,m=(h=this._bufferSimToImage/4,this._poseModule.HEAPF32.subarray(h,h+8)),g="LEFT_FOOT"==t?this._simToImage_L:this._simToImage_R,y=Float32Array.from(g);"LEFT_FOOT"==t&&(y[2]+=y[1]*(this._footFeaturesShape[1]-1),y[5]+=y[4]*(this._footFeaturesShape[1]-1),y[1]=-y[1],y[4]=-y[4]),m.set(y),-1==(n=r("LEFT_FOOT"==t?this._bufferHeatmaps_L:this._bufferHeatmaps_R,this._footFeaturesShape[1],this._footFeaturesShape[2],this._footFeaturesShape[3],0,this._bufferSimToImage,null,"LEFT_FOOT"==t?this._bufferKeyps3D_L:this._bufferKeyps3D_R,p,3,f,d))&&(n=1e4),"LEFT_FOOT"==t?this._pose_L=new Fb(new Float32Array(this._poseModule.HEAPF32.buffer,d,9),new Float32Array(this._poseModule.HEAPF32.buffer,d+9*this._float_size,3)):this._pose_R=new Fb(new Float32Array(this._poseModule.HEAPF32.buffer,d,9),new Float32Array(this._poseModule.HEAPF32.buffer,d+9*this._float_size,3))}return n}return-1},n.prototype.invertFoot=function(){var e,t,n,r,a,o,s;e=[this._rightFootRecShape,this._leftFootRecShape],this._rightFootRecShape=e[0],this._rightFootRecShape=e[1],t=[this._bufferInOutPose_R,this._bufferInOutPose_L],this._bufferInOutPose_L=t[0],this._bufferInOutPose_R=t[1],n=[this._pose_L,this._pose_R],this._pose_R=n[0],this._pose_L=n[1],r=[this._poseManager_L,this._poseManager_R],this._poseManager_R=r[0],this._poseManager_L=r[1],a=[this._simToImage_R,this._simToImage_L],this._simToImage_L=a[0],this._simToImage_R=a[1],o=[this._rightFootState,this._leftFootState],this._leftFootState=o[0],this._rightFootState=o[1],s=[this._bufferHeatmaps_L,this._bufferHeatmaps_R],this._bufferHeatmaps_R=s[0],this._bufferHeatmaps_L=s[1]},n.prototype.dst=function(e,t,n,r){return Math.sqrt((e-n)*(e-n)+(t-r)*(t-r))},n.prototype.bothFeetSamePlaceInit=function(){var e=this._initShape.length/2,t=0;return t+=this.dst(this._initShape[0],this._initShape[e],this._initShape[4],this._initShape[4+e]),t+=this.dst(this._initShape[1],this._initShape[1+e],this._initShape[3],this._initShape[3+e]),(t+=this.dst(this._initShape[2],this._initShape[2+e],this._initShape[5],this._initShape[5+e]))/3<this.dst(this._initShape[0],this._initShape[e],this._initShape[2],this._initShape[2+e])/5},n.prototype.bothFeetSamePlace=function(){var e=db(this._leftFootRecShape,"LEFT_FOOT"),t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],s=e[5],i=e[6],u=e[7],l=db(this._rightFootRecShape,"RIGHT_FOOT"),c=l[0],h=l[1],p=l[2],f=l[3],d=l[4],m=l[5],g=l[6],y=l[7],b=this.dst(t,n,i,u)/4;return this.dst(t,n,c,h)<b&&this.dst(r,a,p,f)<b&&this.dst(o,s,d,m)<b&&this.dst(i,u,g,y)<b},n}(),Lb=(Db="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,r;e=e||{},t||(t=void 0!==e?e:{}),t.ready=new Promise((function(e,t){n=e,r=t}));let a=null;var o=null,s=null,i=null,u=null,l=!1,c=null,h=[];t.preinitializedWebGLContext=t.canvas.getContext("webgl",{alpha:!1}),t.process=function(){};let p=new class{get Fh(){switch(this.type){case"Timer":return this.Bh;case"RAF":return this.th;case"Oscillator":return this.oh}}constructor(){this.oh=this.th=this.Bh=!1,this.type="RAF",this.Mh=1e3/33}add(e){this.Ch=e}start(){switch(this.type){case"Timer":if(!this.Bh){this.Bh=!0;const e=()=>{setTimeout((()=>{this.Ch&&this.Ch(),this.Bh&&e()}),this.Mh)};e()}break;case"RAF":if(!this.th){this.th=!0;const e=t=>{requestAnimationFrame((n=>{n-t<=this.Mh?this.th&&e(t):this.Ch&&(this.Ch(),e(n))}))};e(performance.now())}break;case"Oscillator":if(!this.oh){a=a||new AudioContext,this.oh=!0;const e=a.createGain();let t;e.gain.value=0,e.connect(a.destination);const n=()=>{this.Ch&&this.Ch(),t&&t.disconnect(),this.Rh=t=a.createOscillator(),t.connect(e),this.oh&&(t.onended=n,t.start(),t.stop(a.currentTime+this.Mh/1e3))};n()}}}stop(){switch(this.type){case"Timer":this.Bh=!1;break;case"RAF":this.th=!1;break;case"Oscillator":this.oh=!1,this.Rh&&(this.Rh.onended=null,this.Rh=void 0)}}};t.setFps=function(e){p.Mh=1e3/e},p.add((function(){var e=t.video,n=t.context;const r=t.ji;e&&n&&r&&e.readyState===e.HAVE_ENOUGH_DATA&&(e=t.canvas.width,n=t.canvas.height,t.canvasWidth===e&&t.canvasHeight===n||(t.canvasWidth=e,t.canvasHeight=n,Br(e,n)),t._processFrameVideo(0,t.video.videoWidth,t.video.videoHeight,t.di),t._render())})),t.startLoop=function(){p.start()},t.endLoop=function(){p.stop()},t.takeScreenshot=function(){Pr(),p.Fh||t._render()},t.startVideoRecording=function(){if(l)throw"Video recording already started!";l=!0,null==c&&((c=new MediaRecorder(t.canvas.captureStream())).ondataavailable=function(e){h.push(e.data)}),c.start()},t.finishVideoRecording=function(e){if(!l)throw"Video recording not started!";c.onstop=function(){e(new Blob(h,{type:"video/mp4"})),h=[],l=!1},c.stop()},t.processFrameRawPixels=function(e,n,r,a){var o=t._malloc(e.length);o&&(t.HEAPU8.set(e,o),t._processFrameRawPixels(o,n,r,a),p.Fh||t._render(),t._free(o))},t.setFaceTrackingModel=function(e){t.faceTrackingModelByteArray=e},t.switchEffectByteArray=function(e,n,r){if(s){var a=t._malloc(r.length);a&&(t.HEAPU8.set(r,a),s(n,a,r.length,e),p.Fh||t._render())}},t.switchEffect=function(e,n,r,a){var o=new XMLHttpRequest;o.open("GET",r,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var r=new Uint8Array(o.response);t.switchEffectByteArray(e,n,r),a&&a()}},o.send(null)},t.clearEffect=function(e){i&&(i(e),p.Fh||t._render())},t.moveGameObject=function(e,n){u&&(u(e,n),p.Fh||t._render())},t.setMirror=function(e){t.di=!!e},t.startVideo=function(e,n){if(t.video)console.log("video already running");else{t.mi=!1,t.tj=n,t.di=!!e;var r=document.createElement("video");r.muted=!0,r.loop=!0,r.controls=!0,r.setAttribute("playsinline","playsinline"),r.style.width="100%",r.style.height="100%",(e=document.createElement("div")).appendChild(r),e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style["z-index"]="-1",document.body.appendChild(e),t.ai=e,ar=t.video=r,e=t.tj||!0,t.Ei(),navigator.mediaDevices.getUserMedia({video:e}).then((function(e){try{r.srcObject=e}catch(t){r.src=URL.createObjectURL(e)}t.Gi(),setTimeout((function(){r.play()}),50)})).catch((function(){t.Fi()})),r.addEventListener("loadedmetadata",(function(){var e=document.createElement("canvas"),n=e.getContext("2d");t.ji=e,t.context=n,n=320/r.videoWidth,e.width=Math.floor(r.videoWidth*n),e.height=Math.floor(r.videoHeight*n),t.Uh=t._malloc(e.width*e.height*4),t.Oi()}))}},t.shutdown=function(){t.stopVideo(),Lr(),t.Ni()},t.setVideoElement=function(e,n){function r(){var n=document.createElement("canvas"),a=n.getContext("2d");t.ji=n,t.context=a,a=320/e.videoWidth,n.width=Math.floor(e.videoWidth*a),n.height=Math.floor(e.videoHeight*a),t.Uh=t._malloc(n.width*n.height*4),e.removeEventListener("loadedmetadata",r)}t.di=!!n,t.mi=!0,ar=t.video=e,e.readyState===e.HAVE_ENOUGH_DATA?r():e.addEventListener("loadedmetadata",r)},t.stopVideo=function(){if(t.ai&&(t.ai.parentNode.removeChild(t.ai),t.ai=null),t.video){if(!t.mi){var e=t.video.srcObject.getVideoTracks();e&&0<e.length&&e[0].stop(),t.video.pause()}ar=t.video=null}t.ji=null,t.Uh&&t._free(t.Uh),t.Uh=0,t.context=null},t.touchOccurred=function(e){Ur(e.x,e.y,e.type)},t.setOffscreenRenderingEnabled=function(e){!function(e){var t=p;if(t.type!==e){var n=t.Bh|t.oh|t.th;t.stop(),t.type=e,n&&t.start()}}(e?"Oscillator":"RAF")},t.Ii=function(e,n,r,a){if(t.apiObject.onFaceTracked){for(var o=[],s=0;s<a;s++){var i={detected:!1,translation:[],rotation:[],poseMatrix:[],landmarks:[],landmarks2d:[],faceRect:[]},u=n+s*r,l=u+e.translationOffset,c=u+e.rotationOffset,h=u+e.poseMatrixOffset,p=u+e.landmarksOffset,f=u+e.landmarks2DOffset,d=u+e.faceRectOffset;for(i.detected=!!t.HEAP32[u/Float32Array.BYTES_PER_ELEMENT],u=0;3>u;u++)i.translation.push(t.HEAPF32[l/Float32Array.BYTES_PER_ELEMENT+u]),i.rotation.push(t.HEAPF32[c/Float32Array.BYTES_PER_ELEMENT+u]);for(u=0;16>u;u++)i.poseMatrix.push(t.HEAPF32[h/Float32Array.BYTES_PER_ELEMENT+u]);for(u=0;204>u;u++)i.landmarks.push(t.HEAPF32[p/Float32Array.BYTES_PER_ELEMENT+u]),136>u&&i.landmarks2d.push(t.HEAPF32[f/Float32Array.BYTES_PER_ELEMENT+u]);for(u=0;4>u;u++)i.faceRect.push(t.HEAPF32[d/Float32Array.BYTES_PER_ELEMENT+u]);o.push(i)}t.apiObject.onFaceTracked(o)}},t.Oi=function(){t.apiObject.onVideoStarted&&t.apiObject.onVideoStarted()},t.Hj=function(){t.apiObject.onInitialize&&t.apiObject.onInitialize()},t.Ji=function(e){t.apiObject.onFaceVisibilityChanged&&t.apiObject.onFaceVisibilityChanged(e)},t.Ki=function(e){t.apiObject.onImageVisibilityChanged&&t.apiObject.onImageVisibilityChanged(e)},t.Gi=function(){t.apiObject.onCameraPermissionGranted&&t.apiObject.onCameraPermissionGranted()},t.Fi=function(){t.apiObject.onCameraPermissionDenied&&t.apiObject.onCameraPermissionDenied()},t.Ei=function(){t.apiObject.onCameraPermissionAsked&&t.apiObject.onCameraPermissionAsked()},t.Mi=function(e,n,r){var a=document.createElement("canvas"),o=a.getContext("2d");a.width=n,a.height=r;for(var s=o.getImageData(0,0,a.width,a.height),i=s.data,u=0;u<r;u++)for(var l=0;l<n;l++){var c=4*((r-u-1)*n+l),h=4*(u*n+l);i[h]=t.HEAPU8[e+c+2],i[h+1]=t.HEAPU8[e+c+1],i[h+2]=t.HEAPU8[e+c+0],i[h+3]=t.HEAPU8[e+c+3]}o.putImageData(s,0,0),t.apiObject.onScreenshotTakenCanvas&&t.apiObject.onScreenshotTakenCanvas(a),t.apiObject.onScreenshotTaken&&t.apiObject.onScreenshotTaken(a.toDataURL("image/png"))},t.Di=function(e){t.apiObject.onAnimationTransitionedToState&&t.apiObject.onAnimationTransitionedToState(e)},t.Hi=function(e,n){t.apiObject.onError&&t.apiObject.onError(e,n)},t.Li=function(e){t.apiObject.onNumberOfFacesVisibleChanged&&t.apiObject.onNumberOfFacesVisibleChanged(e)},t.Ni=function(){t.apiObject.onShutdown&&t.apiObject.onShutdown()},t.noInitialRun=!0,t.onRuntimeInitialized=function(){s=Cr("switchEffect",null,["string","number","number","number"]),i=Cr("clearEffect",null,["string"]),u=Cr("moveGameObject",null,["string","string"]),t.pushConsoleLog=Cr("pushConsoleLog","boolean",["string","int"]),t.changeParameterFloat=Cr("changeParameterFloat",null,["string","string","string","number"]),t.changeParameterVector=Cr("changeParameterVector",null,"string string string number number number number".split(" ")),t.changeParameterBool=Cr("changeParameterBool",null,["string","string","string","boolean"]),t.changeParameterTexture=Cr("changeParameterTexture",null,"string string string number number number number".split(" ")),t.fireTrigger=Cr("fireTrigger",null,["string"]),t.setFaceDetectionSensitivity=Cr("setFaceDetectionSensitivity",null,["number"]),t.showStats=Cr("showStats",null,["number"]),t.simulatePhysics=Cr("simulatePhysics",null,["number"]),t.showColliders=Cr("showColliders",null,["number"]),t.setLicenseKey=Cr("setLicenseKey",null,["string"]),t.setLicenseKey(t.licenseKey),o=t.xzimg,Mr(t.canvasWidth,t.canvasHeight)};var f=Object.assign({},t),d="";"undefined"!=typeof document&&document.currentScript&&(d=document.currentScript.src),Db&&(d=Db),d=0!==d.indexOf("blob:")?d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):"";var m=console.log.bind(console),g=console.warn.bind(console);Object.assign(t,f),f=null;var y=!1;"object"!=typeof WebAssembly&&q("no native wasm support detected");var b,v,x,w,_,T,E,S,I,k,C,N=!1,A="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function $(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&A)return A.decode(e.subarray(t,n));for(r="";t<n;){var a=e[t++];if(128&a){var o=63&e[t++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|o);else{var s=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|o<<6|s:(7&a)<<18|o<<12|s<<6|63&e[t++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function R(e,t){return e?$(_,e,t):""}function F(e,t,n,r){if(!(0<r))return 0;var a=n;r=n+r-1;for(var o=0;o<e.length;++o){var s=e.charCodeAt(o);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),127>=s){if(n>=r)break;t[n++]=s}else{if(2047>=s){if(n+1>=r)break;t[n++]=192|s>>6}else{if(65535>=s){if(n+2>=r)break;t[n++]=224|s>>12}else{if(n+3>=r)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63}t[n++]=128|s>>6&63}t[n++]=128|63&s}}return t[n]=0,n-a}function O(e,t,n){return F(e,_,t,n)}function D(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);127>=r?t++:2047>=r?t+=2:55296<=r&&57343>=r?(t+=4,++n):t+=3}return t}function M(){var e=b.buffer;x=e,t.HEAP8=w=new Int8Array(e),t.HEAP16=T=new Int16Array(e),t.HEAP32=S=new Int32Array(e),t.HEAPU8=_=new Uint8Array(e),t.HEAPU16=E=new Uint16Array(e),t.HEAPU32=I=new Uint32Array(e),t.HEAPF32=k=new Float32Array(e),t.HEAPF64=C=new Float64Array(e)}var L,P,B=[],U=[],z=[],V=[],W=!1,j=0,G=0,H=null,K=null;function q(e){throw g(e="Aborted("+e+")"),N=!0,v=1,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function X(){return P.startsWith("data:application/octet-stream;base64,")}if(P="deepar.wasm",!X()){var Y=P;P=t.locateFile?t.locateFile(Y,d):d+Y}function Q(){try{throw"both async and sync fetching of the wasm failed"}catch(e){q(e)}}var J={732152:(e,n,r,a,o,s)=>{var i=document.createElement("canvas"),u=i.getContext("2d");i.width=n,i.height=r,e=new Uint8ClampedArray(t.HEAPU8.subarray(e,e+i.width*i.height*4)),e=new ImageData(e,i.width,i.height),u.putImageData(e,0,0),e=(u=document.createElement("canvas")).getContext("2d"),u.width=o,u.height=s,e.drawImage(i,0,0,u.width,u.height),o=e.getImageData(0,0,u.width,u.height),o=new Uint8Array(o.data.buffer),t.HEAPU8.set(o,a)},733026:(e,n,r,a,o,s)=>{var i=document.createElement("canvas"),u=i.getContext("2d");i.width=n,i.height=r,e=new Uint8ClampedArray(t.HEAPU8.subarray(e,e+i.width*i.height*4)),e=new ImageData(e,i.width,i.height),u.putImageData(e,0,0),e=(u=document.createElement("canvas")).getContext("2d"),u.width=o,u.height=s,e.drawImage(i,0,0,u.width,u.height),o=e.getImageData(0,0,u.width,u.height),o=new Uint8Array(o.data.buffer),t.HEAPU8.set(o,a)},733900:()=>{console.log("License key not valid")},733937:(e,n,r)=>{t.Mi(e,n,r)},733980:e=>{t.Li(e)},734027:(e,n,r,a,o,s,i,u,l)=>{t.Ii({translationOffset:e,rotationOffset:n,poseMatrixOffset:r,landmarksOffset:a,landmarks2DOffset:o,faceRectOffset:s},i,u,l)},734211:(e,n)=>{t.Hi(R(e),R(n))},734268:e=>{t.Ji(!!e)},734309:e=>{t.Ki(!!e)},734353:(e,n)=>{e=R(e,n),t.Di(e)},734434:()=>{alert("DeepAR license not valid")},734468:()=>{t.endLoop()},734489:()=>ar.videoWidth,734531:()=>ar.videoHeight,734574:()=>{var e=t.faceTrackingModelByteArray;if(!e)return 0;var n=t._malloc(e.length);return t.HEAPU8.set(e,n),n},734768:()=>{var e=Xn,t=D(e)+1,n=zr(t);return O(e,n,t),n},734922:()=>{var e=Yn,t=D(e)+1,n=zr(t);return O(e,n,t),n},735081:()=>{var e=Qn,t=D(e)+1,n=zr(t);return O(e,n,t),n},735247:()=>{var e=Zn,t=D(e)+1,n=zr(t);return O(e,n,t),n},735410:()=>{var e=er,t=D(e)+1,n=zr(t);return O(e,n,t),n},735578:()=>{var e=Jn,t=D(e)+1,n=zr(t);return O(e,n,t),n},735743:()=>{var e=tr,t=D(e)+1,n=zr(t);return O(e,n,t),n},735905:()=>{var e=nr,t=D(e)+1,n=zr(t);return O(e,n,t),n},736066:()=>{var e=rr,t=D(e)+1,n=zr(t);return O(e,n,t),n}};function Z(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ee(e){for(;0<e.length;)e.shift()(t)}function te(e){if(!(e instanceof Z||"unwind"==e))throw e}var ne=[],re=0,ae=0;function oe(e){this.Ph=e,this.lh=e-24,this.nj=function(e){I[this.lh+4>>2]=e},this.oh=function(){return I[this.lh+4>>2]},this.hj=function(e){I[this.lh+8>>2]=e},this.Wi=function(){return I[this.lh+8>>2]},this.lj=function(){S[this.lh>>2]=0},this.gi=function(e){w[this.lh+12>>0]=e?1:0},this.Fh=function(){return 0!=w[this.lh+12>>0]},this.hi=function(e){w[this.lh+13>>0]=e?1:0},this.oi=function(){return 0!=w[this.lh+13>>0]},this.Rh=function(e,t){this.th(0),this.nj(e),this.hj(t),this.lj(),this.gi(!1),this.hi(!1)},this.Bh=function(){S[this.lh>>2]+=1},this.gj=function(){var e=S[this.lh>>2];return S[this.lh>>2]=e-1,1===e},this.th=function(e){I[this.lh+16>>2]=e},this.Ch=function(){return I[this.lh+16>>2]},this.Mh=function(){if(Jr(this.oh()))return I[this.Ph>>2];var e=this.Ch();return 0!==e?e:this.Ph}}function se(e){return Vr(new oe(e).lh)}function ie(e){return L.get(e)}var ue={};function le(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function ce(e){return this.fromWireType(S[e>>2])}var he={},pe={},fe={};function de(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return 48<=t&&57>=t?"_"+e:e}function me(e,t){return e=de(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ge(e){var t=Error,n=me(e,(function(t){this.name=e,this.message=t,void 0!==(t=Error(t).stack)&&(this.stack=this.toString()+"\n"+t.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ye=void 0;function be(e){throw new ye(e)}function ve(e,t,n){function r(t){(t=n(t)).length!==e.length&&be("Mismatched type converter count");for(var r=0;r<e.length;++r)Se(e[r],t[r])}e.forEach((function(e){fe[e]=t}));var a=Array(t.length),o=[],s=0;t.forEach(((e,t)=>{pe.hasOwnProperty(e)?a[t]=pe[e]:(o.push(e),he.hasOwnProperty(e)||(he[e]=[]),he[e].push((()=>{a[t]=pe[e],++s===o.length&&r(a)})))})),0===o.length&&r(a)}function xe(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var we=void 0;function _e(e){for(var t="";_[e];)t+=we[_[e++]];return t}var Te=void 0;function Ee(e){throw new Te(e)}function Se(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||Ee('type "'+r+'" must have a positive integer typeid pointer'),pe.hasOwnProperty(e)){if(n.aj)return;Ee("Cannot register type '"+r+"' twice")}pe[e]=t,delete fe[e],he.hasOwnProperty(e)&&(t=he[e],delete he[e],t.forEach((e=>e())))}function Ie(e){Ee(e.kh.nh.mh.name+" instance already deleted")}var ke=!1;function Ce(){}function Ne(e){--e.count.value,0===e.count.value&&(e.qh?e.uh.Ah(e.qh):e.nh.mh.Ah(e.lh))}function Ae(e,t,n){return t===n?e:void 0===n.vh||null===(e=Ae(e,t,n.vh))?null:n.Ri(e)}var $e={},Re=[];function Fe(){for(;Re.length;){var e=Re.pop();e.kh.Kh=!1,e.delete()}}var Oe=void 0,De={};function Me(e,t){return t.nh&&t.lh||be("makeClassHandle requires ptr and ptrType"),!!t.uh!=!!t.qh&&be("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Le(Object.create(e,{kh:{value:t}}))}function Le(e){return"undefined"==typeof FinalizationRegistry?(Le=e=>e,e):(ke=new FinalizationRegistry((e=>{Ne(e.kh)})),Le=e=>{var t=e.kh;return t.qh&&ke.register(e,{kh:t},e),e},Ce=e=>{ke.unregister(e)},Le(e))}function Pe(){}function Be(e,t,n){if(void 0===e[t].ph){var r=e[t];e[t]=function(){return e[t].ph.hasOwnProperty(arguments.length)||Ee("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].ph+")!"),e[t].ph[arguments.length].apply(this,arguments)},e[t].ph=[],e[t].ph[r.Th]=r}}function Ue(e,n,r){t.hasOwnProperty(e)?((void 0===r||void 0!==t[e].ph&&void 0!==t[e].ph[r])&&Ee("Cannot register public name '"+e+"' twice"),Be(t,e,e),t.hasOwnProperty(r)&&Ee("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),t[e].ph[r]=n):(t[e]=n,void 0!==r&&(t[e].Sj=r))}function ze(e,t,n,r,a,o,s,i){this.name=e,this.constructor=t,this.Lh=n,this.Ah=r,this.vh=a,this.Ui=o,this.Sh=s,this.Ri=i,this.dj=[]}function Ve(e,t,n){for(;t!==n;)t.Sh||Ee("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.Sh(e),t=t.vh;return e}function We(e,t){return null===t?(this.bi&&Ee("null is not a valid "+this.name),0):(t.kh||Ee('Cannot pass "'+st(t)+'" as a '+this.name),t.kh.lh||Ee("Cannot pass deleted object as a pointer of type "+this.name),Ve(t.kh.lh,t.kh.nh.mh,this.mh))}function je(e,t){if(null===t){if(this.bi&&Ee("null is not a valid "+this.name),this.Wh){var n=this.ei();return null!==e&&e.push(this.Ah,n),n}return 0}if(t.kh||Ee('Cannot pass "'+st(t)+'" as a '+this.name),t.kh.lh||Ee("Cannot pass deleted object as a pointer of type "+this.name),!this.Vh&&t.kh.nh.Vh&&Ee("Cannot convert argument of type "+(t.kh.uh?t.kh.uh.name:t.kh.nh.name)+" to parameter type "+this.name),n=Ve(t.kh.lh,t.kh.nh.mh,this.mh),this.Wh)switch(void 0===t.kh.qh&&Ee("Passing raw pointer to smart pointer is illegal"),this.mj){case 0:t.kh.uh===this?n=t.kh.qh:Ee("Cannot convert argument of type "+(t.kh.uh?t.kh.uh.name:t.kh.nh.name)+" to parameter type "+this.name);break;case 1:n=t.kh.qh;break;case 2:if(t.kh.uh===this)n=t.kh.qh;else{var r=t.clone();n=this.fj(n,rt((function(){r.delete()}))),null!==e&&e.push(this.Ah,n)}break;default:Ee("Unsupporting sharing policy")}return n}function Ge(e,t){return null===t?(this.bi&&Ee("null is not a valid "+this.name),0):(t.kh||Ee('Cannot pass "'+st(t)+'" as a '+this.name),t.kh.lh||Ee("Cannot pass deleted object as a pointer of type "+this.name),t.kh.nh.Vh&&Ee("Cannot convert argument of type "+t.kh.nh.name+" to parameter type "+this.name),Ve(t.kh.lh,t.kh.nh.mh,this.mh))}function He(e,t,n,r){this.name=e,this.mh=t,this.bi=n,this.Vh=r,this.Wh=!1,this.Ah=this.fj=this.ei=this.si=this.mj=this.cj=void 0,void 0!==t.vh?this.toWireType=je:(this.toWireType=r?We:Ge,this.rh=null)}function Ke(e,n,r){t.hasOwnProperty(e)||be("Replacing nonexistant public symbol"),void 0!==t[e].ph&&void 0!==r?t[e].ph[r]=n:(t[e]=n,t[e].Th=r)}function qe(e,n){var r=(e=_e(e)).includes("j")?function(e,n){var r=[];return function(){if(r.length=0,Object.assign(r,arguments),e.includes("j")){var a=t["dynCall_"+e];a=r&&r.length?a.apply(null,[n].concat(r)):a.call(null,n)}else a=ie(n).apply(null,r);return a}}(e,n):ie(n);return"function"!=typeof r&&Ee("unknown function pointer with signature "+e+": "+n),r}var Xe=void 0;function Ye(e){var t=_e(e=Gr(e));return Vr(e),t}function Qe(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||pe[t]||(fe[t]?fe[t].forEach(e):(n.push(t),r[t]=!0))})),new Xe(e+": "+n.map(Ye).join([", "]))}function Je(e,t){for(var n=[],r=0;r<e;r++)n.push(I[t+4*r>>2]);return n}function Ze(e,t,n,r,a){var o=t.length;2>o&&Ee("argTypes array size mismatch! Must at least get return value and 'this' types!");var s=null!==t[1]&&null!==n,i=!1;for(n=1;n<t.length;++n)if(null!==t[n]&&void 0===t[n].rh){i=!0;break}var u="void"!==t[0].name,l="",c="";for(n=0;n<o-2;++n)l+=(0!==n?", ":"")+"arg"+n,c+=(0!==n?", ":"")+"arg"+n+"Wired";e="return function "+de(e)+"("+l+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n",i&&(e+="var destructors = [];\n");var h=i?"destructors":"null";for(l="throwBindingError invoker fn runDestructors retType classParam".split(" "),r=[Ee,r,a,le,t[0],t[1]],s&&(e+="var thisWired = classParam.toWireType("+h+", this);\n"),n=0;n<o-2;++n)e+="var arg"+n+"Wired = argType"+n+".toWireType("+h+", arg"+n+"); // "+t[n+2].name+"\n",l.push("argType"+n),r.push(t[n+2]);if(s&&(c="thisWired"+(0<c.length?", ":"")+c),e+=(u?"var rv = ":"")+"invoker(fn"+(0<c.length?", ":"")+c+");\n",i)e+="runDestructors(destructors);\n";else for(n=s?1:2;n<t.length;++n)o=1===n?"thisWired":"arg"+(n-2)+"Wired",null!==t[n].rh&&(e+=o+"_dtor("+o+"); // "+t[n].name+"\n",l.push(o+"_dtor"),r.push(t[n].rh));return u&&(e+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),l.push(e+"}\n"),function(e){var t=Function;if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+typeof t+" which is not a function");var n=me(t.name||"unknownFunctionName",(function(){}));return n.prototype=t.prototype,n=new n,(e=t.apply(n,e))instanceof Object?e:n}(l).apply(null,r)}var et=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function nt(e){4<e&&0==--tt[e].fi&&(tt[e]=void 0,et.push(e))}var rt=e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=et.length?et.pop():tt.length;return tt[t]={fi:1,value:e},t}};function at(e,t,n){switch(t){case 0:return function(e){return this.fromWireType((n?w:_)[e])};case 1:return function(e){return this.fromWireType((n?T:E)[e>>1])};case 2:return function(e){return this.fromWireType((n?S:I)[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function ot(e,t){var n=pe[e];return void 0===n&&Ee(t+" has unknown type "+Ye(e)),n}function st(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function it(e,t){switch(t){case 2:return function(e){return this.fromWireType(k[e>>2])};case 3:return function(e){return this.fromWireType(C[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function ut(e,t,n){switch(t){case 0:return n?function(e){return w[e]}:function(e){return _[e]};case 1:return n?function(e){return T[e>>1]}:function(e){return E[e>>1]};case 2:return n?function(e){return S[e>>2]}:function(e){return I[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var lt,ct="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function ht(e,t){for(var n=e>>1,r=n+t/2;!(n>=r)&&E[n];)++n;if(32<(n<<=1)-e&&ct)return ct.decode(_.subarray(e,n));for(n="",r=0;!(r>=t/2);++r){var a=T[e+2*r>>1];if(0==a)break;n+=String.fromCharCode(a)}return n}function pt(e,t,n){if(void 0===n&&(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var a=0;a<n;++a)T[t>>1]=e.charCodeAt(a),t+=2;return T[t>>1]=0,t-r}function ft(e){return 2*e.length}function dt(e,t){for(var n=0,r="";!(n>=t/4);){var a=S[e+4*n>>2];if(0==a)break;++n,65536<=a?(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a)):r+=String.fromCharCode(a)}return r}function mt(e,t,n){if(void 0===n&&(n=2147483647),4>n)return 0;var r=t;n=r+n-4;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),S[t>>2]=o,(t+=4)+4>n)break}return S[t>>2]=0,t-r}function gt(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t}function yt(e){var t=D(e)+1,n=zr(t);return n&&F(e,w,n,t),n}function bt(e,t){if(At=e,$t=t,Nt)if(It||(j+=1,It=!0),0==e)kt=function(){var e=0|Math.max(0,Tt+t-lt());setTimeout(Et,e)};else if(1==e)kt=function(){Wt(Et)};else if(2==e){if("undefined"==typeof setImmediate){var n=[];addEventListener("message",(e=>{"setimmediate"!==e.data&&"setimmediate"!==e.data.target||(e.stopPropagation(),n.shift()())}),!0),setImmediate=function(e){n.push(e),postMessage("setimmediate","*")}}kt=function(){setImmediate(Et)}}}function vt(e){throw v=e,y||0<j||(Hr(),ee(z),jr(0),Hn[1].length&&Kn(1,10),Hn[2].length&&Kn(2,10),W=!0),v=e,y||0<j||(N=!0),new Z(e)}function xt(){if(!(y||0<j))try{vt(v)}catch(e){te(e)}}function wt(e){if(!W&&!N)try{e(),xt()}catch(e){te(e)}}lt=()=>performance.now();var _t,Tt,Et,St,It=!1,kt=null,Ct=0,Nt=null,At=0,$t=0,Rt=0,Ft=[],Ot={},Dt=!1,Mt=!1,Lt=[];var Pt=!1,Bt=void 0,Ut=void 0;function zt(){return!!Dt&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)}var Vt=0;function Wt(e){if("function"==typeof requestAnimationFrame)requestAnimationFrame(e);else{var t=Date.now();if(0===Vt)Vt=t+1e3/60;else for(;t+2>=Vt;)Vt+=1e3/60;setTimeout(e,Math.max(Vt-t,0))}}function jt(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}var Gt=[];function Ht(){var e=t.canvas;Gt.forEach((function(t){t(e.width,e.height)}))}function Kt(e,n,r){n&&r?(e.uj=n,e.$i=r):(n=e.uj,r=e.$i);var a=n,o=r;if(t.forcedAspectRatio&&0<t.forcedAspectRatio&&(a/o<t.forcedAspectRatio?a=Math.round(o*t.forcedAspectRatio):o=Math.round(a/t.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var s=Math.min(screen.width/a,screen.height/o);a=Math.round(a*s),o=Math.round(o*s)}Ut?(e.width!=a&&(e.width=a),e.height!=o&&(e.height=o),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=n&&(e.width=n),e.height!=r&&(e.height=r),void 0!==e.style&&(a!=n||o!=r?(e.style.setProperty("width",a+"px","important"),e.style.setProperty("height",o+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}var qt,Xt,Yt,Qt,Jt,Zt=!1,en=0,tn=0,nn=0,rn={alpha:!1,depth:!1,stencil:!1,antialias:!1},an={},on=1,sn=[],un=[],ln=[],cn=[],hn=[],pn=[],fn=[],dn=[],mn=[],gn={},yn=4;function bn(e){Tn||(Tn=e)}function vn(e){for(var t=on++,n=e.length;n<t;n++)e[n]=null;return t}function xn(e,t,n){for(var r="",a=0;a<e;++a){var o=n?S[n+4*a>>2]:-1;r+=R(S[t+4*a>>2],0>o?void 0:o)}return r}function wn(e,n){if(t.preinitializedWebGLContext){var r=t.preinitializedWebGLContext;n.ci=1}else e.oh||(e.oh=e.getContext,e.getContext=function(t,n){return"webgl"==t==(n=e.oh(t,n))instanceof WebGLRenderingContext?n:null}),r=e.getContext("webgl",n);return r?function(e,t){var n=vn(dn),r={Mj:n,attributes:t,version:t.ci,Dh:e};return e.canvas&&(e.canvas.wi=r),dn[n]=r,(void 0===t.Si||t.Si)&&function(e){if(e||(e=En),!e.bj){e.bj=!0;var t=e.Dh;!function(e){var t=e.getExtension("ANGLE_instanced_arrays");t&&(e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,a){t.drawArraysInstancedANGLE(e,n,r,a)},e.drawElementsInstanced=function(e,n,r,a,o){t.drawElementsInstancedANGLE(e,n,r,a,o)})}(t),function(e){var t=e.getExtension("OES_vertex_array_object");t&&(e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)})}(t),function(e){var t=e.getExtension("WEBGL_draw_buffers");t&&(e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)})}(t),t.sh=t.getExtension("EXT_disjoint_timer_query"),t.Qj=t.getExtension("WEBGL_multi_draw"),(t.getSupportedExtensions()||[]).forEach((function(e){e.includes("lose_context")||e.includes("debug")||t.getExtension(e)}))}}(r),n}(r,n):0}function _n(e){En=dn[e],t.Oh=$r=En&&En.Dh}var Tn,En,Sn={},In=[],kn={},Cn=0,Nn=[];function An(e,t,n,r){for(var a=0;a<e;a++){var o=$r[n](),s=o&&vn(r);o?(o.name=s,r[s]=o):bn(1282),S[t+4*a>>2]=s}}function $n(e,t,n,r,a,o,s,i){t=un[t],(e=$r[e](t,n))&&(r=i&&O(e.name,i,r),a&&(S[a>>2]=r),o&&(S[o>>2]=e.size),s&&(S[s>>2]=e.type))}function Rn(e,t){I[e>>2]=t,I[e+4>>2]=(t-I[e>>2])/4294967296}function Fn(e,t,n){if(t){var r=void 0;switch(e){case 36346:r=1;break;case 36344:return void(0!=n&&1!=n&&bn(1280));case 36345:r=0;break;case 34466:var a=$r.getParameter(34467);r=a?a.length:0}if(void 0===r)switch(a=$r.getParameter(e),typeof a){case"number":r=a;break;case"boolean":r=a?1:0;break;case"string":return void bn(1280);case"object":if(null===a)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:r=0;break;default:return void bn(1280)}else{if(a instanceof Float32Array||a instanceof Uint32Array||a instanceof Int32Array||a instanceof Array){for(e=0;e<a.length;++e)switch(n){case 0:S[t+4*e>>2]=a[e];break;case 2:k[t+4*e>>2]=a[e];break;case 4:w[t+e>>0]=a[e]?1:0}return}try{r=0|a.name}catch(t){return bn(1280),void g("GL_INVALID_ENUM in glGet"+n+"v: Unknown object returned from WebGL getParameter("+e+")! (error: "+t+")")}}break;default:return bn(1280),void g("GL_INVALID_ENUM in glGet"+n+"v: Native code calling glGet"+n+"v("+e+") and it returns "+a+" of type "+typeof a+"!")}switch(n){case 1:Rn(t,r);break;case 0:S[t>>2]=r;break;case 2:k[t>>2]=r;break;case 4:w[t>>0]=r?1:0}}else bn(1281)}function On(e){var t=D(e)+1,n=zr(t);return O(e,n,t),n}function Dn(e){return"]"==e.slice(-1)&&e.lastIndexOf("[")}function Mn(e){var t,n=e.Ih,r=e.$h;if(!n)for(e.Ih=n={},e.ui={},t=0;t<$r.getProgramParameter(e,35718);++t){var a=$r.getActiveUniform(e,t),o=a.name;a=a.size;var s=Dn(o);s=0<s?o.slice(0,s):o;var i=e.Zh;for(e.Zh+=a,r[s]=[a,i],o=0;o<a;++o)n[i]=o,e.ui[i++]=s}}function Ln(e){var t=$r.ki;if(t){var n=t.Ih[e];return"number"==typeof n&&(t.Ih[e]=n=$r.getUniformLocation(t,t.ui[e]+(0<n?"["+n+"]":""))),n}bn(1282)}function Pn(e,t,n,r){if(n)if(Mn(e=un[e]),"number"==typeof(e=$r.getUniform(e,Ln(t)))||"boolean"==typeof e)switch(r){case 0:S[n>>2]=e;break;case 2:k[n>>2]=e}else for(t=0;t<e.length;t++)switch(r){case 0:S[n+4*t>>2]=e[t];break;case 2:k[n+4*t>>2]=e[t]}else bn(1281)}function Bn(e,t,n,r){if(n)if(e=$r.getVertexAttrib(e,t),34975==t)S[n>>2]=e&&e.name;else if("number"==typeof e||"boolean"==typeof e)switch(r){case 0:S[n>>2]=e;break;case 2:k[n>>2]=e;break;case 5:S[n>>2]=Math.fround(e)}else for(t=0;t<e.length;t++)switch(r){case 0:S[n+4*t>>2]=e[t];break;case 2:k[n+4*t>>2]=e[t];break;case 5:S[n+4*t>>2]=Math.fround(e[t])}else bn(1281)}function Un(e,t,n,r,a){e=1==(e-=5120)?_:4==e?S:6==e?k:5==e||28922==e?I:E;var o=31-Math.clz32(e.BYTES_PER_ELEMENT),s=yn;return e.subarray(a>>o,a+r*(n*({5:3,6:4,8:2,29502:3,29504:4}[t-6402]||1)*(1<<o)+s-1&-s)>>o)}var zn=[],Vn=[],Wn={};function jn(){if(!Gn){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Wn)void 0===Wn[e]?delete t[e]:t[e]=Wn[e];var n=[];for(e in t)n.push(e+"="+t[e]);Gn=n}return Gn}var Gn,Hn=[null,[],[]];function Kn(e,t){var n=Hn[e];0===t||10===t?((1===e?m:g)($(n,0)),n.length=0):n.push(t)}var qn,Xn=null,Yn=null,Qn=null,Jn=null,Zn=null,er=null,tr=null,nr=null,rr=null,ar=null,or=null,sr=null,ir=null,ur=null,lr=null,cr=null,hr=null,pr=null,fr=null,dr=null,mr=null,gr=null,yr=null,br=null,vr=null;function xr(e){return 0==e%4&&(0!=e%100||0==e%400)}function wr(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var _r=[31,29,31,30,31,30,31,31,30,31,30,31],Tr=[31,28,31,30,31,30,31,31,30,31,30,31];function Er(e,t){for(e=new Date(e.getTime());0<t;){var n=e.getMonth(),r=(xr(e.getFullYear())?_r:Tr)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return e}function Sr(e,t){var n=Array(D(e)+1);return e=F(e,n,0,n.length),t&&(n.length=e),n}function Ir(e,t,n,r){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function o(e,t){return a(e,t,"0")}function s(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function i(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function u(e){e=Er(new Date(e.Hh+1900,0,1),e.Gh);var t=new Date(e.getFullYear()+1,0,4),n=i(new Date(e.getFullYear(),0,4));return t=i(t),0>=s(n,e)?0>=s(t,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var l=S[r+40>>2];for(var c in r={qj:S[r>>2],pj:S[r+4>>2],Xh:S[r+8>>2],ii:S[r+12>>2],Yh:S[r+16>>2],Hh:S[r+20>>2],wh:S[r+24>>2],Gh:S[r+28>>2],Uj:S[r+32>>2],oj:S[r+36>>2],rj:l?R(l):""},n=R(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(c,"g"),l[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(c in l={"%a":function(e){return h[e.wh].substring(0,3)},"%A":function(e){return h[e.wh]},"%b":function(e){return p[e.Yh].substring(0,3)},"%B":function(e){return p[e.Yh]},"%C":function(e){return o((e.Hh+1900)/100|0,2)},"%d":function(e){return o(e.ii,2)},"%e":function(e){return a(e.ii,2," ")},"%g":function(e){return u(e).toString().substring(2)},"%G":function(e){return u(e)},"%H":function(e){return o(e.Xh,2)},"%I":function(e){return 0==(e=e.Xh)?e=12:12<e&&(e-=12),o(e,2)},"%j":function(e){return o(e.ii+wr(xr(e.Hh+1900)?_r:Tr,e.Yh-1),3)},"%m":function(e){return o(e.Yh+1,2)},"%M":function(e){return o(e.pj,2)},"%n":function(){return"\n"},"%p":function(e){return 0<=e.Xh&&12>e.Xh?"AM":"PM"},"%S":function(e){return o(e.qj,2)},"%t":function(){return"\t"},"%u":function(e){return e.wh||7},"%U":function(e){return o(Math.floor((e.Gh+7-e.wh)/7),2)},"%V":function(e){var t=Math.floor((e.Gh+7-(e.wh+6)%7)/7);if(2>=(e.wh+371-e.Gh-2)%7&&t++,t)53==t&&(4==(n=(e.wh+371-e.Gh)%7)||3==n&&xr(e.Hh)||(t=1));else{t=52;var n=(e.wh+7-e.Gh-1)%7;(4==n||5==n&&xr(e.Hh%400-1))&&t++}return o(t,2)},"%w":function(e){return e.wh},"%W":function(e){return o(Math.floor((e.Gh+7-(e.wh+6)%7)/7),2)},"%y":function(e){return(e.Hh+1900).toString().substring(2)},"%Y":function(e){return e.Hh+1900},"%z":function(e){var t=0<=(e=e.oj);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.rj},"%%":function(){return"%"}},n=n.replace(/%%/g,"\0\0"),l)n.includes(c)&&(n=n.replace(new RegExp(c,"g"),l[c](r)));return(c=Sr(n=n.replace(/\0\0/g,"%"),!1)).length>t?0:(w.set(c,e),c.length-1)}function kr(e,n,r,a){var o={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);O(e,t=Yr(n),n)}return t},array:e=>{var t=Yr(e.length);return w.set(e,t),t}};e=t["_"+e];var s=[],i=0;if(a)for(var u=0;u<a.length;u++){var l=o[r[u]];l?(0===i&&(i=qr()),s[u]=l(a[u])):s[u]=a[u]}return function(e){return 0!==i&&Xr(i),"string"===n?R(e):"boolean"===n?!!e:e}(r=e.apply(null,s))}function Cr(e,n,r,a){var o=(r=r||[]).every((e=>"number"===e||"boolean"===e));return"string"!==n&&o&&!a?t["_"+e]:function(){return kr(e,n,r,arguments)}}ye=t.InternalError=ge("InternalError");for(var Nr=Array(256),Ar=0;256>Ar;++Ar)Nr[Ar]=String.fromCharCode(Ar);we=Nr,Te=t.BindingError=ge("BindingError"),Pe.prototype.isAliasOf=function(e){if(!(this instanceof Pe&&e instanceof Pe))return!1;var t=this.kh.nh.mh,n=this.kh.lh,r=e.kh.nh.mh;for(e=e.kh.lh;t.vh;)n=t.Sh(n),t=t.vh;for(;r.vh;)e=r.Sh(e),r=r.vh;return t===r&&n===e},Pe.prototype.clone=function(){if(this.kh.lh||Ie(this),this.kh.Qh)return this.kh.count.value+=1,this;var e=Le,t=Object,n=t.create,r=Object.getPrototypeOf(this),a=this.kh;return(e=e(n.call(t,r,{kh:{value:{count:a.count,Kh:a.Kh,Qh:a.Qh,lh:a.lh,nh:a.nh,qh:a.qh,uh:a.uh}}}))).kh.count.value+=1,e.kh.Kh=!1,e},Pe.prototype.delete=function(){this.kh.lh||Ie(this),this.kh.Kh&&!this.kh.Qh&&Ee("Object already scheduled for deletion"),Ce(this),Ne(this.kh),this.kh.Qh||(this.kh.qh=void 0,this.kh.lh=void 0)},Pe.prototype.isDeleted=function(){return!this.kh.lh},Pe.prototype.deleteLater=function(){return this.kh.lh||Ie(this),this.kh.Kh&&!this.kh.Qh&&Ee("Object already scheduled for deletion"),Re.push(this),1===Re.length&&Oe&&Oe(Fe),this.kh.Kh=!0,this},t.getInheritedInstanceCount=function(){return Object.keys(De).length},t.getLiveInheritedInstances=function(){var e,t=[];for(e in De)De.hasOwnProperty(e)&&t.push(De[e]);return t},t.flushPendingDeletes=Fe,t.setDelayFunction=function(e){Oe=e,Re.length&&Oe&&Oe(Fe)},He.prototype.Vi=function(e){return this.si&&(e=this.si(e)),e},He.prototype.li=function(e){this.Ah&&this.Ah(e)},He.prototype.argPackAdvance=8,He.prototype.readValueFromPointer=ce,He.prototype.deleteObject=function(e){null!==e&&e.delete()},He.prototype.fromWireType=function(e){function t(){return this.Wh?Me(this.mh.Lh,{nh:this.cj,lh:n,uh:this,qh:e}):Me(this.mh.Lh,{nh:this,lh:e})}var n=this.Vi(e);if(!n)return this.li(e),null;var r=function(e,t){for(void 0===t&&Ee("ptr should not be undefined");e.vh;)t=e.Sh(t),e=e.vh;return De[t]}(this.mh,n);if(void 0!==r)return 0===r.kh.count.value?(r.kh.lh=n,r.kh.qh=e,r.clone()):(r=r.clone(),this.li(e),r);if(r=this.mh.Ui(n),!(r=$e[r]))return t.call(this);r=this.Vh?r.Qi:r.pointerType;var a=Ae(n,this.mh,r.mh);return null===a?t.call(this):this.Wh?Me(r.mh.Lh,{nh:r,lh:a,uh:this,qh:e}):Me(r.mh.Lh,{nh:r,lh:a})},Xe=t.UnboundTypeError=ge("UnboundTypeError"),t.count_emval_handles=function(){for(var e=0,t=5;t<tt.length;++t)void 0!==tt[t]&&++e;return e},t.get_first_emval=function(){for(var e=5;e<tt.length;++e)if(void 0!==tt[e])return tt[e];return null},t.requestFullscreen=function(e,n){!function(e,n){function r(){Dt=!1;var e=a.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(a.exitFullscreen=zt,Bt&&a.requestPointerLock(),Dt=!0,Ut?("undefined"!=typeof SDL&&(S[SDL.screen>>2]=8388608|I[SDL.screen>>2]),Kt(t.canvas),Ht()):Kt(a)):(e.parentNode.insertBefore(a,e),e.parentNode.removeChild(e),Ut?("undefined"!=typeof SDL&&(S[SDL.screen>>2]=-8388609&I[SDL.screen>>2]),Kt(t.canvas),Ht()):Kt(a)),t.onFullScreen&&t.onFullScreen(Dt),t.onFullscreen&&t.onFullscreen(Dt)}void 0===(Bt=e)&&(Bt=!0),void 0===(Ut=n)&&(Ut=!1);var a=t.canvas;Pt||(Pt=!0,document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenchange",r,!1),document.addEventListener("MSFullscreenChange",r,!1));var o=document.createElement("div");a.parentNode.insertBefore(o,a),o.appendChild(a),o.requestFullscreen=o.requestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullscreen?()=>o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(o.webkitRequestFullScreen?()=>o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),o.requestFullscreen()}(e,n)},t.requestAnimationFrame=function(e){Wt(e)},t.setCanvasSize=function(e,n,r){Kt(t.canvas,e,n),r||Ht()},t.pauseMainLoop=function(){kt=null,Ct++},t.resumeMainLoop=function(){Ct++;var e=At,n=$t,r=Nt;Nt=null,function(e){function n(){return!(r<Ct&&(--j,xt(),1))}!Nt||q("emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Nt=e;var r=Ct;It=!1,Et=function(){if(!N)if(0<Ft.length){var r=Date.now(),a=Ft.shift();if(a.Lj(a.Ij),St){var o=St,s=0==o%1?o-1:Math.floor(o);St=a.Jj?s:(8*o+(s+.5))/9}m('main loop blocker "'+a.name+'" took '+(Date.now()-r)+" ms"),t.setStatus&&(r=t.statusMessage||"Please wait...",o=Ot.Kj,(a=St)?a<o?t.setStatus(r+" ("+(o-a)+"/"+o+")"):t.setStatus(r):t.setStatus("")),n()&&setTimeout(Et,0)}else n()&&(Rt=Rt+1|0,1==At&&1<$t&&0!=Rt%$t?kt():(0==At&&(Tt=lt()),N||t.preMainLoop&&!1===t.preMainLoop()||(wt(e),t.postMainLoop&&t.postMainLoop()),n()&&("object"==typeof SDL&&SDL.audio&&SDL.audio.ej&&SDL.audio.ej(),kt())))}}(r),bt(e,n),kt()},t.getUserMedia=function(){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(void 0)},t.createContext=function(e,n,r,a){return function(e,n,r,a){if(n&&t.Oh&&e==t.canvas)return t.Oh;var o;if(n){var s={antialias:!1,alpha:!1,ci:1};if(a)for(var i in a)s[i]=a[i];if(void 0!==Sn&&(o=wn(e,s)))var u=dn[o].Dh}else u=e.getContext("2d");return u?(r&&(n||void 0===$r||q("cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),t.Oh=u,n&&_n(o),t.sj=n,Lt.forEach((function(e){e()})),function(){function e(){Mt=document.pointerLockElement===t.canvas||document.mozPointerLockElement===t.canvas||document.webkitPointerLockElement===t.canvas||document.msPointerLockElement===t.canvas}if(t.preloadPlugins||(t.preloadPlugins=[]),!qt){qt=!0;try{Xt=!0}catch(e){Xt=!1,g("warning: no blob constructor, cannot create blobs with mimetypes")}Yt="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Xt?null:g("warning: no BlobBuilder"),Qt="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,t.pi||void 0!==Qt||(g("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),t.pi=!0),t.preloadPlugins.push({canHandle:function(e){return!t.pi&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,n,r){var a=null;if(Xt)try{(a=new Blob([e],{type:jt(t)})).size!==e.length&&(a=new Blob([new Uint8Array(e).buffer],{type:jt(t)}))}catch(e){!function(e){_t||(_t={}),_t[e]||(_t[e]=1,g(e))}("Blob constructor present but fails: "+e+"; falling back to blob builder")}a||((a=new Yt).append(new Uint8Array(e).buffer),a=a.getBlob());var o=Qt.createObjectURL(a),s=new Image;s.onload=()=>{s.complete||q("Image "+t+" could not be decoded");var r=document.createElement("canvas");r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),Qt.revokeObjectURL(o),n&&n(e)},s.onerror=()=>{m("Image "+o+" could not be decoded"),r&&r()},s.src=o}}),t.preloadPlugins.push({canHandle:function(e){return!t.Rj&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,n,r){function a(){s||(s=!0,n&&n(e))}function o(){s||(s=!0,new Audio,r&&r())}var s=!1;if(!Xt)return o();try{var i=new Blob([e],{type:jt(t)})}catch(e){return o()}i=Qt.createObjectURL(i);var u=new Audio;u.addEventListener("canplaythrough",(()=>a()),!1),u.onerror=function(){if(!s){g("warning: browser could not fully decode audio "+t+", trying slower base64 approach");for(var n="",r=0,o=0,i=0;i<e.length;i++)for(r=r<<8|e[i],o+=8;6<=o;){var l=r>>o-6&63;o-=6,n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==o?(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&r)<<4],n+="=="):4==o&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&r)<<2],n+="="),u.src="data:audio/x-"+t.substr(-3)+";base64,"+n,a()}},u.src=i,function(e){j+=1,setTimeout((function(){--j,wt(e)}),1e4)}((function(){a()}))}});var n=t.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("mspointerlockchange",e,!1),t.elementPointerLock&&n.addEventListener("click",(e=>{!Mt&&t.canvas.requestPointerLock&&(t.canvas.requestPointerLock(),e.preventDefault())}),!1))}}()),u):null}(e,n,r,a)};for(var $r,Rr=0;32>Rr;++Rr)Nn.push(Array(Rr));var Fr=new Float32Array(288);for(Rr=0;288>Rr;++Rr)zn[Rr]=Fr.subarray(0,Rr+1);var Or=new Int32Array(288);for(Rr=0;288>Rr;++Rr)Vn[Rr]=Or.subarray(0,Rr+1);(or=document.createElement("canvas")).style.display="none",sr=or.getContext("2d",{willReadFrequently:!0}),qn=t.segmentationModel;var Dr={j:function(e,t,n,r){q("Assertion failed: "+R(e)+", at: "+[t?R(t):"unknown filename",n,r?R(r):"unknown function"])},o:function(e){return zr(e+24)+24},l:function(e){return(e=new oe(e)).Fh()||(e.gi(!0),re--),e.hi(!1),ne.push(e),e.Bh(),e.Mh()},z:function(){Kr(0);var e=ne.pop();if(e.gj()&&!e.oi()){var t=e.Wi();t&&ie(t)(e.Ph),se(e.Ph)}ae=0},a:function(){var e=ae;if(!e)return Wr(0),0;var t=new oe(e);t.th(e);var n=t.oh();if(!n)return Wr(0),e;for(var r=0;r<arguments.length;r++){var a=arguments[r];if(0===a||a===n)break;if(Qr(a,n,t.lh+16))return Wr(a),e}return Wr(n),e},d:function(){var e=ae;if(!e)return Wr(0),0;var t=new oe(e);t.th(e);var n=t.oh();if(!n)return Wr(0),e;for(var r=0;r<arguments.length;r++){var a=arguments[r];if(0===a||a===n)break;if(Qr(a,n,t.lh+16))return Wr(a),e}return Wr(n),e},g:function(){var e=ae;if(!e)return Wr(0),0;var t=new oe(e);t.th(e);var n=t.oh();if(!n)return Wr(0),e;for(var r=0;r<arguments.length;r++){var a=arguments[r];if(0===a||a===n)break;if(Qr(a,n,t.lh+16))return Wr(a),e}return Wr(n),e},p:se,jb:function(){var e=ne.pop();e||q("no exception to throw");var t=e.Ph;throw e.oi()||(ne.push(e),e.hi(!0),e.gi(!1),re++),ae=t,t},H:function(e,t,n){throw new oe(e).Rh(t,n),ae=e,re++,e},bc:function(){return re},c:function(e){throw ae||(ae=e),e},La:function(){return 0},jc:function(){return 0},kc:function(){},xf:function(e){var t=ue[e];delete ue[e];var n=t.ei,r=t.Ah,a=t.ni,o=a.map((e=>e.Zi)).concat(a.map((e=>e.jj)));ve([e],o,(e=>{var o={};return a.forEach(((t,n)=>{var r=e[n],s=t.Xi,i=t.Yi,u=e[n+a.length],l=t.ij,c=t.kj;o[t.Ti]={read:e=>r.fromWireType(s(i,e)),write:(e,t)=>{var n=[];l(c,e,u.toWireType(n,t)),le(n)}}})),[{name:t.name,fromWireType:function(e){var t,n={};for(t in o)n[t]=o[t].read(e);return r(e),n},toWireType:function(e,t){for(var a in o)if(!(a in t))throw new TypeError('Missing field:  "'+a+'"');var s=n();for(a in o)o[a].write(s,t[a]);return null!==e&&e.push(r,s),s},argPackAdvance:8,readValueFromPointer:ce,rh:r}]}))},Tb:function(){},Cf:function(e,t,n,r,a){var o=xe(n);Se(e,{name:t=_e(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:a},argPackAdvance:8,readValueFromPointer:function(e){if(1===n)var r=w;else if(2===n)r=T;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=S}return this.fromWireType(r[e>>o])},rh:null})},Se:function(e,t,n,r,a,o,s,i,u,l,c,h,p){c=_e(c),o=qe(a,o),i&&(i=qe(s,i)),l&&(l=qe(u,l)),p=qe(h,p);var f=de(c);Ue(f,(function(){Qe("Cannot construct "+c+" due to unbound types",[r])})),ve([e,t,n],r?[r]:[],(function(t){if(t=t[0],r)var n=t.mh,a=n.Lh;else a=Pe.prototype;t=me(f,(function(){if(Object.getPrototypeOf(this)!==s)throw new Te("Use 'new' to construct "+c);if(void 0===u.Eh)throw new Te(c+" has no accessible constructor");var e=u.Eh[arguments.length];if(void 0===e)throw new Te("Tried to invoke ctor of "+c+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(u.Eh).toString()+") parameters instead!");return e.apply(this,arguments)}));var s=Object.create(a,{constructor:{value:t}});t.prototype=s;var u=new ze(c,t,s,p,n,o,i,l);n=new He(c,u,!0,!1),a=new He(c+"*",u,!1,!1);var h=new He(c+" const*",u,!1,!0);return $e[e]={pointerType:a,Qi:h},Ke(f,t),[n,a,h]}))},Vd:function(e,t,n,r,a,o){0<t||q();var s=Je(t,n);a=qe(r,a),ve([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.mh.Eh&&(e.mh.Eh=[]),void 0!==e.mh.Eh[t-1])throw new Te("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.mh.Eh[t-1]=()=>{Qe("Cannot construct "+e.name+" due to unbound types",s)},ve([],s,(function(r){return r.splice(1,0,null),e.mh.Eh[t-1]=Ze(n,r,null,a,o),[]})),[]}))},W:function(e,t,n,r,a,o,s,i){var u=Je(n,r);t=_e(t),o=qe(a,o),ve([],[e],(function(e){function r(){Qe("Cannot call "+a+" due to unbound types",u)}var a=(e=e[0]).name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),i&&e.mh.dj.push(t);var l=e.mh.Lh,c=l[t];return void 0===c||void 0===c.ph&&c.className!==e.name&&c.Th===n-2?(r.Th=n-2,r.className=e.name,l[t]=r):(Be(l,t,a),l[t].ph[n-2]=r),ve([],u,(function(r){return r=Ze(a,r,e,o,s),void 0===l[t].ph?(r.Th=n-2,l[t]=r):l[t].ph[n-2]=r,[]})),[]}))},Bf:function(e,t){Se(e,{name:t=_e(t),fromWireType:function(e){e||Ee("Cannot use deleted val. handle = "+e);var t=tt[e].value;return nt(e),t},toWireType:function(e,t){return rt(t)},argPackAdvance:8,readValueFromPointer:ce,rh:null})},$f:function(e,t,n,r){function a(){}n=xe(n),t=_e(t),a.values={},Se(e,{name:t,constructor:a,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:at(t,n,r),rh:null}),Ue(t,a)},Tf:function(e,t,n){var r=ot(e,"enum");t=_e(t),e=r.constructor,r=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:me(r.name+"_"+t,(function(){}))}}),e.values[n]=r,e[t]=r},Na:function(e,t,n){n=xe(n),Se(e,{name:t=_e(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:it(t,n),rh:null})},bf:function(e,t,n,r,a,o){var s=Je(t,n);e=_e(e),a=qe(r,a),Ue(e,(function(){Qe("Cannot call "+e+" due to unbound types",s)}),t-1),ve([],s,(function(n){return Ke(e,Ze(e,[n[0],null].concat(n.slice(1)),null,a,o),t-1),[]}))},M:function(e,t,n,r,a){t=_e(t),-1===a&&(a=4294967295),a=xe(n);var o=e=>e;if(0===r){var s=32-8*n;o=e=>e<<s>>>s}n=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t},Se(e,{name:t,fromWireType:o,toWireType:n,argPackAdvance:8,readValueFromPointer:ut(t,a,0!==r),rh:null})},E:function(e,t,n){function r(e){var t=I;return new a(x,t[1+(e>>=2)],t[e])}var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];Se(e,{name:n=_e(n),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{aj:!0})},Ma:function(e,t){var n="std::string"===(t=_e(t));Se(e,{name:t,fromWireType:function(e){var t=I[e>>2],r=e+4;if(n)for(var a=r,o=0;o<=t;++o){var s=r+o;if(o==t||0==_[s]){if(a=R(a,s-a),void 0===i)var i=a;else i+=String.fromCharCode(0),i+=a;a=s+1}}else{for(i=Array(t),o=0;o<t;++o)i[o]=String.fromCharCode(_[r+o]);i=i.join("")}return Vr(e),i},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||Ee("Cannot pass non-string to std::string");var a=n&&r?D(t):t.length,o=zr(4+a+1),s=o+4;if(I[o>>2]=a,n&&r)O(t,s,a+1);else if(r)for(r=0;r<a;++r){var i=t.charCodeAt(r);255<i&&(Vr(s),Ee("String has UTF-16 code units that do not fit in 8 bits")),_[s+r]=i}else for(r=0;r<a;++r)_[s+r]=t[r];return null!==e&&e.push(Vr,o),o},argPackAdvance:8,readValueFromPointer:ce,rh:function(e){Vr(e)}})},ka:function(e,t,n){if(n=_e(n),2===t)var r=ht,a=pt,o=ft,s=()=>E,i=1;else 4===t&&(r=dt,a=mt,o=gt,s=()=>I,i=2);Se(e,{name:n,fromWireType:function(e){for(var n,a=I[e>>2],o=s(),u=e+4,l=0;l<=a;++l){var c=e+4+l*t;l!=a&&0!=o[c>>i]||(u=r(u,c-u),void 0===n?n=u:(n+=String.fromCharCode(0),n+=u),u=c+t)}return Vr(e),n},toWireType:function(e,r){"string"!=typeof r&&Ee("Cannot pass non-string to C++ string type "+n);var s=o(r),u=zr(4+s+t);return I[u>>2]=s>>i,a(r,u+4,s+t),null!==e&&e.push(Vr,u),u},argPackAdvance:8,readValueFromPointer:ce,rh:function(e){Vr(e)}})},Of:function(e,t,n,r,a,o){ue[e]={name:_e(t),ei:qe(n,r),Ah:qe(a,o),ni:[]}},Oa:function(e,t,n,r,a,o,s,i,u,l){ue[e].ni.push({Ti:_e(t),Zi:n,Xi:qe(r,a),Yi:o,jj:s,ij:qe(i,u),kj:l})},Df:function(e,t){Se(e,{Nj:!0,name:t=_e(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},lc:function(){return!0},cc:function(){throw 1/0},pd:nt,Ad:function(e){4<e&&(tt[e].fi+=1)},ed:function(e,t){return e=(e=ot(e,"_emval_take_value")).readValueFromPointer(t),rt(e)},mc:function(e,t){e=new Date(1e3*(I[e>>2]+4294967296*S[e+4>>2])),S[t>>2]=e.getUTCSeconds(),S[t+4>>2]=e.getUTCMinutes(),S[t+8>>2]=e.getUTCHours(),S[t+12>>2]=e.getUTCDate(),S[t+16>>2]=e.getUTCMonth(),S[t+20>>2]=e.getUTCFullYear()-1900,S[t+24>>2]=e.getUTCDay(),S[t+28>>2]=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},nc:function(e,t){e=new Date(1e3*(I[e>>2]+4294967296*S[e+4>>2])),S[t>>2]=e.getSeconds(),S[t+4>>2]=e.getMinutes(),S[t+8>>2]=e.getHours(),S[t+12>>2]=e.getDate(),S[t+16>>2]=e.getMonth(),S[t+20>>2]=e.getFullYear()-1900,S[t+24>>2]=e.getDay();var n=new Date(e.getFullYear(),0,1);S[t+28>>2]=(e.getTime()-n.getTime())/864e5|0,S[t+36>>2]=-60*e.getTimezoneOffset();var r=new Date(e.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),S[t+32>>2]=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r))},oc:function(e){var t=new Date(S[e+20>>2]+1900,S[e+16>>2],S[e+12>>2],S[e+8>>2],S[e+4>>2],S[e>>2],0),n=S[e+32>>2],r=t.getTimezoneOffset(),a=new Date(t.getFullYear(),0,1),o=new Date(t.getFullYear(),6,1).getTimezoneOffset(),s=a.getTimezoneOffset(),i=Math.min(s,o);return 0>n?S[e+32>>2]=Number(o!=s&&i==r):0<n!=(i==r)&&(o=Math.max(s,o),t.setTime(t.getTime()+6e4*((0<n?i:o)-r))),S[e+24>>2]=t.getDay(),S[e+28>>2]=(t.getTime()-a.getTime())/864e5|0,S[e>>2]=t.getSeconds(),S[e+4>>2]=t.getMinutes(),S[e+8>>2]=t.getHours(),S[e+12>>2]=t.getDate(),S[e+16>>2]=t.getMonth(),S[e+20>>2]=t.getYear(),t.getTime()/1e3|0},qc:function e(t,n,r){e.Pi||(e.Pi=!0,function(e,t,n){function r(e){return(e=e.toTimeString().match(/\(([A-Za-z ]+)\)$/))?e[1]:"GMT"}var a=(new Date).getFullYear(),o=new Date(a,0,1),s=new Date(a,6,1);a=o.getTimezoneOffset();var i=s.getTimezoneOffset();S[e>>2]=60*Math.max(a,i),S[t>>2]=Number(a!=i),e=r(o),t=r(s),e=yt(e),t=yt(t),i<a?(I[n>>2]=e,I[n+4>>2]=t):(I[n>>2]=t,I[n+4>>2]=e)}(t,n,r))},J:function(){q("")},Ac:function(e,n,r){if(!t.Nh){if(!window.AudioContext){if(!window.webkitAudioContext)return;window.AudioContext=window.webkitAudioContext}t.Nh=new AudioContext}for(var a=new ArrayBuffer(n),o=new Uint8Array(a),s=0;s<n;s++)o[s]=_[s+e];t.Nh.decodeAudioData(a,(function(e){t.Jh&&(t.Jh.stop(),t.Jh=null);var n=t.Nh.createBufferSource();t.Jh=n,n.loop=r,n.buffer=e,n.connect(t.Nh.destination),n.start(0)}))},pc:function(){t.Nh&&t.Jh&&(t.Jh.stop(),t.Jh=null)},Nb:function(e){try{var t=Function('return (function() {}.constructor("return this")( ));')()}catch(e){t=window}var n;for(n in t)if(8==n.length&&116==n.charCodeAt(7)&&101==n.charCodeAt(5)&&117==n.charCodeAt(3)&&100==n.charCodeAt(0)){var r=n;break}for(var a in t[r])if(6==a.length&&110==a.charCodeAt(5)&&100==a.charCodeAt(0)){var o=a;break}return t[r][o].charCodeAt(e)},nb:function(e,t,n,r,a){if(62e3!=e)n=0;else{if(t)for(;;){if(12321==(e=S[t>>2]))rn.alpha=0<S[t+4>>2];else if(12325==e)rn.depth=0<S[t+4>>2];else if(12326==e)rn.stencil=0<S[t+4>>2];else if(12337==e)e=S[t+4>>2],rn.antialias=0<e;else if(12338==e)e=S[t+4>>2],rn.antialias=1==e;else if(12544==e)rn.Oj=12547!=S[t+4>>2];else if(12344==e)break;t+=8}n&&r||a?(a&&(S[a>>2]=1),n&&0<r&&(S[n>>2]=62002),n=1):n=0}return n},Aa:function(e,n,r,a){if(62e3!=e)return 0;for(e=1;;){if(12440!=(n=S[a>>2])){if(12344==n)break;return 0}e=S[a+4>>2],a+=8}return 2!=e?0:(rn.ci=e-1,rn.Pj=0,0!=(Jt=wn(t.canvas,rn))?(_n(Jt),t.sj=!0,Lt.forEach((function(e){e()})),_n(null),62004):0)},Ba:function(e,t){return 62e3!=e||62002!=t?0:62006},za:function(e,t){return 62e3!=e||62004!=t?0:(En===dn[e=Jt]&&(En=null),"object"==typeof JSEvents&&JSEvents.Tj(dn[e].Dh.canvas),dn[e]&&dn[e].Dh.canvas&&(dn[e].Dh.canvas.wi=void 0),dn[e]=null,en==t&&(en=0),1)},ya:function(e,t){return 62e3!=e?0:(62006!=t||(tn==t&&(tn=0),nn==t&&(nn=0)),1)},pb:function(){return 62e3},ob:function(e,t,n){return 62e3!=e?0:(t&&(S[t>>2]=1),n&&(S[n>>2]=4),Zt=!0,1)},O:function(e,t,n,r){return 62e3!=e||0!=r&&62004!=r||0!=n&&62006!=n||0!=t&&62006!=t?0:(_n(r?Jt:null),en=r,nn=t,tn=n,1)},Z:function(e,t){if(62e3!=e)return 0;if(an[t])return an[t];switch(t){case 12371:e=yt("Emscripten");break;case 12372:e=yt("1.4 Emscripten EGL");break;case 12373:e=yt("");break;case 12429:e=yt("OpenGL_ES");break;default:return 0}return an[t]=e},xa:function(){return Zt&&t.Oh&&!t.Oh.isContextLost()?1:0},wa:function(e,t){return 62e3!=e?0:(0==t?bt(0,0):bt(1,t),1)},mb:function(e){return 62e3!=e?0:(nn=tn=en=0,Zt=!1,1)},u:function(e,t,n){var r;for(In.length=0,n>>=2;r=_[t++];)n+=105!=r&n,In.push(105==r?S[n]:C[n++>>1]),++n;return J[e].apply(null,In)},Ob:function(e,t,n,r,a,o,s,i){function u(){if(s){var e=0;if(c.statusText){var t=D(c.statusText)+1;e=Yr(t),O(c.statusText,e,t)}ie(s)(h,r,c.status,e)}}var l=R(e);e=R(t),n=R(n);var c=new XMLHttpRequest;c.open(e,l,!0),c.responseType="arraybuffer";var h=function(){var e=Cn;return Cn++,e}();return c.onload=function(){if(200<=c.status&&300>c.status||0===c.status&&"http"!=l.substr(0,4).toLowerCase()){var e=new Uint8Array(c.response),t=zr(e.length);_.set(e,t),o&&ie(o)(h,r,t,e.length),a&&Vr(t)}else u();delete kn[h]},c.onerror=function(){u(),delete kn[h]},c.onprogress=function(e){i&&ie(i)(h,r,e.loaded,e.lengthComputable||void 0===e.lengthComputable?e.total:0)},c.onabort=function(){delete kn[h]},"POST"==e?(c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(n)):c.send(null),kn[h]=c,h},ja:function(){return Date.now()},Lc:function(e){y=!1,j=0,vt(e)},ec:function(){return 2147483648},_:lt,ff:function(e){$r.activeTexture(e)},ef:function(e,t){$r.attachShader(un[e],pn[t])},wf:function(e,t){$r.sh.beginQueryEXT(e,mn[t])},df:function(e,t,n){$r.bindAttribLocation(un[e],t,R(n))},cf:function(e,t){$r.bindBuffer(e,sn[t])},af:function(e,t){$r.bindFramebuffer(e,ln[t])},$e:function(e,t){$r.bindRenderbuffer(e,cn[t])},_e:function(e,t){$r.bindTexture(e,hn[t])},of:function(e){$r.bindVertexArray(fn[e])},Ze:function(e,t,n,r){$r.blendColor(e,t,n,r)},Ye:function(e){$r.blendEquation(e)},Xe:function(e,t){$r.blendEquationSeparate(e,t)},We:function(e,t){$r.blendFunc(e,t)},Ve:function(e,t,n,r){$r.blendFuncSeparate(e,t,n,r)},Ue:function(e,t,n,r){$r.bufferData(e,n?_.subarray(n,n+t):t,r)},Te:function(e,t,n,r){$r.bufferSubData(e,t,_.subarray(r,r+n))},Re:function(e){return $r.checkFramebufferStatus(e)},Qe:function(e){$r.clear(e)},Pe:function(e,t,n,r){$r.clearColor(e,t,n,r)},Oe:function(e){$r.clearDepth(e)},Ne:function(e){$r.clearStencil(e)},Me:function(e,t,n,r){$r.colorMask(!!e,!!t,!!n,!!r)},Le:function(e){$r.compileShader(pn[e])},Ke:function(e,t,n,r,a,o,s,i){$r.compressedTexImage2D(e,t,n,r,a,o,i?_.subarray(i,i+s):null)},Je:function(e,t,n,r,a,o,s,i,u){$r.compressedTexSubImage2D(e,t,n,r,a,o,s,u?_.subarray(u,u+i):null)},Ie:function(e,t,n,r,a,o,s,i){$r.copyTexImage2D(e,t,n,r,a,o,s,i)},He:function(e,t,n,r,a,o,s,i){$r.copyTexSubImage2D(e,t,n,r,a,o,s,i)},Ge:function(){var e=vn(un),t=$r.createProgram();return t.name=e,t.zh=t.xh=t.yh=0,t.Zh=1,un[e]=t,e},Fe:function(e){var t=vn(pn);return pn[t]=$r.createShader(e),t},Ee:function(e){$r.cullFace(e)},De:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=sn[r];a&&($r.deleteBuffer(a),a.name=0,sn[r]=null)}},Ce:function(e,t){for(var n=0;n<e;++n){var r=S[t+4*n>>2],a=ln[r];a&&($r.deleteFramebuffer(a),a.name=0,ln[r]=null)}},Be:function(e){if(e){var t=un[e];t?($r.deleteProgram(t),t.name=0,un[e]=null):bn(1281)}},zf:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=mn[r];a&&($r.sh.deleteQueryEXT(a),mn[r]=null)}},Ae:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=cn[r];a&&($r.deleteRenderbuffer(a),a.name=0,cn[r]=null)}},ze:function(e){if(e){var t=pn[e];t?($r.deleteShader(t),pn[e]=null):bn(1281)}},ye:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=hn[r];a&&($r.deleteTexture(a),a.name=0,hn[r]=null)}},nf:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2];$r.deleteVertexArray(fn[r]),fn[r]=null}},xe:function(e){$r.depthFunc(e)},we:function(e){$r.depthMask(!!e)},ve:function(e,t){$r.depthRange(e,t)},ue:function(e,t){$r.detachShader(un[e],pn[t])},te:function(e){$r.disable(e)},se:function(e){$r.disableVertexAttribArray(e)},re:function(e,t,n){$r.drawArrays(e,t,n)},jf:function(e,t,n,r){$r.drawArraysInstanced(e,t,n,r)},kf:function(e,t){for(var n=Nn[e],r=0;r<e;r++)n[r]=S[t+4*r>>2];$r.drawBuffers(n)},qe:function(e,t,n,r){$r.drawElements(e,t,n,r)},hf:function(e,t,n,r,a){$r.drawElementsInstanced(e,t,n,r,a)},pe:function(e){$r.enable(e)},oe:function(e){$r.enableVertexAttribArray(e)},vf:function(e){$r.sh.endQueryEXT(e)},ne:function(){$r.finish()},me:function(){$r.flush()},le:function(e,t,n,r){$r.framebufferRenderbuffer(e,t,n,cn[r])},ke:function(e,t,n,r,a){$r.framebufferTexture2D(e,t,n,hn[r],a)},je:function(e){$r.frontFace(e)},ie:function(e,t){An(e,t,"createBuffer",sn)},ge:function(e,t){An(e,t,"createFramebuffer",ln)},Af:function(e,t){for(var n=0;n<e;n++){var r=$r.sh.createQueryEXT();if(!r){for(bn(1282);n<e;)S[t+4*n++>>2]=0;break}var a=vn(mn);r.name=a,mn[a]=r,S[t+4*n>>2]=a}},fe:function(e,t){An(e,t,"createRenderbuffer",cn)},ee:function(e,t){An(e,t,"createTexture",hn)},mf:function(e,t){An(e,t,"createVertexArray",fn)},he:function(e){$r.generateMipmap(e)},de:function(e,t,n,r,a,o,s){$n("getActiveAttrib",e,t,n,r,a,o,s)},ce:function(e,t,n,r,a,o,s){$n("getActiveUniform",e,t,n,r,a,o,s)},be:function(e,t,n,r){var a=(e=$r.getAttachedShaders(un[e])).length;for(a>t&&(a=t),S[n>>2]=a,t=0;t<a;++t)S[r+4*t>>2]=pn.indexOf(e[t])},ae:function(e,t){return $r.getAttribLocation(un[e],R(t))},$d:function(e,t){Fn(e,t,4)},_d:function(e,t,n){n?S[n>>2]=$r.getBufferParameter(e,t):bn(1281)},Zd:function(){var e=$r.getError()||Tn;return Tn=0,e},Yd:function(e,t){Fn(e,t,2)},Xd:function(e,t,n,r){((e=$r.getFramebufferAttachmentParameter(e,t,n))instanceof WebGLRenderbuffer||e instanceof WebGLTexture)&&(e=0|e.name),S[r>>2]=e},Wd:function(e,t){Fn(e,t,0)},Td:function(e,t,n,r){null===(e=$r.getProgramInfoLog(un[e]))&&(e="(unknown error)"),t=0<t&&r?O(e,r,t):0,n&&(S[n>>2]=t)},Ud:function(e,t,n){if(n)if(e>=on)bn(1281);else if(e=un[e],35716==t)null===(e=$r.getProgramInfoLog(e))&&(e="(unknown error)"),S[n>>2]=e.length+1;else if(35719==t){if(!e.zh)for(t=0;t<$r.getProgramParameter(e,35718);++t)e.zh=Math.max(e.zh,$r.getActiveUniform(e,t).name.length+1);S[n>>2]=e.zh}else if(35722==t){if(!e.xh)for(t=0;t<$r.getProgramParameter(e,35721);++t)e.xh=Math.max(e.xh,$r.getActiveAttrib(e,t).name.length+1);S[n>>2]=e.xh}else if(35381==t){if(!e.yh)for(t=0;t<$r.getProgramParameter(e,35382);++t)e.yh=Math.max(e.yh,$r.getActiveUniformBlockName(e,t).length+1);S[n>>2]=e.yh}else S[n>>2]=$r.getProgramParameter(e,t);else bn(1281)},qf:function(e,t,n){n?Rn(n,"boolean"==typeof(e=$r.sh.getQueryObjectEXT(mn[e],t))?e?1:0:e):bn(1281)},sf:function(e,t,n){var r;n?(r="boolean"==typeof(e=$r.sh.getQueryObjectEXT(mn[e],t))?e?1:0:e,S[n>>2]=r):bn(1281)},pf:function(e,t,n){n?Rn(n,"boolean"==typeof(e=$r.sh.getQueryObjectEXT(mn[e],t))?e?1:0:e):bn(1281)},rf:function(e,t,n){var r;n?(r="boolean"==typeof(e=$r.sh.getQueryObjectEXT(mn[e],t))?e?1:0:e,S[n>>2]=r):bn(1281)},tf:function(e,t,n){n?S[n>>2]=$r.sh.getQueryEXT(e,t):bn(1281)},Sd:function(e,t,n){n?S[n>>2]=$r.getRenderbufferParameter(e,t):bn(1281)},Qd:function(e,t,n,r){null===(e=$r.getShaderInfoLog(pn[e]))&&(e="(unknown error)"),t=0<t&&r?O(e,r,t):0,n&&(S[n>>2]=t)},Pd:function(e,t,n,r){e=$r.getShaderPrecisionFormat(e,t),S[n>>2]=e.rangeMin,S[n+4>>2]=e.rangeMax,S[r>>2]=e.precision},Od:function(e,t,n,r){(e=$r.getShaderSource(pn[e]))&&(t=0<t&&r?O(e,r,t):0,n&&(S[n>>2]=t))},Rd:function(e,t,n){n?35716==t?(null===(e=$r.getShaderInfoLog(pn[e]))&&(e="(unknown error)"),S[n>>2]=e?e.length+1:0):35720==t?(e=$r.getShaderSource(pn[e]),S[n>>2]=e?e.length+1:0):S[n>>2]=$r.getShaderParameter(pn[e],t):bn(1281)},Nd:function(e){var t=gn[e];if(!t){switch(e){case 7939:t=(t=$r.getSupportedExtensions()||[]).concat(t.map((function(e){return"GL_"+e}))),t=On(t.join(" "));break;case 7936:case 7937:case 37445:case 37446:(t=$r.getParameter(e))||bn(1280),t=t&&On(t);break;case 7938:t=On("OpenGL ES 2.0 ("+$r.getParameter(7938)+")");break;case 35724:var n=(t=$r.getParameter(35724)).match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==n&&(3==n[1].length&&(n[1]+="0"),t="OpenGL ES GLSL ES "+n[1]+" ("+t+")"),t=On(t);break;default:bn(1280)}gn[e]=t}return t},Md:function(e,t,n){n?k[n>>2]=$r.getTexParameter(e,t):bn(1281)},Ld:function(e,t,n){n?S[n>>2]=$r.getTexParameter(e,t):bn(1281)},Id:function(e,t){if(t=R(t),e=un[e]){Mn(e);var n=e.Ih,r=0,a=t,o=Dn(t);if(0<o&&(r=parseInt(t.slice(o+1))>>>0,a=t.slice(0,o)),(a=e.$h[a])&&r<a[0]&&(n[r+=a[1]]=n[r]||$r.getUniformLocation(e,t)))return r}else bn(1281);return-1},Kd:function(e,t,n){Pn(e,t,n,2)},Jd:function(e,t,n){Pn(e,t,n,0)},Fd:function(e,t,n){n?S[n>>2]=$r.getVertexAttribOffset(e,t):bn(1281)},Hd:function(e,t,n){Bn(e,t,n,2)},Gd:function(e,t,n){Bn(e,t,n,5)},Ed:function(e,t){$r.hint(e,t)},Dd:function(e){return(e=sn[e])?$r.isBuffer(e):0},Cd:function(e){return $r.isEnabled(e)},Bd:function(e){return(e=ln[e])?$r.isFramebuffer(e):0},zd:function(e){return(e=un[e])?$r.isProgram(e):0},yf:function(e){return(e=mn[e])?$r.sh.isQueryEXT(e):0},yd:function(e){return(e=cn[e])?$r.isRenderbuffer(e):0},xd:function(e){return(e=pn[e])?$r.isShader(e):0},wd:function(e){return(e=hn[e])?$r.isTexture(e):0},lf:function(e){return(e=fn[e])?$r.isVertexArray(e):0},vd:function(e){$r.lineWidth(e)},ud:function(e){e=un[e],$r.linkProgram(e),e.Ih=0,e.$h={}},td:function(e,t){3317==e&&(yn=t),$r.pixelStorei(e,t)},sd:function(e,t){$r.polygonOffset(e,t)},uf:function(e,t){$r.sh.queryCounterEXT(mn[e],t)},rd:function(e,t,n,r,a,o,s){(s=Un(o,a,n,r,s))?$r.readPixels(e,t,n,r,a,o,s):bn(1280)},qd:function(){},od:function(e,t,n,r){$r.renderbufferStorage(e,t,n,r)},nd:function(e,t){$r.sampleCoverage(e,!!t)},md:function(e,t,n,r){$r.scissor(e,t,n,r)},ld:function(){bn(1280)},kd:function(e,t,n,r){t=xn(t,n,r),$r.shaderSource(pn[e],t)},jd:function(e,t,n){$r.stencilFunc(e,t,n)},id:function(e,t,n,r){$r.stencilFuncSeparate(e,t,n,r)},hd:function(e){$r.stencilMask(e)},gd:function(e,t){$r.stencilMaskSeparate(e,t)},fd:function(e,t,n){$r.stencilOp(e,t,n)},dd:function(e,t,n,r){$r.stencilOpSeparate(e,t,n,r)},cd:function(e,t,n,r,a,o,s,i,u){$r.texImage2D(e,t,n,r,a,o,s,i,u?Un(i,s,r,a,u):null)},bd:function(e,t,n){$r.texParameterf(e,t,n)},ad:function(e,t,n){$r.texParameterf(e,t,k[n>>2])},$c:function(e,t,n){$r.texParameteri(e,t,n)},_c:function(e,t,n){$r.texParameteri(e,t,S[n>>2])},Zc:function(e,t,n,r,a,o,s,i,u){var l=null;u&&(l=Un(i,s,a,o,u)),$r.texSubImage2D(e,t,n,r,a,o,s,i,l)},Yc:function(e,t){$r.uniform1f(Ln(e),t)},Xc:function(e,t,n){if(288>=t)for(var r=zn[t-1],a=0;a<t;++a)r[a]=k[n+4*a>>2];else r=k.subarray(n>>2,n+4*t>>2);$r.uniform1fv(Ln(e),r)},Wc:function(e,t){$r.uniform1i(Ln(e),t)},Vc:function(e,t,n){if(288>=t)for(var r=Vn[t-1],a=0;a<t;++a)r[a]=S[n+4*a>>2];else r=S.subarray(n>>2,n+4*t>>2);$r.uniform1iv(Ln(e),r)},Uc:function(e,t,n){$r.uniform2f(Ln(e),t,n)},Tc:function(e,t,n){if(144>=t)for(var r=zn[2*t-1],a=0;a<2*t;a+=2)r[a]=k[n+4*a>>2],r[a+1]=k[n+(4*a+4)>>2];else r=k.subarray(n>>2,n+8*t>>2);$r.uniform2fv(Ln(e),r)},Sc:function(e,t,n){$r.uniform2i(Ln(e),t,n)},Rc:function(e,t,n){if(144>=t)for(var r=Vn[2*t-1],a=0;a<2*t;a+=2)r[a]=S[n+4*a>>2],r[a+1]=S[n+(4*a+4)>>2];else r=S.subarray(n>>2,n+8*t>>2);$r.uniform2iv(Ln(e),r)},Qc:function(e,t,n,r){$r.uniform3f(Ln(e),t,n,r)},Pc:function(e,t,n){if(96>=t)for(var r=zn[3*t-1],a=0;a<3*t;a+=3)r[a]=k[n+4*a>>2],r[a+1]=k[n+(4*a+4)>>2],r[a+2]=k[n+(4*a+8)>>2];else r=k.subarray(n>>2,n+12*t>>2);$r.uniform3fv(Ln(e),r)},Oc:function(e,t,n,r){$r.uniform3i(Ln(e),t,n,r)},Nc:function(e,t,n){if(96>=t)for(var r=Vn[3*t-1],a=0;a<3*t;a+=3)r[a]=S[n+4*a>>2],r[a+1]=S[n+(4*a+4)>>2],r[a+2]=S[n+(4*a+8)>>2];else r=S.subarray(n>>2,n+12*t>>2);$r.uniform3iv(Ln(e),r)},Mc:function(e,t,n,r,a){$r.uniform4f(Ln(e),t,n,r,a)},Kc:function(e,t,n){if(72>=t){var r=zn[4*t-1],a=k;n>>=2;for(var o=0;o<4*t;o+=4){var s=n+o;r[o]=a[s],r[o+1]=a[s+1],r[o+2]=a[s+2],r[o+3]=a[s+3]}}else r=k.subarray(n>>2,n+16*t>>2);$r.uniform4fv(Ln(e),r)},Jc:function(e,t,n,r,a){$r.uniform4i(Ln(e),t,n,r,a)},Ic:function(e,t,n){if(72>=t)for(var r=Vn[4*t-1],a=0;a<4*t;a+=4)r[a]=S[n+4*a>>2],r[a+1]=S[n+(4*a+4)>>2],r[a+2]=S[n+(4*a+8)>>2],r[a+3]=S[n+(4*a+12)>>2];else r=S.subarray(n>>2,n+16*t>>2);$r.uniform4iv(Ln(e),r)},Hc:function(e,t,n,r){if(72>=t)for(var a=zn[4*t-1],o=0;o<4*t;o+=4)a[o]=k[r+4*o>>2],a[o+1]=k[r+(4*o+4)>>2],a[o+2]=k[r+(4*o+8)>>2],a[o+3]=k[r+(4*o+12)>>2];else a=k.subarray(r>>2,r+16*t>>2);$r.uniformMatrix2fv(Ln(e),!!n,a)},Gc:function(e,t,n,r){if(32>=t)for(var a=zn[9*t-1],o=0;o<9*t;o+=9)a[o]=k[r+4*o>>2],a[o+1]=k[r+(4*o+4)>>2],a[o+2]=k[r+(4*o+8)>>2],a[o+3]=k[r+(4*o+12)>>2],a[o+4]=k[r+(4*o+16)>>2],a[o+5]=k[r+(4*o+20)>>2],a[o+6]=k[r+(4*o+24)>>2],a[o+7]=k[r+(4*o+28)>>2],a[o+8]=k[r+(4*o+32)>>2];else a=k.subarray(r>>2,r+36*t>>2);$r.uniformMatrix3fv(Ln(e),!!n,a)},Fc:function(e,t,n,r){if(18>=t){var a=zn[16*t-1],o=k;r>>=2;for(var s=0;s<16*t;s+=16){var i=r+s;a[s]=o[i],a[s+1]=o[i+1],a[s+2]=o[i+2],a[s+3]=o[i+3],a[s+4]=o[i+4],a[s+5]=o[i+5],a[s+6]=o[i+6],a[s+7]=o[i+7],a[s+8]=o[i+8],a[s+9]=o[i+9],a[s+10]=o[i+10],a[s+11]=o[i+11],a[s+12]=o[i+12],a[s+13]=o[i+13],a[s+14]=o[i+14],a[s+15]=o[i+15]}}else a=k.subarray(r>>2,r+64*t>>2);$r.uniformMatrix4fv(Ln(e),!!n,a)},Ec:function(e){e=un[e],$r.useProgram(e),$r.ki=e},Dc:function(e){$r.validateProgram(un[e])},Cc:function(e,t){$r.vertexAttrib1f(e,t)},Bc:function(e,t){$r.vertexAttrib1f(e,k[t>>2])},zc:function(e,t,n){$r.vertexAttrib2f(e,t,n)},yc:function(e,t){$r.vertexAttrib2f(e,k[t>>2],k[t+4>>2])},xc:function(e,t,n,r){$r.vertexAttrib3f(e,t,n,r)},wc:function(e,t){$r.vertexAttrib3f(e,k[t>>2],k[t+4>>2],k[t+8>>2])},vc:function(e,t,n,r,a){$r.vertexAttrib4f(e,t,n,r,a)},uc:function(e,t){$r.vertexAttrib4f(e,k[t>>2],k[t+4>>2],k[t+8>>2],k[t+12>>2])},gf:function(e,t){$r.vertexAttribDivisor(e,t)},tc:function(e,t,n,r,a,o){$r.vertexAttribPointer(e,t,n,!!r,a,o)},sc:function(e,t,n,r){$r.viewport(e,t,n,r)},rc:function(e,t,n){_.copyWithin(e,t,t+n)},dc:function(e){var t=_.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var a=Math;r=Math.max(e,r),a=a.min.call(a,2147483648,r+(65536-r%65536)%65536);e:{try{b.grow(a-x.byteLength+65535>>>16),M();var o=1;break e}catch(e){}o=void 0}if(o)return!0}return!1},lb:function(e,n){Kt(t.canvas,e,n),Ht()},fc:function(e,t){var n=0;return jn().forEach((function(r,a){var o=t+n;for(a=I[e+4*a>>2]=o,o=0;o<r.length;++o)w[a++>>0]=r.charCodeAt(o);w[a>>0]=0,n+=r.length+1})),0},gc:function(e,t){var n=jn();I[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),I[t>>2]=r,0},Hf:vt,Ja:function(){return 52},ic:function(){return 52},Sb:function(){return 70},Ka:function(e,t,n,r){for(var a=0,o=0;o<n;o++){var s=I[t>>2],i=I[t+4>>2];t+=8;for(var u=0;u<i;u++)Kn(e,_[s+u]);a+=i}return I[r>>2]=a,0},$b:function e(t,n){e.ri||(e.ri=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}return()=>q("randomDevice")}());for(var r=0;r<n;r++)w[t+r>>0]=e.ri();return 0},$a:function(e){$r.activeTexture(e)},ib:function(e,t){$r.attachShader(un[e],pn[t])},B:function(e,t){$r.bindBuffer(e,sn[t])},v:function(e,t){$r.bindFramebuffer(e,ln[t])},S:function(e,t){$r.bindRenderbuffer(e,cn[t])},F:function(e,t){$r.bindTexture(e,hn[t])},Qf:function(e,t,n,r){$r.blendColor(e,t,n,r)},Rf:function(e,t){$r.blendEquationSeparate(e,t)},Sf:function(e,t,n,r){$r.blendFuncSeparate(e,t,n,r)},Pa:function(e,t,n,r){$r.bufferData(e,n?_.subarray(n,n+t):t,r)},Ua:function(e,t,n,r){$r.bufferSubData(e,t,_.subarray(r,r+n))},sa:function(e){return $r.checkFramebufferStatus(e)},Lf:function(e){$r.clear(e)},Ta:function(e,t,n,r){$r.clearColor(e,t,n,r)},Nf:function(e){$r.clearDepth(e)},Mf:function(e){$r.clearStencil(e)},ca:function(e,t,n,r){$r.colorMask(!!e,!!t,!!n,!!r)},Wf:function(e){$r.compileShader(pn[e])},qb:function(e,t,n,r,a,o,s,i){$r.compressedTexImage2D(e,t,n,r,a,o,i?_.subarray(i,i+s):null)},_f:function(e,t,n,r,a,o,s,i,u){$r.compressedTexSubImage2D(e,t,n,r,a,o,s,u?_.subarray(u,u+i):null)},hg:function(){var e=vn(un),t=$r.createProgram();return t.name=e,t.zh=t.xh=t.yh=0,t.Zh=1,un[e]=t,e},Yf:function(e){var t=vn(pn);return pn[t]=$r.createShader(e),t},Va:function(e){$r.cullFace(e)},bb:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=sn[r];a&&($r.deleteBuffer(a),a.name=0,sn[r]=null)}},ra:function(e,t){for(var n=0;n<e;++n){var r=S[t+4*n>>2],a=ln[r];a&&($r.deleteFramebuffer(a),a.name=0,ln[r]=null)}},hb:function(e){if(e){var t=un[e];t?($r.deleteProgram(t),t.name=0,un[e]=null):bn(1281)}},ua:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=cn[r];a&&($r.deleteRenderbuffer(a),a.name=0,cn[r]=null)}},Za:function(e){if(e){var t=pn[e];t?($r.deleteShader(t),pn[e]=null):bn(1281)}},fa:function(e,t){for(var n=0;n<e;n++){var r=S[t+4*n>>2],a=hn[r];a&&($r.deleteTexture(a),a.name=0,hn[r]=null)}},X:function(e){$r.depthFunc(e)},pa:function(e){$r.depthMask(!!e)},gb:function(e,t){$r.detachShader(un[e],pn[t])},x:function(e){$r.disable(e)},eb:function(e){$r.disableVertexAttribArray(e)},Sa:function(e,t,n){$r.drawArrays(e,t,n)},Ra:function(e,t,n,r){$r.drawElements(e,t,n,r)},G:function(e){$r.enable(e)},db:function(e){$r.enableVertexAttribArray(e)},Pf:function(){$r.flush()},ta:function(e,t,n,r){$r.framebufferRenderbuffer(e,t,n,cn[r])},da:function(e,t,n,r,a){$r.framebufferTexture2D(e,t,n,hn[r],a)},Qa:function(e,t){An(e,t,"createBuffer",sn)},ea:function(e,t){An(e,t,"createFramebuffer",ln)},va:function(e,t){An(e,t,"createRenderbuffer",cn)},ha:function(e,t){An(e,t,"createTexture",hn)},_a:function(e){$r.generateMipmap(e)},eg:function(e,t,n,r,a,o,s){$n("getActiveAttrib",e,t,n,r,a,o,s)},dg:function(e,t,n,r,a,o,s){$n("getActiveUniform",e,t,n,r,a,o,s)},fb:function(e,t){return $r.getAttribLocation(un[e],R(t))},A:function(){var e=$r.getError()||Tn;return Tn=0,e},ig:function(e,t){Fn(e,t,2)},U:function(e,t){Fn(e,t,0)},fg:function(e,t,n,r){null===(e=$r.getProgramInfoLog(un[e]))&&(e="(unknown error)"),t=0<t&&r?O(e,r,t):0,n&&(S[n>>2]=t)},T:function(e,t,n){if(n)if(e>=on)bn(1281);else if(e=un[e],35716==t)null===(e=$r.getProgramInfoLog(e))&&(e="(unknown error)"),S[n>>2]=e.length+1;else if(35719==t){if(!e.zh)for(t=0;t<$r.getProgramParameter(e,35718);++t)e.zh=Math.max(e.zh,$r.getActiveUniform(e,t).name.length+1);S[n>>2]=e.zh}else if(35722==t){if(!e.xh)for(t=0;t<$r.getProgramParameter(e,35721);++t)e.xh=Math.max(e.xh,$r.getActiveAttrib(e,t).name.length+1);S[n>>2]=e.xh}else if(35381==t){if(!e.yh)for(t=0;t<$r.getProgramParameter(e,35382);++t)e.yh=Math.max(e.yh,$r.getActiveUniformBlockName(e,t).length+1);S[n>>2]=e.yh}else S[n>>2]=$r.getProgramParameter(e,t);else bn(1281)},Uf:function(e,t,n,r){null===(e=$r.getShaderInfoLog(pn[e]))&&(e="(unknown error)"),t=0<t&&r?O(e,r,t):0,n&&(S[n>>2]=t)},Vf:function(e,t,n){n?35716==t?(null===(e=$r.getShaderInfoLog(pn[e]))&&(e="(unknown error)"),S[n>>2]=e?e.length+1:0):35720==t?(e=$r.getShaderSource(pn[e]),S[n>>2]=e?e.length+1:0):S[n>>2]=$r.getShaderParameter(pn[e],t):bn(1281)},ia:function(e){var t=gn[e];if(!t){switch(e){case 7939:t=(t=$r.getSupportedExtensions()||[]).concat(t.map((function(e){return"GL_"+e}))),t=On(t.join(" "));break;case 7936:case 7937:case 37445:case 37446:(t=$r.getParameter(e))||bn(1280),t=t&&On(t);break;case 7938:t=On("OpenGL ES 2.0 ("+$r.getParameter(7938)+")");break;case 35724:var n=(t=$r.getParameter(35724)).match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==n&&(3==n[1].length&&(n[1]+="0"),t="OpenGL ES GLSL ES "+n[1]+" ("+t+")"),t=On(t);break;default:bn(1280)}gn[e]=t}return t},cg:function(e,t){if(t=R(t),e=un[e]){Mn(e);var n=e.Ih,r=0,a=t,o=Dn(t);if(0<o&&(r=parseInt(t.slice(o+1))>>>0,a=t.slice(0,o)),(a=e.$h[a])&&r<a[0]&&(n[r+=a[1]]=n[r]||$r.getUniformLocation(e,t)))return r}else bn(1281);return-1},gg:function(e){e=un[e],$r.linkProgram(e),e.Ih=0,e.$h={}},ga:function(e,t){3317==e&&(yn=t),$r.pixelStorei(e,t)},ma:function(e,t,n,r,a,o,s){(s=Un(o,a,n,r,s))?$r.readPixels(e,t,n,r,a,o,s):bn(1280)},ab:function(e,t,n,r){$r.renderbufferStorage(e,t,n,r)},qa:function(e,t,n,r){$r.scissor(e,t,n,r)},Xf:function(e,t,n,r){t=xn(t,n,r),$r.shaderSource(pn[e],t)},Xa:function(e,t,n,r){$r.stencilFuncSeparate(e,t,n,r)},Wa:function(e,t,n,r){$r.stencilOpSeparate(e,t,n,r)},kb:function(e,t,n,r,a,o,s,i,u){$r.texImage2D(e,t,n,r,a,o,s,i,u?Un(i,s,r,a,u):null)},bg:function(e,t,n){$r.texParameterf(e,t,n)},ag:function(e,t,n){$r.texParameterf(e,t,k[n>>2])},N:function(e,t,n){$r.texParameteri(e,t,n)},Zf:function(e,t,n,r,a,o,s,i,u){var l=null;u&&(l=Un(i,s,a,o,u)),$r.texSubImage2D(e,t,n,r,a,o,s,i,l)},If:function(e,t){$r.uniform1i(Ln(e),t)},Kf:function(e,t,n){if(288>=t)for(var r=Vn[t-1],a=0;a<t;++a)r[a]=S[n+4*a>>2];else r=S.subarray(n>>2,n+4*t>>2);$r.uniform1iv(Ln(e),r)},oa:function(e,t,n){if(72>=t){var r=zn[4*t-1],a=k;n>>=2;for(var o=0;o<4*t;o+=4){var s=n+o;r[o]=a[s],r[o+1]=a[s+1],r[o+2]=a[s+2],r[o+3]=a[s+3]}}else r=k.subarray(n>>2,n+16*t>>2);$r.uniform4fv(Ln(e),r)},Jf:function(e,t,n,r){if(32>=t)for(var a=zn[9*t-1],o=0;o<9*t;o+=9)a[o]=k[r+4*o>>2],a[o+1]=k[r+(4*o+4)>>2],a[o+2]=k[r+(4*o+8)>>2],a[o+3]=k[r+(4*o+12)>>2],a[o+4]=k[r+(4*o+16)>>2],a[o+5]=k[r+(4*o+20)>>2],a[o+6]=k[r+(4*o+24)>>2],a[o+7]=k[r+(4*o+28)>>2],a[o+8]=k[r+(4*o+32)>>2];else a=k.subarray(r>>2,r+36*t>>2);$r.uniformMatrix3fv(Ln(e),!!n,a)},na:function(e,t,n,r){if(18>=t){var a=zn[16*t-1],o=k;r>>=2;for(var s=0;s<16*t;s+=16){var i=r+s;a[s]=o[i],a[s+1]=o[i+1],a[s+2]=o[i+2],a[s+3]=o[i+3],a[s+4]=o[i+4],a[s+5]=o[i+5],a[s+6]=o[i+6],a[s+7]=o[i+7],a[s+8]=o[i+8],a[s+9]=o[i+9],a[s+10]=o[i+10],a[s+11]=o[i+11],a[s+12]=o[i+12],a[s+13]=o[i+13],a[s+14]=o[i+14],a[s+15]=o[i+15]}}else a=k.subarray(r>>2,r+64*t>>2);$r.uniformMatrix4fv(Ln(e),!!n,a)},Y:function(e){e=un[e],$r.useProgram(e),$r.ki=e},cb:function(e,t,n,r,a,o){$r.vertexAttribPointer(e,t,n,!!r,a,o)},Ya:function(e,t,n,r){$r.viewport(e,t,n,r)},C:function(e,t,n){var r=qr();try{return ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},Ga:function(e,t,n,r){var a=qr();try{return ie(e)(t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},Ha:function(e,t,n,r){var a=qr();try{return ie(e)(t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},s:function(e){var t=qr();try{return ie(e)()}catch(e){if(Xr(t),e!==e+0)throw e;Kr(1,0)}},f:function(e,t){var n=qr();try{return ie(e)(t)}catch(e){if(Xr(n),e!==e+0)throw e;Kr(1,0)}},L:function(e,t,n){var r=qr();try{return ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},Q:function(e,t,n){var r=qr();try{return ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},sb:function(e,t,n,r,a){var o=qr();try{return ie(e)(t,n,r,a)}catch(e){if(Xr(o),e!==e+0)throw e;Kr(1,0)}},b:function(e,t,n){var r=qr();try{return ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},n:function(e,t,n,r){var a=qr();try{return ie(e)(t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},r:function(e,t,n,r,a){var o=qr();try{return ie(e)(t,n,r,a)}catch(e){if(Xr(o),e!==e+0)throw e;Kr(1,0)}},Ia:function(e,t,n,r,a,o){var s=qr();try{return ie(e)(t,n,r,a,o)}catch(e){if(Xr(s),e!==e+0)throw e;Kr(1,0)}},y:function(e,t,n,r,a,o){var s=qr();try{return ie(e)(t,n,r,a,o)}catch(e){if(Xr(s),e!==e+0)throw e;Kr(1,0)}},D:function(e,t,n,r,a,o,s){var i=qr();try{return ie(e)(t,n,r,a,o,s)}catch(e){if(Xr(i),e!==e+0)throw e;Kr(1,0)}},I:function(e,t,n,r,a,o,s,i){var u=qr();try{return ie(e)(t,n,r,a,o,s,i)}catch(e){if(Xr(u),e!==e+0)throw e;Kr(1,0)}},Fa:function(e,t,n,r,a,o,s,i,u){var l=qr();try{return ie(e)(t,n,r,a,o,s,i,u)}catch(e){if(Xr(l),e!==e+0)throw e;Kr(1,0)}},Ea:function(e,t,n,r,a,o,s,i,u,l){var c=qr();try{return ie(e)(t,n,r,a,o,s,i,u,l)}catch(e){if(Xr(c),e!==e+0)throw e;Kr(1,0)}},ba:function(e,t,n,r,a,o,s,i,u,l,c,h){var p=qr();try{return ie(e)(t,n,r,a,o,s,i,u,l,c,h)}catch(e){if(Xr(p),e!==e+0)throw e;Kr(1,0)}},Qb:function(e,t,n,r,a,o,s){var i=qr();try{return ia(e,t,n,r,a,o,s)}catch(e){if(Xr(i),e!==e+0)throw e;Kr(1,0)}},Wb:function(e,t,n,r){var a=qr();try{return na(e,t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},_b:function(e){var t=qr();try{return Zr(e)}catch(e){if(Xr(t),e!==e+0)throw e;Kr(1,0)}},Zb:function(e,t){var n=qr();try{return ea(e,t)}catch(e){if(Xr(n),e!==e+0)throw e;Kr(1,0)}},Ub:function(e,t,n){var r=qr();try{return aa(e,t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},Pb:function(e,t,n,r,a){var o=qr();try{return ua(e,t,n,r,a)}catch(e){if(Xr(o),e!==e+0)throw e;Kr(1,0)}},k:function(e){var t=qr();try{ie(e)()}catch(e){if(Xr(t),e!==e+0)throw e;Kr(1,0)}},i:function(e,t){var n=qr();try{ie(e)(t)}catch(e){if(Xr(n),e!==e+0)throw e;Kr(1,0)}},$:function(e,t,n){var r=qr();try{ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},V:function(e,t,n){var r=qr();try{ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},tb:function(e,t,n,r){var a=qr();try{ie(e)(t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},e:function(e,t,n){var r=qr();try{ie(e)(t,n)}catch(e){if(Xr(r),e!==e+0)throw e;Kr(1,0)}},Da:function(e,t,n,r){var a=qr();try{ie(e)(t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},ub:function(e,t,n,r,a){var o=qr();try{ie(e)(t,n,r,a)}catch(e){if(Xr(o),e!==e+0)throw e;Kr(1,0)}},K:function(e,t,n,r,a,o,s){var i=qr();try{ie(e)(t,n,r,a,o,s)}catch(e){if(Xr(i),e!==e+0)throw e;Kr(1,0)}},P:function(e,t,n,r,a){var o=qr();try{ie(e)(t,n,r,a)}catch(e){if(Xr(o),e!==e+0)throw e;Kr(1,0)}},h:function(e,t,n,r){var a=qr();try{ie(e)(t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},q:function(e,t,n,r,a){var o=qr();try{ie(e)(t,n,r,a)}catch(e){if(Xr(o),e!==e+0)throw e;Kr(1,0)}},t:function(e,t,n,r,a,o){var s=qr();try{ie(e)(t,n,r,a,o)}catch(e){if(Xr(s),e!==e+0)throw e;Kr(1,0)}},rb:function(e,t,n,r,a,o,s){var i=qr();try{ie(e)(t,n,r,a,o,s)}catch(e){if(Xr(i),e!==e+0)throw e;Kr(1,0)}},la:function(e,t,n,r,a,o,s){var i=qr();try{ie(e)(t,n,r,a,o,s)}catch(e){if(Xr(i),e!==e+0)throw e;Kr(1,0)}},w:function(e,t,n,r,a,o,s,i){var u=qr();try{ie(e)(t,n,r,a,o,s,i)}catch(e){if(Xr(u),e!==e+0)throw e;Kr(1,0)}},Gf:function(e,t,n,r,a,o,s,i,u){var l=qr();try{ie(e)(t,n,r,a,o,s,i,u)}catch(e){if(Xr(l),e!==e+0)throw e;Kr(1,0)}},R:function(e,t,n,r,a,o,s,i,u,l,c){var h=qr();try{ie(e)(t,n,r,a,o,s,i,u,l,c)}catch(e){if(Xr(h),e!==e+0)throw e;Kr(1,0)}},Ca:function(e,t,n,r,a,o,s,i,u,l,c,h,p){var f=qr();try{ie(e)(t,n,r,a,o,s,i,u,l,c,h,p)}catch(e){if(Xr(f),e!==e+0)throw e;Kr(1,0)}},aa:function(e,t,n,r,a,o,s,i,u,l,c,h,p,f,d,m){var g=qr();try{ie(e)(t,n,r,a,o,s,i,u,l,c,h,p,f,d,m)}catch(e){if(Xr(g),e!==e+0)throw e;Kr(1,0)}},Rb:function(e,t,n,r,a,o,s){var i=qr();try{sa(e,t,n,r,a,o,s)}catch(e){if(Xr(i),e!==e+0)throw e;Kr(1,0)}},Yb:function(e,t,n,r){var a=qr();try{ta(e,t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},Xb:function(e,t,n,r){var a=qr();try{ra(e,t,n,r)}catch(e){if(Xr(a),e!==e+0)throw e;Kr(1,0)}},Vb:function(){let e=window.localStorage.getItem("k39d");e||(e=function(){let e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){let r=16*Math.random();return 0<e?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===n?r:3&r|8).toString(16)}))}(),window.localStorage.setItem("k39d",e));let t=document.title;t&&0!==t.length||(t="No title");let n=navigator.vendor;n&&0!==n.length||(n="N/A");let r=navigator.platform;r&&0!==r.length||(r="N/A"),Xn=e,Yn=navigator.userAgent,Qn=window.screen.width+"x"+window.screen.height,Jn=t,Zn=document.domain,er="1.0.0",tr=n,rr=nr=r},hc:function(){if(console.assert(null!=En),console.assert(null!=ar),!En||!ar)return-1;if(null!=ur){var e=hn[ur.name];e&&($r.deleteTexture(e),hn[ur.name]=null,e.name=0,ur=null)}const t=(e=En.Dh).createTexture(),n=vn(hn);return t.name=n,hn[n]=t,e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,ar),ur=t,n},vb:function(e){if(null==ir)throw"Vision image has not been processed! Call processVisionImage() first.";_.set(ir.data,e)},wb:function(){if(null==ar)throw"Cannot process video frame if source video is not set";or.width===ar.videoWidth&&or.height===ar.videoHeight||(or.width=ar.videoWidth,or.height=ar.videoHeight,ir=null),sr.drawImage(ar,0,0,or.width,or.height),ir=sr.getImageData(0,0,or.width,or.height)},xb:function(){$r.bindTexture($r.TEXTURE_2D,ur),$r.texImage2D($r.TEXTURE_2D,0,$r.RGBA,$r.RGBA,$r.UNSIGNED_BYTE,ar)},Cb:function(e){k.set(hr,e>>2)},Bb:function(e){k.set(pr,e>>2)},zb:function(e){k.set(dr,e>>2)},yb:function(e){k.set(mr,e>>2)},Gb:async function(){console.log("DeepAR FootTracking initialize started."),null==lr&&(lr=new o.Foot),null==cr&&(cr=new o.VideoManager(null,ar.videoWidth,ar.videoHeight)),lr.isInitialized()||(await lr.initialize(cr,{poseEstimationWasmFilename:t.footTrackingConfig.poseEstimationWasmPath,modelFilename:t.footTrackingConfig.detectorPath,featuresFilename:t.footTrackingConfig.trackerPath,objFilename:t.footTrackingConfig.objPath,fovY:50,detection_score_t:.25,tracking_score_t:.35,footToDetect:"BOTH_FEET",filteringLevel:0,filteringShift:.5}),console.log("DeepAR FootTracking initialized!"))},Fb:function(){return null!=lr&&lr.isInitialized()},Db:function(){return fr},Ab:function(){return gr},Eb:function(){if(lr.isInitialized()){cr.preProcessWithBuffer(ir),lr.trackSync();var e=lr.getInterpolatedPose("LEFT_FOOT"),t=lr.getInterpolatedPose("RIGHT_FOOT");null!=e&&e.isDetected()?(hr=e.t(),pr=e.R(),fr=!0):fr=!1,null!=t&&t.isDetected()?(dr=t.t(),mr=t.R(),gr=!0):gr=!1}},Jb:function(){return yr.getHeight()},Kb:function(){return yr.getWidth()},Hb:function(e){k.set(vr,e>>2)},Mb:async function(){console.log("DeepAR segmentation initialize started"),null==yr&&(yr=new o.Segmentation),null==br&&(br=new o.VideoManager(null)),yr.isInitialized()||(await yr.initialize(br,{filename:qn}),console.log("DeepAR segmentation initialized"))},Lb:function(){return null!=yr&&yr.isInitialized()},Ib:function(){yr.isInitialized()&&(br.preProcessWithBuffer(ir),yr.processSync(),vr=yr.getOutput(),br.postProcess())},m:function(e){return e},Ef:Ir,ac:function(e,t,n,r){return Ir(e,t,n,r)},Ff:function(e,t,n){for(var r=R(t),a=0;25>a;++a)r=r.replace(new RegExp("\\"+"\\!@#$^&*()+=-[]/{}|:<>?,."[a],"g"),"\\"+"\\!@#$^&*()+=-[]/{}|:<>?,."[a]);for(var o in t={"%A":"%a","%B":"%b","%c":"%a %b %d %H:%M:%S %Y","%D":"%m\\/%d\\/%y","%e":"%d","%F":"%Y-%m-%d","%h":"%b","%R":"%H\\:%M","%r":"%I\\:%M\\:%S\\s%p","%T":"%H\\:%M\\:%S","%x":"%m\\/%d\\/(?:%y|%Y)","%X":"%H\\:%M\\:%S"})r=r.replace(o,t[o]);a={"%a":"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)","%b":"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)","%C":"\\d\\d","%d":"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31","%H":"\\d(?!\\d)|[0,1]\\d|20|21|22|23","%I":"\\d(?!\\d)|0\\d|10|11|12","%j":"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d","%m":"0[1-9]|[1-9](?!\\d)|10|11|12","%M":"0\\d|\\d(?!\\d)|[1-5]\\d","%n":"\\s","%p":"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.","%S":"0\\d|\\d(?!\\d)|[1-5]\\d|60","%U":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%W":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%w":"[0-6]","%y":"\\d\\d","%Y":"\\d\\d\\d\\d","%%":"%","%t":"\\s"};var s={zj:0,yj:1,Cj:2,vj:3,Dj:4,Bj:5,Aj:6,wj:7,Gj:8,Fj:9,Ej:10,xj:11};for(var i in o={zi:0,xi:1,Bi:2,Ci:3,Ai:4,vi:5,yi:6},t={xi:0,Bi:1,Ci:2,Ai:3,vi:4,yi:5,zi:6},a)r=r.replace(i,"("+i+a[i]+")");var u=[];for(a=r.indexOf("%");0<=a;a=r.indexOf("%"))u.push(r[a+1]),r=r.replace(new RegExp("\\%"+r[a+1],"g"),"");var l=new RegExp("^"+r,"i").exec(R(e));if(l){if(i=function(){function e(e,t,n){return"number"!=typeof e||isNaN(e)?t:e>=t?e<=n?e:n:t}return{year:e(S[n+20>>2]+1900,1970,9999),month:e(S[n+16>>2],0,11),day:e(S[n+12>>2],1,31),hour:e(S[n+8>>2],0,23),min:e(S[n+4>>2],0,59),ti:e(S[n>>2],0,59)}}(),a=e=>{if(0<=(e=u.indexOf(e)))return l[e+1]},(r=a("S"))&&(i.ti=parseInt(r)),(r=a("M"))&&(i.min=parseInt(r)),r=a("H"))i.hour=parseInt(r);else if(r=a("I")){var c=parseInt(r);(r=a("p"))&&(c+="P"===r.toUpperCase()[0]?12:0),i.hour=c}if((r=a("Y"))?i.year=parseInt(r):(r=a("y"))&&(c=parseInt(r),c=(r=a("C"))?c+100*parseInt(r):c+(69>c?2e3:1900),i.year=c),(r=a("m"))?i.month=parseInt(r)-1:(r=a("b"))&&(i.month=s[r.substring(0,3).toUpperCase()]||0),r=a("d"))i.day=parseInt(r);else if(r=a("j"))for(o=parseInt(r),t=xr(i.year),s=0;12>s;++s)o<=(r=wr(t?_r:Tr,s-1))+(t?_r:Tr)[s]&&(i.day=o-r);else(r=a("a"))&&(s=r.substring(0,3).toUpperCase(),(r=a("U"))?(o=o[s],t=parseInt(r),o=0===(s=new Date(i.year,0,1)).getDay()?Er(s,o+7*(t-1)):Er(s,7-s.getDay()+o+7*(t-1)),i.day=o.getDate(),i.month=o.getMonth()):(r=a("W"))&&(o=t[s],t=parseInt(r),o=1===(s=new Date(i.year,0,1)).getDay()?Er(s,o+7*(t-1)):Er(s,7-s.getDay()+1+o+7*(t-1)),i.day=o.getDate(),i.month=o.getMonth()));return i=new Date(i.year,i.month,i.day,i.hour,i.min,i.ti,0),S[n>>2]=i.getSeconds(),S[n+4>>2]=i.getMinutes(),S[n+8>>2]=i.getHours(),S[n+12>>2]=i.getDate(),S[n+16>>2]=i.getMonth(),S[n+20>>2]=i.getFullYear()-1900,S[n+24>>2]=i.getDay(),S[n+28>>2]=wr(xr(i.getFullYear())?_r:Tr,i.getMonth()-1)+i.getDate()-1,S[n+32>>2]=0,e+Sr(l[0]).length-1}return 0}};!function(){function e(e){t.asm=e.exports,b=t.asm.jg,M(),L=t.asm.Ig,U.unshift(t.asm.kg),0==--G&&(null!==H&&(clearInterval(H),H=null),K&&(e=K,K=null,e()))}function n(t){e(t.instance)}function a(e){return("function"==typeof fetch?fetch(P,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+P+"'";return e.arrayBuffer()})).catch((function(){return Q()})):Promise.resolve().then((function(){return Q()}))).then((function(e){return WebAssembly.instantiate(e,o)})).then((function(e){return e})).then(e,(function(e){g("failed to asynchronously prepare wasm: "+e),q(e)}))}var o={a:Dr};if(G++,t.instantiateWasm)try{return t.instantiateWasm(o,e)}catch(e){g("Module.instantiateWasm callback failed with error: "+e),r(e)}("function"!=typeof WebAssembly.instantiateStreaming||X()||"function"!=typeof fetch?a(n):fetch(P,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,o).then(n,(function(e){return g("wasm streaming compile failed: "+e),g("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.kg).apply(null,arguments)};var Mr=t._initialize=function(){return(Mr=t._initialize=t.asm.lg).apply(null,arguments)};t._setLicenseKey=function(){return(t._setLicenseKey=t.asm.mg).apply(null,arguments)};var Lr=t._shutdownEngine=function(){return(Lr=t._shutdownEngine=t.asm.ng).apply(null,arguments)};t._processFrameVideo=function(){return(t._processFrameVideo=t.asm.og).apply(null,arguments)},t._processFrameRawPixels=function(){return(t._processFrameRawPixels=t.asm.pg).apply(null,arguments)};var Pr=t._takeScreenshot=function(){return(Pr=t._takeScreenshot=t.asm.qg).apply(null,arguments)};t._switchEffect=function(){return(t._switchEffect=t.asm.rg).apply(null,arguments)},t._clearEffect=function(){return(t._clearEffect=t.asm.sg).apply(null,arguments)},t._showStats=function(){return(t._showStats=t.asm.tg).apply(null,arguments)},t._simulatePhysics=function(){return(t._simulatePhysics=t.asm.ug).apply(null,arguments)},t._showColliders=function(){return(t._showColliders=t.asm.vg).apply(null,arguments)},t._render=function(){return(t._render=t.asm.wg).apply(null,arguments)},t._fireTrigger=function(){return(t._fireTrigger=t.asm.xg).apply(null,arguments)},t._setFaceDetectionSensitivity=function(){return(t._setFaceDetectionSensitivity=t.asm.yg).apply(null,arguments)},t._changeParameterFloat=function(){return(t._changeParameterFloat=t.asm.zg).apply(null,arguments)},t._changeParameterBool=function(){return(t._changeParameterBool=t.asm.Ag).apply(null,arguments)},t._changeParameterVector=function(){return(t._changeParameterVector=t.asm.Bg).apply(null,arguments)},t._changeParameterTexture=function(){return(t._changeParameterTexture=t.asm.Cg).apply(null,arguments)};var Br=t._reset=function(){return(Br=t._reset=t.asm.Dg).apply(null,arguments)};t._moveGameObject=function(){return(t._moveGameObject=t.asm.Eg).apply(null,arguments)};var Ur=t._touchOccurred=function(){return(Ur=t._touchOccurred=t.asm.Fg).apply(null,arguments)};t._pushConsoleLog=function(){return(t._pushConsoleLog=t.asm.Gg).apply(null,arguments)};var zr=t._malloc=function(){return(zr=t._malloc=t.asm.Hg).apply(null,arguments)},Vr=t._free=function(){return(Vr=t._free=t.asm.Jg).apply(null,arguments)},Wr=t.setTempRet0=function(){return(Wr=t.setTempRet0=t.asm.Kg).apply(null,arguments)},jr=t._fflush=function(){return(jr=t._fflush=t.asm.Lg).apply(null,arguments)},Gr=t.___getTypeName=function(){return(Gr=t.___getTypeName=t.asm.Mg).apply(null,arguments)};t.__embind_initialize_bindings=function(){return(t.__embind_initialize_bindings=t.asm.Ng).apply(null,arguments)};var Hr=t.___funcs_on_exit=function(){return(Hr=t.___funcs_on_exit=t.asm.Og).apply(null,arguments)},Kr=t._setThrew=function(){return(Kr=t._setThrew=t.asm.Pg).apply(null,arguments)},qr=t.stackSave=function(){return(qr=t.stackSave=t.asm.Qg).apply(null,arguments)},Xr=t.stackRestore=function(){return(Xr=t.stackRestore=t.asm.Rg).apply(null,arguments)},Yr=t.stackAlloc=function(){return(Yr=t.stackAlloc=t.asm.Sg).apply(null,arguments)},Qr=t.___cxa_can_catch=function(){return(Qr=t.___cxa_can_catch=t.asm.Tg).apply(null,arguments)},Jr=t.___cxa_is_pointer_type=function(){return(Jr=t.___cxa_is_pointer_type=t.asm.Ug).apply(null,arguments)};t.dynCall_viiiij=function(){return(t.dynCall_viiiij=t.asm.Vg).apply(null,arguments)},t.dynCall_vijiiii=function(){return(t.dynCall_vijiiii=t.asm.Wg).apply(null,arguments)};var Zr=t.dynCall_j=function(){return(Zr=t.dynCall_j=t.asm.Xg).apply(null,arguments)},ea=t.dynCall_ji=function(){return(ea=t.dynCall_ji=t.asm.Yg).apply(null,arguments)},ta=t.dynCall_vij=function(){return(ta=t.dynCall_vij=t.asm.Zg).apply(null,arguments)},na=t.dynCall_iij=function(){return(na=t.dynCall_iij=t.asm._g).apply(null,arguments)};t.dynCall_iijii=function(){return(t.dynCall_iijii=t.asm.$g).apply(null,arguments)},t.dynCall_vijii=function(){return(t.dynCall_vijii=t.asm.ah).apply(null,arguments)};var ra=t.dynCall_vji=function(){return(ra=t.dynCall_vji=t.asm.bh).apply(null,arguments)},aa=t.dynCall_jii=function(){return(aa=t.dynCall_jii=t.asm.ch).apply(null,arguments)};t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.dh).apply(null,arguments)},t.dynCall_viij=function(){return(t.dynCall_viij=t.asm.eh).apply(null,arguments)};var oa,sa=t.dynCall_viijii=function(){return(sa=t.dynCall_viijii=t.asm.fh).apply(null,arguments)},ia=t.dynCall_iiiiij=function(){return(ia=t.dynCall_iiiiij=t.asm.gh).apply(null,arguments)},ua=t.dynCall_jiiii=function(){return(ua=t.dynCall_jiiii=t.asm.hh).apply(null,arguments)};function la(){0<G||(ee(B),0<G||oa||(oa=!0,t.calledRun=!0,N))||(ee(U),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),ee(V))}return t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.ih).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.jh).apply(null,arguments)},t.cwrap=Cr,K=function e(){oa||la(),oa||(K=e)},la(),e.ready});const Pb=Lb;var Bb,Ub;!function(e){e[e.Start=0]="Start",e[e.Move=1]="Move",e[e.End=2]="End"}(Bb||(Bb={})),function(e){e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(Ub||(Ub={}));var zb="DeepAR not yet initialized.",Vb=function(){function e(e){var t=this;this.module=null,this.functionsToCallOnInitialize=[],this.callbacks=e.callbacks;var n={licenseKey:e.licenseKey,canvasWidth:e.canvas.width,canvasHeight:e.canvas.height,canvas:e.canvas,segmentationModel:e.segmentationConfig&&e.segmentationConfig.modelPath||null,footTrackingConfig:Object.assign({},e.footTrackingConfig),apiObject:this.callbacks,xzimg:{Segmentation:hb,VideoManager:s,Foot:Mb},locateFile:function(t,n){return e.deeparWasmPath||n+t}};Pb(n).then((function(n){t.module=n,e.callbacks.onInitialize&&e.callbacks.onInitialize(),t.functionsToCallOnInitialize.forEach((function(e){return e()}))}))}return e.prototype.switchEffect=function(e,t,n,r){this.module?this.module.switchEffect(e,t,n,r):console.log(zb)},e.prototype.clearEffect=function(e){this.module?this.module.clearEffect(e):console.log(zb)},e.prototype.startVideo=function(e,t){this.module?(this.module.startVideo(e,t),this.module.startLoop()):console.log(zb)},e.prototype.stopVideo=function(){this.module?this.module.stopVideo():console.log(zb)},e.prototype.setVideoElement=function(e,t){this.module?(this.module.setVideoElement(e,t),this.module.startLoop()):console.log(zb)},e.prototype.shutdown=function(){this.module?this.module.shutdown():console.log(zb)},e.prototype.downloadFaceTrackingModel=function(e,t){var n=this,r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=new Uint8Array(r.response);n.module?(n.module.setFaceTrackingModel(e),t&&t()):n.functionsToCallOnInitialize.push((function(){n.module.setFaceTrackingModel(e),t&&t()}))}},r.send(null)},e.prototype.setFaceTrackingModel=function(e){var t=this;this.module?this.module.setFaceTrackingModel(e):this.functionsToCallOnInitialize.push((function(){t.module.setFaceTrackingModel(e)}))},e.prototype.showStats=function(e){this.module?this.module.showStats(e):console.log(zb)},e.prototype.simulatePhysics=function(e){this.module?this.module.simulatePhysics(e):console.log(zb)},e.prototype.showColliders=function(e){this.module?this.module.showColliders(e):console.log(zb)},e.prototype.processFrame=function(e,t,n,r){this.module?this.module.processFrameRawPixels(e,t,n,r):console.log(zb)},e.prototype.processImage=function(e){if(this.module){var t=document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});t.width=e.width,t.height=e.height,n.drawImage(e,0,0);var r=n.getImageData(0,0,t.width,t.height),a=new Uint8Array(r.data.buffer);this.processFrame(a,e.width,e.height,!1)}else console.log(zb)},e.prototype.resume=function(){this.module?this.module.startLoop():console.log(zb)},e.prototype.pause=function(){this.module?this.module.endLoop():console.log(zb)},e.prototype.changeParameterFloat=function(e,t,n,r){this.module?this.module.changeParameterFloat(e,t,n,r):console.log(zb)},e.prototype.changeParameterBool=function(e,t,n,r){this.module?this.module.changeParameterBool(e,t,n,r):console.log(zb)},e.prototype.changeParameterVector=function(e,t,n,r,a,o,s){this.module?this.module.changeParameterVector(e,t,n,r,a,o,s):console.log(zb)},e.prototype.changeParameterTexture=function(e,t,n,r){var a=this;if(this.module){var o=new Image;o.onload=function(){var r=document.createElement("canvas"),s=r.getContext("2d",{willReadFrequently:!0});r.width=o.width,r.height=o.height,s.drawImage(o,0,0);var i=s.getImageData(0,0,r.width,r.height),u=new Uint8Array(i.data.buffer),l=a.module._malloc(u.length);a.module.HEAPU8.set(u,l),a.module.changeParameterTexture(e,t,n,l,u.length,r.width,r.height)},o.src=r}else console.log(zb)},e.prototype.takeScreenshot=function(){this.module?this.module.takeScreenshot():console.log(zb)},e.prototype.setFps=function(e){this.module?this.module.setFps(e):console.log(zb)},e.prototype.moveGameObject=function(e,t){this.module?this.module.moveGameObject(e,t):console.log(zb)},e.prototype.fireTrigger=function(e){this.module?this.module.fireTrigger(e):console.log(zb)},e.prototype.touchOccurred=function(e){this.module?(e.x/=this.module.canvasWidth,e.y/=this.module.canvasHeight,this.module.touchOccurred(e)):console.log(zb)},e.prototype.startVideoRecording=function(){this.module?this.module.startVideoRecording():console.log(zb)},e.prototype.finishVideoRecording=function(e){this.module?this.module.finishVideoRecording(e):console.log(zb)},e.prototype.pushConsoleLog=function(e,t){return this.module?this.module.pushConsoleLog(e,t):(console.log(zb),!1)},e.prototype.getConsoleLogs=function(){if(this.module)return this.module.getConsoleLogs();console.log(zb)},e.prototype.setFaceDetectionSensitivity=function(e){this.module?this.module.setFaceDetectionSensitivity(e):console.log(zb)},e.prototype.setOffscreenRenderingEnabled=function(e){this.module.setOffscreenRenderingEnabled(e)},e}()})(),r.DeepAR})()));